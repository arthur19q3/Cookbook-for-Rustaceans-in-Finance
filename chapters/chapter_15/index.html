<!DOCTYPE html><html lang="en" dir="ltr" data-has-toc data-has-sidebar class="astro-fpze62lo"> <head><meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><title>作用域规则和生命周期 | Cookbook for Rustaceans in Finance / Rust 量化金融开发指南</title><link rel="canonical"/><link rel="shortcut icon" href="/favicon.svg" type="image/svg+xml"/><meta name="generator" content="Astro v4.3.3"/><meta name="generator" content="Starlight v0.17.3"/><meta property="og:title" content="作用域规则和生命周期"/><meta property="og:type" content="article"/><meta property="og:url"/><meta property="og:locale" content="en"/><meta property="og:description"/><meta property="og:site_name" content="Cookbook for Rustaceans in Finance / Rust 量化金融开发指南"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:title" content="作用域规则和生命周期"/><meta name="twitter:description"/><script>
	window.StarlightThemeProvider = (() => {
		const storedTheme =
			typeof localStorage !== 'undefined' && localStorage.getItem('starlight-theme');
		const theme =
			storedTheme ||
			(window.matchMedia('(prefers-color-scheme: light)').matches ? 'light' : 'dark');
		document.documentElement.dataset.theme = theme === 'light' ? 'light' : 'dark';
		return {
			updatePickers(theme = storedTheme || 'auto') {
				document.querySelectorAll('starlight-theme-select').forEach((picker) => {
					const select = picker.querySelector('select');
					if (select) select.value = theme;
					/** @type {HTMLTemplateElement | null} */
					const tmpl = document.querySelector(`#theme-icons`);
					const newIcon = tmpl && tmpl.content.querySelector('.' + theme);
					if (newIcon) {
						const oldIcon = picker.querySelector('svg.label-icon');
						if (oldIcon) {
							oldIcon.replaceChildren(...newIcon.cloneNode(true).childNodes);
						}
					}
				});
			},
		};
	})();
</script><template id="theme-icons"><svg aria-hidden="true" class="light astro-xrndq6a6" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M5 12a1 1 0 0 0-1-1H3a1 1 0 0 0 0 2h1a1 1 0 0 0 1-1Zm.64 5-.71.71a1 1 0 0 0 0 1.41 1 1 0 0 0 1.41 0l.71-.71A1 1 0 0 0 5.64 17ZM12 5a1 1 0 0 0 1-1V3a1 1 0 0 0-2 0v1a1 1 0 0 0 1 1Zm5.66 2.34a1 1 0 0 0 .7-.29l.71-.71a1 1 0 1 0-1.41-1.41l-.66.71a1 1 0 0 0 0 1.41 1 1 0 0 0 .66.29Zm-12-.29a1 1 0 0 0 1.41 0 1 1 0 0 0 0-1.41l-.71-.71a1.004 1.004 0 1 0-1.43 1.41l.73.71ZM21 11h-1a1 1 0 0 0 0 2h1a1 1 0 0 0 0-2Zm-2.64 6A1 1 0 0 0 17 18.36l.71.71a1 1 0 0 0 1.41 0 1 1 0 0 0 0-1.41l-.76-.66ZM12 6.5a5.5 5.5 0 1 0 5.5 5.5A5.51 5.51 0 0 0 12 6.5Zm0 9a3.5 3.5 0 1 1 0-7 3.5 3.5 0 0 1 0 7Zm0 3.5a1 1 0 0 0-1 1v1a1 1 0 0 0 2 0v-1a1 1 0 0 0-1-1Z"/></svg> <svg aria-hidden="true" class="dark astro-xrndq6a6" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M21.64 13a1 1 0 0 0-1.05-.14 8.049 8.049 0 0 1-3.37.73 8.15 8.15 0 0 1-8.14-8.1 8.59 8.59 0 0 1 .25-2A1 1 0 0 0 8 2.36a10.14 10.14 0 1 0 14 11.69 1 1 0 0 0-.36-1.05Zm-9.5 6.69A8.14 8.14 0 0 1 7.08 5.22v.27a10.15 10.15 0 0 0 10.14 10.14 9.784 9.784 0 0 0 2.1-.22 8.11 8.11 0 0 1-7.18 4.32v-.04Z"/></svg> <svg aria-hidden="true" class="auto astro-xrndq6a6" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M21 14h-1V7a3 3 0 0 0-3-3H7a3 3 0 0 0-3 3v7H3a1 1 0 0 0-1 1v2a3 3 0 0 0 3 3h14a3 3 0 0 0 3-3v-2a1 1 0 0 0-1-1ZM6 7a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v7H6V7Zm14 10a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1v-1h16v1Z"/></svg> </template><link rel="stylesheet" href="/_astro/index.4lckRRHb.css" /><script type="module" src="/_astro/hoisted.RLbdawI7.js"></script>
<script type="module" src="/_astro/page.X_0NJa-z.js"></script></head> <body class="astro-fpze62lo"> <a href="#_top" class="astro-byjsuuaw">Skip to content</a>  <div class="page sl-flex astro-yxqmbg7i"> <header class="header astro-yxqmbg7i"><div class="header sl-flex astro-cyrhhlnw"> <div class="title-wrapper sl-flex astro-cyrhhlnw"> <a href="/" class="site-title sl-flex astro-ylanx5mn">  <span class="astro-ylanx5mn"> Cookbook for Rustaceans in Finance / Rust 量化金融开发指南 </span> </a>  </div> <div class="sl-flex astro-cyrhhlnw"> <site-search data-translations="{&#34;placeholder&#34;:&#34;Search&#34;}" class="astro-usz5hgcn"> <button data-open-modal disabled class="astro-usz5hgcn">  <svg aria-label="Search" class="astro-usz5hgcn astro-xrndq6a6" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M21.71 20.29 18 16.61A9 9 0 1 0 16.61 18l3.68 3.68a.999.999 0 0 0 1.42 0 1 1 0 0 0 0-1.39ZM11 18a7 7 0 1 1 0-14 7 7 0 0 1 0 14Z"/></svg>  <span class="sl-hidden md:sl-block astro-usz5hgcn" aria-hidden="true">Search</span> <svg aria-label="(Press / to Search)" class="sl-hidden md:sl-block astro-usz5hgcn astro-xrndq6a6" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M17 2H7a5 5 0 0 0-5 5v10a5 5 0 0 0 5 5h10a5 5 0 0 0 5-5V7a5 5 0 0 0-5-5Zm3 15a3 3 0 0 1-3 3H7a3 3 0 0 1-3-3V7a3 3 0 0 1 3-3h10a3 3 0 0 1 3 3v10Z"/><path d="M15.293 6.707a1 1 0 1 1 1.414 1.414l-8.485 8.486a1 1 0 0 1-1.414-1.415l8.485-8.485Z"/></svg>  </button> <dialog style="padding:0" aria-label="Search" class="astro-usz5hgcn"> <div class="dialog-frame sl-flex astro-usz5hgcn">  <button data-close-modal class="sl-flex md:sl-hidden astro-usz5hgcn"> Cancel </button> <div class="search-container astro-usz5hgcn"> <div id="starlight__search" class="astro-usz5hgcn"></div> </div> </div> </dialog> </site-search>    </div> <div class="sl-hidden md:sl-flex right-group astro-cyrhhlnw"> <div class="sl-flex social-icons astro-cyrhhlnw"> <a href="https://github.com/withastro/starlight" rel="me" class="sl-flex astro-3daxh4jc"><span class="sr-only astro-3daxh4jc">GitHub</span><svg aria-hidden="true" class="astro-3daxh4jc astro-xrndq6a6" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M12 .3a12 12 0 0 0-3.8 23.38c.6.12.83-.26.83-.57L9 21.07c-3.34.72-4.04-1.61-4.04-1.61-.55-1.39-1.34-1.76-1.34-1.76-1.08-.74.09-.73.09-.73 1.2.09 1.83 1.24 1.83 1.24 1.08 1.83 2.81 1.3 3.5 1 .1-.78.42-1.31.76-1.61-2.67-.3-5.47-1.33-5.47-5.93 0-1.31.47-2.38 1.24-3.22-.14-.3-.54-1.52.1-3.18 0 0 1-.32 3.3 1.23a11.5 11.5 0 0 1 6 0c2.28-1.55 3.29-1.23 3.29-1.23.64 1.66.24 2.88.12 3.18a4.65 4.65 0 0 1 1.23 3.22c0 4.61-2.8 5.63-5.48 5.92.42.36.81 1.1.81 2.22l-.01 3.29c0 .31.2.69.82.57A12 12 0 0 0 12 .3Z"/></svg> </a> </div> <starlight-theme-select>  <label style="--sl-select-width: 6.25em" class="astro-kc6u4lxd"> <span class="sr-only astro-kc6u4lxd">Select theme</span> <svg aria-hidden="true" class="icon label-icon astro-kc6u4lxd astro-xrndq6a6" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M21 14h-1V7a3 3 0 0 0-3-3H7a3 3 0 0 0-3 3v7H3a1 1 0 0 0-1 1v2a3 3 0 0 0 3 3h14a3 3 0 0 0 3-3v-2a1 1 0 0 0-1-1ZM6 7a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v7H6V7Zm14 10a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1v-1h16v1Z"/></svg>  <select value="auto" class="astro-kc6u4lxd"> <option value="dark" class="astro-kc6u4lxd">Dark</option><option value="light" class="astro-kc6u4lxd">Light</option><option value="auto" selected="true" class="astro-kc6u4lxd">Auto</option> </select> <svg aria-hidden="true" class="icon caret astro-kc6u4lxd astro-xrndq6a6" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M17 9.17a1 1 0 0 0-1.41 0L12 12.71 8.46 9.17a1 1 0 1 0-1.41 1.42l4.24 4.24a1.002 1.002 0 0 0 1.42 0L17 10.59a1.002 1.002 0 0 0 0-1.42Z"/></svg>  </label>  </starlight-theme-select>  <script>
	StarlightThemeProvider.updatePickers();
</script>   </div> </div> </header> <nav class="sidebar astro-yxqmbg7i" aria-label="Main"> <starlight-menu-button class="astro-eouth4v3"> <button aria-expanded="false" aria-label="Menu" aria-controls="starlight__sidebar" class="sl-flex md:sl-hidden astro-eouth4v3"> <svg aria-hidden="true" class="astro-eouth4v3 astro-xrndq6a6" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M3 8h18a1 1 0 1 0 0-2H3a1 1 0 0 0 0 2Zm18 8H3a1 1 0 0 0 0 2h18a1 1 0 0 0 0-2Zm0-5H3a1 1 0 0 0 0 2h18a1 1 0 0 0 0-2Z"/></svg>  </button> </starlight-menu-button>    <div id="starlight__sidebar" class="sidebar-pane astro-yxqmbg7i"> <div class="sidebar-content sl-flex astro-yxqmbg7i"> <ul class="top-level astro-4mcqxzkb"> <li class="astro-4mcqxzkb"> <details open class="astro-4mcqxzkb"> <summary class="astro-4mcqxzkb"> <div class="group-label astro-4mcqxzkb"> <span class="large astro-4mcqxzkb">PART I 基础部分 - 量化语境下的Rust编程基础</span>  </div> <svg aria-hidden="true" class="caret astro-4mcqxzkb astro-xrndq6a6" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.25rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg>  </summary> <ul class="astro-4mcqxzkb"> <li class="astro-4mcqxzkb"> <a href="/chapters/chapter_1" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">1. Rust 语言入门101</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_2/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">2. 格式化输出</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_3/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">3. 原生类型</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_4/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">4. 自定义类型 Struct &amp; Enum</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_5/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">5. 标准库类型</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_6/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">6. 变量和作用域</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_7/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">7. 类型系统</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_8/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">8. 类型转换</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_9/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">9. 流程控制</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_10/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">10. 函数、方法和闭包</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_11/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">11. 模块</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_12/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">12. Cargo 的进阶使用</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_13/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">13. 属性(Attributes)</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_14/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">14. 泛型进阶(Advanced Generic Type Usage)</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_15/" aria-current="page" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">15. 作用域规则和生命周期</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_16/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">16. 错误处理进阶(Advanced Error handling)</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_17/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">17. 特性(trait)详解</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_18/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">18. 创建自定义宏</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_19/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">19. 时间处理</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_20/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">20. Redis、爬虫、交易日库</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_21/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">21. 线程和管道</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_22/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">22. 文件处理</span>  </a> </li> </ul>  </details> </li><li class="astro-4mcqxzkb"> <details open class="astro-4mcqxzkb"> <summary class="astro-4mcqxzkb"> <div class="group-label astro-4mcqxzkb"> <span class="large astro-4mcqxzkb">PART II 进阶部分 - 量化实战</span>  </div> <svg aria-hidden="true" class="caret astro-4mcqxzkb astro-xrndq6a6" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.25rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg>  </summary> <ul class="astro-4mcqxzkb"> <li class="astro-4mcqxzkb"> <a href="/chapters/chapter_23/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">23. Polars 入门</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_24/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">24. 时序数据库 Clickhouse</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_25/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">25. Unsafe【未完成】</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_26/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">26. 文档和测试【未完成】</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_27/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">27. 常见技术指标及其实现【本章代码未添加】</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_28/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">28. 统计模型【未完成】</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_29/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">29. 引擎系统【未完成】</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_30/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">30. 日志系统【未完成】</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_31/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">31. 投资组合管理【未完成】</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_32/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">32. 量化计量经济学【未完成】</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_33/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">33. 限价指令簿【未完成】</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_34/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">34. 最优配置和执行【未完成】</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_35/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">35. 信息学、监管、风控【未完成】</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_36/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">36. 机器学习【未完成】</span>  </a> </li> </ul>  </details> </li> </ul>  <div class="md:sl-hidden"> <div class="mobile-preferences sl-flex astro-vfur2aw5"> <div class="sl-flex social-icons astro-vfur2aw5"> <a href="https://github.com/withastro/starlight" rel="me" class="sl-flex astro-3daxh4jc"><span class="sr-only astro-3daxh4jc">GitHub</span><svg aria-hidden="true" class="astro-3daxh4jc astro-xrndq6a6" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M12 .3a12 12 0 0 0-3.8 23.38c.6.12.83-.26.83-.57L9 21.07c-3.34.72-4.04-1.61-4.04-1.61-.55-1.39-1.34-1.76-1.34-1.76-1.08-.74.09-.73.09-.73 1.2.09 1.83 1.24 1.83 1.24 1.08 1.83 2.81 1.3 3.5 1 .1-.78.42-1.31.76-1.61-2.67-.3-5.47-1.33-5.47-5.93 0-1.31.47-2.38 1.24-3.22-.14-.3-.54-1.52.1-3.18 0 0 1-.32 3.3 1.23a11.5 11.5 0 0 1 6 0c2.28-1.55 3.29-1.23 3.29-1.23.64 1.66.24 2.88.12 3.18a4.65 4.65 0 0 1 1.23 3.22c0 4.61-2.8 5.63-5.48 5.92.42.36.81 1.1.81 2.22l-.01 3.29c0 .31.2.69.82.57A12 12 0 0 0 12 .3Z"/></svg> </a> </div> <starlight-theme-select>  <label style="--sl-select-width: 6.25em" class="astro-kc6u4lxd"> <span class="sr-only astro-kc6u4lxd">Select theme</span> <svg aria-hidden="true" class="icon label-icon astro-kc6u4lxd astro-xrndq6a6" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M21 14h-1V7a3 3 0 0 0-3-3H7a3 3 0 0 0-3 3v7H3a1 1 0 0 0-1 1v2a3 3 0 0 0 3 3h14a3 3 0 0 0 3-3v-2a1 1 0 0 0-1-1ZM6 7a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v7H6V7Zm14 10a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1v-1h16v1Z"/></svg>  <select value="auto" class="astro-kc6u4lxd"> <option value="dark" class="astro-kc6u4lxd">Dark</option><option value="light" class="astro-kc6u4lxd">Light</option><option value="auto" selected="true" class="astro-kc6u4lxd">Auto</option> </select> <svg aria-hidden="true" class="icon caret astro-kc6u4lxd astro-xrndq6a6" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M17 9.17a1 1 0 0 0-1.41 0L12 12.71 8.46 9.17a1 1 0 1 0-1.41 1.42l4.24 4.24a1.002 1.002 0 0 0 1.42 0L17 10.59a1.002 1.002 0 0 0 0-1.42Z"/></svg>  </label>  </starlight-theme-select>  <script>
	StarlightThemeProvider.updatePickers();
</script>   </div>  </div> </div> </div> </nav> <div class="main-frame astro-yxqmbg7i">  <div class="lg:sl-flex astro-3vvvt7cz"> <aside class="right-sidebar-container astro-3vvvt7cz"> <div class="right-sidebar astro-3vvvt7cz"> <div class="lg:sl-hidden astro-f63w33c6"><mobile-starlight-toc data-min-h="2" data-max-h="3" class="astro-q2mrqdva"><nav aria-labelledby="starlight__on-this-page--mobile" class="astro-q2mrqdva"><details id="starlight__mobile-toc" class="astro-q2mrqdva"><summary id="starlight__on-this-page--mobile" class="sl-flex astro-q2mrqdva"><div class="toggle sl-flex astro-q2mrqdva">On this page<svg aria-hidden="true" class="caret astro-q2mrqdva astro-xrndq6a6" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg> </div><span class="display-current astro-q2mrqdva"></span></summary><div class="dropdown astro-q2mrqdva"><ul class="isMobile astro-acifyk5h" style="--depth: 0;"> <li class="astro-acifyk5h" style="--depth: 0;"> <a href="#_top" class="astro-acifyk5h" style="--depth: 0;"> <span class="astro-acifyk5h" style="--depth: 0;">Overview</span> </a>  </li><li class="astro-acifyk5h" style="--depth: 0;"> <a href="#151-raiiresource-acquisition-is-initialization" class="astro-acifyk5h" style="--depth: 0;"> <span class="astro-acifyk5h" style="--depth: 0;">15.1 RAII(Resource Acquisition Is Initialization)</span> </a>  </li><li class="astro-acifyk5h" style="--depth: 0;"> <a href="#152-析构函数--drop-trait" class="astro-acifyk5h" style="--depth: 0;"> <span class="astro-acifyk5h" style="--depth: 0;">15.2 析构函数 &amp; Drop trait</span> </a>  </li><li class="astro-acifyk5h" style="--depth: 0;"> <a href="#153-生命周期lifetimes详解" class="astro-acifyk5h" style="--depth: 0;"> <span class="astro-acifyk5h" style="--depth: 0;">15.3 生命周期（Lifetimes）详解</span> </a> <ul class="isMobile astro-acifyk5h" style="--depth: 1;"> <li class="astro-acifyk5h" style="--depth: 1;"> <a href="#1532-生命周期和结构体" class="astro-acifyk5h" style="--depth: 1;"> <span class="astro-acifyk5h" style="--depth: 1;">15.3.2 生命周期和结构体</span> </a>  </li><li class="astro-acifyk5h" style="--depth: 1;"> <a href="#1533-static" class="astro-acifyk5h" style="--depth: 1;"> <span class="astro-acifyk5h" style="--depth: 1;">15.3.3 static</span> </a>  </li><li class="astro-acifyk5h" style="--depth: 1;"> <a href="#案例-static-在量化金融中的作用" class="astro-acifyk5h" style="--depth: 1;"> <span class="astro-acifyk5h" style="--depth: 1;">案例 &#39;static 在量化金融中的作用</span> </a>  </li> </ul>  </li> </ul> </div></details></nav></mobile-starlight-toc></div><div class="right-sidebar-panel sl-hidden lg:sl-block astro-f63w33c6"><div class="sl-container astro-f63w33c6"><starlight-toc data-min-h="2" data-max-h="3"><nav aria-labelledby="starlight__on-this-page"><h2 id="starlight__on-this-page">On this page</h2><ul class="astro-acifyk5h" style="--depth: 0;"> <li class="astro-acifyk5h" style="--depth: 0;"> <a href="#_top" class="astro-acifyk5h" style="--depth: 0;"> <span class="astro-acifyk5h" style="--depth: 0;">Overview</span> </a>  </li><li class="astro-acifyk5h" style="--depth: 0;"> <a href="#151-raiiresource-acquisition-is-initialization" class="astro-acifyk5h" style="--depth: 0;"> <span class="astro-acifyk5h" style="--depth: 0;">15.1 RAII(Resource Acquisition Is Initialization)</span> </a>  </li><li class="astro-acifyk5h" style="--depth: 0;"> <a href="#152-析构函数--drop-trait" class="astro-acifyk5h" style="--depth: 0;"> <span class="astro-acifyk5h" style="--depth: 0;">15.2 析构函数 &amp; Drop trait</span> </a>  </li><li class="astro-acifyk5h" style="--depth: 0;"> <a href="#153-生命周期lifetimes详解" class="astro-acifyk5h" style="--depth: 0;"> <span class="astro-acifyk5h" style="--depth: 0;">15.3 生命周期（Lifetimes）详解</span> </a> <ul class="astro-acifyk5h" style="--depth: 1;"> <li class="astro-acifyk5h" style="--depth: 1;"> <a href="#1532-生命周期和结构体" class="astro-acifyk5h" style="--depth: 1;"> <span class="astro-acifyk5h" style="--depth: 1;">15.3.2 生命周期和结构体</span> </a>  </li><li class="astro-acifyk5h" style="--depth: 1;"> <a href="#1533-static" class="astro-acifyk5h" style="--depth: 1;"> <span class="astro-acifyk5h" style="--depth: 1;">15.3.3 static</span> </a>  </li><li class="astro-acifyk5h" style="--depth: 1;"> <a href="#案例-static-在量化金融中的作用" class="astro-acifyk5h" style="--depth: 1;"> <span class="astro-acifyk5h" style="--depth: 1;">案例 &#39;static 在量化金融中的作用</span> </a>  </li> </ul>  </li> </ul> </nav></starlight-toc></div></div> </div> </aside> <div class="main-pane astro-3vvvt7cz">  <main data-pagefind-body lang="en" dir="ltr" class="astro-fpze62lo">    <div class="content-panel astro-vo2eo5fg"> <div class="sl-container astro-vo2eo5fg"> <h1 id="_top" class="astro-daoses2n">作用域规则和生命周期</h1>  </div> </div>  <div class="content-panel astro-vo2eo5fg"> <div class="sl-container astro-vo2eo5fg"> <div class="sl-markdown-content"> <p>Rust的作用域规则和生命周期是该语言中的关键概念，用于管理变量的生命周期、引用的有效性和资源的释放。</p>
<p>Rust的作用域规则和生命周期是该语言中的关键概念，用于管理变量的生命周期、引用的有效性和资源的释放。让我们更详细地了解一下这些概念。</p>
<ol>
<li><strong>变量的作用域规则</strong>：</li>
</ol>
<p>Rust中的变量有明确的作用域，这意味着变量只在其定义的作用域内可见和可访问。作用域通常由大括号 <code dir="auto">{}</code> 定义，例如函数、代码块或结构体定义。</p>
<div class="expressive-code"><link rel="stylesheet" href="/_astro/ec.usa2f.css"><script type="module" src="/_astro/ec.sgewm.js"></script><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">fn</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">main</span><span style="--0:#D6DEEB;--1:#403F53">() {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">x</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#F78C6C;--1:#AA0982">42</span><span style="--0:#D6DEEB;--1:#403F53">;</span><span style="--0:#809191;--1:#5E6578"> // x 在 main 函数的作用域内可见</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#82AAFF;--1:#3C63B3">println!</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">x = {}</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#C5E478;--1:#3C63B3">x</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">}</span><span style="--0:#809191;--1:#5E6578"> // x 的作用域在这里结束，它被销毁</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="fn main() {    let x = 42; // x 在 main 函数的作用域内可见    println!(&#x22;x = {}&#x22;, x);} // x 的作用域在这里结束，它被销毁"><div></div></button></div></figure></div>
<ol start="2">
<li><strong>引用和借用</strong>：</li>
</ol>
<p>在Rust中，引用是一种允许你借用(或者说访问)数据而不拥有它的方式。引用有两种类型：可变引用和不可变引用。</p>
<ul>
<li>不可变引用(<code dir="auto">&#x26;T</code>)：允许多个只读引用同时存在，但不允许修改数据。</li>
<li>可变引用(<code dir="auto">&#x26;mut T</code>)：允许单一可变引用，但不允许同时存在多个引用。</li>
</ul>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">fn</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">main</span><span style="--0:#D6DEEB;--1:#403F53">() {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">mut</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">x</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#F78C6C;--1:#AA0982">42</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">y</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#097174">&#x26;</span><span style="--0:#C5E478;--1:#3C63B3">x</span><span style="--0:#D6DEEB;--1:#403F53">;</span><span style="--0:#809191;--1:#5E6578"> // 不可变引用</span></div><div class="ec-line"><span style="--0:#809191;--1:#5E6578">    // let z = &#x26;mut x; // 错误，不能同时存在可变和不可变引用</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#82AAFF;--1:#3C63B3">println!</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">x = {}</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#C5E478;--1:#3C63B3">x</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">}</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="fn main() {    let mut x = 42;    let y = &#x26;x; // 不可变引用    // let z = &#x26;mut x; // 错误，不能同时存在可变和不可变引用    println!(&#x22;x = {}&#x22;, x);}"><div></div></button></div></figure></div>
<ol start="3">
<li><strong>生命周期</strong>：</li>
</ol>
<p>生命周期(Lifetime)是一种用于描述引用的有效范围的标记，它确保引用在其生命周期内有效。生命周期参数通常以单引号 <code dir="auto">'</code> 开头，例如 <code dir="auto">'a</code>。</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">fn</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">longest</span><span style="--0:#D6DEEB;--1:#403F53">&#x3C;'a>(</span><span style="--0:#C5E478;--1:#3C63B3">s1</span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#097174">&#x26;</span><span style="--0:#D6DEEB;--1:#403F53">'a str, </span><span style="--0:#C5E478;--1:#3C63B3">s2</span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#097174">&#x26;</span><span style="--0:#D6DEEB;--1:#403F53">'a str) </span><span style="--0:#7FDBCA;--1:#097174">-></span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#097174">&#x26;</span><span style="--0:#D6DEEB;--1:#403F53">'a str {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">if</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">s1</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">len</span><span style="--0:#D6DEEB;--1:#403F53">() > </span><span style="--0:#C5E478;--1:#3C63B3">s2</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">len</span><span style="--0:#D6DEEB;--1:#403F53">() {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        </span><span style="--0:#C5E478;--1:#3C63B3">s1</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    } </span><span style="--0:#C792EA;--1:#8D46B4">else</span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        </span><span style="--0:#C5E478;--1:#3C63B3">s2</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    }</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">}</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">fn</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">main</span><span style="--0:#D6DEEB;--1:#403F53">() {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">s1</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">Hello</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">s2</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">World</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">result</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">longest</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#C5E478;--1:#3C63B3">s1</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#C5E478;--1:#3C63B3">s2</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#82AAFF;--1:#3C63B3">println!</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">The longest string is: {}</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#C5E478;--1:#3C63B3">result</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">}</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="fn longest<&#x27;a>(s1: &#x26;&#x27;a str, s2: &#x26;&#x27;a str) -> &#x26;&#x27;a str {    if s1.len() > s2.len() {        s1    } else {        s2    }}fn main() {    let s1 = &#x22;Hello&#x22;;    let s2 = &#x22;World&#x22;;    let result = longest(s1, s2);    println!(&#x22;The longest string is: {}&#x22;, result);}"><div></div></button></div></figure></div>
<p>在上述示例中，<code dir="auto">longest</code> 函数的参数和返回值都有相同的生命周期 <code dir="auto">'a</code>，这表示函数返回的引用的生命周期与输入参数中更长的那个引用的生命周期相同。这是通过生命周期参数 <code dir="auto">'a</code> 来表达的。</p>
<ol start="4">
<li><strong>生命周期注解</strong>：</li>
</ol>
<p>有时，编译器无法自动确定引用的生命周期关系，因此我们需要使用生命周期注解来帮助编译器理解引用的关系。生命周期注解的语法是将生命周期参数放在函数签名中，并使用单引号标识，例如 <code dir="auto">'a</code>。</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">fn</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">first_word</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#C5E478;--1:#3C63B3">s</span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#097174">&#x26;</span><span style="--0:#D6DEEB;--1:#403F53">str) </span><span style="--0:#7FDBCA;--1:#097174">-></span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#097174">&#x26;</span><span style="--0:#D6DEEB;--1:#403F53">str {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">bytes</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">s</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">as_bytes</span><span style="--0:#D6DEEB;--1:#403F53">();</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">for</span><span style="--0:#D6DEEB;--1:#403F53"> (</span><span style="--0:#C5E478;--1:#3C63B3">i</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#7FDBCA;--1:#097174">&#x26;</span><span style="--0:#C5E478;--1:#3C63B3">byte</span><span style="--0:#D6DEEB;--1:#403F53">) </span><span style="--0:#C792EA;--1:#8D46B4">in</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">bytes</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">iter</span><span style="--0:#D6DEEB;--1:#403F53">()</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">enumerate</span><span style="--0:#D6DEEB;--1:#403F53">() {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        </span><span style="--0:#C792EA;--1:#8D46B4">if</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">byte</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">==</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#9B504E">b' '</span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">            </span><span style="--0:#C792EA;--1:#8D46B4">return</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#097174">&#x26;</span><span style="--0:#C5E478;--1:#3C63B3">s</span><span style="--0:#D6DEEB;--1:#403F53">[</span><span style="--0:#F78C6C;--1:#AA0982">0</span><span style="--0:#7FDBCA;--1:#097174">..</span><span style="--0:#C5E478;--1:#3C63B3">i</span><span style="--0:#D6DEEB;--1:#403F53">];</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        }</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    }</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#7FDBCA;--1:#097174">&#x26;</span><span style="--0:#C5E478;--1:#3C63B3">s</span><span style="--0:#D6DEEB;--1:#403F53">[</span><span style="--0:#7FDBCA;--1:#097174">..</span><span style="--0:#D6DEEB;--1:#403F53">]</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">}</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="fn first_word(s: &#x26;str) -> &#x26;str {    let bytes = s.as_bytes();    for (i, &#x26;byte) in bytes.iter().enumerate() {        if byte == b&#x27; &#x27; {            return &#x26;s[0..i];        }    }    &#x26;s[..]}"><div></div></button></div></figure></div>
<p>在上述示例中，<code dir="auto">&#x26;str</code> 类型的引用 <code dir="auto">s</code> 有一个生命周期，但编译器可以自动推断出来。如果编译器无法自动推断，我们可以使用生命周期注解来明确指定引用之间的生命周期关系。</p>
<p>这些是Rust中作用域规则和生命周期的基本概念。它们帮助编译器进行正确性检查，防止数据竞争和资源泄漏，使Rust成为一门安全的系统编程语言。</p>
<h2 id="151-raiiresource-acquisition-is-initialization">15.1 RAII(Resource Acquisition Is Initialization)</h2>
<p>资源获取即初始化 / RAII(Resource Acquisition Is Initialization)是一种编程范式，主要用于C++和Rust等编程语言中，旨在通过对象的生命周期来管理资源的获取和释放。RAII的核心思想是资源的获取应该在对象的构造阶段完成，而资源的释放应该在对象的析构阶段完成，从而确保资源的正确管理，避免资源泄漏。</p>
<p>在金融领域的语境中，RAII(Resource Acquisition Is Initialization)的原则可以理解为资源的获取和释放与金融数据对象的生命周期紧密相关，以确保金融数据的正确管理和资源的合理使用。下面详细解释在金融背景下应用RAII的重要概念和原则：</p>
<ol>
<li>
<p><strong>资源的获取和释放绑定到金融数据对象的生命周期：</strong> 在金融领域，资源可以是金融数据、交易订单、数据库连接等，这些资源的获取和释放应该与金融数据对象的生命周期紧密绑定。这确保了资源的正确使用，避免了资源泄漏或错误的资源释放。</p>
</li>
<li>
<p><strong>金融数据对象的构造函数负责资源的获取：</strong> 在金融数据对象的构造函数中，应该负责获取相关资源。例如，可以在金融数据对象创建时从数据库中加载数据或建立网络连接。</p>
</li>
<li>
<p><strong>金融数据对象的析构函数负责资源的释放：</strong> 金融数据对象的析构函数应该负责释放与其关联的资源。这可能包括关闭数据库连接、释放内存或提交交易订单。</p>
</li>
<li>
<p><strong>自动化管理：</strong> RAII的一个关键特点是资源管理的自动化。当金融数据对象超出其作用域(例如，离开函数或代码块)时，析构函数会自动调用，确保资源被正确释放，从而减少了人为错误的可能性。</p>
</li>
<li>
<p><strong>异常安全性：</strong> 在金融领域，异常处理非常重要。RAII确保了异常安全性，即使在处理金融数据时发生异常，也会确保相关资源的正确释放，从而防止数据不一致或资源泄漏。</p>
</li>
<li>
<p><strong>嵌套资源管理：</strong> 金融数据处理通常涉及多层嵌套，例如，一个交易可能包含多个订单，每个订单可能涉及不同的金融工具。RAII可以帮助管理这些嵌套资源，确保它们在正确的时间被获取和释放。</p>
</li>
<li>
<p><strong>通用性：</strong> RAII原则在金融领域的通用性强，可以应用于不同类型的金融数据和资源管理，包括证券交易、风险管理、数据分析等各个方面，以确保代码的可靠性和安全性。</p>
</li>
</ol>
<p>在C++中，RAII通常使用类和析构函数来实现。在Rust中，RAII的概念与C++类似，但使用了所有权和生命周期系统来确保资源的安全管理，而不需要显式的析构函数。</p>
<p>总之，RAII是一种重要的资源管理范式，它通过对象的生命周期来自动化资源的获取和释放，确保资源的正确管理和异常安全性。这使得代码更加可靠、易于维护，同时减少了资源泄漏和内存泄漏的风险。</p>
<h2 id="152-析构函数--drop-trait">15.2 析构函数 &#x26; Drop trait</h2>
<p>在Rust中，析构函数的概念与一些其他编程语言(如C++)中的析构函数不同。Rust中<strong>没有传统的析构函数</strong>，而是通过<code dir="auto">Drop</code> trait来实现资源的释放和清理操作。让我详细解释一下<code dir="auto">Drop</code> trait以及如何在Rust中使用它来管理资源。</p>
<p><code dir="auto">Drop</code> trait是Rust中的一种特殊trait，用于定义资源释放的逻辑。当拥有实现<code dir="auto">Drop</code> trait的类型的值的生命周期结束时(例如，离开作用域或通过<code dir="auto">std::mem::drop</code>函数手动释放)，Rust会自动调用这个类型的<code dir="auto">drop</code>方法，以进行资源清理和释放。</p>
<p><code dir="auto">Drop</code> trait的定义如下：</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">pub</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">trait</span><span style="--0:#D6DEEB;--1:#403F53"> Drop {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">fn</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">drop</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#7FDBCA;--1:#097174">&#x26;</span><span style="--0:#C792EA;--1:#8D46B4">mut</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#097174">self</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">}</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="pub trait Drop {    fn drop(&#x26;mut self);}"><div></div></button></div></figure></div>
<p><code dir="auto">Drop</code> trait只有一个方法，即<code dir="auto">drop</code>方法，它接受一个可变引用<code dir="auto">&#x26;mut self</code>，在其中编写资源的释放逻辑。</p>
<p><strong>示例</strong>：以下是一个简单示例，展示如何使用<code dir="auto">Drop</code> trait来管理资源。在这个示例中，我们定义一个自定义结构<code dir="auto">FileHandler</code>，用于打开文件，并在对象销毁时关闭文件：</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">use</span><span style="--0:#D6DEEB;--1:#403F53"> std</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#D6DEEB;--1:#403F53">fs</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#D6DEEB;--1:#403F53">File;</span></div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">use</span><span style="--0:#D6DEEB;--1:#403F53"> std</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#D6DEEB;--1:#403F53">io</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#D6DEEB;--1:#403F53">Write;</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">struct</span><span style="--0:#D6DEEB;--1:#403F53"> FileHandler {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C5E478;--1:#3C63B3">file</span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#D6DEEB;--1:#403F53"> File,</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">}</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">impl</span><span style="--0:#D6DEEB;--1:#403F53"> FileHandler {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">fn</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">new</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#C5E478;--1:#3C63B3">filename</span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#097174">&#x26;</span><span style="--0:#D6DEEB;--1:#403F53">str) </span><span style="--0:#7FDBCA;--1:#097174">-></span><span style="--0:#D6DEEB;--1:#403F53"> std</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#D6DEEB;--1:#403F53">io</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#D6DEEB;--1:#403F53">Result&#x3C;</span><span style="--0:#7FDBCA;--1:#097174">Self</span><span style="--0:#D6DEEB;--1:#403F53">> {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">file</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> File</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#82AAFF;--1:#3C63B3">create</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#C5E478;--1:#3C63B3">filename</span><span style="--0:#D6DEEB;--1:#403F53">)</span><span style="--0:#7FDBCA;--1:#097174">?</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        Ok(FileHandler { </span><span style="--0:#C5E478;--1:#3C63B3">file</span><span style="--0:#D6DEEB;--1:#403F53"> })</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    }</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">fn</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">write_data</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#7FDBCA;--1:#097174">&#x26;</span><span style="--0:#C792EA;--1:#8D46B4">mut</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#097174">self</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#C5E478;--1:#3C63B3">data</span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#097174">&#x26;</span><span style="--0:#D6DEEB;--1:#403F53">[u8]) </span><span style="--0:#7FDBCA;--1:#097174">-></span><span style="--0:#D6DEEB;--1:#403F53"> std</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#D6DEEB;--1:#403F53">io</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#D6DEEB;--1:#403F53">Result&#x3C;usize> {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        </span><span style="--0:#7FDBCA;--1:#097174">self.</span><span style="--0:#D6DEEB;--1:#403F53">file</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">write</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#C5E478;--1:#3C63B3">data</span><span style="--0:#D6DEEB;--1:#403F53">)</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    }</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">}</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">impl</span><span style="--0:#D6DEEB;--1:#403F53"> Drop </span><span style="--0:#C792EA;--1:#8D46B4">for</span><span style="--0:#D6DEEB;--1:#403F53"> FileHandler {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">fn</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">drop</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#7FDBCA;--1:#097174">&#x26;</span><span style="--0:#C792EA;--1:#8D46B4">mut</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#097174">self</span><span style="--0:#D6DEEB;--1:#403F53">) {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        </span><span style="--0:#82AAFF;--1:#3C63B3">println!</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">Closing file.</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    }</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">}</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">fn</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">main</span><span style="--0:#D6DEEB;--1:#403F53">() </span><span style="--0:#7FDBCA;--1:#097174">-></span><span style="--0:#D6DEEB;--1:#403F53"> std</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#D6DEEB;--1:#403F53">io</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#D6DEEB;--1:#403F53">Result&#x3C;()> {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">mut</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">file_handler</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> FileHandler</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#82AAFF;--1:#3C63B3">new</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">example.txt</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">)</span><span style="--0:#7FDBCA;--1:#097174">?</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C5E478;--1:#3C63B3">file_handler</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">write_data</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#ECC48D;--1:#9B504E">b</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">Hello, RAII!</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">)</span><span style="--0:#7FDBCA;--1:#097174">?</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#809191;--1:#5E6578">    // file_handler对象在这里离开作用域，触发Drop trait中的drop方法</span></div><div class="ec-line"><span style="--0:#809191;--1:#5E6578">    // 文件会被自动关闭</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    Ok(())</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">}</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="use std::fs::File;use std::io::Write;struct FileHandler {    file: File,}impl FileHandler {    fn new(filename: &#x26;str) -> std::io::Result<Self> {        let file = File::create(filename)?;        Ok(FileHandler { file })    }    fn write_data(&#x26;mut self, data: &#x26;[u8]) -> std::io::Result<usize> {        self.file.write(data)    }}impl Drop for FileHandler {    fn drop(&#x26;mut self) {        println!(&#x22;Closing file.&#x22;);    }}fn main() -> std::io::Result<()> {    let mut file_handler = FileHandler::new(&#x22;example.txt&#x22;)?;    file_handler.write_data(b&#x22;Hello, RAII!&#x22;)?;    // file_handler对象在这里离开作用域，触发Drop trait中的drop方法    // 文件会被自动关闭    Ok(())}"><div></div></button></div></figure></div>
<p>在上述示例中，<code dir="auto">FileHandler</code>结构实现了<code dir="auto">Drop</code> trait，在<code dir="auto">drop</code>方法中关闭文件。当<code dir="auto">file_handler</code>对象离开作用域时，<code dir="auto">Drop</code> trait的<code dir="auto">drop</code>方法会被自动调用，关闭文件。这确保了文件资源的正确释放。</p>
<h2 id="153-生命周期lifetimes详解">15.3 生命周期（Lifetimes）详解</h2>
<p>生命周期（Lifetimes）是Rust中一个非常重要的概念，用于确保内存安全和防止数据竞争。在Rust中，生命周期指定了引用的有效范围，帮助编译器检查引用是否合法。在进阶Rust中，我们将深入探讨生命周期的高级概念和应用。</p>
<p>在进阶Rust中，我们将深入探讨生命周期的高级概念和应用。</p>
<h4 id="1531-生命周期的自动推断和省略"><strong>15.3.1 生命周期的自动推断和省略</strong></h4>
<p>其实Rust在很多情况下，甚至式大部分情况下，可以自动推断生命周期，但有时需要显式注解来帮助编译器理解引用的生命周期。以下是一些关于Rust生命周期自动推断的示例和解释。</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">fn</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">get_length</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#C5E478;--1:#3C63B3">s</span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#097174">&#x26;</span><span style="--0:#D6DEEB;--1:#403F53">str) </span><span style="--0:#7FDBCA;--1:#097174">-></span><span style="--0:#D6DEEB;--1:#403F53"> usize {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C5E478;--1:#3C63B3">s</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">len</span><span style="--0:#D6DEEB;--1:#403F53">()</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">}</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">fn</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">main</span><span style="--0:#D6DEEB;--1:#403F53">() {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">text</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> String</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#82AAFF;--1:#3C63B3">from</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">Hello, Rust!</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">length</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">get_length</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#7FDBCA;--1:#097174">&#x26;</span><span style="--0:#C5E478;--1:#3C63B3">text</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#82AAFF;--1:#3C63B3">println!</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">Length: {}</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#C5E478;--1:#3C63B3">length</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">}</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="fn get_length(s: &#x26;str) -> usize {    s.len()}fn main() {    let text = String::from(&#x22;Hello, Rust!&#x22;);    let length = get_length(&#x26;text);    println!(&#x22;Length: {}&#x22;, length);}"><div></div></button></div></figure></div>
<p>在上述示例中，<code dir="auto">get_length</code>函数接受一个<code dir="auto">&#x26;str</code>引用作为参数，并没有显式指定生命周期。Rust会自动推断引用的生命周期，使其与调用者的生命周期相符。</p>
<p>但是在这个案例中，你需要显式声明生命周期参数来使代码合法：</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">fn</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">shorter</span><span style="--0:#D6DEEB;--1:#403F53">&#x3C;'a>(</span><span style="--0:#C5E478;--1:#3C63B3">x</span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#097174">&#x26;</span><span style="--0:#D6DEEB;--1:#403F53">'a str, </span><span style="--0:#C5E478;--1:#3C63B3">y</span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#097174">&#x26;</span><span style="--0:#D6DEEB;--1:#403F53">'a str, </span><span style="--0:#C5E478;--1:#3C63B3">z</span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#097174">&#x26;</span><span style="--0:#D6DEEB;--1:#403F53">'a str) </span><span style="--0:#7FDBCA;--1:#097174">-></span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#097174">&#x26;</span><span style="--0:#D6DEEB;--1:#403F53">str {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">if</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">x</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">len</span><span style="--0:#D6DEEB;--1:#403F53">() </span><span style="--0:#C792EA;--1:#8D46B4">&#x3C;=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">y</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">len</span><span style="--0:#D6DEEB;--1:#403F53">() </span><span style="--0:#C792EA;--1:#8D46B4">&#x26;&#x26;</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">x</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">len</span><span style="--0:#D6DEEB;--1:#403F53">() </span><span style="--0:#C792EA;--1:#8D46B4">&#x3C;=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">z</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">len</span><span style="--0:#D6DEEB;--1:#403F53">() {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        </span><span style="--0:#C5E478;--1:#3C63B3">x</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    } </span><span style="--0:#C792EA;--1:#8D46B4">else</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">if</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">y</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">len</span><span style="--0:#D6DEEB;--1:#403F53">() </span><span style="--0:#C792EA;--1:#8D46B4">&#x3C;=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">x</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">len</span><span style="--0:#D6DEEB;--1:#403F53">() </span><span style="--0:#C792EA;--1:#8D46B4">&#x26;&#x26;</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">y</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">len</span><span style="--0:#D6DEEB;--1:#403F53">() </span><span style="--0:#C792EA;--1:#8D46B4">&#x3C;=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">z</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">len</span><span style="--0:#D6DEEB;--1:#403F53">() {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        </span><span style="--0:#C5E478;--1:#3C63B3">y</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    } </span><span style="--0:#C792EA;--1:#8D46B4">else</span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        </span><span style="--0:#C5E478;--1:#3C63B3">z</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    }</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">}</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">fn</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">main</span><span style="--0:#D6DEEB;--1:#403F53">() {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">string1</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> String</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#82AAFF;--1:#3C63B3">from</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">abcd</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">string2</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">xyz</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">string3</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">lmnop</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">result</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">shorter</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#C5E478;--1:#3C63B3">string1</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">as_str</span><span style="--0:#D6DEEB;--1:#403F53">(), </span><span style="--0:#C5E478;--1:#3C63B3">string2</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#C5E478;--1:#3C63B3">string3</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#82AAFF;--1:#3C63B3">println!</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">The shortest string is {}</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#C5E478;--1:#3C63B3">result</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">}</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="fn shorter<&#x27;a>(x: &#x26;&#x27;a str, y: &#x26;&#x27;a str, z: &#x26;&#x27;a str) -> &#x26;str {    if x.len() <= y.len() &#x26;&#x26; x.len() <= z.len() {        x    } else if y.len() <= x.len() &#x26;&#x26; y.len() <= z.len() {        y    } else {        z    }}fn main() {    let string1 = String::from(&#x22;abcd&#x22;);    let string2 = &#x22;xyz&#x22;;    let string3 = &#x22;lmnop&#x22;;    let result = shorter(string1.as_str(), string2, string3);    println!(&#x22;The shortest string is {}&#x22;, result);}"><div></div></button></div></figure></div>
<p><strong>执行结果：</strong></p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#C5E478;--1:#3C63B3">error</span><span style="--0:#D6DEEB;--1:#403F53">[E0106]</span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">missing</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">lifetime</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">specifier</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#097174">--></span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">src</span><span style="--0:#7FDBCA;--1:#097174">/</span><span style="--0:#C5E478;--1:#3C63B3">main</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#D6DEEB;--1:#403F53">rs</span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#F78C6C;--1:#AA0982">1</span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#F78C6C;--1:#AA0982">55</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">  </span><span style="--0:#C792EA;--1:#8D46B4">|</span></div><div class="ec-line"><span style="--0:#F78C6C;--1:#AA0982">1</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">|</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">fn</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">shorter</span><span style="--0:#D6DEEB;--1:#403F53">&#x3C;'a>(</span><span style="--0:#C5E478;--1:#3C63B3">x</span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#097174">&#x26;</span><span style="--0:#D6DEEB;--1:#403F53">'a str, </span><span style="--0:#C5E478;--1:#3C63B3">y</span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#097174">&#x26;</span><span style="--0:#D6DEEB;--1:#403F53">'a str, </span><span style="--0:#C5E478;--1:#3C63B3">z</span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#097174">&#x26;</span><span style="--0:#D6DEEB;--1:#403F53">'a str) </span><span style="--0:#7FDBCA;--1:#097174">-></span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#097174">&#x26;</span><span style="--0:#D6DEEB;--1:#403F53">str {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">  </span><span style="--0:#C792EA;--1:#8D46B4">|</span><span style="--0:#D6DEEB;--1:#403F53">                   </span><span style="--0:#7FDBCA;--1:#097174">-------</span><span style="--0:#D6DEEB;--1:#403F53">     </span><span style="--0:#7FDBCA;--1:#097174">-------</span><span style="--0:#D6DEEB;--1:#403F53">     </span><span style="--0:#7FDBCA;--1:#097174">-------</span><span style="--0:#D6DEEB;--1:#403F53">     </span><span style="--0:#C792EA;--1:#8D46B4">^</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">expected</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">named</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">lifetime</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">parameter</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">  </span><span style="--0:#C792EA;--1:#8D46B4">|</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">  </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">help</span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">this</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">function</span><span style="--0:#D6DEEB;--1:#403F53">'s </span><span style="--0:#C792EA;--1:#8D46B4">return</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">type</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">contains</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">a</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">borrowed</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">value</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">with</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">an</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">elided</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">lifetime</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#C5E478;--1:#3C63B3">but</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">the</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">lifetime</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">cannot</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">be</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">derived</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">from</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">the</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">arguments</span></div><div class="ec-line"><span style="--0:#C5E478;--1:#3C63B3">help</span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">consider</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">using</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">the</span><span style="--0:#D6DEEB;--1:#403F53"> `'a` </span><span style="--0:#C5E478;--1:#3C63B3">lifetime</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">  </span><span style="--0:#C792EA;--1:#8D46B4">|</span></div><div class="ec-line"><span style="--0:#F78C6C;--1:#AA0982">1</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">|</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">fn</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">shorter</span><span style="--0:#D6DEEB;--1:#403F53">&#x3C;'a>(</span><span style="--0:#C5E478;--1:#3C63B3">x</span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#097174">&#x26;</span><span style="--0:#D6DEEB;--1:#403F53">'a str, </span><span style="--0:#C5E478;--1:#3C63B3">y</span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#097174">&#x26;</span><span style="--0:#D6DEEB;--1:#403F53">'a str, </span><span style="--0:#C5E478;--1:#3C63B3">z</span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#097174">&#x26;</span><span style="--0:#D6DEEB;--1:#403F53">'a str) </span><span style="--0:#7FDBCA;--1:#097174">-></span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#097174">&#x26;</span><span style="--0:#D6DEEB;--1:#403F53">'a str {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">  </span><span style="--0:#C792EA;--1:#8D46B4">|</span><span style="--0:#D6DEEB;--1:#403F53">                                                        </span><span style="--0:#7FDBCA;--1:#097174">++</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">For </span><span style="--0:#C5E478;--1:#3C63B3">more</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">information</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">about</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">this</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">error</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#C792EA;--1:#8D46B4">try</span><span style="--0:#D6DEEB;--1:#403F53"> `</span><span style="--0:#C5E478;--1:#3C63B3">rustc</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#097174">--</span><span style="--0:#C5E478;--1:#3C63B3">explain</span><span style="--0:#D6DEEB;--1:#403F53"> E0106`</span><span style="--0:#7FDBCA;--1:#097174">.</span></div><div class="ec-line"><span style="--0:#C5E478;--1:#3C63B3">error</span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">could</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">not</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">compile</span><span style="--0:#D6DEEB;--1:#403F53"> `</span><span style="--0:#C5E478;--1:#3C63B3">book_test</span><span style="--0:#D6DEEB;--1:#403F53">` (</span><span style="--0:#C5E478;--1:#3C63B3">bin</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">book_test</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">) </span><span style="--0:#C5E478;--1:#3C63B3">due</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">to</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">previous</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">error</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="error[E0106]: missing lifetime specifier --> src/main.rs:1:55  |1 | fn shorter<&#x27;a>(x: &#x26;&#x27;a str, y: &#x26;&#x27;a str, z: &#x26;&#x27;a str) -> &#x26;str {  |                   -------     -------     -------     ^ expected named lifetime parameter  |  = help: this function&#x27;s return type contains a borrowed value with an elided lifetime, but the lifetime cannot be derived from the argumentshelp: consider using the &#x60;&#x27;a&#x60; lifetime  |1 | fn shorter<&#x27;a>(x: &#x26;&#x27;a str, y: &#x26;&#x27;a str, z: &#x26;&#x27;a str) -> &#x26;&#x27;a str {  |                                                        ++For more information about this error, try &#x60;rustc --explain E0106&#x60;.error: could not compile &#x60;book_test&#x60; (bin &#x22;book_test&#x22;) due to previous error"><div></div></button></div></figure></div>
<p>在 Rust 中，生命周期参数应该在函数参数和返回值中保持一致。这是为了确保借用规则得到正确的应用和编译器能够理解代码的生命周期要求。在你的 <code dir="auto">shorter</code> 函数中，所有的参数和返回值引用都使用了相同的生命周期参数 <code dir="auto">'a</code>，这是正确的做法，因为它们都应该在同一个生命周期内有效。</p>
<h3 id="1532-生命周期和结构体">15.3.2 生命周期和结构体</h3>
<p>在结构体中标注生命周期和函数的类似, 可以通过显式标注来使变量或者引用的生命周期超过结构体或者枚举本身。来看一个简单的例子:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">#[derive(Debug)]</span></div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">struct</span><span style="--0:#D6DEEB;--1:#403F53"> Book&#x3C;'a> {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C5E478;--1:#3C63B3">title</span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#097174">&#x26;</span><span style="--0:#D6DEEB;--1:#403F53">'a str,</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C5E478;--1:#3C63B3">author</span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#097174">&#x26;</span><span style="--0:#D6DEEB;--1:#403F53">'a str,</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">}</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">#[derive(Debug)]</span></div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">struct</span><span style="--0:#D6DEEB;--1:#403F53"> Chapter&#x3C;'a> {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C5E478;--1:#3C63B3">book</span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#097174">&#x26;</span><span style="--0:#D6DEEB;--1:#403F53">'a Book&#x3C;'a>,</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C5E478;--1:#3C63B3">title</span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#097174">&#x26;</span><span style="--0:#D6DEEB;--1:#403F53">'a str,</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">}</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">fn</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">main</span><span style="--0:#D6DEEB;--1:#403F53">() {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">book_title</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">Rust Programming</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">book_author</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">Arthur</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">book</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> Book {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        </span><span style="--0:#C5E478;--1:#3C63B3">title</span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#097174">&#x26;</span><span style="--0:#C5E478;--1:#3C63B3">book_title</span><span style="--0:#D6DEEB;--1:#403F53">,</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        </span><span style="--0:#C5E478;--1:#3C63B3">author</span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#097174">&#x26;</span><span style="--0:#C5E478;--1:#3C63B3">book_author</span><span style="--0:#D6DEEB;--1:#403F53">,</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    };</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">chapter_title</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">Chapter 1: Introduction</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">chapter</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> Chapter {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        </span><span style="--0:#C5E478;--1:#3C63B3">book</span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#097174">&#x26;</span><span style="--0:#C5E478;--1:#3C63B3">book</span><span style="--0:#D6DEEB;--1:#403F53">,</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        </span><span style="--0:#C5E478;--1:#3C63B3">title</span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#097174">&#x26;</span><span style="--0:#C5E478;--1:#3C63B3">chapter_title</span><span style="--0:#D6DEEB;--1:#403F53">,</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    };</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#82AAFF;--1:#3C63B3">println!</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">Book: {:?}</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#C5E478;--1:#3C63B3">book</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#82AAFF;--1:#3C63B3">println!</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">Chapter: {:?}</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#C5E478;--1:#3C63B3">chapter</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">}</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="#[derive(Debug)]struct Book<&#x27;a> {    title: &#x26;&#x27;a str,    author: &#x26;&#x27;a str,}#[derive(Debug)]struct Chapter<&#x27;a> {    book: &#x26;&#x27;a Book<&#x27;a>,    title: &#x26;&#x27;a str,}fn main() {    let book_title = &#x22;Rust Programming&#x22;;    let book_author = &#x22;Arthur&#x22;;    let book = Book {        title: &#x26;book_title,        author: &#x26;book_author,    };    let chapter_title = &#x22;Chapter 1: Introduction&#x22;;    let chapter = Chapter {        book: &#x26;book,        title: &#x26;chapter_title,    };    println!(&#x22;Book: {:?}&#x22;, book);    println!(&#x22;Chapter: {:?}&#x22;, chapter);}"><div></div></button></div></figure></div>
<p>在这里，<code dir="auto">'a</code> 是一个生命周期参数，它告诉编译器引用 <code dir="auto">title</code> 和 <code dir="auto">author</code> 的有效范围与 <code dir="auto">'a</code> 相关联。这意味着 <code dir="auto">title</code> 和 <code dir="auto">author</code> 引用的生命周期不能超过与 <code dir="auto">Book</code> 结构体关联的生命周期 <code dir="auto">'a</code>。</p>
<p>然后，我们来看 <code dir="auto">Chapter</code> 结构体，它包含了一个对 <code dir="auto">Book</code> 结构体的引用，以及章节的标题引用。注意，<code dir="auto">Chapter</code> 结构体的生命周期参数 <code dir="auto">'a</code> 与 <code dir="auto">Book</code> 结构体的生命周期参数相同，这意味着 <code dir="auto">Chapter</code> 结构体中的引用也必须在 <code dir="auto">'a</code> 生命周期内有效。</p>
<h3 id="1533-static">15.3.3 static</h3>
<p>在Rust中，你可以使用<code dir="auto">static</code>声明来创建具有静态生命周期的全局变量，这些变量将在整个程序运行期间存在，并且可以被强制转换成更短的生命周期。以下是一个给乐队成员报幕的Rust代码示例：</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#d6deeb;--1:#403f53">// 定义一个包含乐队成员信息的结构体</span></div><div class="ec-line"><span style="--0:#d6deeb;--1:#403f53">struct BandMember {</span></div><div class="ec-line"><span style="--0:#d6deeb;--1:#403f53">    name: &#x26;'static str,</span></div><div class="ec-line"><span style="--0:#d6deeb;--1:#403f53">    age: u32,</span></div><div class="ec-line"><span style="--0:#d6deeb;--1:#403f53">    instrument: &#x26;'static str,</span></div><div class="ec-line"><span style="--0:#d6deeb;--1:#403f53">}</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#d6deeb;--1:#403f53">// 声明一个具有 'static 生命周期的全局变量</span></div><div class="ec-line"><span style="--0:#d6deeb;--1:#403f53">static BAND_MEMBERS: [BandMember; 4] = [</span></div><div class="ec-line"><span style="--0:#d6deeb;--1:#403f53">    BandMember { name: "John", age: 30, instrument: "吉他手" },</span></div><div class="ec-line"><span style="--0:#d6deeb;--1:#403f53">    BandMember { name: "Lisa", age: 28, instrument: "贝斯手" },</span></div><div class="ec-line"><span style="--0:#d6deeb;--1:#403f53">    BandMember { name: "Mike", age: 32, instrument: "鼓手" },</span></div><div class="ec-line"><span style="--0:#d6deeb;--1:#403f53">    BandMember { name: "Sarah", age: 25, instrument: "键盘手" },</span></div><div class="ec-line"><span style="--0:#d6deeb;--1:#403f53">];</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#d6deeb;--1:#403f53">fn main() {</span></div><div class="ec-line"><span style="--0:#d6deeb;--1:#403f53">    // 给乐队成员报幕</span></div><div class="ec-line"><span style="--0:#d6deeb;--1:#403f53">    for member in BAND_MEMBERS.iter() {</span></div><div class="ec-line"><span style="--0:#d6deeb;--1:#403f53">        println!("欢迎 {}，{}岁，负责{}！", member.name, member.age, member.instrument);</span></div><div class="ec-line"><span style="--0:#d6deeb;--1:#403f53">    }</span></div><div class="ec-line"><span style="--0:#d6deeb;--1:#403f53">}</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="// 定义一个包含乐队成员信息的结构体struct BandMember {    name: &#x26;&#x27;static str,    age: u32,    instrument: &#x26;&#x27;static str,}// 声明一个具有 &#x27;static 生命周期的全局变量static BAND_MEMBERS: [BandMember; 4] = [    BandMember { name: &#x22;John&#x22;, age: 30, instrument: &#x22;吉他手&#x22; },    BandMember { name: &#x22;Lisa&#x22;, age: 28, instrument: &#x22;贝斯手&#x22; },    BandMember { name: &#x22;Mike&#x22;, age: 32, instrument: &#x22;鼓手&#x22; },    BandMember { name: &#x22;Sarah&#x22;, age: 25, instrument: &#x22;键盘手&#x22; },];fn main() {    // 给乐队成员报幕    for member in BAND_MEMBERS.iter() {        println!(&#x22;欢迎 {}，{}岁，负责{}！&#x22;, member.name, member.age, member.instrument);    }}"><div></div></button></div></figure></div>
<p><strong>执行结果</strong>：</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#d6deeb;--1:#403f53">欢迎 John，30岁，负责吉他手！</span></div><div class="ec-line"><span style="--0:#d6deeb;--1:#403f53">欢迎 Lisa，28岁，负责贝斯手！</span></div><div class="ec-line"><span style="--0:#d6deeb;--1:#403f53">欢迎 Mike，32岁，负责鼓手！</span></div><div class="ec-line"><span style="--0:#d6deeb;--1:#403f53">欢迎 Sarah，25岁，负责键盘手！</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="欢迎 John，30岁，负责吉他手！欢迎 Lisa，28岁，负责贝斯手！欢迎 Mike，32岁，负责鼓手！欢迎 Sarah，25岁，负责键盘手！"><div></div></button></div></figure></div>
<p>在这个执行结果中，程序使用<code dir="auto">println!</code>宏为每位乐队成员生成了一条报幕信息，显示了他们的姓名、年龄和担任的乐器。这样就模拟了给乐队成员报幕的效果。</p>
<h3 id="案例-static-在量化金融中的作用">案例 <code dir="auto">'static</code> 在量化金融中的作用</h3>
<p><code dir="auto">'static</code> 在量化金融中可以具有重要的作用，尤其是在处理常量、全局配置、参数以及模型参数等方面。以下是五个简单的案例示例：</p>
<h4 id="1-全局配置和参数">1: 全局配置和参数</h4>
<p>在一个量化金融系统中，你可以定义全局配置和参数，例如交易手续费、市场数据源和回测周期，并将它们存储在具有 <code dir="auto">'static</code> 生命周期的全局变量中：</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">static</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">TRADING_COMMISSION</span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#D6DEEB;--1:#403F53"> f64 </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#F78C6C;--1:#AA0982">0.005</span><span style="--0:#D6DEEB;--1:#403F53">;</span><span style="--0:#809191;--1:#5E6578"> // 交易手续费率 (0.5%)</span></div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">static</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">MARKET_DATA_SOURCE</span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#097174">&#x26;</span><span style="--0:#D6DEEB;--1:#403F53">str </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">NASDAQ</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">;</span><span style="--0:#809191;--1:#5E6578"> // 市场数据源</span></div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">static</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">BACKTEST_PERIOD</span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#D6DEEB;--1:#403F53"> u32 </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#F78C6C;--1:#AA0982">365</span><span style="--0:#D6DEEB;--1:#403F53">;</span><span style="--0:#809191;--1:#5E6578"> // 回测周期（一年）</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="static TRADING_COMMISSION: f64 = 0.005; // 交易手续费率 (0.5%)static MARKET_DATA_SOURCE: &#x26;str = &#x22;NASDAQ&#x22;; // 市场数据源static BACKTEST_PERIOD: u32 = 365; // 回测周期（一年）"><div></div></button></div></figure></div>
<p>这些参数可以在整个量化金融系统中共享和访问，以确保一致性和方便的配置。</p>
<h4 id="2-模型参数">2: 模型参数</h4>
<p>假设你正在开发一个金融模型，例如布莱克-斯科尔斯期权定价模型。模型中的参数（例如波动率、无风险利率）可以定义为 <code dir="auto">'static</code> 生命周期的全局变量：</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">static</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">VOLATILITY</span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#D6DEEB;--1:#403F53"> f64 </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#F78C6C;--1:#AA0982">0.2</span><span style="--0:#D6DEEB;--1:#403F53">;</span><span style="--0:#809191;--1:#5E6578"> // 波动率参数</span></div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">static</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">RISK_FREE_RATE</span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#D6DEEB;--1:#403F53"> f64 </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#F78C6C;--1:#AA0982">0.03</span><span style="--0:#D6DEEB;--1:#403F53">;</span><span style="--0:#809191;--1:#5E6578"> // 无风险利率</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="static VOLATILITY: f64 = 0.2; // 波动率参数static RISK_FREE_RATE: f64 = 0.03; // 无风险利率"><div></div></button></div></figure></div>
<p>这些模型参数可以在整个模型的实现中使用，而不必在函数之间传递。</p>
<h4 id="3-常量定义">3: 常量定义</h4>
<p>在量化金融中，常常有一些常量，如交易所的交易时间表、证券代码前缀等。这些常量可以定义为 <code dir="auto">'static</code> 生命周期的全局常量：</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">static</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">TRADING_HOURS</span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#D6DEEB;--1:#403F53"> [u8; </span><span style="--0:#F78C6C;--1:#AA0982">24</span><span style="--0:#D6DEEB;--1:#403F53">] </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> [</span><span style="--0:#F78C6C;--1:#AA0982">0</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#F78C6C;--1:#AA0982">1</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#F78C6C;--1:#AA0982">2</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#F78C6C;--1:#AA0982">3</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#F78C6C;--1:#AA0982">4</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#F78C6C;--1:#AA0982">5</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#F78C6C;--1:#AA0982">6</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#F78C6C;--1:#AA0982">7</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#F78C6C;--1:#AA0982">8</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#F78C6C;--1:#AA0982">9</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#F78C6C;--1:#AA0982">10</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#F78C6C;--1:#AA0982">11</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#F78C6C;--1:#AA0982">12</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#F78C6C;--1:#AA0982">13</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#F78C6C;--1:#AA0982">14</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#F78C6C;--1:#AA0982">15</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#F78C6C;--1:#AA0982">16</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#F78C6C;--1:#AA0982">17</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#F78C6C;--1:#AA0982">18</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#F78C6C;--1:#AA0982">19</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#F78C6C;--1:#AA0982">20</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#F78C6C;--1:#AA0982">21</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#F78C6C;--1:#AA0982">22</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#F78C6C;--1:#AA0982">23</span><span style="--0:#D6DEEB;--1:#403F53">];</span><span style="--0:#809191;--1:#5E6578"> // 交易时间</span></div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">static</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">STOCK_PREFIX</span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#097174">&#x26;</span><span style="--0:#D6DEEB;--1:#403F53">str </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">AAPL</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">;</span><span style="--0:#809191;--1:#5E6578"> // 证券代码前缀</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="static TRADING_HOURS: [u8; 24] = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23]; // 交易时间static STOCK_PREFIX: &#x26;str = &#x22;AAPL&#x22;; // 证券代码前缀"><div></div></button></div></figure></div>
<p>这些常量可以在整个应用程序中使用，而无需重复定义。</p>
<h4 id="4-缓存数据">4: 缓存数据</h4>
<p>在量化金融中，你可能需要缓存市场数据，以减少对外部数据源的频繁访问。你可以使用 <code dir="auto">'static</code> 生命周期的变量来存储缓存数据：</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">static</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">mut</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">PRICE_CACHE</span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#D6DEEB;--1:#403F53"> HashMap&#x3C;String, f64> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> HashMap</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#82AAFF;--1:#3C63B3">new</span><span style="--0:#D6DEEB;--1:#403F53">();</span><span style="--0:#809191;--1:#5E6578"> // 价格缓存</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="static mut PRICE_CACHE: HashMap<String, f64> = HashMap::new(); // 价格缓存"><div></div></button></div></figure></div>
<p>这个缓存可以在多个函数中使用，以便快速访问最近的价格数据。</p>
<h4 id="5-单例模式">5: 单例模式</h4>
<p>假设你需要创建一个单例对象，例如日志记录器，以确保在整个应用程序中只有一个实例。你可以使用 <code dir="auto">'static</code> 生命周期来实现单例模式：</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">struct</span><span style="--0:#D6DEEB;--1:#403F53"> Logger {</span></div><div class="ec-line"><span style="--0:#809191;--1:#5E6578">    // 日志记录器的属性和方法</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">}</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">impl</span><span style="--0:#D6DEEB;--1:#403F53"> Logger {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">fn</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">new</span><span style="--0:#D6DEEB;--1:#403F53">() </span><span style="--0:#7FDBCA;--1:#097174">-></span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#097174">Self</span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        Logger {</span></div><div class="ec-line"><span style="--0:#809191;--1:#5E6578">            // 初始化日志记录器</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        }</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    }</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">}</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">static</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">LOGGER</span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#D6DEEB;--1:#403F53"> Logger </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> Logger</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#82AAFF;--1:#3C63B3">new</span><span style="--0:#D6DEEB;--1:#403F53">();</span><span style="--0:#809191;--1:#5E6578"> // 单例日志记录器</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">fn</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">main</span><span style="--0:#D6DEEB;--1:#403F53">() {</span></div><div class="ec-line"><span style="--0:#809191;--1:#5E6578">    // 在整个应用程序中，你可以通过 LOGGER 访问单例日志记录器</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#82AAFF;--1:#3C63B3">LOGGER</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">log</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">This is a log message</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">}</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="struct Logger {    // 日志记录器的属性和方法}impl Logger {    fn new() -> Self {        Logger {            // 初始化日志记录器        }    }}static LOGGER: Logger = Logger::new(); // 单例日志记录器fn main() {    // 在整个应用程序中，你可以通过 LOGGER 访问单例日志记录器    LOGGER.log(&#x22;This is a log message&#x22;);}"><div></div></button></div></figure></div>
<p>在这个案例中，<code dir="auto">LOGGER</code> 是具有 <code dir="auto">'static</code> 生命周期的全局变量，确保在整个应用程序中只有一个日志记录器实例。</p>
<p>这些案例突出了在量化金融中使用 <code dir="auto">'static</code> 生命周期的不同情况，以管理全局配置、模型参数、常量、缓存数据和单例对象。这有助于提高代码的可维护性、一致性和性能。</p> </div> <footer class="astro-w7wtsaw6"> <div class="meta sl-flex astro-w7wtsaw6">   </div> <div class="pagination-links astro-qnftudm7" dir="ltr"> <a href="/chapters/chapter_14/" rel="prev" class="astro-qnftudm7"> <svg aria-hidden="true" class="astro-qnftudm7 astro-xrndq6a6" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.5rem;"><path d="M17 11H9.41l3.3-3.29a1.004 1.004 0 1 0-1.42-1.42l-5 5a1 1 0 0 0-.21.33 1 1 0 0 0 0 .76 1 1 0 0 0 .21.33l5 5a1.002 1.002 0 0 0 1.639-.325 1 1 0 0 0-.219-1.095L9.41 13H17a1 1 0 0 0 0-2Z"/></svg>  <span class="astro-qnftudm7"> Previous <br class="astro-qnftudm7"> <span class="link-title astro-qnftudm7">14. 泛型进阶(Advanced Generic Type Usage)</span> </span> </a> <a href="/chapters/chapter_16/" rel="next" class="astro-qnftudm7"> <svg aria-hidden="true" class="astro-qnftudm7 astro-xrndq6a6" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.5rem;"><path d="M17.92 11.62a1.001 1.001 0 0 0-.21-.33l-5-5a1.003 1.003 0 1 0-1.42 1.42l3.3 3.29H7a1 1 0 0 0 0 2h7.59l-3.3 3.29a1.002 1.002 0 0 0 .325 1.639 1 1 0 0 0 1.095-.219l5-5a1 1 0 0 0 .21-.33 1 1 0 0 0 0-.76Z"/></svg>  <span class="astro-qnftudm7"> Next <br class="astro-qnftudm7"> <span class="link-title astro-qnftudm7">16. 错误处理进阶(Advanced Error handling)</span> </span> </a> </div>  </footer>  </div> </div>   </main> </div> </div>  </div> </div>  </body></html>