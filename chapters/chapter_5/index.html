<!DOCTYPE html><html lang="en" dir="ltr" data-has-toc data-has-sidebar class="astro-fpze62lo"> <head><meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><title>标准库类型 | Cookbook for Rustaceans in Finance / Rust 量化金融开发指南</title><link rel="canonical"/><link rel="shortcut icon" href="/favicon.svg" type="image/svg+xml"/><meta name="generator" content="Astro v4.3.3"/><meta name="generator" content="Starlight v0.17.3"/><meta property="og:title" content="标准库类型"/><meta property="og:type" content="article"/><meta property="og:url"/><meta property="og:locale" content="en"/><meta property="og:description"/><meta property="og:site_name" content="Cookbook for Rustaceans in Finance / Rust 量化金融开发指南"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:title" content="标准库类型"/><meta name="twitter:description"/><script>
	window.StarlightThemeProvider = (() => {
		const storedTheme =
			typeof localStorage !== 'undefined' && localStorage.getItem('starlight-theme');
		const theme =
			storedTheme ||
			(window.matchMedia('(prefers-color-scheme: light)').matches ? 'light' : 'dark');
		document.documentElement.dataset.theme = theme === 'light' ? 'light' : 'dark';
		return {
			updatePickers(theme = storedTheme || 'auto') {
				document.querySelectorAll('starlight-theme-select').forEach((picker) => {
					const select = picker.querySelector('select');
					if (select) select.value = theme;
					/** @type {HTMLTemplateElement | null} */
					const tmpl = document.querySelector(`#theme-icons`);
					const newIcon = tmpl && tmpl.content.querySelector('.' + theme);
					if (newIcon) {
						const oldIcon = picker.querySelector('svg.label-icon');
						if (oldIcon) {
							oldIcon.replaceChildren(...newIcon.cloneNode(true).childNodes);
						}
					}
				});
			},
		};
	})();
</script><template id="theme-icons"><svg aria-hidden="true" class="light astro-xrndq6a6" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M5 12a1 1 0 0 0-1-1H3a1 1 0 0 0 0 2h1a1 1 0 0 0 1-1Zm.64 5-.71.71a1 1 0 0 0 0 1.41 1 1 0 0 0 1.41 0l.71-.71A1 1 0 0 0 5.64 17ZM12 5a1 1 0 0 0 1-1V3a1 1 0 0 0-2 0v1a1 1 0 0 0 1 1Zm5.66 2.34a1 1 0 0 0 .7-.29l.71-.71a1 1 0 1 0-1.41-1.41l-.66.71a1 1 0 0 0 0 1.41 1 1 0 0 0 .66.29Zm-12-.29a1 1 0 0 0 1.41 0 1 1 0 0 0 0-1.41l-.71-.71a1.004 1.004 0 1 0-1.43 1.41l.73.71ZM21 11h-1a1 1 0 0 0 0 2h1a1 1 0 0 0 0-2Zm-2.64 6A1 1 0 0 0 17 18.36l.71.71a1 1 0 0 0 1.41 0 1 1 0 0 0 0-1.41l-.76-.66ZM12 6.5a5.5 5.5 0 1 0 5.5 5.5A5.51 5.51 0 0 0 12 6.5Zm0 9a3.5 3.5 0 1 1 0-7 3.5 3.5 0 0 1 0 7Zm0 3.5a1 1 0 0 0-1 1v1a1 1 0 0 0 2 0v-1a1 1 0 0 0-1-1Z"/></svg> <svg aria-hidden="true" class="dark astro-xrndq6a6" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M21.64 13a1 1 0 0 0-1.05-.14 8.049 8.049 0 0 1-3.37.73 8.15 8.15 0 0 1-8.14-8.1 8.59 8.59 0 0 1 .25-2A1 1 0 0 0 8 2.36a10.14 10.14 0 1 0 14 11.69 1 1 0 0 0-.36-1.05Zm-9.5 6.69A8.14 8.14 0 0 1 7.08 5.22v.27a10.15 10.15 0 0 0 10.14 10.14 9.784 9.784 0 0 0 2.1-.22 8.11 8.11 0 0 1-7.18 4.32v-.04Z"/></svg> <svg aria-hidden="true" class="auto astro-xrndq6a6" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M21 14h-1V7a3 3 0 0 0-3-3H7a3 3 0 0 0-3 3v7H3a1 1 0 0 0-1 1v2a3 3 0 0 0 3 3h14a3 3 0 0 0 3-3v-2a1 1 0 0 0-1-1ZM6 7a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v7H6V7Zm14 10a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1v-1h16v1Z"/></svg> </template><link rel="stylesheet" href="/_astro/index.4lckRRHb.css" /><script type="module" src="/_astro/hoisted.RLbdawI7.js"></script>
<script type="module" src="/_astro/page.X_0NJa-z.js"></script></head> <body class="astro-fpze62lo"> <a href="#_top" class="astro-byjsuuaw">Skip to content</a>  <div class="page sl-flex astro-yxqmbg7i"> <header class="header astro-yxqmbg7i"><div class="header sl-flex astro-cyrhhlnw"> <div class="title-wrapper sl-flex astro-cyrhhlnw"> <a href="/" class="site-title sl-flex astro-ylanx5mn">  <span class="astro-ylanx5mn"> Cookbook for Rustaceans in Finance / Rust 量化金融开发指南 </span> </a>  </div> <div class="sl-flex astro-cyrhhlnw"> <site-search data-translations="{&#34;placeholder&#34;:&#34;Search&#34;}" class="astro-usz5hgcn"> <button data-open-modal disabled class="astro-usz5hgcn">  <svg aria-label="Search" class="astro-usz5hgcn astro-xrndq6a6" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M21.71 20.29 18 16.61A9 9 0 1 0 16.61 18l3.68 3.68a.999.999 0 0 0 1.42 0 1 1 0 0 0 0-1.39ZM11 18a7 7 0 1 1 0-14 7 7 0 0 1 0 14Z"/></svg>  <span class="sl-hidden md:sl-block astro-usz5hgcn" aria-hidden="true">Search</span> <svg aria-label="(Press / to Search)" class="sl-hidden md:sl-block astro-usz5hgcn astro-xrndq6a6" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M17 2H7a5 5 0 0 0-5 5v10a5 5 0 0 0 5 5h10a5 5 0 0 0 5-5V7a5 5 0 0 0-5-5Zm3 15a3 3 0 0 1-3 3H7a3 3 0 0 1-3-3V7a3 3 0 0 1 3-3h10a3 3 0 0 1 3 3v10Z"/><path d="M15.293 6.707a1 1 0 1 1 1.414 1.414l-8.485 8.486a1 1 0 0 1-1.414-1.415l8.485-8.485Z"/></svg>  </button> <dialog style="padding:0" aria-label="Search" class="astro-usz5hgcn"> <div class="dialog-frame sl-flex astro-usz5hgcn">  <button data-close-modal class="sl-flex md:sl-hidden astro-usz5hgcn"> Cancel </button> <div class="search-container astro-usz5hgcn"> <div id="starlight__search" class="astro-usz5hgcn"></div> </div> </div> </dialog> </site-search>    </div> <div class="sl-hidden md:sl-flex right-group astro-cyrhhlnw"> <div class="sl-flex social-icons astro-cyrhhlnw"> <a href="https://github.com/withastro/starlight" rel="me" class="sl-flex astro-3daxh4jc"><span class="sr-only astro-3daxh4jc">GitHub</span><svg aria-hidden="true" class="astro-3daxh4jc astro-xrndq6a6" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M12 .3a12 12 0 0 0-3.8 23.38c.6.12.83-.26.83-.57L9 21.07c-3.34.72-4.04-1.61-4.04-1.61-.55-1.39-1.34-1.76-1.34-1.76-1.08-.74.09-.73.09-.73 1.2.09 1.83 1.24 1.83 1.24 1.08 1.83 2.81 1.3 3.5 1 .1-.78.42-1.31.76-1.61-2.67-.3-5.47-1.33-5.47-5.93 0-1.31.47-2.38 1.24-3.22-.14-.3-.54-1.52.1-3.18 0 0 1-.32 3.3 1.23a11.5 11.5 0 0 1 6 0c2.28-1.55 3.29-1.23 3.29-1.23.64 1.66.24 2.88.12 3.18a4.65 4.65 0 0 1 1.23 3.22c0 4.61-2.8 5.63-5.48 5.92.42.36.81 1.1.81 2.22l-.01 3.29c0 .31.2.69.82.57A12 12 0 0 0 12 .3Z"/></svg> </a> </div> <starlight-theme-select>  <label style="--sl-select-width: 6.25em" class="astro-kc6u4lxd"> <span class="sr-only astro-kc6u4lxd">Select theme</span> <svg aria-hidden="true" class="icon label-icon astro-kc6u4lxd astro-xrndq6a6" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M21 14h-1V7a3 3 0 0 0-3-3H7a3 3 0 0 0-3 3v7H3a1 1 0 0 0-1 1v2a3 3 0 0 0 3 3h14a3 3 0 0 0 3-3v-2a1 1 0 0 0-1-1ZM6 7a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v7H6V7Zm14 10a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1v-1h16v1Z"/></svg>  <select value="auto" class="astro-kc6u4lxd"> <option value="dark" class="astro-kc6u4lxd">Dark</option><option value="light" class="astro-kc6u4lxd">Light</option><option value="auto" selected="true" class="astro-kc6u4lxd">Auto</option> </select> <svg aria-hidden="true" class="icon caret astro-kc6u4lxd astro-xrndq6a6" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M17 9.17a1 1 0 0 0-1.41 0L12 12.71 8.46 9.17a1 1 0 1 0-1.41 1.42l4.24 4.24a1.002 1.002 0 0 0 1.42 0L17 10.59a1.002 1.002 0 0 0 0-1.42Z"/></svg>  </label>  </starlight-theme-select>  <script>
	StarlightThemeProvider.updatePickers();
</script>   </div> </div> </header> <nav class="sidebar astro-yxqmbg7i" aria-label="Main"> <starlight-menu-button class="astro-eouth4v3"> <button aria-expanded="false" aria-label="Menu" aria-controls="starlight__sidebar" class="sl-flex md:sl-hidden astro-eouth4v3"> <svg aria-hidden="true" class="astro-eouth4v3 astro-xrndq6a6" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M3 8h18a1 1 0 1 0 0-2H3a1 1 0 0 0 0 2Zm18 8H3a1 1 0 0 0 0 2h18a1 1 0 0 0 0-2Zm0-5H3a1 1 0 0 0 0 2h18a1 1 0 0 0 0-2Z"/></svg>  </button> </starlight-menu-button>    <div id="starlight__sidebar" class="sidebar-pane astro-yxqmbg7i"> <div class="sidebar-content sl-flex astro-yxqmbg7i"> <ul class="top-level astro-4mcqxzkb"> <li class="astro-4mcqxzkb"> <details open class="astro-4mcqxzkb"> <summary class="astro-4mcqxzkb"> <div class="group-label astro-4mcqxzkb"> <span class="large astro-4mcqxzkb">PART I 基础部分 - 量化语境下的Rust编程基础</span>  </div> <svg aria-hidden="true" class="caret astro-4mcqxzkb astro-xrndq6a6" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.25rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg>  </summary> <ul class="astro-4mcqxzkb"> <li class="astro-4mcqxzkb"> <a href="/chapters/chapter_1" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">1. Rust 语言入门101</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_2/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">2. 格式化输出</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_3/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">3. 原生类型</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_4/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">4. 自定义类型 Struct &amp; Enum</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_5/" aria-current="page" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">5. 标准库类型</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_6/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">6. 变量和作用域</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_7/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">7. 类型系统</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_8/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">8. 类型转换</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_9/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">9. 流程控制</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_10/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">10. 函数、方法和闭包</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_11/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">11. 模块</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_12/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">12. Cargo 的进阶使用</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_13/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">13. 属性(Attributes)</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_14/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">14. 泛型进阶(Advanced Generic Type Usage)</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_15/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">15. 作用域规则和生命周期</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_16/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">16. 错误处理进阶(Advanced Error handling)</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_17/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">17. 特性(trait)详解</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_18/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">18. 创建自定义宏</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_19/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">19. 时间处理</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_20/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">20. Redis、爬虫、交易日库</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_21/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">21. 线程和管道</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_22/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">22. 文件处理</span>  </a> </li> </ul>  </details> </li><li class="astro-4mcqxzkb"> <details open class="astro-4mcqxzkb"> <summary class="astro-4mcqxzkb"> <div class="group-label astro-4mcqxzkb"> <span class="large astro-4mcqxzkb">PART II 进阶部分 - 量化实战</span>  </div> <svg aria-hidden="true" class="caret astro-4mcqxzkb astro-xrndq6a6" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.25rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg>  </summary> <ul class="astro-4mcqxzkb"> <li class="astro-4mcqxzkb"> <a href="/chapters/chapter_23/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">23. Polars 入门</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_24/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">24. 时序数据库 Clickhouse</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_25/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">25. Unsafe【未完成】</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_26/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">26. 文档和测试【未完成】</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_27/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">27. 常见技术指标及其实现【本章代码未添加】</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_28/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">28. 统计模型【未完成】</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_29/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">29. 引擎系统【未完成】</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_30/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">30. 日志系统【未完成】</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_31/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">31. 投资组合管理【未完成】</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_32/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">32. 量化计量经济学【未完成】</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_33/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">33. 限价指令簿【未完成】</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_34/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">34. 最优配置和执行【未完成】</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_35/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">35. 信息学、监管、风控【未完成】</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_36/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">36. 机器学习【未完成】</span>  </a> </li> </ul>  </details> </li> </ul>  <div class="md:sl-hidden"> <div class="mobile-preferences sl-flex astro-vfur2aw5"> <div class="sl-flex social-icons astro-vfur2aw5"> <a href="https://github.com/withastro/starlight" rel="me" class="sl-flex astro-3daxh4jc"><span class="sr-only astro-3daxh4jc">GitHub</span><svg aria-hidden="true" class="astro-3daxh4jc astro-xrndq6a6" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M12 .3a12 12 0 0 0-3.8 23.38c.6.12.83-.26.83-.57L9 21.07c-3.34.72-4.04-1.61-4.04-1.61-.55-1.39-1.34-1.76-1.34-1.76-1.08-.74.09-.73.09-.73 1.2.09 1.83 1.24 1.83 1.24 1.08 1.83 2.81 1.3 3.5 1 .1-.78.42-1.31.76-1.61-2.67-.3-5.47-1.33-5.47-5.93 0-1.31.47-2.38 1.24-3.22-.14-.3-.54-1.52.1-3.18 0 0 1-.32 3.3 1.23a11.5 11.5 0 0 1 6 0c2.28-1.55 3.29-1.23 3.29-1.23.64 1.66.24 2.88.12 3.18a4.65 4.65 0 0 1 1.23 3.22c0 4.61-2.8 5.63-5.48 5.92.42.36.81 1.1.81 2.22l-.01 3.29c0 .31.2.69.82.57A12 12 0 0 0 12 .3Z"/></svg> </a> </div> <starlight-theme-select>  <label style="--sl-select-width: 6.25em" class="astro-kc6u4lxd"> <span class="sr-only astro-kc6u4lxd">Select theme</span> <svg aria-hidden="true" class="icon label-icon astro-kc6u4lxd astro-xrndq6a6" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M21 14h-1V7a3 3 0 0 0-3-3H7a3 3 0 0 0-3 3v7H3a1 1 0 0 0-1 1v2a3 3 0 0 0 3 3h14a3 3 0 0 0 3-3v-2a1 1 0 0 0-1-1ZM6 7a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v7H6V7Zm14 10a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1v-1h16v1Z"/></svg>  <select value="auto" class="astro-kc6u4lxd"> <option value="dark" class="astro-kc6u4lxd">Dark</option><option value="light" class="astro-kc6u4lxd">Light</option><option value="auto" selected="true" class="astro-kc6u4lxd">Auto</option> </select> <svg aria-hidden="true" class="icon caret astro-kc6u4lxd astro-xrndq6a6" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M17 9.17a1 1 0 0 0-1.41 0L12 12.71 8.46 9.17a1 1 0 1 0-1.41 1.42l4.24 4.24a1.002 1.002 0 0 0 1.42 0L17 10.59a1.002 1.002 0 0 0 0-1.42Z"/></svg>  </label>  </starlight-theme-select>  <script>
	StarlightThemeProvider.updatePickers();
</script>   </div>  </div> </div> </div> </nav> <div class="main-frame astro-yxqmbg7i">  <div class="lg:sl-flex astro-3vvvt7cz"> <aside class="right-sidebar-container astro-3vvvt7cz"> <div class="right-sidebar astro-3vvvt7cz"> <div class="lg:sl-hidden astro-f63w33c6"><mobile-starlight-toc data-min-h="2" data-max-h="3" class="astro-q2mrqdva"><nav aria-labelledby="starlight__on-this-page--mobile" class="astro-q2mrqdva"><details id="starlight__mobile-toc" class="astro-q2mrqdva"><summary id="starlight__on-this-page--mobile" class="sl-flex astro-q2mrqdva"><div class="toggle sl-flex astro-q2mrqdva">On this page<svg aria-hidden="true" class="caret astro-q2mrqdva astro-xrndq6a6" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg> </div><span class="display-current astro-q2mrqdva"></span></summary><div class="dropdown astro-q2mrqdva"><ul class="isMobile astro-acifyk5h" style="--depth: 0;"> <li class="astro-acifyk5h" style="--depth: 0;"> <a href="#_top" class="astro-acifyk5h" style="--depth: 0;"> <span class="astro-acifyk5h" style="--depth: 0;">Overview</span> </a>  </li><li class="astro-acifyk5h" style="--depth: 0;"> <a href="#51-字符串-string" class="astro-acifyk5h" style="--depth: 0;"> <span class="astro-acifyk5h" style="--depth: 0;">5.1 字符串 (String)</span> </a>  </li><li class="astro-acifyk5h" style="--depth: 0;"> <a href="#52-向量-vector" class="astro-acifyk5h" style="--depth: 0;"> <span class="astro-acifyk5h" style="--depth: 0;">5.2 向量 (vector)</span> </a> <ul class="isMobile astro-acifyk5h" style="--depth: 1;"> <li class="astro-acifyk5h" style="--depth: 1;"> <a href="#案例处理期货合约列表" class="astro-acifyk5h" style="--depth: 1;"> <span class="astro-acifyk5h" style="--depth: 1;">案例：处理期货合约列表</span> </a>  </li> </ul>  </li><li class="astro-acifyk5h" style="--depth: 0;"> <a href="#53-哈希映射hashmap" class="astro-acifyk5h" style="--depth: 0;"> <span class="astro-acifyk5h" style="--depth: 0;">5.3 哈希映射(Hashmap)</span> </a> <ul class="isMobile astro-acifyk5h" style="--depth: 1;"> <li class="astro-acifyk5h" style="--depth: 1;"> <a href="#案例1管理股票价格数据" class="astro-acifyk5h" style="--depth: 1;"> <span class="astro-acifyk5h" style="--depth: 1;">案例1：管理股票价格数据</span> </a>  </li><li class="astro-acifyk5h" style="--depth: 1;"> <a href="#案例2-数据类型异质但是仍然安全的hashmap" class="astro-acifyk5h" style="--depth: 1;"> <span class="astro-acifyk5h" style="--depth: 1;">案例2： 数据类型异质但是仍然安全的Hashmap</span> </a>  </li> </ul>  </li><li class="astro-acifyk5h" style="--depth: 0;"> <a href="#54-选项类型optional-types" class="astro-acifyk5h" style="--depth: 0;"> <span class="astro-acifyk5h" style="--depth: 0;">5.4 选项类型(optional types)</span> </a> <ul class="isMobile astro-acifyk5h" style="--depth: 1;"> <li class="astro-acifyk5h" style="--depth: 1;"> <a href="#案例-处理银行账户余额查询" class="astro-acifyk5h" style="--depth: 1;"> <span class="astro-acifyk5h" style="--depth: 1;">案例: 处理银行账户余额查询</span> </a>  </li> </ul>  </li><li class="astro-acifyk5h" style="--depth: 0;"> <a href="#55-错误处理类型error-handling-types" class="astro-acifyk5h" style="--depth: 0;"> <span class="astro-acifyk5h" style="--depth: 0;">5.5 错误处理类型(error handling types)</span> </a> <ul class="isMobile astro-acifyk5h" style="--depth: 1;"> <li class="astro-acifyk5h" style="--depth: 1;"> <a href="#551-result枚举类型" class="astro-acifyk5h" style="--depth: 1;"> <span class="astro-acifyk5h" style="--depth: 1;">5.5.1 Result枚举类型</span> </a>  </li><li class="astro-acifyk5h" style="--depth: 1;"> <a href="#552-panic-宏" class="astro-acifyk5h" style="--depth: 1;"> <span class="astro-acifyk5h" style="--depth: 1;">5.5.2 panic! 宏</span> </a>  </li><li class="astro-acifyk5h" style="--depth: 1;"> <a href="#553-常见错误处理方式的比较" class="astro-acifyk5h" style="--depth: 1;"> <span class="astro-acifyk5h" style="--depth: 1;">5.5.3 常见错误处理方式的比较</span> </a>  </li> </ul>  </li><li class="astro-acifyk5h" style="--depth: 0;"> <a href="#56-栈stack堆heap和箱子box" class="astro-acifyk5h" style="--depth: 0;"> <span class="astro-acifyk5h" style="--depth: 0;">5.6 栈(Stack)、堆(Heap)和箱子(Box)</span> </a> <ul class="isMobile astro-acifyk5h" style="--depth: 1;"> <li class="astro-acifyk5h" style="--depth: 1;"> <a href="#561-内存栈stack" class="astro-acifyk5h" style="--depth: 1;"> <span class="astro-acifyk5h" style="--depth: 1;">5.6.1 内存栈(Stack)</span> </a>  </li><li class="astro-acifyk5h" style="--depth: 1;"> <a href="#562-内存堆heap" class="astro-acifyk5h" style="--depth: 1;"> <span class="astro-acifyk5h" style="--depth: 1;">5.6.2 内存堆(Heap)</span> </a>  </li><li class="astro-acifyk5h" style="--depth: 1;"> <a href="#563-箱子box" class="astro-acifyk5h" style="--depth: 1;"> <span class="astro-acifyk5h" style="--depth: 1;">5.6.3 箱子(Box)</span> </a>  </li><li class="astro-acifyk5h" style="--depth: 1;"> <a href="#补充学习into_boxed_slice" class="astro-acifyk5h" style="--depth: 1;"> <span class="astro-acifyk5h" style="--depth: 1;">补充学习：into_boxed_slice</span> </a>  </li><li class="astro-acifyk5h" style="--depth: 1;"> <a href="#案例1-向大型金融数据集添加账户" class="astro-acifyk5h" style="--depth: 1;"> <span class="astro-acifyk5h" style="--depth: 1;">案例1： 向大型金融数据集添加账户</span> </a>  </li><li class="astro-acifyk5h" style="--depth: 1;"> <a href="#案例2处理多种可能的错误情况" class="astro-acifyk5h" style="--depth: 1;"> <span class="astro-acifyk5h" style="--depth: 1;">案例2：处理多种可能的错误情况</span> </a>  </li><li class="astro-acifyk5h" style="--depth: 1;"> <a href="#案例3多线程共享数据" class="astro-acifyk5h" style="--depth: 1;"> <span class="astro-acifyk5h" style="--depth: 1;">案例3：多线程共享数据</span> </a>  </li> </ul>  </li><li class="astro-acifyk5h" style="--depth: 0;"> <a href="#57-多线程处理multithreading" class="astro-acifyk5h" style="--depth: 0;"> <span class="astro-acifyk5h" style="--depth: 0;">5.7 多线程处理(Multithreading)</span> </a>  </li><li class="astro-acifyk5h" style="--depth: 0;"> <a href="#58-互斥锁" class="astro-acifyk5h" style="--depth: 0;"> <span class="astro-acifyk5h" style="--depth: 0;">5.8 互斥锁</span> </a> <ul class="isMobile astro-acifyk5h" style="--depth: 1;"> <li class="astro-acifyk5h" style="--depth: 1;"> <a href="#补充学习lock方法" class="astro-acifyk5h" style="--depth: 1;"> <span class="astro-acifyk5h" style="--depth: 1;">补充学习：lock方法</span> </a>  </li> </ul>  </li><li class="astro-acifyk5h" style="--depth: 0;"> <a href="#59-堆分配的指针heap-allocated-pointers" class="astro-acifyk5h" style="--depth: 0;"> <span class="astro-acifyk5h" style="--depth: 0;">5.9 堆分配的指针(heap allocated pointers)</span> </a> <ul class="isMobile astro-acifyk5h" style="--depth: 1;"> <li class="astro-acifyk5h" style="--depth: 1;"> <a href="#591-rc-指针reference-counting" class="astro-acifyk5h" style="--depth: 1;"> <span class="astro-acifyk5h" style="--depth: 1;">5.9.1 Rc 指针(Reference Counting)</span> </a>  </li><li class="astro-acifyk5h" style="--depth: 1;"> <a href="#592-arc指针atomic-reference-counting" class="astro-acifyk5h" style="--depth: 1;"> <span class="astro-acifyk5h" style="--depth: 1;">5.9.2 `Arc指针(Atomic Reference Counting)</span> </a>  </li><li class="astro-acifyk5h" style="--depth: 1;"> <a href="#593-常见的-rust-智能指针类型之间的比较" class="astro-acifyk5h" style="--depth: 1;"> <span class="astro-acifyk5h" style="--depth: 1;">5.9.3 常见的 Rust 智能指针类型之间的比较</span> </a>  </li><li class="astro-acifyk5h" style="--depth: 1;"> <a href="#案例使用多线程备份一组金融数据" class="astro-acifyk5h" style="--depth: 1;"> <span class="astro-acifyk5h" style="--depth: 1;">案例：使用多线程备份一组金融数据</span> </a>  </li> </ul>  </li> </ul> </div></details></nav></mobile-starlight-toc></div><div class="right-sidebar-panel sl-hidden lg:sl-block astro-f63w33c6"><div class="sl-container astro-f63w33c6"><starlight-toc data-min-h="2" data-max-h="3"><nav aria-labelledby="starlight__on-this-page"><h2 id="starlight__on-this-page">On this page</h2><ul class="astro-acifyk5h" style="--depth: 0;"> <li class="astro-acifyk5h" style="--depth: 0;"> <a href="#_top" class="astro-acifyk5h" style="--depth: 0;"> <span class="astro-acifyk5h" style="--depth: 0;">Overview</span> </a>  </li><li class="astro-acifyk5h" style="--depth: 0;"> <a href="#51-字符串-string" class="astro-acifyk5h" style="--depth: 0;"> <span class="astro-acifyk5h" style="--depth: 0;">5.1 字符串 (String)</span> </a>  </li><li class="astro-acifyk5h" style="--depth: 0;"> <a href="#52-向量-vector" class="astro-acifyk5h" style="--depth: 0;"> <span class="astro-acifyk5h" style="--depth: 0;">5.2 向量 (vector)</span> </a> <ul class="astro-acifyk5h" style="--depth: 1;"> <li class="astro-acifyk5h" style="--depth: 1;"> <a href="#案例处理期货合约列表" class="astro-acifyk5h" style="--depth: 1;"> <span class="astro-acifyk5h" style="--depth: 1;">案例：处理期货合约列表</span> </a>  </li> </ul>  </li><li class="astro-acifyk5h" style="--depth: 0;"> <a href="#53-哈希映射hashmap" class="astro-acifyk5h" style="--depth: 0;"> <span class="astro-acifyk5h" style="--depth: 0;">5.3 哈希映射(Hashmap)</span> </a> <ul class="astro-acifyk5h" style="--depth: 1;"> <li class="astro-acifyk5h" style="--depth: 1;"> <a href="#案例1管理股票价格数据" class="astro-acifyk5h" style="--depth: 1;"> <span class="astro-acifyk5h" style="--depth: 1;">案例1：管理股票价格数据</span> </a>  </li><li class="astro-acifyk5h" style="--depth: 1;"> <a href="#案例2-数据类型异质但是仍然安全的hashmap" class="astro-acifyk5h" style="--depth: 1;"> <span class="astro-acifyk5h" style="--depth: 1;">案例2： 数据类型异质但是仍然安全的Hashmap</span> </a>  </li> </ul>  </li><li class="astro-acifyk5h" style="--depth: 0;"> <a href="#54-选项类型optional-types" class="astro-acifyk5h" style="--depth: 0;"> <span class="astro-acifyk5h" style="--depth: 0;">5.4 选项类型(optional types)</span> </a> <ul class="astro-acifyk5h" style="--depth: 1;"> <li class="astro-acifyk5h" style="--depth: 1;"> <a href="#案例-处理银行账户余额查询" class="astro-acifyk5h" style="--depth: 1;"> <span class="astro-acifyk5h" style="--depth: 1;">案例: 处理银行账户余额查询</span> </a>  </li> </ul>  </li><li class="astro-acifyk5h" style="--depth: 0;"> <a href="#55-错误处理类型error-handling-types" class="astro-acifyk5h" style="--depth: 0;"> <span class="astro-acifyk5h" style="--depth: 0;">5.5 错误处理类型(error handling types)</span> </a> <ul class="astro-acifyk5h" style="--depth: 1;"> <li class="astro-acifyk5h" style="--depth: 1;"> <a href="#551-result枚举类型" class="astro-acifyk5h" style="--depth: 1;"> <span class="astro-acifyk5h" style="--depth: 1;">5.5.1 Result枚举类型</span> </a>  </li><li class="astro-acifyk5h" style="--depth: 1;"> <a href="#552-panic-宏" class="astro-acifyk5h" style="--depth: 1;"> <span class="astro-acifyk5h" style="--depth: 1;">5.5.2 panic! 宏</span> </a>  </li><li class="astro-acifyk5h" style="--depth: 1;"> <a href="#553-常见错误处理方式的比较" class="astro-acifyk5h" style="--depth: 1;"> <span class="astro-acifyk5h" style="--depth: 1;">5.5.3 常见错误处理方式的比较</span> </a>  </li> </ul>  </li><li class="astro-acifyk5h" style="--depth: 0;"> <a href="#56-栈stack堆heap和箱子box" class="astro-acifyk5h" style="--depth: 0;"> <span class="astro-acifyk5h" style="--depth: 0;">5.6 栈(Stack)、堆(Heap)和箱子(Box)</span> </a> <ul class="astro-acifyk5h" style="--depth: 1;"> <li class="astro-acifyk5h" style="--depth: 1;"> <a href="#561-内存栈stack" class="astro-acifyk5h" style="--depth: 1;"> <span class="astro-acifyk5h" style="--depth: 1;">5.6.1 内存栈(Stack)</span> </a>  </li><li class="astro-acifyk5h" style="--depth: 1;"> <a href="#562-内存堆heap" class="astro-acifyk5h" style="--depth: 1;"> <span class="astro-acifyk5h" style="--depth: 1;">5.6.2 内存堆(Heap)</span> </a>  </li><li class="astro-acifyk5h" style="--depth: 1;"> <a href="#563-箱子box" class="astro-acifyk5h" style="--depth: 1;"> <span class="astro-acifyk5h" style="--depth: 1;">5.6.3 箱子(Box)</span> </a>  </li><li class="astro-acifyk5h" style="--depth: 1;"> <a href="#补充学习into_boxed_slice" class="astro-acifyk5h" style="--depth: 1;"> <span class="astro-acifyk5h" style="--depth: 1;">补充学习：into_boxed_slice</span> </a>  </li><li class="astro-acifyk5h" style="--depth: 1;"> <a href="#案例1-向大型金融数据集添加账户" class="astro-acifyk5h" style="--depth: 1;"> <span class="astro-acifyk5h" style="--depth: 1;">案例1： 向大型金融数据集添加账户</span> </a>  </li><li class="astro-acifyk5h" style="--depth: 1;"> <a href="#案例2处理多种可能的错误情况" class="astro-acifyk5h" style="--depth: 1;"> <span class="astro-acifyk5h" style="--depth: 1;">案例2：处理多种可能的错误情况</span> </a>  </li><li class="astro-acifyk5h" style="--depth: 1;"> <a href="#案例3多线程共享数据" class="astro-acifyk5h" style="--depth: 1;"> <span class="astro-acifyk5h" style="--depth: 1;">案例3：多线程共享数据</span> </a>  </li> </ul>  </li><li class="astro-acifyk5h" style="--depth: 0;"> <a href="#57-多线程处理multithreading" class="astro-acifyk5h" style="--depth: 0;"> <span class="astro-acifyk5h" style="--depth: 0;">5.7 多线程处理(Multithreading)</span> </a>  </li><li class="astro-acifyk5h" style="--depth: 0;"> <a href="#58-互斥锁" class="astro-acifyk5h" style="--depth: 0;"> <span class="astro-acifyk5h" style="--depth: 0;">5.8 互斥锁</span> </a> <ul class="astro-acifyk5h" style="--depth: 1;"> <li class="astro-acifyk5h" style="--depth: 1;"> <a href="#补充学习lock方法" class="astro-acifyk5h" style="--depth: 1;"> <span class="astro-acifyk5h" style="--depth: 1;">补充学习：lock方法</span> </a>  </li> </ul>  </li><li class="astro-acifyk5h" style="--depth: 0;"> <a href="#59-堆分配的指针heap-allocated-pointers" class="astro-acifyk5h" style="--depth: 0;"> <span class="astro-acifyk5h" style="--depth: 0;">5.9 堆分配的指针(heap allocated pointers)</span> </a> <ul class="astro-acifyk5h" style="--depth: 1;"> <li class="astro-acifyk5h" style="--depth: 1;"> <a href="#591-rc-指针reference-counting" class="astro-acifyk5h" style="--depth: 1;"> <span class="astro-acifyk5h" style="--depth: 1;">5.9.1 Rc 指针(Reference Counting)</span> </a>  </li><li class="astro-acifyk5h" style="--depth: 1;"> <a href="#592-arc指针atomic-reference-counting" class="astro-acifyk5h" style="--depth: 1;"> <span class="astro-acifyk5h" style="--depth: 1;">5.9.2 `Arc指针(Atomic Reference Counting)</span> </a>  </li><li class="astro-acifyk5h" style="--depth: 1;"> <a href="#593-常见的-rust-智能指针类型之间的比较" class="astro-acifyk5h" style="--depth: 1;"> <span class="astro-acifyk5h" style="--depth: 1;">5.9.3 常见的 Rust 智能指针类型之间的比较</span> </a>  </li><li class="astro-acifyk5h" style="--depth: 1;"> <a href="#案例使用多线程备份一组金融数据" class="astro-acifyk5h" style="--depth: 1;"> <span class="astro-acifyk5h" style="--depth: 1;">案例：使用多线程备份一组金融数据</span> </a>  </li> </ul>  </li> </ul> </nav></starlight-toc></div></div> </div> </aside> <div class="main-pane astro-3vvvt7cz">  <main data-pagefind-body lang="en" dir="ltr" class="astro-fpze62lo">    <div class="content-panel astro-vo2eo5fg"> <div class="sl-container astro-vo2eo5fg"> <h1 id="_top" class="astro-daoses2n">标准库类型</h1>  </div> </div>  <div class="content-panel astro-vo2eo5fg"> <div class="sl-container astro-vo2eo5fg"> <div class="sl-markdown-content"> <p>当提到 Rust 的标准库时，确实包含了许多自定义类型，它们在原生数据类型的基础上进行了扩展和增强，为 Rust 程序提供了更多的功能和灵活性。以下是一些常见的自定义类型和类型包装器：</p>
<ol>
<li>
<p><strong>可增长的字符串(<code dir="auto">String</code>)</strong>：</p>
<ul>
<li><code dir="auto">String</code> 是一个可变的、堆分配的字符串类型，与原生的字符串切片(<code dir="auto">str</code>)不同。它允许<strong>动态地</strong>增加和修改字符串内容。</li>
</ul>
<div class="expressive-code"><link rel="stylesheet" href="/_astro/ec.usa2f.css"><script type="module" src="/_astro/ec.sgewm.js"></script><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">greeting</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> String</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#82AAFF;--1:#3C63B3">from</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">Hello, </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">name</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">Alice</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">message</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">greeting</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#097174">+</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">name</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="let greeting = String::from(&#x22;Hello, &#x22;);let name = &#x22;Alice&#x22;;let message = greeting + name;"><div></div></button></div></figure></div>
</li>
<li>
<p><strong>可增长的向量(<code dir="auto">Vec</code>)</strong>：</p>
<ul>
<li><code dir="auto">Vec</code> 是一个可变的、堆分配的<strong>动态数组</strong>，可以根据需要动态增加或删除元素。</li>
</ul>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">mut</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">numbers</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> Vec</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#82AAFF;--1:#3C63B3">new</span><span style="--0:#D6DEEB;--1:#403F53">();</span></div><div class="ec-line"><span style="--0:#C5E478;--1:#3C63B3">numbers</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">push</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#F78C6C;--1:#AA0982">1</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div><div class="ec-line"><span style="--0:#C5E478;--1:#3C63B3">numbers</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">push</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#F78C6C;--1:#AA0982">2</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="let mut numbers = Vec::new();numbers.push(1);numbers.push(2);"><div></div></button></div></figure></div>
</li>
<li>
<p><strong>选项类型(<code dir="auto">Option</code>)</strong>：</p>
<ul>
<li><code dir="auto">Option</code> 表示一个可能存在也可能<strong>不存在的值</strong>，它用于处理缺失值的情况。它有两个变体：<code dir="auto">Some(value)</code> 表示存在一个值，<code dir="auto">None</code> 表示缺失值。</li>
</ul>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">fn</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">divide</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#C5E478;--1:#3C63B3">x</span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#D6DEEB;--1:#403F53"> f64, </span><span style="--0:#C5E478;--1:#3C63B3">y</span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#D6DEEB;--1:#403F53"> f64) </span><span style="--0:#7FDBCA;--1:#097174">-></span><span style="--0:#D6DEEB;--1:#403F53"> Option&#x3C;f64> {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">if</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">y</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">==</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#F78C6C;--1:#AA0982">0.0</span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        None</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    } </span><span style="--0:#C792EA;--1:#8D46B4">else</span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        Some(</span><span style="--0:#C5E478;--1:#3C63B3">x</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#097174">/</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">y</span><span style="--0:#D6DEEB;--1:#403F53">)</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    }</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">}</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="fn divide(x: f64, y: f64) -> Option<f64> {    if y == 0.0 {        None    } else {        Some(x / y)    }}"><div></div></button></div></figure></div>
</li>
<li>
<p><strong>错误处理类型(<code dir="auto">Result</code>)</strong>：</p>
<ul>
<li><code dir="auto">Result</code> 用于表示操作的结果，可能成功<strong>也可能失败</strong>。它有两个变体：<code dir="auto">Ok(value)</code> 表示操作成功并返回一个值，<code dir="auto">Err(error)</code> 表示操作失败并返回一个错误。</li>
</ul>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">fn</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">parse_input</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#C5E478;--1:#3C63B3">input</span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#097174">&#x26;</span><span style="--0:#D6DEEB;--1:#403F53">str) </span><span style="--0:#7FDBCA;--1:#097174">-></span><span style="--0:#D6DEEB;--1:#403F53"> Result&#x3C;i32, </span><span style="--0:#7FDBCA;--1:#097174">&#x26;</span><span style="--0:#D6DEEB;--1:#403F53">str> {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">if</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> Ok(</span><span style="--0:#C5E478;--1:#3C63B3">value</span><span style="--0:#D6DEEB;--1:#403F53">) </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">input</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">parse</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#D6DEEB;--1:#403F53">&#x3C;i32>() {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        Ok(</span><span style="--0:#C5E478;--1:#3C63B3">value</span><span style="--0:#D6DEEB;--1:#403F53">)</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    } </span><span style="--0:#C792EA;--1:#8D46B4">else</span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        Err(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">Invalid input</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">)</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    }</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">}</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="fn parse_input(input: &#x26;str) -> Result<i32, &#x26;str> {    if let Ok(value) = input.parse::<i32>() {        Ok(value)    } else {        Err(&#x22;Invalid input&#x22;)    }}"><div></div></button></div></figure></div>
</li>
<li>
<p><strong>堆分配的指针(<code dir="auto">Box</code>)</strong>：</p>
<ul>
<li><code dir="auto">Box</code> 是 Rust 的类型包装器，它允许将数据在堆上分配，并提供了堆数据的所有权。它通常用于管理内存和解决所有权问题。</li>
</ul>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">fn</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">create_boxed_integer</span><span style="--0:#D6DEEB;--1:#403F53">() </span><span style="--0:#7FDBCA;--1:#097174">-></span><span style="--0:#D6DEEB;--1:#403F53"> Box&#x3C;i32> {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    Box</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#82AAFF;--1:#3C63B3">new</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#F78C6C;--1:#AA0982">42</span><span style="--0:#D6DEEB;--1:#403F53">)</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">}</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="fn create_boxed_integer() -> Box<i32> {    Box::new(42)}"><div></div></button></div></figure></div>
</li>
</ol>
<p>这些标准类型和类型包装器扩展了 Rust 的基本数据类型，使其更适用于各种编程任务。</p>
<h2 id="51-字符串-string">5.1 字符串 (String)</h2>
<p><code dir="auto">String</code> 是 Rust 中的一种字符串类型，它是一个可变的、堆分配的字符串。下面详细解释和介绍 <code dir="auto">String</code>，包括其内存特征：</p>
<ol>
<li><strong>可变性</strong>：
<ul>
<li><code dir="auto">String</code> 是可变的，这意味着你可以动态地向其添加、修改或删除字符，而不需要创建一个新的字符串对象。</li>
</ul>
</li>
<li><strong>堆分配</strong>：
<ul>
<li><code dir="auto">String</code> 的内存是在堆上分配的。这意味着它的大小是动态的，可以根据需要动态增长或减小，而不受栈内存的限制。</li>
<li>堆分配的内存由 Rust 的所有权系统管理，当不再需要 <code dir="auto">String</code> 时，它会自动释放其内存，防止内存泄漏。</li>
</ul>
</li>
<li><strong>UTF-8 编码</strong>：
<ul>
<li><code dir="auto">String</code> 内部存储的数据是一个有效的 UTF-8 字符序列。UTF-8 是一种可变长度的字符编码，允许表示各种语言的字符，并且在全球范围内广泛使用。</li>
<li>由于 <code dir="auto">String</code> 内部是有效的 UTF-8 编码，因此它是一个合法的 Unicode 字符串。</li>
</ul>
</li>
<li><strong>字节向量(<code dir="auto">Vec&#x3C;u8></code>)</strong>：
<ul>
<li><code dir="auto">String</code> 的底层数据结构是一个由字节(<code dir="auto">u8</code>)组成的向量，即 <code dir="auto">Vec&#x3C;u8></code>。</li>
<li>这个字节向量存储了字符串的每个字符的 UTF-8 编码字节序列。</li>
</ul>
</li>
<li><strong>拥有所有权</strong>：
<ul>
<li><code dir="auto">String</code> 拥有其内部数据的所有权。这意味着当你将一个 <code dir="auto">String</code> 分配给另一个 <code dir="auto">String</code> 或在函数之间传递时，所有权会转移，而不是复制数据。这有助于避免不必要的内存复制。</li>
</ul>
</li>
<li><strong>克隆和复制</strong>：
<ul>
<li><code dir="auto">String</code> 类型实现了 <code dir="auto">Clone</code> trait，因此你可以使用 <code dir="auto">.clone()</code> 方法克隆一个 <code dir="auto">String</code>，这将创建一个新的 <code dir="auto">String</code>，拥有相同的内容。</li>
<li>与 <code dir="auto">&#x26;str</code> 不同，<code dir="auto">String</code> 是可以复制的(<code dir="auto">Copy</code> trait)，这意味着它在某些情况下可以自动复制，而不会移动所有权。</li>
</ul>
</li>
</ol>
<p><strong>示例：</strong></p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">fn</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">main</span><span style="--0:#D6DEEB;--1:#403F53">() {</span></div><div class="ec-line"><span style="--0:#809191;--1:#5E6578">    // 创建一个新的空字符串</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">mut</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">my_string</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> String</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#82AAFF;--1:#3C63B3">new</span><span style="--0:#D6DEEB;--1:#403F53">();</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#809191;--1:#5E6578">    // 向字符串添加内容</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C5E478;--1:#3C63B3">my_string</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">push_str</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">Hello, </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C5E478;--1:#3C63B3">my_string</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">push_str</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">world!</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#82AAFF;--1:#3C63B3">println!</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">{}</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#C5E478;--1:#3C63B3">my_string</span><span style="--0:#D6DEEB;--1:#403F53">);</span><span style="--0:#809191;--1:#5E6578"> // 输出 "Hello, world!"</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">}</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="fn main() {    // 创建一个新的空字符串    let mut my_string = String::new();    // 向字符串添加内容    my_string.push_str(&#x22;Hello, &#x22;);    my_string.push_str(&#x22;world!&#x22;);    println!(&#x22;{}&#x22;, my_string); // 输出 &#x22;Hello, world!&#x22;}"><div></div></button></div></figure></div>
<p><strong>总结：</strong></p>
<p><code dir="auto">String</code> 是 Rust 中的字符串类型，具有可变性、堆分配的特性，内部存储有效的 UTF-8 编码数据，并拥有所有权。它是一种非常有用的字符串类型，适合处理需要动态增长和修改内容的字符串操作。同时，Rust 的所有权系统确保了内存安全性和有效的内存管理。</p>
<p>之前我们在第三章详细讲过&#x26;str , 以下是一个表格，对比了 <code dir="auto">String</code> 和 <code dir="auto">&#x26;str</code> 这两种 Rust 字符串类型的主要特性：</p>




























































<table><thead><tr><th align="left">特性</th><th align="center"><code dir="auto">String</code></th><th align="center"><code dir="auto">&#x26;str</code></th></tr></thead><tbody><tr><td align="left">可变性</td><td align="center">可变</td><td align="center">不可变</td></tr><tr><td align="left">内存分配</td><td align="center">堆分配</td><td align="center">不拥有内存，通常是栈上的视图</td></tr><tr><td align="left">UTF-8 编码</td><td align="center">有效的 UTF-8 字符序列</td><td align="center">有效的 UTF-8 字符序列</td></tr><tr><td align="left">底层数据结构</td><td align="center"><code dir="auto">Vec&#x3C;u8></code>(字节向量)</td><td align="center">无(只是切片的引用)</td></tr><tr><td align="left">所有权</td><td align="center">拥有内部数据的所有权</td><td align="center">不拥有内部数据的所有权</td></tr><tr><td align="left">可克隆(Clone)</td><td align="center">可克隆(实现了 <code dir="auto">Clone</code> trait)</td><td align="center">不可克隆</td></tr><tr><td align="left">移动和复制</td><td align="center">移动或复制数据，具体情况而定</td><td align="center">复制切片的引用，无内存移动</td></tr><tr><td align="left">增加、修改和删除</td><td align="center">可以动态进行，不需要重新分配</td><td align="center">不可变，不能直接修改</td></tr><tr><td align="left">适用场景</td><td align="center">动态字符串，需要增加和修改内容</td><td align="center">读取、传递现有字符串的引用</td></tr><tr><td align="left">内存管理</td><td align="center">Rust 的所有权系统管理</td><td align="center">Rust 的借用和生命周期系统管理</td></tr></tbody></table>
<p>在生产环境中，根据你的具体需求来选择使用哪种类型，通常情况下，<code dir="auto">String</code> 适用于动态字符串内容的构建和修改，而 <code dir="auto">&#x26;str</code> 适用于只需要读取字符串内容的情况，或者作为函数参数和返回值。</p>
<h2 id="52-向量-vector">5.2 向量 (vector)</h2>
<p>向量(Vector)是 Rust 中的一种动态数组数据结构，它允许你存储多个相同类型的元素，并且可以在运行时动态增长或缩小。向量是 Rust 标准库(<code dir="auto">std::vec::Vec</code>)提供的一种非常有用的数据结构，以下是关于向量的详细解释：</p>
<p><strong>特性和用途</strong>：</p>
<ol>
<li>
<p><strong>动态大小</strong>：向量的大小可以在运行时<strong>动态增长或缩小</strong>，而不需要事先指定大小。这使得向量适用于需要动态管理元素的情况，避免了固定数组大小的限制。</p>
</li>
<li>
<p><strong>堆分配</strong>：向量的元素是在堆上分配的，这意味着它们不受栈内存的限制，<strong>可以容纳大量元素</strong>。向量的内存由 Rust 的所有权系统管理，确保在不再需要时释放内存。</p>
</li>
<li>
<p><strong>类型安全</strong>：向量只能<strong>存储相同类型的元素</strong>，这提供了类型安全性和编译时检查。如果尝试将不同类型的元素插入到向量中，Rust 编译器会报错。</p>
</li>
<li>
<p><strong>索引访问</strong>：可以使用索引来访问向量中的元素。Rust 的索引从 0 开始，因此第一个元素的索引为 0。</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">my_vec</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">vec!</span><span style="--0:#D6DEEB;--1:#403F53">[</span><span style="--0:#F78C6C;--1:#AA0982">1</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#F78C6C;--1:#AA0982">2</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#F78C6C;--1:#AA0982">3</span><span style="--0:#D6DEEB;--1:#403F53">];</span></div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">first_element</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">my_vec</span><span style="--0:#D6DEEB;--1:#403F53">[</span><span style="--0:#F78C6C;--1:#AA0982">0</span><span style="--0:#D6DEEB;--1:#403F53">];</span><span style="--0:#809191;--1:#5E6578"> // 访问第一个元素</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="let my_vec = vec![1, 2, 3];let first_element = my_vec[0]; // 访问第一个元素"><div></div></button></div></figure></div>
</li>
<li>
<p><strong>迭代</strong>：可以使用迭代器来遍历向量中的元素。Rust 提供了多种方法来迭代向量，包括 <code dir="auto">for</code> 循环、<code dir="auto">iter()</code> 方法等。</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">my_vec</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">vec!</span><span style="--0:#D6DEEB;--1:#403F53">[</span><span style="--0:#F78C6C;--1:#AA0982">1</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#F78C6C;--1:#AA0982">2</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#F78C6C;--1:#AA0982">3</span><span style="--0:#D6DEEB;--1:#403F53">];</span></div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">for</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">item</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">in</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#097174">&#x26;</span><span style="--0:#C5E478;--1:#3C63B3">my_vec</span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#82AAFF;--1:#3C63B3">println!</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">Element: {}</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#C5E478;--1:#3C63B3">item</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">}</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="let my_vec = vec![1, 2, 3];for item in &#x26;my_vec {    println!(&#x22;Element: {}&#x22;, item);}"><div></div></button></div></figure></div>
</li>
<li>
<p><strong>增加和删除元素</strong>：向量提供了多种方法来增加和删除元素，如 <code dir="auto">push()</code>、<code dir="auto">pop()</code>、<code dir="auto">insert()</code>、<code dir="auto">remove()</code> 等。</p>
<p>以下是关于 <code dir="auto">push()</code>、<code dir="auto">pop()</code>、<code dir="auto">insert()</code> 和 <code dir="auto">remove()</code> 方法的详细解释，以及它们之间的异同点：</p>






























<table><thead><tr><th>方法</th><th>功能</th><th>异同点</th></tr></thead><tbody><tr><td><code dir="auto">push(item)</code></td><td>向向量的末尾添加一个元素。</td><td>- <code dir="auto">push()</code> 方法是向向量的末尾添加元素。<br>- 可以传递单个元素，也可以传递多个元素。</td></tr><tr><td><code dir="auto">pop()</code></td><td>移除并返回向量的最后一个元素。</td><td>- <code dir="auto">pop()</code> 方法会移除并返回向量的最后一个元素。<br>- 如果向量为空，它会返回 <code dir="auto">None</code>(<code dir="auto">Option</code> 类型)。</td></tr><tr><td><code dir="auto">insert(index, item)</code></td><td>在指定索引位置插入一个元素。</td><td>- <code dir="auto">insert()</code> 方法可以在向量的任意位置插入元素。<br>- 需要传递要插入的索引和元素。<br>- 插入操作可能导致元素的移动，因此具有 O(n) 的时间复杂度。</td></tr><tr><td><code dir="auto">remove(index)</code></td><td>移除并返回指定索引位置的元素。</td><td>- <code dir="auto">remove()</code> 方法可以移除向量中指定索引位置的元素。<br>- 移除操作可能导致元素的移动，因此具有 O(n) 的时间复杂度。</td></tr></tbody></table>
<p>这些方法允许你在向量中添加、删除和修改元素，以及按照需要进行动态调整。需要注意的是，<code dir="auto">push()</code> 和 <code dir="auto">pop()</code> 通常用于向向量的末尾添加和移除元素，而 <code dir="auto">insert()</code> 和 <code dir="auto">remove()</code> 允许你在任意位置插入和移除元素。由于插入和移除操作可能涉及元素的移动，因此它们的时间复杂度是 O(n)，其中 n 是向量中的元素数量。</p>
<p><strong>示例：</strong></p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">fn</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">main</span><span style="--0:#D6DEEB;--1:#403F53">() {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">mut</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">my_vec</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">vec!</span><span style="--0:#D6DEEB;--1:#403F53">[</span><span style="--0:#F78C6C;--1:#AA0982">1</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#F78C6C;--1:#AA0982">2</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#F78C6C;--1:#AA0982">3</span><span style="--0:#D6DEEB;--1:#403F53">];</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C5E478;--1:#3C63B3">my_vec</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">push</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#F78C6C;--1:#AA0982">4</span><span style="--0:#D6DEEB;--1:#403F53">);</span><span style="--0:#809191;--1:#5E6578"> // 向末尾添加元素，my_vec 现在为 [1, 2, 3, 4]</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">popped</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">my_vec</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">pop</span><span style="--0:#D6DEEB;--1:#403F53">();</span><span style="--0:#809191;--1:#5E6578"> // 移除并返回最后一个元素，popped 是 Some(4)，my_vec 现在为 [1, 2, 3]</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C5E478;--1:#3C63B3">my_vec</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">insert</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#F78C6C;--1:#AA0982">1</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#F78C6C;--1:#AA0982">5</span><span style="--0:#D6DEEB;--1:#403F53">);</span><span style="--0:#809191;--1:#5E6578"> // 在索引 1 处插入元素 5，my_vec 现在为 [1, 5, 2, 3]</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">removed</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">my_vec</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">remove</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#F78C6C;--1:#AA0982">2</span><span style="--0:#D6DEEB;--1:#403F53">);</span><span style="--0:#809191;--1:#5E6578"> // 移除并返回索引 2 的元素，removed 是 2，my_vec 现在为 [1, 5, 3]</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#82AAFF;--1:#3C63B3">println!</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">my_vec after operations: {:?}</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#C5E478;--1:#3C63B3">my_vec</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#82AAFF;--1:#3C63B3">println!</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">Popped value: {:?}</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#C5E478;--1:#3C63B3">popped</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#82AAFF;--1:#3C63B3">println!</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">Removed value: {:?}</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#C5E478;--1:#3C63B3">removed</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">}</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="fn main() {    let mut my_vec = vec![1, 2, 3];    my_vec.push(4); // 向末尾添加元素，my_vec 现在为 [1, 2, 3, 4]    let popped = my_vec.pop(); // 移除并返回最后一个元素，popped 是 Some(4)，my_vec 现在为 [1, 2, 3]    my_vec.insert(1, 5); // 在索引 1 处插入元素 5，my_vec 现在为 [1, 5, 2, 3]    let removed = my_vec.remove(2); // 移除并返回索引 2 的元素，removed 是 2，my_vec 现在为 [1, 5, 3]    println!(&#x22;my_vec after operations: {:?}&#x22;, my_vec);    println!(&#x22;Popped value: {:?}&#x22;, popped);    println!(&#x22;Removed value: {:?}&#x22;, removed);}"><div></div></button></div></figure></div>
<p>执行结果：</p>
<div class="expressive-code"><figure class="frame is-terminal not-content"><figcaption class="header"><span class="title"></span><span class="sr-only">Terminal window</span></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#82AAFF;--1:#3C63B3">my_vec</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">after</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">operations:</span><span style="--0:#D6DEEB;--1:#403F53"> [1, </span><span style="--0:#F78C6C;--1:#AA0982">5</span><span style="--0:#ECC48D;--1:#3C63B3">,</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#F78C6C;--1:#AA0982">3</span><span style="--0:#ECC48D;--1:#3C63B3">]</span></div><div class="ec-line"><span style="--0:#82AAFF;--1:#3C63B3">Popped</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">value:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">Some</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#82AAFF;--1:#3C63B3">4</span><span style="--0:#D6DEEB;--1:#403F53">) </span><span style="--0:#809191;--1:#616671">#注意，pop()是有可能可以无法返回数值的方法，所以4会被some包裹。 具体我们会在本章第4节详叙。</span></div><div class="ec-line"><span style="--0:#82AAFF;--1:#3C63B3">Removed</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">value:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#F78C6C;--1:#AA0982">2</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="my_vec after operations: [1, 5, 3]Popped value: Some(4) #注意，pop()是有可能可以无法返回数值的方法，所以4会被some包裹。 具体我们会在本章第4节详叙。Removed value: 2"><div></div></button></div></figure></div>
<p>**总结：**这些方法是用于向向量中添加、移除和修改元素的常见操作，根据具体需求选择使用合适的方法。 <code dir="auto">push()</code> 和 <code dir="auto">pop()</code> 适用于末尾操作，而 <code dir="auto">insert()</code> 和 <code dir="auto">remove()</code> 可以在任何位置执行操作。但要注意，有时候插入和移除操作可能导致元素的移动，因此在性能敏感的情况下需要谨慎使用。</p>
</li>
<li>
<p><strong>切片操作</strong>：可以使用切片操作来获取向量的一部分，返回的是一个切片类型 <code dir="auto">&#x26;[T]</code>。</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">my_vec</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">vec!</span><span style="--0:#D6DEEB;--1:#403F53">[</span><span style="--0:#F78C6C;--1:#AA0982">1</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#F78C6C;--1:#AA0982">2</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#F78C6C;--1:#AA0982">3</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#F78C6C;--1:#AA0982">4</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#F78C6C;--1:#AA0982">5</span><span style="--0:#D6DEEB;--1:#403F53">];</span></div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">slice</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#097174">&#x26;</span><span style="--0:#C5E478;--1:#3C63B3">my_vec</span><span style="--0:#D6DEEB;--1:#403F53">[</span><span style="--0:#F78C6C;--1:#AA0982">1</span><span style="--0:#7FDBCA;--1:#097174">..</span><span style="--0:#F78C6C;--1:#AA0982">4</span><span style="--0:#D6DEEB;--1:#403F53">];</span><span style="--0:#809191;--1:#5E6578"> // 获取索引 1 到 3 的元素的切片</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="let my_vec = vec![1, 2, 3, 4, 5];let slice = &#x26;my_vec[1..4]; // 获取索引 1 到 3 的元素的切片"><div></div></button></div></figure></div>
</li>
</ol>
<h3 id="案例处理期货合约列表">案例：处理期货合约列表</h3>
<p>以下是一个示例，演示了如何使用 <code dir="auto">push()</code>、<code dir="auto">pop()</code>、<code dir="auto">insert()</code> 和 <code dir="auto">remove()</code> 方法对存储中国期货合约列表的向量进行操作</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">fn</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">main</span><span style="--0:#D6DEEB;--1:#403F53">() {</span></div><div class="ec-line"><span style="--0:#809191;--1:#5E6578">    // 创建一个向量来存储中国期货合约列表</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">mut</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">futures_contracts</span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#D6DEEB;--1:#403F53"> Vec&#x3C;String> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">vec!</span><span style="--0:#D6DEEB;--1:#403F53">[</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">AU2012</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">to_string</span><span style="--0:#D6DEEB;--1:#403F53">(),</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">IF2110</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">to_string</span><span style="--0:#D6DEEB;--1:#403F53">(),</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">C2109</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">to_string</span><span style="--0:#D6DEEB;--1:#403F53">(),</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    ];</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#809191;--1:#5E6578">    // 使用 push() 方法添加新的期货合约</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C5E478;--1:#3C63B3">futures_contracts</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">push</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">IH2110</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">to_string</span><span style="--0:#D6DEEB;--1:#403F53">());</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#809191;--1:#5E6578">    // 打印当前期货合约列表</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#82AAFF;--1:#3C63B3">println!</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">当前期货合约列表: {:?}</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#C5E478;--1:#3C63B3">futures_contracts</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#809191;--1:#5E6578">    // 使用 pop() 方法移除最后一个期货合约</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">popped_contract</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">futures_contracts</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">pop</span><span style="--0:#D6DEEB;--1:#403F53">();</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#82AAFF;--1:#3C63B3">println!</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">移除的最后一个期货合约: {:?}</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#C5E478;--1:#3C63B3">popped_contract</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#809191;--1:#5E6578">    // 使用 insert() 方法在指定位置插入新的期货合约</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C5E478;--1:#3C63B3">futures_contracts</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">insert</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#F78C6C;--1:#AA0982">1</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">IC2110</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">to_string</span><span style="--0:#D6DEEB;--1:#403F53">());</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#82AAFF;--1:#3C63B3">println!</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">插入新期货合约后的列表: {:?}</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#C5E478;--1:#3C63B3">futures_contracts</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#809191;--1:#5E6578">    // 使用 remove() 方法移除指定位置的期货合约</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">removed_contract</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">futures_contracts</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">remove</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#F78C6C;--1:#AA0982">2</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#82AAFF;--1:#3C63B3">println!</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">移除的第三个期货合约: {:?}</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#C5E478;--1:#3C63B3">removed_contract</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#809191;--1:#5E6578">    // 打印最终的期货合约列表</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#82AAFF;--1:#3C63B3">println!</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">最终期货合约列表: {:?}</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#C5E478;--1:#3C63B3">futures_contracts</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">}</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="fn main() {    // 创建一个向量来存储中国期货合约列表    let mut futures_contracts: Vec<String> = vec![        &#x22;AU2012&#x22;.to_string(),        &#x22;IF2110&#x22;.to_string(),        &#x22;C2109&#x22;.to_string(),    ];    // 使用 push() 方法添加新的期货合约    futures_contracts.push(&#x22;IH2110&#x22;.to_string());    // 打印当前期货合约列表    println!(&#x22;当前期货合约列表: {:?}&#x22;, futures_contracts);    // 使用 pop() 方法移除最后一个期货合约    let popped_contract = futures_contracts.pop();    println!(&#x22;移除的最后一个期货合约: {:?}&#x22;, popped_contract);    // 使用 insert() 方法在指定位置插入新的期货合约    futures_contracts.insert(1, &#x22;IC2110&#x22;.to_string());    println!(&#x22;插入新期货合约后的列表: {:?}&#x22;, futures_contracts);    // 使用 remove() 方法移除指定位置的期货合约    let removed_contract = futures_contracts.remove(2);    println!(&#x22;移除的第三个期货合约: {:?}&#x22;, removed_contract);    // 打印最终的期货合约列表    println!(&#x22;最终期货合约列表: {:?}&#x22;, futures_contracts);}"><div></div></button></div></figure></div>
<p><strong>执行结果：</strong></p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#d6deeb;--1:#403f53">当前期货合约列表: ["AU2012", "IF2110", "C2109", "IH2110"]</span></div><div class="ec-line"><span style="--0:#d6deeb;--1:#403f53">移除的最后一个期货合约: Some("IH2110")</span></div><div class="ec-line"><span style="--0:#d6deeb;--1:#403f53">插入新期货合约后的列表: ["AU2012", "IC2110", "IF2110", "C2109"]</span></div><div class="ec-line"><span style="--0:#d6deeb;--1:#403f53">移除的第三个期货合约: Some("IF2110")</span></div><div class="ec-line"><span style="--0:#d6deeb;--1:#403f53">最终期货合约列表: ["AU2012", "IC2110", "C2109"]</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="当前期货合约列表: [&#x22;AU2012&#x22;, &#x22;IF2110&#x22;, &#x22;C2109&#x22;, &#x22;IH2110&#x22;]移除的最后一个期货合约: Some(&#x22;IH2110&#x22;)插入新期货合约后的列表: [&#x22;AU2012&#x22;, &#x22;IC2110&#x22;, &#x22;IF2110&#x22;, &#x22;C2109&#x22;]移除的第三个期货合约: Some(&#x22;IF2110&#x22;)最终期货合约列表: [&#x22;AU2012&#x22;, &#x22;IC2110&#x22;, &#x22;C2109&#x22;]"><div></div></button></div></figure></div>
<p>这些输出显示了不同方法对中国期货合约列表的操作结果。我们使用 <code dir="auto">push()</code> 添加了一个期货合约，<code dir="auto">pop()</code> 移除了最后一个期货合约，<code dir="auto">insert()</code> 在指定位置插入了一个期货合约，而 <code dir="auto">remove()</code> 移除了指定位置的期货合约。最后，我们打印了最终的期货合约列表。</p>
<h2 id="53-哈希映射hashmap"><strong>5.3</strong> 哈希映射(Hashmap)</h2>
<p><code dir="auto">HashMap</code> 是 Rust 标准库中的一种数据结构，用于存储键值对(key-value pairs)。它是一种哈希表(hash table)的实现，允许你通过键来快速检索值。</p>
<p><code dir="auto">HashMap</code> 在 Rust 中的功能类似于 Python 中的字典(<code dir="auto">dict</code>)。它们都是用于存储键值对的数据结构，允许你通过键来查找对应的值。以下是一些类比：</p>
<ul>
<li>Rust 的 <code dir="auto">HashMap</code> &#x3C;=> Python 的 <code dir="auto">dict</code></li>
<li>Rust 的 键(key) &#x3C;=> Python 的 键(key)</li>
<li>Rust 的 值(value) &#x3C;=> Python 的 值(value)</li>
</ul>
<p>与 Python 字典类似，Rust 的 <code dir="auto">HashMap</code> 具有快速的查找性能，允许你通过键快速检索对应的值。此外，它们都是动态大小的，可以根据需要添加或删除键值对。然而，Rust 和 Python 在语法和语义上有一些不同之处，因为它们是不同的编程语言，具有不同的特性和约束。</p>
<p>总之，如果你熟悉 Python 中的字典操作，那么在 Rust 中使用 <code dir="auto">HashMap</code> 应该会感到非常自然，因为它们提供了类似的键值对存储和检索功能。以下是关于 <code dir="auto">HashMap</code> 的详细解释：</p>
<ol>
<li>
<p><strong>键值对存储</strong>：<code dir="auto">HashMap</code> 存储的数据以键值对的形式存在，每个键都有一个对应的值。键是唯一的，而值可以重复。</p>
</li>
<li>
<p><strong>动态大小</strong>：与数组不同，<code dir="auto">HashMap</code> 是动态大小的，这意味着它可以根据需要增长或缩小以容纳键值对。</p>
</li>
<li>
<p><strong>快速检索</strong>：<code dir="auto">HashMap</code> 的实现基于哈希表，这使得在其中查找值的速度非常快，通常是常数时间复杂度(O(1))。</p>
</li>
<li>
<p><strong>无序集合</strong>：<code dir="auto">HashMap</code> 不维护元素的顺序，因此它不会保留插入元素的顺序。如果需要有序集合，可以考虑使用 <code dir="auto">BTreeMap</code>。</p>
</li>
<li>
<p><strong>泛型支持</strong>：<code dir="auto">HashMap</code> 是泛型的，这意味着你可以在其中存储不同类型的键和值，只要它们满足 <code dir="auto">Eq</code> 和 <code dir="auto">Hash</code> trait 的要求。</p>
</li>
<li>
<p><strong>自动扩容</strong>：当 <code dir="auto">HashMap</code> 的负载因子(load factor)超过一定阈值时，它会自动扩容，以保持检索性能。</p>
</li>
<li>
<p><strong>安全性</strong>：Rust 的 <code dir="auto">HashMap</code> 提供了安全性保证，防止悬垂引用和数据竞争。它使用所有权系统来管理内存。</p>
</li>
<li>
<p><strong>示例用途</strong>：<code dir="auto">HashMap</code> 在许多情况下都非常有用，例如用于缓存、配置管理、数据索引等。它提供了一种高效的方式来存储和检索键值对。</p>
</li>
</ol>
<p>以下是一个简单的示例，展示如何创建、插入、检索和删除 <code dir="auto">HashMap</code> 中的键值对：</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">use</span><span style="--0:#D6DEEB;--1:#403F53"> std</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#D6DEEB;--1:#403F53">collections</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#D6DEEB;--1:#403F53">HashMap;</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">fn</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">main</span><span style="--0:#D6DEEB;--1:#403F53">() {</span></div><div class="ec-line"><span style="--0:#809191;--1:#5E6578">    // 创建一个空的 HashMap，键是字符串，值是整数</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">mut</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">scores</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> HashMap</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#82AAFF;--1:#3C63B3">new</span><span style="--0:#D6DEEB;--1:#403F53">();</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#809191;--1:#5E6578">    // 插入键值对</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C5E478;--1:#3C63B3">scores</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">insert</span><span style="--0:#D6DEEB;--1:#403F53">(String</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#82AAFF;--1:#3C63B3">from</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">Alice</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">), </span><span style="--0:#F78C6C;--1:#AA0982">100</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C5E478;--1:#3C63B3">scores</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">insert</span><span style="--0:#D6DEEB;--1:#403F53">(String</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#82AAFF;--1:#3C63B3">from</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">Bob</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">), </span><span style="--0:#F78C6C;--1:#AA0982">90</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#809191;--1:#5E6578">    // 检索键对应的值</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">_alice_score</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">scores</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">get</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">Alice</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">);</span><span style="--0:#809191;--1:#5E6578"> // 返回 Some(100)</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#809191;--1:#5E6578">    // 删除键值对</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C5E478;--1:#3C63B3">scores</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">remove</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">Bob</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#809191;--1:#5E6578">    // 遍历 HashMap 中的键值对</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">for</span><span style="--0:#D6DEEB;--1:#403F53"> (</span><span style="--0:#C5E478;--1:#3C63B3">name</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#C5E478;--1:#3C63B3">score</span><span style="--0:#D6DEEB;--1:#403F53">) </span><span style="--0:#C792EA;--1:#8D46B4">in</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#097174">&#x26;</span><span style="--0:#C5E478;--1:#3C63B3">scores</span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        </span><span style="--0:#82AAFF;--1:#3C63B3">println!</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">{} 的分数是 {}</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#C5E478;--1:#3C63B3">name</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#C5E478;--1:#3C63B3">score</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    }</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">}</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="use std::collections::HashMap;fn main() {    // 创建一个空的 HashMap，键是字符串，值是整数    let mut scores = HashMap::new();    // 插入键值对    scores.insert(String::from(&#x22;Alice&#x22;), 100);    scores.insert(String::from(&#x22;Bob&#x22;), 90);    // 检索键对应的值    let _alice_score = scores.get(&#x22;Alice&#x22;); // 返回 Some(100)    // 删除键值对    scores.remove(&#x22;Bob&#x22;);    // 遍历 HashMap 中的键值对    for (name, score) in &#x26;scores {        println!(&#x22;{} 的分数是 {}&#x22;, name, score);    }}"><div></div></button></div></figure></div>
<p><strong>执行结果</strong>：</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#d6deeb;--1:#403f53">Alice 的分数是 100</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="Alice 的分数是 100"><div></div></button></div></figure></div>
<p>这是一个简单的 <code dir="auto">HashMap</code> 示例，展示了如何使用 <code dir="auto">HashMap</code> 进行基本操作。你可以根据自己的需求插入、删除、检索键值对，以及遍历 <code dir="auto">HashMap</code> 中的元素。</p>
<h3 id="案例1管理股票价格数据">案例1：管理股票价格数据</h3>
<p>HashMap 当然也适合用于管理金融数据和执行各种金融计算。以下是一个简单的 Rust 量化金融案例，展示了如何使用 HashMap 来管理股票价格数据：</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">use</span><span style="--0:#D6DEEB;--1:#403F53"> std</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#D6DEEB;--1:#403F53">collections</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#D6DEEB;--1:#403F53">HashMap;</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#809191;--1:#5E6578">// 定义一个股票价格数据结构</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">#[derive(Debug)]</span></div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">struct</span><span style="--0:#D6DEEB;--1:#403F53"> StockPrice {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C5E478;--1:#3C63B3">symbol</span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#D6DEEB;--1:#403F53"> String,</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C5E478;--1:#3C63B3">price</span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#D6DEEB;--1:#403F53"> f64,</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">}</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">fn</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">main</span><span style="--0:#D6DEEB;--1:#403F53">() {</span></div><div class="ec-line"><span style="--0:#809191;--1:#5E6578">    // 创建一个空的 HashMap 来存储股票价格数据</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">mut</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">stock_prices</span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#D6DEEB;--1:#403F53"> HashMap&#x3C;String, StockPrice> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> HashMap</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#82AAFF;--1:#3C63B3">new</span><span style="--0:#D6DEEB;--1:#403F53">();</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#809191;--1:#5E6578">    // 添加股票价格数据</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">stock1</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> StockPrice {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        </span><span style="--0:#C5E478;--1:#3C63B3">symbol</span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#D6DEEB;--1:#403F53"> String</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#82AAFF;--1:#3C63B3">from</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">AAPL</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">),</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        </span><span style="--0:#C5E478;--1:#3C63B3">price</span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#F78C6C;--1:#AA0982">150.0</span><span style="--0:#D6DEEB;--1:#403F53">,</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    };</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C5E478;--1:#3C63B3">stock_prices</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">insert</span><span style="--0:#D6DEEB;--1:#403F53">(String</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#82AAFF;--1:#3C63B3">from</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">AAPL</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">), </span><span style="--0:#C5E478;--1:#3C63B3">stock1</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">stock2</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> StockPrice {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        </span><span style="--0:#C5E478;--1:#3C63B3">symbol</span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#D6DEEB;--1:#403F53"> String</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#82AAFF;--1:#3C63B3">from</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">GOOGL</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">),</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        </span><span style="--0:#C5E478;--1:#3C63B3">price</span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#F78C6C;--1:#AA0982">2800.0</span><span style="--0:#D6DEEB;--1:#403F53">,</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    };</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C5E478;--1:#3C63B3">stock_prices</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">insert</span><span style="--0:#D6DEEB;--1:#403F53">(String</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#82AAFF;--1:#3C63B3">from</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">GOOGL</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">), </span><span style="--0:#C5E478;--1:#3C63B3">stock2</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">stock3</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> StockPrice {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        </span><span style="--0:#C5E478;--1:#3C63B3">symbol</span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#D6DEEB;--1:#403F53"> String</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#82AAFF;--1:#3C63B3">from</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">MSFT</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">),</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        </span><span style="--0:#C5E478;--1:#3C63B3">price</span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#F78C6C;--1:#AA0982">300.0</span><span style="--0:#D6DEEB;--1:#403F53">,</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    };</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C5E478;--1:#3C63B3">stock_prices</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">insert</span><span style="--0:#D6DEEB;--1:#403F53">(String</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#82AAFF;--1:#3C63B3">from</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">MSFT</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">), </span><span style="--0:#C5E478;--1:#3C63B3">stock3</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#809191;--1:#5E6578">    // 查询股票价格</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">if</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> Some(</span><span style="--0:#C5E478;--1:#3C63B3">price</span><span style="--0:#D6DEEB;--1:#403F53">) </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">stock_prices</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">get</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">AAPL</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">) {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        </span><span style="--0:#82AAFF;--1:#3C63B3">println!</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">The price of AAPL is ${}</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#C5E478;--1:#3C63B3">price</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#D6DEEB;--1:#403F53">price);</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    } </span><span style="--0:#C792EA;--1:#8D46B4">else</span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        </span><span style="--0:#82AAFF;--1:#3C63B3">println!</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">AAPL not found in the stock prices.</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    }</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#809191;--1:#5E6578">    // 遍历并打印所有股票价格</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">for</span><span style="--0:#D6DEEB;--1:#403F53"> (</span><span style="--0:#C5E478;--1:#3C63B3">symbol</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#C5E478;--1:#3C63B3">price</span><span style="--0:#D6DEEB;--1:#403F53">) </span><span style="--0:#C792EA;--1:#8D46B4">in</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#097174">&#x26;</span><span style="--0:#C5E478;--1:#3C63B3">stock_prices</span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        </span><span style="--0:#82AAFF;--1:#3C63B3">println!</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">{}: ${}</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#C5E478;--1:#3C63B3">symbol</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#C5E478;--1:#3C63B3">price</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#D6DEEB;--1:#403F53">price);</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    }</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">}</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="use std::collections::HashMap;// 定义一个股票价格数据结构#[derive(Debug)]struct StockPrice {    symbol: String,    price: f64,}fn main() {    // 创建一个空的 HashMap 来存储股票价格数据    let mut stock_prices: HashMap<String, StockPrice> = HashMap::new();    // 添加股票价格数据    let stock1 = StockPrice {        symbol: String::from(&#x22;AAPL&#x22;),        price: 150.0,    };    stock_prices.insert(String::from(&#x22;AAPL&#x22;), stock1);    let stock2 = StockPrice {        symbol: String::from(&#x22;GOOGL&#x22;),        price: 2800.0,    };    stock_prices.insert(String::from(&#x22;GOOGL&#x22;), stock2);    let stock3 = StockPrice {        symbol: String::from(&#x22;MSFT&#x22;),        price: 300.0,    };    stock_prices.insert(String::from(&#x22;MSFT&#x22;), stock3);    // 查询股票价格    if let Some(price) = stock_prices.get(&#x22;AAPL&#x22;) {        println!(&#x22;The price of AAPL is ${}&#x22;, price.price);    } else {        println!(&#x22;AAPL not found in the stock prices.&#x22;);    }    // 遍历并打印所有股票价格    for (symbol, price) in &#x26;stock_prices {        println!(&#x22;{}: ${}&#x22;, symbol, price.price);    }}"><div></div></button></div></figure></div>
<p><strong>执行结果:</strong></p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#d6deeb;--1:#403f53">The price of AAPL is $150</span></div><div class="ec-line"><span style="--0:#d6deeb;--1:#403f53">GOOGL: $2800</span></div><div class="ec-line"><span style="--0:#d6deeb;--1:#403f53">MSFT: $300</span></div><div class="ec-line"><span style="--0:#d6deeb;--1:#403f53">AAPL: $150</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="The price of AAPL is $150GOOGL: $2800MSFT: $300AAPL: $150"><div></div></button></div></figure></div>
<h4 id="思考-的-hashmap-是不是和-python-的字典或者-c-的map有相似性"><strong>思考<div></div> 的 hashmap 是不是和 python 的字典或者 C++ 的map有相似性?</strong></h4>
<p>是的，Rust 中的 HashMap 与 Python 中的字典(Dictionary)和 C++ 中的 std::unordered_map(无序映射)有相似性。它们都是用于存储键值对的数据结构，允许你通过键快速查找值。</p>
<p>以下是一些共同点：</p>
<ol>
<li>
<p><strong>键值对存储</strong>：HashMap、字典和无序映射都以键值对的形式存储数据，每个键都映射到一个值。</p>
</li>
<li>
<p><strong>快速查找</strong>：它们都提供了快速的查找操作，你可以根据键来获取相应的值，时间复杂度通常为 O(1)。</p>
</li>
<li>
<p><strong>插入和删除</strong>：你可以在这些数据结构中插入新的键值对，也可以删除已有的键值对。</p>
</li>
<li>
<p><strong>可变性</strong>：它们都支持在已创建的数据结构中修改值。</p>
</li>
<li>
<p><strong>遍历</strong>：你可以遍历这些数据结构中的所有键值对。</p>
</li>
</ol>
<p>尽管它们在概念上相似，但在不同编程语言中的实现和用法可能会有一些差异。例如，Rust 的 HashMap 是类型安全的，要求键和值都具有相同的类型，而 Python 的字典可以容纳不同类型的键和值。此外，性能和内存管理方面也会有差异。</p>
<p>总之，这些数据结构在不同的编程语言中都用于相似的用途，但具体的实现和用法可能因语言而异。在选择使用时，应考虑语言的要求和性能特性。</p>
<h3 id="案例2-数据类型异质但是仍然安全的hashmap">案例2： 数据类型异质但是仍然安全的Hashmap</h3>
<p>在 Rust 中，标准库提供的 <code dir="auto">HashMap</code> 是类型安全的，这意味着在编译时，编译器会强制要求键和值都具有相同的类型。这是为了确保代码的类型安全性，防止在运行时发生类型不匹配的错误。</p>
<p>如果你需要在 Rust 中创建一个 HashMap，其中键和值具有不同的类型，你可以使用 Rust 的枚举(Enum)来实现这一目标。具体来说，你可以创建一个枚举，枚举的变体代表不同的类型，然后将枚举用作 HashMap 的值。这样，你可以在 HashMap 中存储不同类型的数据，而仍然保持类型安全。</p>
<p>以下是一个示例，演示了如何在 Rust 中创建一个 HashMap，其中键的类型是字符串，而值的类型是枚举，枚举的变体可以表示不同的数据类型：</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">use</span><span style="--0:#D6DEEB;--1:#403F53"> std</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#D6DEEB;--1:#403F53">collections</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#D6DEEB;--1:#403F53">HashMap;</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#809191;--1:#5E6578">// 定义一个枚举，表示不同的数据类型</span></div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">enum</span><span style="--0:#D6DEEB;--1:#403F53"> Value {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#82AAFF;--1:#3C63B3">Integer</span><span style="--0:#D6DEEB;--1:#403F53">(i32),</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#82AAFF;--1:#3C63B3">Float</span><span style="--0:#D6DEEB;--1:#403F53">(f64),</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#82AAFF;--1:#3C63B3">String</span><span style="--0:#D6DEEB;--1:#403F53">(String),</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">}</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">fn</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">main</span><span style="--0:#D6DEEB;--1:#403F53">() {</span></div><div class="ec-line"><span style="--0:#809191;--1:#5E6578">    // 创建一个 HashMap，键是字符串，值是枚举</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">mut</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">data</span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#D6DEEB;--1:#403F53"> HashMap&#x3C;String, Value> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> HashMap</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#82AAFF;--1:#3C63B3">new</span><span style="--0:#D6DEEB;--1:#403F53">();</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#809191;--1:#5E6578">    // 向 HashMap 中添加不同类型的数据</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C5E478;--1:#3C63B3">data</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">insert</span><span style="--0:#D6DEEB;--1:#403F53">(String</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#82AAFF;--1:#3C63B3">from</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">age</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">), Value</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#82AAFF;--1:#3C63B3">Integer</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#F78C6C;--1:#AA0982">30</span><span style="--0:#D6DEEB;--1:#403F53">));</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C5E478;--1:#3C63B3">data</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">insert</span><span style="--0:#D6DEEB;--1:#403F53">(String</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#82AAFF;--1:#3C63B3">from</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">height</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">), Value</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#82AAFF;--1:#3C63B3">Float</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#F78C6C;--1:#AA0982">175.5</span><span style="--0:#D6DEEB;--1:#403F53">));</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C5E478;--1:#3C63B3">data</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">insert</span><span style="--0:#D6DEEB;--1:#403F53">(String</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#82AAFF;--1:#3C63B3">from</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">name</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">), Value</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#82AAFF;--1:#3C63B3">String</span><span style="--0:#D6DEEB;--1:#403F53">(String</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#82AAFF;--1:#3C63B3">from</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">John</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">)));</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#809191;--1:#5E6578">    // 访问和打印数据</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">if</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> Some(</span><span style="--0:#C5E478;--1:#3C63B3">value</span><span style="--0:#D6DEEB;--1:#403F53">) </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">data</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">get</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">age</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">) {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        </span><span style="--0:#C792EA;--1:#8D46B4">match</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">value</span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">            Value</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#82AAFF;--1:#3C63B3">Integer</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#C5E478;--1:#3C63B3">age</span><span style="--0:#D6DEEB;--1:#403F53">) </span><span style="--0:#7FDBCA;--1:#097174">=></span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">println!</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">Age: {}</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#C5E478;--1:#3C63B3">age</span><span style="--0:#D6DEEB;--1:#403F53">),</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">            </span><span style="--0:#C5E478;--1:#3C63B3">_</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#097174">=></span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">println!</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">Invalid data type for age.</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">),</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        }</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    }</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">if</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> Some(</span><span style="--0:#C5E478;--1:#3C63B3">value</span><span style="--0:#D6DEEB;--1:#403F53">) </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">data</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">get</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">height</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">) {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        </span><span style="--0:#C792EA;--1:#8D46B4">match</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">value</span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">            Value</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#82AAFF;--1:#3C63B3">Float</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#C5E478;--1:#3C63B3">height</span><span style="--0:#D6DEEB;--1:#403F53">) </span><span style="--0:#7FDBCA;--1:#097174">=></span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">println!</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">Height: {}</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#C5E478;--1:#3C63B3">height</span><span style="--0:#D6DEEB;--1:#403F53">),</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">            </span><span style="--0:#C5E478;--1:#3C63B3">_</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#097174">=></span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">println!</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">Invalid data type for height.</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">),</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        }</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    }</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">if</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> Some(</span><span style="--0:#C5E478;--1:#3C63B3">value</span><span style="--0:#D6DEEB;--1:#403F53">) </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">data</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">get</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">name</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">) {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        </span><span style="--0:#C792EA;--1:#8D46B4">match</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">value</span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">            Value</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#82AAFF;--1:#3C63B3">String</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#C5E478;--1:#3C63B3">name</span><span style="--0:#D6DEEB;--1:#403F53">) </span><span style="--0:#7FDBCA;--1:#097174">=></span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">println!</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">Name: {}</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#C5E478;--1:#3C63B3">name</span><span style="--0:#D6DEEB;--1:#403F53">),</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">            </span><span style="--0:#C5E478;--1:#3C63B3">_</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#097174">=></span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">println!</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">Invalid data type for name.</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">),</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        }</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    }</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">}</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="use std::collections::HashMap;// 定义一个枚举，表示不同的数据类型enum Value {    Integer(i32),    Float(f64),    String(String),}fn main() {    // 创建一个 HashMap，键是字符串，值是枚举    let mut data: HashMap<String, Value> = HashMap::new();    // 向 HashMap 中添加不同类型的数据    data.insert(String::from(&#x22;age&#x22;), Value::Integer(30));    data.insert(String::from(&#x22;height&#x22;), Value::Float(175.5));    data.insert(String::from(&#x22;name&#x22;), Value::String(String::from(&#x22;John&#x22;)));    // 访问和打印数据    if let Some(value) = data.get(&#x22;age&#x22;) {        match value {            Value::Integer(age) => println!(&#x22;Age: {}&#x22;, age),            _ => println!(&#x22;Invalid data type for age.&#x22;),        }    }    if let Some(value) = data.get(&#x22;height&#x22;) {        match value {            Value::Float(height) => println!(&#x22;Height: {}&#x22;, height),            _ => println!(&#x22;Invalid data type for height.&#x22;),        }    }    if let Some(value) = data.get(&#x22;name&#x22;) {        match value {            Value::String(name) => println!(&#x22;Name: {}&#x22;, name),            _ => println!(&#x22;Invalid data type for name.&#x22;),        }    }}"><div></div></button></div></figure></div>
<p><strong>执行结果:</strong></p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#d6deeb;--1:#403f53">Age: 30</span></div><div class="ec-line"><span style="--0:#d6deeb;--1:#403f53">Height: 175.5</span></div><div class="ec-line"><span style="--0:#d6deeb;--1:#403f53">Name: John</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="Age: 30Height: 175.5Name: John"><div></div></button></div></figure></div>
<p>在这个示例中，我们定义了一个名为 <code dir="auto">Value</code> 的枚举，它有三个变体，分别代表整数、浮点数和字符串类型的数据。然后，我们创建了一个 HashMap，其中键是字符串，值是 <code dir="auto">Value</code> 枚举。这使得我们可以在 HashMap 中存储不同类型的数据，而仍然保持类型安全。</p>
<h2 id="54-选项类型optional-types">5.4 选项类型(optional types)</h2>
<p>选项类型(Option types)是 Rust 中一种非常重要的枚举类型，<strong>用于表示一个值要么存在，要么不存在的情况</strong>。这种概念在实现了图灵完备的编程语言中非常常见，尤其是在处理可能出现错误或缺失数据的情况下非常有用。下面详细论述 Rust 中的选项类型：</p>
<ol>
<li>
<p><strong>枚举定义</strong>：</p>
<p>在 Rust 中，选项类型由标准库的 <code dir="auto">Option</code> 枚举来表示。它有两个变体：</p>
<ul>
<li><code dir="auto">Some(T)</code>: 表示一个值存在，并将这个值封装在 <code dir="auto">Some</code> 内。</li>
<li><code dir="auto">None</code>: 表示值不存在，通常用于表示缺失数据或错误。</li>
</ul>
<p><code dir="auto">Option</code> 的定义如下：</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">enum</span><span style="--0:#D6DEEB;--1:#403F53"> Option&#x3C;T> {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    Some(T),</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    None,</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">}</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="enum Option<T> {    Some(T),    None,}"><div></div></button></div></figure></div>
</li>
<li>
<p><strong>用途</strong>：</p>
<ul>
<li>
<p><strong>处理可能的空值</strong>：选项类型常用于处理可能为空(<code dir="auto">null</code> 或 <code dir="auto">nil</code>)的情况。它允许你明确地处理值的存在和缺失，而不会出现空指针异常。</p>
</li>
<li>
<p><strong>错误处理</strong>：选项类型也用于函数返回值，特别是那些可能会出现错误的情况。例如，<code dir="auto">Result</code> 类型就是基于 <code dir="auto">Option</code> 构建的，其中 <code dir="auto">Ok(T)</code> 表示成功并包含一个值，而 <code dir="auto">Err(E)</code> 表示错误并包含一个错误信息。</p>
</li>
</ul>
</li>
<li>
<p><strong>示例</strong>：</p>
<p>使用选项类型来处理可能为空的情况非常常见。以下是一个示例，演示了如何使用选项类型来查找向量中的最大值：</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">fn</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">find_max</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#C5E478;--1:#3C63B3">numbers</span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#D6DEEB;--1:#403F53"> Vec&#x3C;i32>) </span><span style="--0:#7FDBCA;--1:#097174">-></span><span style="--0:#D6DEEB;--1:#403F53"> Option&#x3C;i32> {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">if</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">numbers</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">is_empty</span><span style="--0:#D6DEEB;--1:#403F53">() {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        </span><span style="--0:#C792EA;--1:#8D46B4">return</span><span style="--0:#D6DEEB;--1:#403F53"> None;</span><span style="--0:#809191;--1:#5E6578"> // 空向量，返回 None 表示值不存在</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    }</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">mut</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">max</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">numbers</span><span style="--0:#D6DEEB;--1:#403F53">[</span><span style="--0:#F78C6C;--1:#AA0982">0</span><span style="--0:#D6DEEB;--1:#403F53">];</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">for</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#097174">&#x26;</span><span style="--0:#C5E478;--1:#3C63B3">num</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">in</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#097174">&#x26;</span><span style="--0:#C5E478;--1:#3C63B3">numbers</span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        </span><span style="--0:#C792EA;--1:#8D46B4">if</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">num</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">></span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">max</span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">            </span><span style="--0:#C5E478;--1:#3C63B3">max</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">num</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        }</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    }</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    Some(</span><span style="--0:#C5E478;--1:#3C63B3">max</span><span style="--0:#D6DEEB;--1:#403F53">)</span><span style="--0:#809191;--1:#5E6578"> // 返回最大值封装在 Some 内</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">}</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">fn</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">main</span><span style="--0:#D6DEEB;--1:#403F53">() {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">numbers</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">vec!</span><span style="--0:#D6DEEB;--1:#403F53">[</span><span style="--0:#F78C6C;--1:#AA0982">10</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#F78C6C;--1:#AA0982">5</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#F78C6C;--1:#AA0982">20</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#F78C6C;--1:#AA0982">8</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#F78C6C;--1:#AA0982">15</span><span style="--0:#D6DEEB;--1:#403F53">];</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">match</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">find_max</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#C5E478;--1:#3C63B3">numbers</span><span style="--0:#D6DEEB;--1:#403F53">) {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        Some(</span><span style="--0:#C5E478;--1:#3C63B3">max</span><span style="--0:#D6DEEB;--1:#403F53">) </span><span style="--0:#7FDBCA;--1:#097174">=></span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">println!</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">最大值是: {}</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#C5E478;--1:#3C63B3">max</span><span style="--0:#D6DEEB;--1:#403F53">),</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        None </span><span style="--0:#7FDBCA;--1:#097174">=></span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">println!</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">向量为空或没有最大值。</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">),</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    }</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">}</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="fn find_max(numbers: Vec<i32>) -> Option<i32> {    if numbers.is_empty() {        return None; // 空向量，返回 None 表示值不存在    }    let mut max = numbers[0];    for &#x26;num in &#x26;numbers {        if num > max {            max = num;        }    }    Some(max) // 返回最大值封装在 Some 内}fn main() {    let numbers = vec![10, 5, 20, 8, 15];    match find_max(numbers) {        Some(max) => println!(&#x22;最大值是: {}&#x22;, max),        None => println!(&#x22;向量为空或没有最大值。&#x22;),    }}"><div></div></button></div></figure></div>
<p>在这个示例中，<code dir="auto">find_max</code> 函数接受一个整数向量，并返回一个 <code dir="auto">Option&#x3C;i32></code> 类型的结果。如果向量为空，它返回 <code dir="auto">None</code>；否则，返回最大值封装在 <code dir="auto">Some</code> 中。在 <code dir="auto">main</code> 函数中，我们使用 <code dir="auto">match</code> 表达式来处理 <code dir="auto">find_max</code> 的结果，分别处理存在值和不存在值的情况。</p>
</li>
<li>
<p><strong>unwrap 和 expect 方法</strong>：</p>
<p>为了从 <code dir="auto">Option</code> 中获取封装的值，你可以使用 <code dir="auto">unwrap()</code> 方法。但要小心，如果 <code dir="auto">Option</code> 是 <code dir="auto">None</code>，调用 <code dir="auto">unwrap()</code> 将导致程序 panic。</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">result</span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#D6DEEB;--1:#403F53"> Option&#x3C;i32> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> Some(</span><span style="--0:#F78C6C;--1:#AA0982">42</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">value</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">result</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">unwrap</span><span style="--0:#D6DEEB;--1:#403F53">();</span><span style="--0:#809191;--1:#5E6578"> // 如果是 Some，获取封装的值，否则 panic</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="let result: Option<i32> = Some(42);let value = result.unwrap(); // 如果是 Some，获取封装的值，否则 panic"><div></div></button></div></figure></div>
<p>为了更加安全地处理 <code dir="auto">None</code>，你可以使用 <code dir="auto">expect()</code> 方法，它允许你提供一个自定义的错误消息。</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">result</span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#D6DEEB;--1:#403F53"> Option&#x3C;i32> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> None;</span></div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">value</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">result</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">expect</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">值不存在</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">);</span><span style="--0:#809191;--1:#5E6578"> // 提供自定义的错误消息</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="let result: Option<i32> = None;let value = result.expect(&#x22;值不存在&#x22;); // 提供自定义的错误消息"><div></div></button></div></figure></div>
</li>
<li>
<p><strong>if let 表达式</strong>：</p>
<p>你可以使用 <code dir="auto">if let</code> 表达式来简化匹配 <code dir="auto">Option</code> 的过程，特别是在只关心其中一种情况的情况下。</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">result</span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#D6DEEB;--1:#403F53"> Option&#x3C;i32> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> Some(</span><span style="--0:#F78C6C;--1:#AA0982">42</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">if</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> Some(</span><span style="--0:#C5E478;--1:#3C63B3">value</span><span style="--0:#D6DEEB;--1:#403F53">) </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">result</span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#82AAFF;--1:#3C63B3">println!</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">存在值: {}</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#C5E478;--1:#3C63B3">value</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">} </span><span style="--0:#C792EA;--1:#8D46B4">else</span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#82AAFF;--1:#3C63B3">println!</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">值不存在</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">}</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="let result: Option<i32> = Some(42);if let Some(value) = result {    println!(&#x22;存在值: {}&#x22;, value);} else {    println!(&#x22;值不存在&#x22;);}"><div></div></button></div></figure></div>
<p>这可以减少代码的嵌套，并使代码更加清晰。</p>
</li>
</ol>
<p>总之，选项类型(Option types)是 Rust 中用于表示值的存在和缺失的强大工具，可用于处理可能为空的情况以及错误处理。它是 Rust 语言的核心特性之一，有助于编写更安全和可靠的代码。</p>
<h3 id="案例-处理银行账户余额查询">案例: 处理银行账户余额查询</h3>
<p>以下是一个简单的金融领域案例，演示了如何在 Rust 中使用选项类型来处理银行账户余额查询的情况：</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">struct</span><span style="--0:#D6DEEB;--1:#403F53"> BankAccount {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C5E478;--1:#3C63B3">account_holder</span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#D6DEEB;--1:#403F53"> String,</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C5E478;--1:#3C63B3">balance</span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#D6DEEB;--1:#403F53"> Option&#x3C;f64>,</span><span style="--0:#809191;--1:#5E6578"> // 使用选项类型表示余额，可能为空</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">}</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">impl</span><span style="--0:#D6DEEB;--1:#403F53"> BankAccount {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">fn</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">new</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#C5E478;--1:#3C63B3">account_holder</span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#097174">&#x26;</span><span style="--0:#D6DEEB;--1:#403F53">str) </span><span style="--0:#7FDBCA;--1:#097174">-></span><span style="--0:#D6DEEB;--1:#403F53"> BankAccount {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        BankAccount {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">            </span><span style="--0:#C5E478;--1:#3C63B3">account_holder</span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">account_holder</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">to_string</span><span style="--0:#D6DEEB;--1:#403F53">(),</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">            </span><span style="--0:#C5E478;--1:#3C63B3">balance</span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#D6DEEB;--1:#403F53"> None,</span><span style="--0:#809191;--1:#5E6578"> // 初始时没有余额</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        }</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    }</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">fn</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">deposit</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#7FDBCA;--1:#097174">&#x26;</span><span style="--0:#C792EA;--1:#8D46B4">mut</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#097174">self</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#C5E478;--1:#3C63B3">amount</span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#D6DEEB;--1:#403F53"> f64) {</span></div><div class="ec-line"><span style="--0:#809191;--1:#5E6578">        // 存款操作，更新余额</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        </span><span style="--0:#C792EA;--1:#8D46B4">if</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> Some(</span><span style="--0:#C5E478;--1:#3C63B3">existing_balance</span><span style="--0:#D6DEEB;--1:#403F53">) </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#097174">self.</span><span style="--0:#D6DEEB;--1:#403F53">balance {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">            </span><span style="--0:#7FDBCA;--1:#097174">self.</span><span style="--0:#D6DEEB;--1:#403F53">balance </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> Some(</span><span style="--0:#C5E478;--1:#3C63B3">existing_balance</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#097174">+</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">amount</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        } </span><span style="--0:#C792EA;--1:#8D46B4">else</span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">            </span><span style="--0:#7FDBCA;--1:#097174">self.</span><span style="--0:#D6DEEB;--1:#403F53">balance </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> Some(</span><span style="--0:#C5E478;--1:#3C63B3">amount</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        }</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    }</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">fn</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">withdraw</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#7FDBCA;--1:#097174">&#x26;</span><span style="--0:#C792EA;--1:#8D46B4">mut</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#097174">self</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#C5E478;--1:#3C63B3">amount</span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#D6DEEB;--1:#403F53"> f64) </span><span style="--0:#7FDBCA;--1:#097174">-></span><span style="--0:#D6DEEB;--1:#403F53"> Option&#x3C;f64> {</span></div><div class="ec-line"><span style="--0:#809191;--1:#5E6578">        // 取款操作，更新余额并返回取款金额</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        </span><span style="--0:#C792EA;--1:#8D46B4">if</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> Some(</span><span style="--0:#C5E478;--1:#3C63B3">existing_balance</span><span style="--0:#D6DEEB;--1:#403F53">) </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#097174">self.</span><span style="--0:#D6DEEB;--1:#403F53">balance {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">            </span><span style="--0:#C792EA;--1:#8D46B4">if</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">existing_balance</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">>=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">amount</span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">                </span><span style="--0:#7FDBCA;--1:#097174">self.</span><span style="--0:#D6DEEB;--1:#403F53">balance </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> Some(</span><span style="--0:#C5E478;--1:#3C63B3">existing_balance</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#097174">-</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">amount</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">                Some(</span><span style="--0:#C5E478;--1:#3C63B3">amount</span><span style="--0:#D6DEEB;--1:#403F53">)</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">            } </span><span style="--0:#C792EA;--1:#8D46B4">else</span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">                None</span><span style="--0:#809191;--1:#5E6578"> // 余额不足，返回 None 表示取款失败</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">            }</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        } </span><span style="--0:#C792EA;--1:#8D46B4">else</span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">            None</span><span style="--0:#809191;--1:#5E6578"> // 没有余额可取，返回 None</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        }</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    }</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">fn</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">check_balance</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#7FDBCA;--1:#097174">&#x26;self</span><span style="--0:#D6DEEB;--1:#403F53">) </span><span style="--0:#7FDBCA;--1:#097174">-></span><span style="--0:#D6DEEB;--1:#403F53"> Option&#x3C;f64> {</span></div><div class="ec-line"><span style="--0:#809191;--1:#5E6578">        // 查询余额操作</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        </span><span style="--0:#7FDBCA;--1:#097174">self.</span><span style="--0:#D6DEEB;--1:#403F53">balance</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    }</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">}</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">fn</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">main</span><span style="--0:#D6DEEB;--1:#403F53">() {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">mut</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">account</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> BankAccount</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#82AAFF;--1:#3C63B3">new</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">Alice</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">);</span><span style="--0:#809191;--1:#5E6578"> // 建立新账户，里面没有余额。</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C5E478;--1:#3C63B3">account</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">deposit</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#F78C6C;--1:#AA0982">1000.0</span><span style="--0:#D6DEEB;--1:#403F53">);</span><span style="--0:#809191;--1:#5E6578"> // 存入1000</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#82AAFF;--1:#3C63B3">println!</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">存款后的余额: {:?}</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#C5E478;--1:#3C63B3">account</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">check_balance</span><span style="--0:#D6DEEB;--1:#403F53">());</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">if</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> Some(</span><span style="--0:#C5E478;--1:#3C63B3">withdrawn_amount</span><span style="--0:#D6DEEB;--1:#403F53">) </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">account</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">withdraw</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#F78C6C;--1:#AA0982">500.0</span><span style="--0:#D6DEEB;--1:#403F53">) {</span><span style="--0:#809191;--1:#5E6578">  // 在Some方法的包裹下安全取走500</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        </span><span style="--0:#82AAFF;--1:#3C63B3">println!</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">成功取款: {:?}</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#C5E478;--1:#3C63B3">withdrawn_amount</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    } </span><span style="--0:#C792EA;--1:#8D46B4">else</span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        </span><span style="--0:#82AAFF;--1:#3C63B3">println!</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">取款失败，余额不足或没有余额。</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    }</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#82AAFF;--1:#3C63B3">println!</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">最终余额: {:?}</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#C5E478;--1:#3C63B3">account</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">check_balance</span><span style="--0:#D6DEEB;--1:#403F53">());</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">}</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="struct BankAccount {    account_holder: String,    balance: Option<f64>, // 使用选项类型表示余额，可能为空}impl BankAccount {    fn new(account_holder: &#x26;str) -> BankAccount {        BankAccount {            account_holder: account_holder.to_string(),            balance: None, // 初始时没有余额        }    }    fn deposit(&#x26;mut self, amount: f64) {        // 存款操作，更新余额        if let Some(existing_balance) = self.balance {            self.balance = Some(existing_balance + amount);        } else {            self.balance = Some(amount);        }    }    fn withdraw(&#x26;mut self, amount: f64) -> Option<f64> {        // 取款操作，更新余额并返回取款金额        if let Some(existing_balance) = self.balance {            if existing_balance >= amount {                self.balance = Some(existing_balance - amount);                Some(amount)            } else {                None // 余额不足，返回 None 表示取款失败            }        } else {            None // 没有余额可取，返回 None        }    }    fn check_balance(&#x26;self) -> Option<f64> {        // 查询余额操作        self.balance    }}fn main() {    let mut account = BankAccount::new(&#x22;Alice&#x22;); // 建立新账户，里面没有余额。    account.deposit(1000.0); // 存入1000    println!(&#x22;存款后的余额: {:?}&#x22;, account.check_balance());    if let Some(withdrawn_amount) = account.withdraw(500.0) {  // 在Some方法的包裹下安全取走500        println!(&#x22;成功取款: {:?}&#x22;, withdrawn_amount);    } else {        println!(&#x22;取款失败，余额不足或没有余额。&#x22;);    }    println!(&#x22;最终余额: {:?}&#x22;, account.check_balance());}"><div></div></button></div></figure></div>
<p><strong>执行结果：</strong></p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#d6deeb;--1:#403f53">存款后的余额: Some(1000.0)</span></div><div class="ec-line"><span style="--0:#d6deeb;--1:#403f53">成功取款: 500.0</span></div><div class="ec-line"><span style="--0:#d6deeb;--1:#403f53">最终余额: Some(500.0)</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="存款后的余额: Some(1000.0)成功取款: 500.0最终余额: Some(500.0)"><div></div></button></div></figure></div>
<p>在这个示例中，我们定义了一个 <code dir="auto">BankAccount</code> 结构体，其中 <code dir="auto">balance</code> 使用了选项类型 <code dir="auto">Option&#x3C;f64></code> 表示余额。我们实现了存款 (<code dir="auto">deposit</code>)、取款 (<code dir="auto">withdraw</code>) 和查询余额 (<code dir="auto">check_balance</code>) 的方法来操作账户余额。这些方法都使用了选项类型来处理可能的空值情况。</p>
<p>在 <code dir="auto">main</code> 函数中，我们创建了一个银行账户，进行了存款和取款操作，并查询了最终的余额。使用选项类型使我们能够更好地处理可能的错误或空值情况，以确保银行账户操作的安全性和可靠性。</p>
<h2 id="55-错误处理类型error-handling-types">5.5 错误处理类型(error handling types)</h2>
<h3 id="551-result枚举类型">5.5.1 Result枚举类型</h3>
<p><code dir="auto">Result</code> 是 Rust 中用于处理可能产生错误的值的枚举类型。它被广泛用于 Rust 程序中，用于返回函数执行的结果，并允许明确地处理潜在的错误情况。<code dir="auto">Result</code> 枚举有两个变体：</p>
<ol>
<li>
<p><code dir="auto">Ok(T)</code>：表示操作成功，包含一个类型为 <code dir="auto">T</code> 的值，其中 <code dir="auto">T</code> 是成功结果的类型。</p>
</li>
<li>
<p><code dir="auto">Err(E)</code>：表示操作失败，包含一个类型为 <code dir="auto">E</code> 的错误值，其中 <code dir="auto">E</code> 是错误的类型。错误值通常用于携带有关失败原因的信息。</p>
</li>
</ol>
<p><code dir="auto">Result</code> 的主要目标是提供一种安全、可靠的方式来处理错误，而不需要在函数中使用异常。它强制程序员显式地处理错误，以确保错误情况不会被忽略。</p>
<p>以下是使用 <code dir="auto">Result</code> 的一些示例：</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">use</span><span style="--0:#D6DEEB;--1:#403F53"> std</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#D6DEEB;--1:#403F53">fs</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#D6DEEB;--1:#403F53">File;</span><span style="--0:#809191;--1:#5E6578">           // 导入文件操作相关的模块</span></div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">use</span><span style="--0:#D6DEEB;--1:#403F53"> std</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#D6DEEB;--1:#403F53">io</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#D6DEEB;--1:#403F53">Read;</span><span style="--0:#809191;--1:#5E6578">           // 导入输入输出相关的模块</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#809191;--1:#5E6578">// 定义一个函数，该函数用于读取文件的内容</span></div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">fn</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">read_file_contents</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#C5E478;--1:#3C63B3">file_path</span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#097174">&#x26;</span><span style="--0:#D6DEEB;--1:#403F53">str) </span><span style="--0:#7FDBCA;--1:#097174">-></span><span style="--0:#D6DEEB;--1:#403F53"> Result&#x3C;String, </span><span style="--0:#C5E478;--1:#3C63B3">std</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#C5E478;--1:#3C63B3">io</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#D6DEEB;--1:#403F53">Error> {</span></div><div class="ec-line"><span style="--0:#809191;--1:#5E6578">    // 打开指定路径的文件并返回结果(Result类型)</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">mut</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">file</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> File</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#82AAFF;--1:#3C63B3">open</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#C5E478;--1:#3C63B3">file_path</span><span style="--0:#D6DEEB;--1:#403F53">)</span><span style="--0:#7FDBCA;--1:#097174">?</span><span style="--0:#D6DEEB;--1:#403F53">;</span><span style="--0:#809191;--1:#5E6578">  // ? 用于将可能的错误传播到调用者</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#809191;--1:#5E6578">    // 创建一个可变字符串来存储文件的内容</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">mut</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">contents</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> String</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#82AAFF;--1:#3C63B3">new</span><span style="--0:#D6DEEB;--1:#403F53">();</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#809191;--1:#5E6578">    // 读取文件的内容到字符串中，并将结果存储在 contents 变量中</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C5E478;--1:#3C63B3">file</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">read_to_string</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#7FDBCA;--1:#097174">&#x26;</span><span style="--0:#C792EA;--1:#8D46B4">mut</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">contents</span><span style="--0:#D6DEEB;--1:#403F53">)</span><span style="--0:#7FDBCA;--1:#097174">?</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#809191;--1:#5E6578">    // 如果成功读取文件内容，返回包含内容的 Result::Ok(contents)</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    Ok(</span><span style="--0:#C5E478;--1:#3C63B3">contents</span><span style="--0:#D6DEEB;--1:#403F53">)</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">}</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#809191;--1:#5E6578">// 主函数</span></div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">fn</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">main</span><span style="--0:#D6DEEB;--1:#403F53">() {</span></div><div class="ec-line"><span style="--0:#809191;--1:#5E6578">    // 调用 read_file_contents 函数来尝试读取文件</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">match</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">read_file_contents</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">example.txt</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">) {</span><span style="--0:#809191;--1:#5E6578">  // 使用 match 来处理函数的返回值</span></div><div class="ec-line"><span style="--0:#809191;--1:#5E6578">        // 如果操作成功，执行以下代码块</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        Ok(</span><span style="--0:#C5E478;--1:#3C63B3">contents</span><span style="--0:#D6DEEB;--1:#403F53">) </span><span style="--0:#7FDBCA;--1:#097174">=></span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div><div class="ec-line"><span style="--0:#809191;--1:#5E6578">            // 打印文件的内容</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">            </span><span style="--0:#82AAFF;--1:#3C63B3">println!</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">File contents: {}</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#C5E478;--1:#3C63B3">contents</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        }</span></div><div class="ec-line"><span style="--0:#809191;--1:#5E6578">        // 如果操作失败，执行以下代码块</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        Err(</span><span style="--0:#C5E478;--1:#3C63B3">error</span><span style="--0:#D6DEEB;--1:#403F53">) </span><span style="--0:#7FDBCA;--1:#097174">=></span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div><div class="ec-line"><span style="--0:#809191;--1:#5E6578">            // 打印错误信息</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">            </span><span style="--0:#82AAFF;--1:#3C63B3">eprintln!</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">Error reading file: {}</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#C5E478;--1:#3C63B3">error</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        }</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    }</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">}</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="use std::fs::File;           // 导入文件操作相关的模块use std::io::Read;           // 导入输入输出相关的模块// 定义一个函数，该函数用于读取文件的内容fn read_file_contents(file_path: &#x26;str) -> Result<String, std::io::Error> {    // 打开指定路径的文件并返回结果(Result类型)    let mut file = File::open(file_path)?;  // ? 用于将可能的错误传播到调用者    // 创建一个可变字符串来存储文件的内容    let mut contents = String::new();    // 读取文件的内容到字符串中，并将结果存储在 contents 变量中    file.read_to_string(&#x26;mut contents)?;    // 如果成功读取文件内容，返回包含内容的 Result::Ok(contents)    Ok(contents)}// 主函数fn main() {    // 调用 read_file_contents 函数来尝试读取文件    match read_file_contents(&#x22;example.txt&#x22;) {  // 使用 match 来处理函数的返回值        // 如果操作成功，执行以下代码块        Ok(contents) => {            // 打印文件的内容            println!(&#x22;File contents: {}&#x22;, contents);        }        // 如果操作失败，执行以下代码块        Err(error) => {            // 打印错误信息            eprintln!(&#x22;Error reading file: {}&#x22;, error);        }    }}"><div></div></button></div></figure></div>
<p><strong>可能的结果：</strong></p>
<p>假设 “example.txt” 文件存在且包含文本 “Hello, Rust!”，那么程序的输出将是：</p>
<div class="expressive-code"><figure class="frame is-terminal not-content"><figcaption class="header"><span class="title"></span><span class="sr-only">Terminal window</span></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#82AAFF;--1:#3C63B3">File</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">contents:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">Hello,</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">Rust!</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="File contents: Hello, Rust!"><div></div></button></div></figure></div>
<p>如果文件不存在或出现其他IO错误，程序将打印类似以下内容的错误信息：</p>
<div class="expressive-code"><figure class="frame is-terminal not-content"><figcaption class="header"><span class="title"></span><span class="sr-only">Terminal window</span></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#82AAFF;--1:#3C63B3">Error</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">reading</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">file:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">No</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">such</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">file</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">or</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">directory</span><span style="--0:#D6DEEB;--1:#403F53"> (os </span><span style="--0:#ECC48D;--1:#3C63B3">error</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#F78C6C;--1:#AA0982">2</span><span style="--0:#D6DEEB;--1:#403F53">)</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="Error reading file: No such file or directory (os error 2)"><div></div></button></div></figure></div>
<p>这个错误消息的具体内容取决于发生的错误类型和上下文。</p>
<p>在上述示例中，<code dir="auto">read_file_contents</code> 函数尝试打开指定文件并读取其内容，如果操作成功，它会返回包含文件内容的 <code dir="auto">Result::Ok(contents)</code>，否则返回一个 <code dir="auto">Result::Err(error)</code>，其中 <code dir="auto">error</code> 包含了出现的错误。在 <code dir="auto">main</code> 函数中，我们使用 <code dir="auto">match</code> 来检查并处理结果。</p>
<p>总之，<code dir="auto">Result</code> 是 Rust 中用于处理错误的重要工具，它使程序员能够以一种明确和安全的方式处理可能出现的错误情况，并避免了异常处理的复杂性。这有助于编写可靠和健壮的 Rust 代码。现在让我们和上一节的option做个对比。下面是一个表格，列出了<code dir="auto">Result</code>和<code dir="auto">Option</code>之间的主要区别：</p>
<p>下面是一个表格，列出了<code dir="auto">Result</code>和<code dir="auto">Option</code>之间的主要区别：</p>


















































<table><thead><tr><th>特征</th><th>Result</th><th>Option</th></tr></thead><tbody><tr><td>用途</td><td>用于表示可能发生错误的结果</td><td>用于表示可能存在或不存在的值</td></tr><tr><td>枚举变体</td><td><code dir="auto">Result&#x3C;T, E></code> 和 <code dir="auto">Result&#x3C;(), E></code></td><td><code dir="auto">Some(T)</code> 和 <code dir="auto">None</code></td></tr><tr><td>成功情况(存在值)</td><td><code dir="auto">Ok(T)</code> 包含成功的结果值 <code dir="auto">T</code></td><td><code dir="auto">Some(T)</code> 包含值 <code dir="auto">T</code></td></tr><tr><td>失败情况(错误信息)</td><td><code dir="auto">Err(E)</code> 包含错误的信息 <code dir="auto">E</code></td><td>N/A(<code dir="auto">Option</code> 不提供错误信息)</td></tr><tr><td>错误处理</td><td>通常使用 <code dir="auto">match</code> 或 <code dir="auto">?</code> 运算符</td><td>通常使用 <code dir="auto">if let</code> 或 <code dir="auto">match</code></td></tr><tr><td>主要用途</td><td>用于处理可恢复的错误</td><td>用于处理可选值，如可能为<code dir="auto">None</code>的情况</td></tr><tr><td>引发程序终止(panic)的情况</td><td>不会引发程序终止</td><td>不会引发程序终止</td></tr><tr><td>适用于何种情况</td><td>I/O操作、文件操作、网络请求等可能失败的操作</td><td>从集合中查找元素、配置选项等可能为<code dir="auto">None</code>的情况</td></tr></tbody></table>
<p>这个表格总结了<code dir="auto">Result</code>和<code dir="auto">Option</code>的主要区别，它们在Rust中分别用于处理错误和处理可选值。<code dir="auto">Result</code>用于表示可能发生错误的操作结果，而<code dir="auto">Option</code>用于表示可能存在或不存在的值。</p>
<h3 id="552-panic-宏">5.5.2 panic! 宏</h3>
<p><code dir="auto">panic!</code> 是Rust编程语言中的一个宏(macro)，用于引发恐慌(panic)。当程序在运行时遇到无法处理的错误或不一致性时，<code dir="auto">panic!</code> 宏会导致程序立即终止，并在终止前打印错误信息。这种行为是Rust中的一种不可恢复错误处理机制。</p>
<p>下面是有关 <code dir="auto">panic!</code> 宏的详细说明：</p>
<ol>
<li>
<p><strong>引发恐慌</strong>：</p>
<ul>
<li><code dir="auto">panic!</code> 宏的主要目的是立即终止程序的执行。它会在终止之前打印一条错误消息，并可选地附带错误信息。</li>
<li>恐慌通常用于表示不应该发生的错误情况，例如除以零或数组越界。这些错误通常表明程序的状态已经不一致，无法安全地继续执行。</li>
</ul>
</li>
<li>
<p><strong>用法</strong>：</p>
<ul>
<li><code dir="auto">panic!</code> 宏的语法非常简单，可以像函数调用一样使用。例如：<code dir="auto">panic!("Something went wrong");</code>。</li>
<li>你也可以使用<code dir="auto">panic!</code> 宏的带格式的版本，类似于 <code dir="auto">println!</code> 宏：<code dir="auto">panic!("Error: {}", error_message);</code>。</li>
</ul>
</li>
<li>
<p><strong>错误信息</strong>：</p>
<ul>
<li>你可以提供一个字符串作为 <code dir="auto">panic!</code> 宏的参数，用于描述发生的错误。这个字符串会被打印到标准错误输出(stderr)。</li>
<li>错误信息通常应该清晰地描述问题，以便开发人员能够理解错误的原因。</li>
</ul>
</li>
<li>
<p><strong>恢复恐慌</strong>：</p>
<ul>
<li>默认情况下，当程序遇到恐慌时，它会终止执行。这是为了确保不一致状态不会传播到程序的其他部分。</li>
<li>但是，你可以使用 <code dir="auto">std::panic::catch_unwind</code> 函数来捕获恐慌并尝试在某种程度上恢复程序的执行。这通常需要使用 <code dir="auto">std::panic::UnwindSafe</code> trait 来标记可安全恢复的代码。</li>
</ul>
</li>
</ol>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">use</span><span style="--0:#D6DEEB;--1:#403F53"> std</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#D6DEEB;--1:#403F53">panic;</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">fn</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">main</span><span style="--0:#D6DEEB;--1:#403F53">() {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">result</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> panic</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#82AAFF;--1:#3C63B3">catch_unwind</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#C792EA;--1:#8D46B4">||</span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div><div class="ec-line"><span style="--0:#809191;--1:#5E6578">        // 可能引发恐慌的代码块</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        </span><span style="--0:#82AAFF;--1:#3C63B3">panic!</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">Something went wrong</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    });</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">match</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">result</span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        Ok(</span><span style="--0:#C5E478;--1:#3C63B3">_</span><span style="--0:#D6DEEB;--1:#403F53">) </span><span style="--0:#7FDBCA;--1:#097174">=></span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">println!</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">Panic handled successfully</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">),</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        Err(</span><span style="--0:#C5E478;--1:#3C63B3">_</span><span style="--0:#D6DEEB;--1:#403F53">) </span><span style="--0:#7FDBCA;--1:#097174">=></span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">println!</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">Panic occurred and was caught</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">),</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    }</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">}</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="use std::panic;fn main() {    let result = panic::catch_unwind(|| {        // 可能引发恐慌的代码块        panic!(&#x22;Something went wrong&#x22;);    });    match result {        Ok(_) => println!(&#x22;Panic handled successfully&#x22;),        Err(_) => println!(&#x22;Panic occurred and was caught&#x22;),    }}"><div></div></button></div></figure></div>
<p><strong>总结：</strong> <code dir="auto">panic!</code> 宏是Rust中一种不可恢复错误处理机制，用于处理不应该发生的错误情况。在正常的程序执行中，应该尽量避免使用 <code dir="auto">panic!</code>，而是使用 <code dir="auto">Result</code> 或 <code dir="auto">Option</code> 来处理错误和可选值。</p>
<h3 id="553-常见错误处理方式的比较">5.5.3 常见错误处理方式的比较</h3>
<p>现在让我们在错误处理的矩阵中加入panic！宏，再来比较一下：</p>



























































<table><thead><tr><th>特征</th><th align="center">panic!</th><th align="center">Result</th><th align="center">Option</th></tr></thead><tbody><tr><td>用途</td><td align="center">用于表示不可恢复的错误，通常是不应该发生的情况</td><td align="center">用于表示可恢复的错误或失败情况，如文件操作、网络请求等</td><td align="center">用于表示可能存在或不存在的值，如从集合中查找元素等</td></tr><tr><td>枚举变体</td><td align="center">N/A(不是枚举)</td><td align="center"><code dir="auto">Result&#x3C;T, E></code> 和 <code dir="auto">Result&#x3C;(), E></code>(或其他自定义错误类型)</td><td align="center"><code dir="auto">Some(T)</code> 和 <code dir="auto">None</code></td></tr><tr><td>程序终止(Termination)</td><td align="center">引发恐慌，<strong>立即终止程序</strong></td><td align="center">不引发程序终止，<strong>允许继续执行</strong></td><td align="center">不引发程序终止，<strong>允许继续执行</strong></td></tr><tr><td>错误处理方式</td><td align="center">不提供清晰的错误信息，通常只打印错误消息</td><td align="center">提供明确的错误类型(如IO错误、自定义错误)和错误信息</td><td align="center">N/A(不提供错误信息)</td></tr><tr><td>引发程序终止(panic)的情况</td><td align="center">遇到不可恢复的错误或不一致情况</td><td align="center">通常用于可预见的、可恢复的错误情况</td><td align="center">N/A(不用于错误处理)</td></tr><tr><td>恢复机制</td><td align="center">可以使用 <code dir="auto">std::panic::catch_unwind</code> 来捕获恐慌并尝试恢复</td><td align="center">通常通过 <code dir="auto">match</code>、<code dir="auto">if let</code>、<code dir="auto">?</code> 运算符等来处理错误，不需要恢复机制</td><td align="center">N/A(不用于错误处理)</td></tr><tr><td>适用性</td><td align="center">适用于不可恢复的错误情况</td><td align="center">适用于可恢复的错误情况</td><td align="center">适用于可选值的情况，如可能为<code dir="auto">None</code>的情况</td></tr><tr><td>主要示例</td><td align="center"><code dir="auto">panic!("Division by zero");</code></td><td align="center"><code dir="auto">File::open("file.txt")?;</code> 或其他 <code dir="auto">Result</code> 使用方式</td><td align="center"><code dir="auto">Some(42)</code> 或 <code dir="auto">None</code></td></tr></tbody></table>
<p>这个表格总结了<code dir="auto">panic!</code>、<code dir="auto">Result</code> 和 <code dir="auto">Option</code> 之间的主要区别。<code dir="auto">panic!</code> 用于处理不可恢复的错误情况，<code dir="auto">Result</code> 用于处理可恢复的错误或失败情况，并提供明确的错误信息，而 <code dir="auto">Option</code> 用于表示可能存在或不存在的值，例如在从集合中查找元素时使用。在实际编程中，通常应该根据具体情况选择适当的错误处理方式。</p>
<h2 id="56-栈stack堆heap和箱子box">5.6 栈(Stack)、堆(Heap)和箱子(Box)</h2>
<p>内存中的栈(stack)和堆(heap)是计算机内存管理的两个关键方面。在Rust中，与其他编程语言一样，栈和堆起着不同的角色，用于存储不同类型的数据。下面详细解释这两者，包括示例和图表。</p>
<h3 id="561-内存栈stack">5.6.1 内存栈(Stack)</h3>
<ul>
<li>内存栈是一种线性数据结构，用于存储程序运行时的函数调用、局部变量和函数参数。</li>
<li>栈是一种高效的数据结构，因为它支持常量时间的入栈(push)和出栈(pop)操作。</li>
<li>栈上的数据的生命周期是确定的，当变量超出作用域时，相关的数据会自动销毁。</li>
<li>在Rust中，基本数据类型(如整数、浮点数、布尔值)和固定大小的数据结构(如元组)通常存储在栈上。</li>
</ul>
<p>下面是一个示例，说明了内存栈的工作原理：</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">fn</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">main</span><span style="--0:#D6DEEB;--1:#403F53">() {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">x</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#F78C6C;--1:#AA0982">42</span><span style="--0:#D6DEEB;--1:#403F53">;</span><span style="--0:#809191;--1:#5E6578">  // 整数x被存储在栈上</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">y</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#F78C6C;--1:#AA0982">17</span><span style="--0:#D6DEEB;--1:#403F53">;</span><span style="--0:#809191;--1:#5E6578">  // 整数y被存储在栈上</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">sum</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">x</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#097174">+</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">y</span><span style="--0:#D6DEEB;--1:#403F53">;</span><span style="--0:#809191;--1:#5E6578"> // 栈上的x和y的值被相加，结果存储在栈上的sum中</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">}</span><span style="--0:#809191;--1:#5E6578">  // 所有变量超出作用域，栈上的数据现在全部自动销毁</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="fn main() {    let x = 42;  // 整数x被存储在栈上    let y = 17;  // 整数y被存储在栈上    let sum = x + y; // 栈上的x和y的值被相加，结果存储在栈上的sum中}  // 所有变量超出作用域，栈上的数据现在全部自动销毁"><div></div></button></div></figure></div>
<h3 id="562-内存堆heap">5.6.2 内存堆(Heap)</h3>
<ul>
<li>内存堆是一块较大的、动态分配的内存区域，用于存储不确定大小或可变大小的数据，例如字符串、向量、结构体等。</li>
<li>堆上的数据的生命周期不是固定的，需要手动管理内存的分配和释放。</li>
<li>在Rust中，堆上的数据通常由智能指针(例如<code dir="auto">Box</code>、<code dir="auto">Rc</code>、<code dir="auto">Arc</code>)管理，这些智能指针提供了安全的堆内存访问方式，避免了内存泄漏和使用-after-free等问题。</li>
</ul>
<p><strong>示例</strong>：</p>
<p>如何在堆上分配一个字符串：</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">fn</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">main</span><span style="--0:#D6DEEB;--1:#403F53">() {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">s</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> String</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#82AAFF;--1:#3C63B3">from</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">Hello, Rust!</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">);</span><span style="--0:#809191;--1:#5E6578"> // 字符串s在堆上分配</span></div><div class="ec-line"><span style="--0:#809191;--1:#5E6578">    // ...</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">}</span><span style="--0:#809191;--1:#5E6578"> // 当s超出作用域时，堆上的字符串会被自动释放</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="fn main() {    let s = String::from(&#x22;Hello, Rust!&#x22;); // 字符串s在堆上分配    // ...} // 当s超出作用域时，堆上的字符串会被自动释放"><div></div></button></div></figure></div>
<p>下面是一个简单的图表，展示了内存栈和内存堆的区别：</p>
<p><img src="https://craftofcoding.files.wordpress.com/2015/12/stackmemory4.jpg" alt="Memory in C – the stack, the heap, and static – The Craft of Coding"></p>
<p>栈上的数据具有固定的生命周期，是直接管理的。堆上的数据可以是动态分配的，需要<strong>智能指针</strong>来管理其生命周期。</p>
<h3 id="563-箱子box">5.6.3 箱子(Box)</h3>
<p>在 Rust 中，默认情况下，所有值都是栈上分配的。但是，通过创建 <code dir="auto">Box&#x3C;T></code>，可以将值进行<strong>装箱</strong>(boxed)，使其<strong>在堆上分配内存</strong>。一个箱子(box，即 <code dir="auto">Box&#x3C;T></code> 类型的实例)实际上是一个智能指针，指向堆上分配的 <code dir="auto">T</code> 类型的值。当箱子超出其作用域时，内部的对象就会被销毁，并且堆上分配的内存也会被释放。</p>
<p>以下是一个示例，其中演示了在Rust中使用Box的重要性。在这个示例中，我们试图创建一个包含非常大数据的结构，但由于没有使用Box，编译器会报错，因为数据无法在栈上存储：</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">struct</span><span style="--0:#D6DEEB;--1:#403F53"> LargeData {</span></div><div class="ec-line"><span style="--0:#809191;--1:#5E6578">    // 假设这是一个非常大的数据结构</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C5E478;--1:#3C63B3">data</span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#D6DEEB;--1:#403F53"> [u8; </span><span style="--0:#F78C6C;--1:#AA0982">1024</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#097174">*</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#F78C6C;--1:#AA0982">1024</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#097174">*</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#F78C6C;--1:#AA0982">1024</span><span style="--0:#D6DEEB;--1:#403F53">],</span><span style="--0:#809191;--1:#5E6578"> // 1 GB的数据</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">}</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">fn</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">main</span><span style="--0:#D6DEEB;--1:#403F53">() {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">large_data</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> LargeData {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        </span><span style="--0:#C5E478;--1:#3C63B3">data</span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#D6DEEB;--1:#403F53"> [</span><span style="--0:#F78C6C;--1:#AA0982">0</span><span style="--0:#D6DEEB;--1:#403F53">; </span><span style="--0:#F78C6C;--1:#AA0982">1024</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#097174">*</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#F78C6C;--1:#AA0982">1024</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#097174">*</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#F78C6C;--1:#AA0982">1024</span><span style="--0:#D6DEEB;--1:#403F53">],</span><span style="--0:#809191;--1:#5E6578"> // 初始化数据</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    };</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#82AAFF;--1:#3C63B3">println!</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">Large data created.</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">}</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="struct LargeData {    // 假设这是一个非常大的数据结构    data: [u8; 1024 * 1024 * 1024], // 1 GB的数据}fn main() {    let large_data = LargeData {        data: [0; 1024 * 1024 * 1024], // 初始化数据    };    println!(&#x22;Large data created.&#x22;);}"><div></div></button></div></figure></div>
<p><strong>执行结果：</strong></p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#d6deeb;--1:#403f53">thread 'main' has overflowed its stack</span></div><div class="ec-line"><span style="--0:#d6deeb;--1:#403f53">fatal runtime error: stack overflow</span></div><div class="ec-line"><span style="--0:#d6deeb;--1:#403f53">fish: Job 1, 'cargo run $argv' terminated by signal SIGABRT (Abort)</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="thread &#x27;main&#x27; has overflowed its stackfatal runtime error: stack overflowfish: Job 1, &#x27;cargo run $argv&#x27; terminated by signal SIGABRT (Abort)"><div></div></button></div></figure></div>
<p>在这个示例中，我们尝试创建一个<code dir="auto">LargeData</code>结构，其中包含一个1GB大小的数据数组。由于Rust默认情况下将数据存储在栈上，这将导致编译错误，因为栈上无法容纳如此大的数据。要解决这个问题，可以使用Box来将数据存储在堆上，如下所示：</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">struct</span><span style="--0:#D6DEEB;--1:#403F53"> LargeData {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C5E478;--1:#3C63B3">data</span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#D6DEEB;--1:#403F53"> Box&#x3C;[u8]>,</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">}</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">fn</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">main</span><span style="--0:#D6DEEB;--1:#403F53">() {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">large_data</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> LargeData {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        </span><span style="--0:#C5E478;--1:#3C63B3">data</span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">vec!</span><span style="--0:#D6DEEB;--1:#403F53">[</span><span style="--0:#F78C6C;--1:#AA0982">0</span><span style="--0:#D6DEEB;--1:#403F53">; </span><span style="--0:#F78C6C;--1:#AA0982">1024</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#097174">*</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#F78C6C;--1:#AA0982">1024</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#097174">*</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#F78C6C;--1:#AA0982">1024</span><span style="--0:#D6DEEB;--1:#403F53">]</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">into_boxed_slice</span><span style="--0:#D6DEEB;--1:#403F53">(),</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    };</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#809191;--1:#5E6578">    // 使用 large_data 变量</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#82AAFF;--1:#3C63B3">println!</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">Large data created.</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">}</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="struct LargeData {    data: Box<[u8]>,}fn main() {    let large_data = LargeData {        data: vec![0; 1024 * 1024 * 1024].into_boxed_slice(),    };    // 使用 large_data 变量    println!(&#x22;Large data created.&#x22;);}"><div></div></button></div></figure></div>
<p>在这个示例中，我们使用了<code dir="auto">Box::new</code>来创建一个包含1GB数据的堆分配的数组，这样就不会出现编译错误了。</p>
<h3 id="补充学习into_boxed_slice">补充学习：into_boxed_slice</h3>
<p><code dir="auto">into_boxed_slice</code> 是一个用于将向量(<code dir="auto">Vec</code>)转换为 <code dir="auto">Box&#x3C;[T]></code> 的方法。</p>
<p>如果向量有多余的容量(excess capacity)，它的元素将会被移动到一个新分配的缓冲区，该缓冲区具有刚好正确的容量。</p>
<p>示例：</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">v</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">vec!</span><span style="--0:#D6DEEB;--1:#403F53">[</span><span style="--0:#F78C6C;--1:#AA0982">1</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#F78C6C;--1:#AA0982">2</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#F78C6C;--1:#AA0982">3</span><span style="--0:#D6DEEB;--1:#403F53">];</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">slice</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">v</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">into_boxed_slice</span><span style="--0:#D6DEEB;--1:#403F53">();</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="let v = vec![1, 2, 3];let slice = v.into_boxed_slice();"><div></div></button></div></figure></div>
<p>在这个示例中，向量 <code dir="auto">v</code> 被转换成了一个 <code dir="auto">Box&#x3C;[T]></code> 类型的切片 <code dir="auto">slice</code>。<strong>任何多余的容量都会被移除。</strong></p>
<p>另一个示例，假设有一个具有预分配容量的向量：</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">mut</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">vec</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> Vec</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#82AAFF;--1:#3C63B3">with_capacity</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#F78C6C;--1:#AA0982">10</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div><div class="ec-line"><span style="--0:#C5E478;--1:#3C63B3">vec</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">extend</span><span style="--0:#D6DEEB;--1:#403F53">([</span><span style="--0:#F78C6C;--1:#AA0982">1</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#F78C6C;--1:#AA0982">2</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#F78C6C;--1:#AA0982">3</span><span style="--0:#D6DEEB;--1:#403F53">]);</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#82AAFF;--1:#3C63B3">assert!</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#C5E478;--1:#3C63B3">vec</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">capacity</span><span style="--0:#D6DEEB;--1:#403F53">() </span><span style="--0:#C792EA;--1:#8D46B4">>=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#F78C6C;--1:#AA0982">10</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">slice</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">vec</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">into_boxed_slice</span><span style="--0:#D6DEEB;--1:#403F53">();</span></div><div class="ec-line"><span style="--0:#82AAFF;--1:#3C63B3">assert_eq!</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#C5E478;--1:#3C63B3">slice</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">into_vec</span><span style="--0:#D6DEEB;--1:#403F53">()</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">capacity</span><span style="--0:#D6DEEB;--1:#403F53">(), </span><span style="--0:#F78C6C;--1:#AA0982">3</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="let mut vec = Vec::with_capacity(10);vec.extend([1, 2, 3]);assert!(vec.capacity() >= 10);let slice = vec.into_boxed_slice();assert_eq!(slice.into_vec().capacity(), 3);"><div></div></button></div></figure></div>
<p>在这个示例中，首先创建了一个容量为10的向量，然后通过 <code dir="auto">extend</code> 方法将元素添加到向量中。之后，通过 <code dir="auto">into_boxed_slice</code> 将向量转换为 <code dir="auto">Box&#x3C;[T]></code> 类型的切片 <code dir="auto">slice</code>。由于多余的容量不再需要，所以它们会被移除。最后，我们使用 <code dir="auto">into_vec</code> 方法将 <code dir="auto">slice</code> 转换回向量，并检查它的容量是否等于3。这是因为移除了多余的容量，所以容量变为了3。</p>
<p><strong>总结：</strong></p>
<p>在Rust中，<code dir="auto">Box</code> 类型虽然不是金融领域特定的工具，但在金融应用程序中具有以下一般应用：</p>
<ol>
<li><strong>数据管理</strong>：金融应用程序通常需要处理大量数据，如市场报价、交易订单、投资组合等。<code dir="auto">Box</code> 可以用于将数据分配在堆上，以避免栈溢出，同时确保数据的所有权在不同部分之间传递。</li>
<li><strong>构建复杂数据结构</strong>：金融领域需要使用各种复杂的数据结构，如树、图、链表等，来表示金融工具和投资组合。<code dir="auto">Box</code> 有助于构建这些数据结构，并管理数据的生命周期。</li>
<li><strong>异常处理</strong>：金融应用程序需要处理各种异常情况，如错误交易、数据丢失等。<code dir="auto">Box</code> 可以用于存储和传递异常情况的详细信息，以进行适当的处理和报告。</li>
<li><strong>多线程和并发</strong>：金融应用程序通常需要处理多线程和并发，以确保高性能和可伸缩性。<code dir="auto">Box</code> 可以用于在线程之间安全传递数据，避免竞争条件和数据不一致性。</li>
<li><strong>异步编程</strong>：金融应用程序需要处理异步事件，如市场数据更新、交易执行等。<code dir="auto">Box</code> 可以在异步上下文中安全地存储和传递数据。</li>
</ol>
<h3 id="案例1-向大型金融数据集添加账户">案例1： 向大型金融数据集添加账户</h3>
<p>当需要处理大型复杂数据集时，使用<code dir="auto">Box</code>可以帮助管理内存并提高程序性能。下面是一个示例，展示如何使用Rust创建一个简单的金融数据集(在实际生产过程中，可能是极大的。)，其中包含多个交易账户和每个账户的交易历史。在这个示例中，我们使用<code dir="auto">Box</code>来管理账户和交易历史的内存，以避免在栈上分配过多内存。</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">#[allow(dead_code)]</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">#[derive(Debug)]</span></div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">struct</span><span style="--0:#D6DEEB;--1:#403F53"> Transaction {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C5E478;--1:#3C63B3">amount</span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#D6DEEB;--1:#403F53"> f64,</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C5E478;--1:#3C63B3">date</span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#D6DEEB;--1:#403F53"> String,</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">}</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">#[allow(dead_code)]</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">#[derive(Debug)]</span></div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">struct</span><span style="--0:#D6DEEB;--1:#403F53"> Account {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C5E478;--1:#3C63B3">name</span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#D6DEEB;--1:#403F53"> String,</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C5E478;--1:#3C63B3">transactions</span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#D6DEEB;--1:#403F53"> Vec&#x3C;Transaction>,</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">}</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">fn</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">main</span><span style="--0:#D6DEEB;--1:#403F53">() {</span></div><div class="ec-line"><span style="--0:#809191;--1:#5E6578">    // 创建一个包含多个账户的金融数据集</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">mut</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">financial_data</span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#D6DEEB;--1:#403F53"> Vec&#x3C;Box&#x3C;Account>> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> Vec</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#82AAFF;--1:#3C63B3">new</span><span style="--0:#D6DEEB;--1:#403F53">();</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#809191;--1:#5E6578">    // 添加一些示例账户和交易历史</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">account1</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> Account {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        </span><span style="--0:#C5E478;--1:#3C63B3">name</span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">Account 1</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">to_string</span><span style="--0:#D6DEEB;--1:#403F53">(),</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        </span><span style="--0:#C5E478;--1:#3C63B3">transactions</span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">vec!</span><span style="--0:#D6DEEB;--1:#403F53">[</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">            Transaction {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">                </span><span style="--0:#C5E478;--1:#3C63B3">amount</span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#F78C6C;--1:#AA0982">1000.0</span><span style="--0:#D6DEEB;--1:#403F53">,</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">                </span><span style="--0:#C5E478;--1:#3C63B3">date</span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">2023-09-14</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">to_string</span><span style="--0:#D6DEEB;--1:#403F53">(),</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">            },</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">            Transaction {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">                </span><span style="--0:#C5E478;--1:#3C63B3">amount</span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#097174">-</span><span style="--0:#F78C6C;--1:#AA0982">500.0</span><span style="--0:#D6DEEB;--1:#403F53">,</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">                </span><span style="--0:#C5E478;--1:#3C63B3">date</span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">2023-09-15</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">to_string</span><span style="--0:#D6DEEB;--1:#403F53">(),</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">            },</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        ],</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    };</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">account2</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> Account {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        </span><span style="--0:#C5E478;--1:#3C63B3">name</span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">Account 2</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">to_string</span><span style="--0:#D6DEEB;--1:#403F53">(),</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        </span><span style="--0:#C5E478;--1:#3C63B3">transactions</span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">vec!</span><span style="--0:#D6DEEB;--1:#403F53">[</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">            Transaction {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">                </span><span style="--0:#C5E478;--1:#3C63B3">amount</span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#F78C6C;--1:#AA0982">2000.0</span><span style="--0:#D6DEEB;--1:#403F53">,</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">                </span><span style="--0:#C5E478;--1:#3C63B3">date</span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">2023-09-14</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">to_string</span><span style="--0:#D6DEEB;--1:#403F53">(),</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">            },</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">            Transaction {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">                </span><span style="--0:#C5E478;--1:#3C63B3">amount</span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#097174">-</span><span style="--0:#F78C6C;--1:#AA0982">1000.0</span><span style="--0:#D6DEEB;--1:#403F53">,</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">                </span><span style="--0:#C5E478;--1:#3C63B3">date</span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">2023-09-15</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">to_string</span><span style="--0:#D6DEEB;--1:#403F53">(),</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">            },</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        ],</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    };</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#809191;--1:#5E6578">    // 使用Box将账户添加到金融数据集</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C5E478;--1:#3C63B3">financial_data</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">push</span><span style="--0:#D6DEEB;--1:#403F53">(Box</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#82AAFF;--1:#3C63B3">new</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#C5E478;--1:#3C63B3">account1</span><span style="--0:#D6DEEB;--1:#403F53">));</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C5E478;--1:#3C63B3">financial_data</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">push</span><span style="--0:#D6DEEB;--1:#403F53">(Box</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#82AAFF;--1:#3C63B3">new</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#C5E478;--1:#3C63B3">account2</span><span style="--0:#D6DEEB;--1:#403F53">));</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#809191;--1:#5E6578">    // 打印金融数据集</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">for</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">account</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">in</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">financial_data</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">iter</span><span style="--0:#D6DEEB;--1:#403F53">() {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        </span><span style="--0:#82AAFF;--1:#3C63B3">println!</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">{:?}</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#C5E478;--1:#3C63B3">account</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    }</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">}</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="#[allow(dead_code)]#[derive(Debug)]struct Transaction {    amount: f64,    date: String,}#[allow(dead_code)]#[derive(Debug)]struct Account {    name: String,    transactions: Vec<Transaction>,}fn main() {    // 创建一个包含多个账户的金融数据集    let mut financial_data: Vec<Box<Account>> = Vec::new();    // 添加一些示例账户和交易历史    let account1 = Account {        name: &#x22;Account 1&#x22;.to_string(),        transactions: vec![            Transaction {                amount: 1000.0,                date: &#x22;2023-09-14&#x22;.to_string(),            },            Transaction {                amount: -500.0,                date: &#x22;2023-09-15&#x22;.to_string(),            },        ],    };    let account2 = Account {        name: &#x22;Account 2&#x22;.to_string(),        transactions: vec![            Transaction {                amount: 2000.0,                date: &#x22;2023-09-14&#x22;.to_string(),            },            Transaction {                amount: -1000.0,                date: &#x22;2023-09-15&#x22;.to_string(),            },        ],    };    // 使用Box将账户添加到金融数据集    financial_data.push(Box::new(account1));    financial_data.push(Box::new(account2));    // 打印金融数据集    for account in financial_data.iter() {        println!(&#x22;{:?}&#x22;, account);    }}"><div></div></button></div></figure></div>
<p><strong>执行结果:</strong></p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#d6deeb;--1:#403f53">Account { name: "Account 1", transactions: [Transaction { amount: 1000.0, date: "2023-09-14" }, Transaction { amount: -500.0, date: "2023-09-15" }] }</span></div><div class="ec-line"><span style="--0:#d6deeb;--1:#403f53">Account { name: "Account 2", transactions: [Transaction { amount: 2000.0, date: "2023-09-14" }, Transaction { amount: -1000.0, date: "2023-09-15" }] }</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="Account { name: &#x22;Account 1&#x22;, transactions: [Transaction { amount: 1000.0, date: &#x22;2023-09-14&#x22; }, Transaction { amount: -500.0, date: &#x22;2023-09-15&#x22; }] }Account { name: &#x22;Account 2&#x22;, transactions: [Transaction { amount: 2000.0, date: &#x22;2023-09-14&#x22; }, Transaction { amount: -1000.0, date: &#x22;2023-09-15&#x22; }] }"><div></div></button></div></figure></div>
<p>在上述示例中，我们定义了两个结构体<code dir="auto">Transaction</code>和<code dir="auto">Account</code>，分别用于表示交易和账户。然后，我们创建了一个包含多个账户的<code dir="auto">financial_data</code>向量，使用<code dir="auto">Box</code>将账户放入其中。这允许我们有效地管理内存，并且可以轻松地扩展金融数据集。</p>
<p>请注意，这只是一个简单的示例，实际的金融数据集可能会更加复杂，包括更多的字段和逻辑。使用<code dir="auto">Box</code>来管理内存可以在处理大型数据集时提供更好的性能和可维护性。</p>
<h3 id="案例2处理多种可能的错误情况">案例2：处理多种可能的错误情况</h3>
<p>当你处理多种错误的金融脚本时，经常需要使用<code dir="auto">Box</code>来包装错误类型，因为<strong>不同的错误可能具有不同的大小</strong>。这里我将为你展示一个简单的例子，假设我们要编写一个金融脚本，它从用户输入中解析数字，并进行一些简单的金融计算，同时处理可能的错误。</p>
<p>首先，我们需要在<code dir="auto">main.rs</code>中创建一个Rust项目：</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">use</span><span style="--0:#D6DEEB;--1:#403F53"> std</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#D6DEEB;--1:#403F53">error</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#D6DEEB;--1:#403F53">Error;</span></div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">use</span><span style="--0:#D6DEEB;--1:#403F53"> std</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#D6DEEB;--1:#403F53">fmt;</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#809191;--1:#5E6578">// 定义自定义错误类型</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">#[derive(Debug)]</span></div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">enum</span><span style="--0:#D6DEEB;--1:#403F53"> FinancialError {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    InvalidInput,</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    DivisionByZero,</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">}</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">impl</span><span style="--0:#D6DEEB;--1:#403F53"> fmt</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#D6DEEB;--1:#403F53">Display </span><span style="--0:#C792EA;--1:#8D46B4">for</span><span style="--0:#D6DEEB;--1:#403F53"> FinancialError {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">fn</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">fmt</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#7FDBCA;--1:#097174">&#x26;self</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#C5E478;--1:#3C63B3">f</span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#097174">&#x26;</span><span style="--0:#C792EA;--1:#8D46B4">mut</span><span style="--0:#D6DEEB;--1:#403F53"> fmt</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#D6DEEB;--1:#403F53">Formatter) </span><span style="--0:#7FDBCA;--1:#097174">-></span><span style="--0:#D6DEEB;--1:#403F53"> fmt</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#D6DEEB;--1:#403F53">Result {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        </span><span style="--0:#C792EA;--1:#8D46B4">match</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#097174">self</span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">            FinancialError</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#D6DEEB;--1:#403F53">InvalidInput </span><span style="--0:#7FDBCA;--1:#097174">=></span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">write!</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#C5E478;--1:#3C63B3">f</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">Invalid input</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">),</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">            FinancialError</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#D6DEEB;--1:#403F53">DivisionByZero </span><span style="--0:#7FDBCA;--1:#097174">=></span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">write!</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#C5E478;--1:#3C63B3">f</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">Division by zero</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">),</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        }</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    }</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">}</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">impl</span><span style="--0:#D6DEEB;--1:#403F53"> Error </span><span style="--0:#C792EA;--1:#8D46B4">for</span><span style="--0:#D6DEEB;--1:#403F53"> FinancialError {}</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">fn</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">main</span><span style="--0:#D6DEEB;--1:#403F53">() </span><span style="--0:#7FDBCA;--1:#097174">-></span><span style="--0:#D6DEEB;--1:#403F53"> Result&#x3C;(), Box&#x3C;</span><span style="--0:#C792EA;--1:#8D46B4">dyn</span><span style="--0:#D6DEEB;--1:#403F53"> Error>> {</span></div><div class="ec-line"><span style="--0:#809191;--1:#5E6578">    // 模拟用户输入</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">input</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">10</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#809191;--1:#5E6578">    // 解析用户输入为数字</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">num</span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#D6DEEB;--1:#403F53"> i32 </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">input</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        </span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">parse</span><span style="--0:#D6DEEB;--1:#403F53">()</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        </span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">map_err</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#C792EA;--1:#8D46B4">|</span><span style="--0:#C5E478;--1:#3C63B3">_</span><span style="--0:#C792EA;--1:#8D46B4">|</span><span style="--0:#D6DEEB;--1:#403F53"> Box</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#82AAFF;--1:#3C63B3">new</span><span style="--0:#D6DEEB;--1:#403F53">(FinancialError</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#D6DEEB;--1:#403F53">InvalidInput))</span><span style="--0:#7FDBCA;--1:#097174">?</span><span style="--0:#D6DEEB;--1:#403F53">;</span><span style="--0:#809191;--1:#5E6578"> // 使用Box包装错误</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#809191;--1:#5E6578">    // 检查除以0的情况</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">if</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">num</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">==</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#F78C6C;--1:#AA0982">0</span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        </span><span style="--0:#C792EA;--1:#8D46B4">return</span><span style="--0:#D6DEEB;--1:#403F53"> Err(Box</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#82AAFF;--1:#3C63B3">new</span><span style="--0:#D6DEEB;--1:#403F53">(FinancialError</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#D6DEEB;--1:#403F53">DivisionByZero));</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    }</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#809191;--1:#5E6578">    // 进行一些金融计算</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">result</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#F78C6C;--1:#AA0982">100</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#097174">/</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">num</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#82AAFF;--1:#3C63B3">println!</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">Result: {}</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#C5E478;--1:#3C63B3">result</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    Ok(())</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">}</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="use std::error::Error;use std::fmt;// 定义自定义错误类型#[derive(Debug)]enum FinancialError {    InvalidInput,    DivisionByZero,}impl fmt::Display for FinancialError {    fn fmt(&#x26;self, f: &#x26;mut fmt::Formatter) -> fmt::Result {        match self {            FinancialError::InvalidInput => write!(f, &#x22;Invalid input&#x22;),            FinancialError::DivisionByZero => write!(f, &#x22;Division by zero&#x22;),        }    }}impl Error for FinancialError {}fn main() -> Result<(), Box<dyn Error>> {    // 模拟用户输入    let input = &#x22;10&#x22;;    // 解析用户输入为数字    let num: i32 = input        .parse()        .map_err(|_| Box::new(FinancialError::InvalidInput))?; // 使用Box包装错误    // 检查除以0的情况    if num == 0 {        return Err(Box::new(FinancialError::DivisionByZero));    }    // 进行一些金融计算    let result = 100 / num;    println!(&#x22;Result: {}&#x22;, result);    Ok(())}"><div></div></button></div></figure></div>
<p>在上述代码中，我们创建了一个自定义错误类型<code dir="auto">FinancialError</code>，它包括两种可能的错误：<code dir="auto">InvalidInput</code>和<code dir="auto">DivisionByZero</code>。我们还实现了<code dir="auto">Error</code>和<code dir="auto">Display</code> trait，以便能够格式化错误消息。</p>
<p>当你运行上述Rust代码时，可能的执行后返回的错误情况如下：</p>
<ol>
<li>
<p><strong>成功情况</strong>：如果用户输入能够成功解析为数字且不等于零，程序将执行金融计算，并打印结果，然后返回成功的<code dir="auto">Ok(())</code>。</p>
</li>
<li>
<p><strong>无效输入错误</strong>：如果用户输入无法解析为数字，例如输入了非数字字符，程序将返回一个包含”Invalid input”错误消息的<code dir="auto">Box&#x3C;FinancialError></code>。</p>
</li>
<li>
<p><strong>除零错误</strong>：如果用户输入解析为数字且为零，程序将返回一个包含”Division by zero”错误消息的<code dir="auto">Box&#x3C;FinancialError></code>。</p>
</li>
</ol>
<p>下面是在不同情况下的示例输出：</p>
<p>成功情况：</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#d6deeb;--1:#403f53">Result: 10</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="Result: 10"><div></div></button></div></figure></div>
<p>无效输入错误情况：</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#d6deeb;--1:#403f53">Error: Invalid input</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="Error: Invalid input"><div></div></button></div></figure></div>
<p>除零错误情况：</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#d6deeb;--1:#403f53">Error: Division by zero</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="Error: Division by zero"><div></div></button></div></figure></div>
<p>这些是可能的执行后返回的错误示例，取决于用户的输入和脚本中的逻辑。程序能够通过自定义错误类型和<code dir="auto">Result</code>类型来明确指示发生的错误，并提供相应的错误消息。</p>
<h3 id="案例3多线程共享数据">案例3：多线程共享数据</h3>
<p>另一个常见的情况是当我们想要在不同的线程之间共享数据时。如果数据存储在栈上，其他线程无法访问它，所以如果我们希望在线程之间共享数据，就需要将数据存储在堆上。使用Box正是为了解决这个问题的方便方式，因为它允许我们轻松地在堆上分配数据，并在不同的线程之间共享它。</p>
<p>当需要在多线程和并发的金融脚本中共享数据时，可以使用<code dir="auto">Box</code>来管理数据并确保线程安全性。以下是一个示例，展示如何使用<code dir="auto">Box</code>来创建一个共享的数据池，以便多个线程可以读写它：</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">use</span><span style="--0:#D6DEEB;--1:#403F53"> std</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#D6DEEB;--1:#403F53">sync</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#D6DEEB;--1:#403F53">{Arc, Mutex};</span></div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">use</span><span style="--0:#D6DEEB;--1:#403F53"> std</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#D6DEEB;--1:#403F53">thread;</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#809191;--1:#5E6578">// 定义共享的数据结构</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">#[allow(dead_code)]</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">#[derive(Debug)]</span></div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">struct</span><span style="--0:#D6DEEB;--1:#403F53"> FinancialData {</span></div><div class="ec-line"><span style="--0:#809191;--1:#5E6578">    // 这里可以放入金融数据的字段</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C5E478;--1:#3C63B3">value</span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#D6DEEB;--1:#403F53"> f64,</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">}</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">fn</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">main</span><span style="--0:#D6DEEB;--1:#403F53">() {</span></div><div class="ec-line"><span style="--0:#809191;--1:#5E6578">    // 创建一个共享的数据池，存储FinancialData的Box</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">shared_data_pool</span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#D6DEEB;--1:#403F53"> Arc&#x3C;Mutex&#x3C;Vec&#x3C;Box&#x3C;FinancialData>>>> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> Arc</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#82AAFF;--1:#3C63B3">new</span><span style="--0:#D6DEEB;--1:#403F53">(Mutex</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#82AAFF;--1:#3C63B3">new</span><span style="--0:#D6DEEB;--1:#403F53">(Vec</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#82AAFF;--1:#3C63B3">new</span><span style="--0:#D6DEEB;--1:#403F53">()));</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#809191;--1:#5E6578">    // 创建多个写线程来添加数据到数据池</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">num_writers</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#F78C6C;--1:#AA0982">4</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">mut</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">writer_handles</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">vec!</span><span style="--0:#D6DEEB;--1:#403F53">[];</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">for</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">i</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">in</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#F78C6C;--1:#AA0982">0</span><span style="--0:#7FDBCA;--1:#097174">..</span><span style="--0:#C5E478;--1:#3C63B3">num_writers</span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">shared_data_pool</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> Arc</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#82AAFF;--1:#3C63B3">clone</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#7FDBCA;--1:#097174">&#x26;</span><span style="--0:#C5E478;--1:#3C63B3">shared_data_pool</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">handle</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> thread</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#82AAFF;--1:#3C63B3">spawn</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#C792EA;--1:#8D46B4">move</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">||</span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div><div class="ec-line"><span style="--0:#809191;--1:#5E6578">            // 在不同线程中创建新的FinancialData并添加到数据池</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">            </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">new_data</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> FinancialData {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">                </span><span style="--0:#C5E478;--1:#3C63B3">value</span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">i</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">as</span><span style="--0:#D6DEEB;--1:#403F53"> f64 </span><span style="--0:#7FDBCA;--1:#097174">*</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#F78C6C;--1:#AA0982">100.0</span><span style="--0:#D6DEEB;--1:#403F53">,</span><span style="--0:#809191;--1:#5E6578"> // 举例：假设每个线程添加的数据不同</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">            };</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">            </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">mut</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">data_pool</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">shared_data_pool</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">lock</span><span style="--0:#D6DEEB;--1:#403F53">()</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">unwrap</span><span style="--0:#D6DEEB;--1:#403F53">();</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">            </span><span style="--0:#C5E478;--1:#3C63B3">data_pool</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">push</span><span style="--0:#D6DEEB;--1:#403F53">(Box</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#82AAFF;--1:#3C63B3">new</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#C5E478;--1:#3C63B3">new_data</span><span style="--0:#D6DEEB;--1:#403F53">));</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        });</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        </span><span style="--0:#C5E478;--1:#3C63B3">writer_handles</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">push</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#C5E478;--1:#3C63B3">handle</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    }</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#809191;--1:#5E6578">    // 创建多个读线程来读取数据池</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">num_readers</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#F78C6C;--1:#AA0982">2</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">mut</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">reader_handles</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">vec!</span><span style="--0:#D6DEEB;--1:#403F53">[];</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">for</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">_</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">in</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#F78C6C;--1:#AA0982">0</span><span style="--0:#7FDBCA;--1:#097174">..</span><span style="--0:#C5E478;--1:#3C63B3">num_readers</span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">shared_data_pool</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> Arc</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#82AAFF;--1:#3C63B3">clone</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#7FDBCA;--1:#097174">&#x26;</span><span style="--0:#C5E478;--1:#3C63B3">shared_data_pool</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">handle</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> thread</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#82AAFF;--1:#3C63B3">spawn</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#C792EA;--1:#8D46B4">move</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">||</span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div><div class="ec-line"><span style="--0:#809191;--1:#5E6578">            // 在不同线程中读取数据池的内容</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">            </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">data_pool</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">shared_data_pool</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">lock</span><span style="--0:#D6DEEB;--1:#403F53">()</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">unwrap</span><span style="--0:#D6DEEB;--1:#403F53">();</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">            </span><span style="--0:#C792EA;--1:#8D46B4">for</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">data</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">in</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#097174">&#x26;*</span><span style="--0:#C5E478;--1:#3C63B3">data_pool</span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">                </span><span style="--0:#82AAFF;--1:#3C63B3">println!</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">Reader thread - Data: {:?}</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#C5E478;--1:#3C63B3">data</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">            }</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        });</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        </span><span style="--0:#C5E478;--1:#3C63B3">reader_handles</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">push</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#C5E478;--1:#3C63B3">handle</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    }</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#809191;--1:#5E6578">    // 等待所有写线程完成</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">for</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">handle</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">in</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">writer_handles</span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        </span><span style="--0:#C5E478;--1:#3C63B3">handle</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">join</span><span style="--0:#D6DEEB;--1:#403F53">()</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">unwrap</span><span style="--0:#D6DEEB;--1:#403F53">();</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    }</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#809191;--1:#5E6578">    // 等待所有读线程完成</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">for</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">handle</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">in</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">reader_handles</span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        </span><span style="--0:#C5E478;--1:#3C63B3">handle</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">join</span><span style="--0:#D6DEEB;--1:#403F53">()</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">unwrap</span><span style="--0:#D6DEEB;--1:#403F53">();</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    }</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">}</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="use std::sync::{Arc, Mutex};use std::thread;// 定义共享的数据结构#[allow(dead_code)]#[derive(Debug)]struct FinancialData {    // 这里可以放入金融数据的字段    value: f64,}fn main() {    // 创建一个共享的数据池，存储FinancialData的Box    let shared_data_pool: Arc<Mutex<Vec<Box<FinancialData>>>> = Arc::new(Mutex::new(Vec::new()));    // 创建多个写线程来添加数据到数据池    let num_writers = 4;    let mut writer_handles = vec![];    for i in 0..num_writers {        let shared_data_pool = Arc::clone(&#x26;shared_data_pool);        let handle = thread::spawn(move || {            // 在不同线程中创建新的FinancialData并添加到数据池            let new_data = FinancialData {                value: i as f64 * 100.0, // 举例：假设每个线程添加的数据不同            };            let mut data_pool = shared_data_pool.lock().unwrap();            data_pool.push(Box::new(new_data));        });        writer_handles.push(handle);    }    // 创建多个读线程来读取数据池    let num_readers = 2;    let mut reader_handles = vec![];    for _ in 0..num_readers {        let shared_data_pool = Arc::clone(&#x26;shared_data_pool);        let handle = thread::spawn(move || {            // 在不同线程中读取数据池的内容            let data_pool = shared_data_pool.lock().unwrap();            for data in &#x26;*data_pool {                println!(&#x22;Reader thread - Data: {:?}&#x22;, data);            }        });        reader_handles.push(handle);    }    // 等待所有写线程完成    for handle in writer_handles {        handle.join().unwrap();    }    // 等待所有读线程完成    for handle in reader_handles {        handle.join().unwrap();    }}"><div></div></button></div></figure></div>
<p><strong>执行结果:</strong></p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#d6deeb;--1:#403f53">Reader thread - Data: FinancialData { value: 300.0 }</span></div><div class="ec-line"><span style="--0:#d6deeb;--1:#403f53">Reader thread - Data: FinancialData { value: 0.0 }</span></div><div class="ec-line"><span style="--0:#d6deeb;--1:#403f53">Reader thread - Data: FinancialData { value: 100.0 }</span></div><div class="ec-line"><span style="--0:#d6deeb;--1:#403f53">Reader thread - Data: FinancialData { value: 300.0 }</span></div><div class="ec-line"><span style="--0:#d6deeb;--1:#403f53">Reader thread - Data: FinancialData { value: 0.0 }</span></div><div class="ec-line"><span style="--0:#d6deeb;--1:#403f53">Reader thread - Data: FinancialData { value: 100.0 }</span></div><div class="ec-line"><span style="--0:#d6deeb;--1:#403f53">Reader thread - Data: FinancialData { value: 200.0 }</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="Reader thread - Data: FinancialData { value: 300.0 }Reader thread - Data: FinancialData { value: 0.0 }Reader thread - Data: FinancialData { value: 100.0 }Reader thread - Data: FinancialData { value: 300.0 }Reader thread - Data: FinancialData { value: 0.0 }Reader thread - Data: FinancialData { value: 100.0 }Reader thread - Data: FinancialData { value: 200.0 }"><div></div></button></div></figure></div>
<p>在这个示例中，我们创建了一个共享的数据池，其中存储了<code dir="auto">Box&#x3C;FinancialData></code>。多个<strong>写线程</strong>用于创建新的<code dir="auto">FinancialData</code>并将其添加到数据池，而多个<strong>读线程</strong>用于读取数据池的内容。<code dir="auto">Arc</code>和<code dir="auto">Mutex</code>用于确保线程安全性，以允许多个线程同时访问数据池。</p>
<p>这个示例展示了如何使用<code dir="auto">Box</code>和线程来创建一个共享的数据池，以满足金融应用程序中的多线程和并发需求。注意，<code dir="auto">FinancialData</code>结构体只是示例中的一个占位符，你可以根据实际需求定义自己的金融数据结构。</p>
<h2 id="57-多线程处理multithreading">5.7 多线程处理(Multithreading)</h2>
<p>在Rust中，你可以使用多线程来并行处理任务。Rust提供了一些内置的工具和标准库支持来实现多线程编程。以下是使用Rust进行多线程处理的基本步骤：</p>
<ol>
<li>
<p>创建线程：
你可以使用<code dir="auto">std::thread</code>模块来创建新的线程。下面是一个创建单个线程的示例：</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">use</span><span style="--0:#D6DEEB;--1:#403F53"> std</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#D6DEEB;--1:#403F53">thread;</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">fn</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">main</span><span style="--0:#D6DEEB;--1:#403F53">() {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">thread_handle</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> thread</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#82AAFF;--1:#3C63B3">spawn</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#C792EA;--1:#8D46B4">||</span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div><div class="ec-line"><span style="--0:#809191;--1:#5E6578">        // 在这里编写线程要执行的代码</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        </span><span style="--0:#82AAFF;--1:#3C63B3">println!</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">Hello from the thread!</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    });</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#809191;--1:#5E6578">    // 等待线程执行完成</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C5E478;--1:#3C63B3">thread_handle</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">join</span><span style="--0:#D6DEEB;--1:#403F53">()</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">unwrap</span><span style="--0:#D6DEEB;--1:#403F53">();</span><span style="--0:#809191;--1:#5E6578"> //输出 "Hello from the thread!"</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">}</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="use std::thread;fn main() {    let thread_handle = thread::spawn(|| {        // 在这里编写线程要执行的代码        println!(&#x22;Hello from the thread!&#x22;);    });    // 等待线程执行完成    thread_handle.join().unwrap(); //输出 &#x22;Hello from the thread!&#x22;}"><div></div></button></div></figure></div>
</li>
<li>
<p>通过消息传递进行线程间通信：</p>
<p>当多个线程需要在Rust中进行通信，就像朋友之间通过纸条传递消息一样。每个线程就像一个朋友，它们可以独立地工作，但有时需要互相交流信息。</p>
<p>Rust提供了一种叫做通道(channel)的机制，就像是朋友们之间传递纸条的方式。一个线程可以把消息写在纸条上，然后把纸条放在通道里。而其他线程可以从通道里拿到这些消息纸条。</p>
<p>下面是一个简单的例子，演示了如何在Rust中使用通道进行线程间通信：</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">use</span><span style="--0:#D6DEEB;--1:#403F53"> std</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#D6DEEB;--1:#403F53">sync</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#D6DEEB;--1:#403F53">mpsc;</span><span style="--0:#809191;--1:#5E6578"> // mpsc 是 Rust 中的一种消息传递方式，可以帮助多个线程之间互相发送消息，但只有一个线程能够接收这些消息。</span></div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">use</span><span style="--0:#D6DEEB;--1:#403F53"> std</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#D6DEEB;--1:#403F53">thread;</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">fn</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">main</span><span style="--0:#D6DEEB;--1:#403F53">() {</span></div><div class="ec-line"><span style="--0:#809191;--1:#5E6578">    // 创建一个通道，就像准备一根传递纸条的管道</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> (</span><span style="--0:#C5E478;--1:#3C63B3">sender</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#C5E478;--1:#3C63B3">receiver</span><span style="--0:#D6DEEB;--1:#403F53">) </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> mpsc</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#82AAFF;--1:#3C63B3">channel</span><span style="--0:#D6DEEB;--1:#403F53">();</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#809191;--1:#5E6578">    // 创建一个线程，负责发送消息</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">sender_thread</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> thread</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#82AAFF;--1:#3C63B3">spawn</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#C792EA;--1:#8D46B4">move</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">||</span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">message</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">Hello from the sender!</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        </span><span style="--0:#C5E478;--1:#3C63B3">sender</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">send</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#C5E478;--1:#3C63B3">message</span><span style="--0:#D6DEEB;--1:#403F53">)</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">unwrap</span><span style="--0:#D6DEEB;--1:#403F53">();</span><span style="--0:#809191;--1:#5E6578"> // 发送消息</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    });</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#809191;--1:#5E6578">    // 创建另一个线程，负责接收消息</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">receiver_thread</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> thread</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#82AAFF;--1:#3C63B3">spawn</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#C792EA;--1:#8D46B4">move</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">||</span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">received_message</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">receiver</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">recv</span><span style="--0:#D6DEEB;--1:#403F53">()</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">unwrap</span><span style="--0:#D6DEEB;--1:#403F53">();</span><span style="--0:#809191;--1:#5E6578"> // 接收消息</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        </span><span style="--0:#82AAFF;--1:#3C63B3">println!</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">Received: {}</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#C5E478;--1:#3C63B3">received_message</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    });</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#809191;--1:#5E6578">    // 等待线程完成</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C5E478;--1:#3C63B3">sender_thread</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">join</span><span style="--0:#D6DEEB;--1:#403F53">()</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">unwrap</span><span style="--0:#D6DEEB;--1:#403F53">();</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C5E478;--1:#3C63B3">receiver_thread</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">join</span><span style="--0:#D6DEEB;--1:#403F53">()</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">unwrap</span><span style="--0:#D6DEEB;--1:#403F53">();</span><span style="--0:#809191;--1:#5E6578"> // 输出"Received: Hello from the sender!"</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">}</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="use std::sync::mpsc; // mpsc 是 Rust 中的一种消息传递方式，可以帮助多个线程之间互相发送消息，但只有一个线程能够接收这些消息。use std::thread;fn main() {    // 创建一个通道，就像准备一根传递纸条的管道    let (sender, receiver) = mpsc::channel();    // 创建一个线程，负责发送消息    let sender_thread = thread::spawn(move || {        let message = &#x22;Hello from the sender!&#x22;;        sender.send(message).unwrap(); // 发送消息    });    // 创建另一个线程，负责接收消息    let receiver_thread = thread::spawn(move || {        let received_message = receiver.recv().unwrap(); // 接收消息        println!(&#x22;Received: {}&#x22;, received_message);    });    // 等待线程完成    sender_thread.join().unwrap();    receiver_thread.join().unwrap(); // 输出&#x22;Received: Hello from the sender!&#x22;}"><div></div></button></div></figure></div>
</li>
<li>
<p>线程安全性和共享数据：
在多线程编程中，要注意确保对共享数据的访问是安全的。Rust通过Ownership和Borrowing系统来强制执行线程安全性。你可以使用<code dir="auto">std::sync</code>模块中的<code dir="auto">Mutex</code>、<code dir="auto">Arc</code>等类型来管理共享数据的访问。</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">use</span><span style="--0:#D6DEEB;--1:#403F53"> std</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#D6DEEB;--1:#403F53">sync</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#D6DEEB;--1:#403F53">{Arc, Mutex};</span></div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">use</span><span style="--0:#D6DEEB;--1:#403F53"> std</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#D6DEEB;--1:#403F53">thread;</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">fn</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">main</span><span style="--0:#D6DEEB;--1:#403F53">() {</span></div><div class="ec-line"><span style="--0:#809191;--1:#5E6578">    // 创建一个共享数据结构，使用Arc包装Mutex以实现多线程安全</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">shared_data</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> Arc</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#82AAFF;--1:#3C63B3">new</span><span style="--0:#D6DEEB;--1:#403F53">(Mutex</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#82AAFF;--1:#3C63B3">new</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#F78C6C;--1:#AA0982">0</span><span style="--0:#D6DEEB;--1:#403F53">));</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#809191;--1:#5E6578">    // 创建一个包含四个线程的向量</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">threads</span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#D6DEEB;--1:#403F53"> Vec&#x3C;</span><span style="--0:#C5E478;--1:#3C63B3">_</span><span style="--0:#D6DEEB;--1:#403F53">> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> (</span><span style="--0:#F78C6C;--1:#AA0982">0</span><span style="--0:#7FDBCA;--1:#097174">..</span><span style="--0:#F78C6C;--1:#AA0982">4</span><span style="--0:#D6DEEB;--1:#403F53">)</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        </span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">map</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#C792EA;--1:#8D46B4">|</span><span style="--0:#C5E478;--1:#3C63B3">_</span><span style="--0:#C792EA;--1:#8D46B4">|</span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div><div class="ec-line"><span style="--0:#809191;--1:#5E6578">            // 克隆共享数据以便在线程间共享</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">            </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">data</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> Arc</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#82AAFF;--1:#3C63B3">clone</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#7FDBCA;--1:#097174">&#x26;</span><span style="--0:#C5E478;--1:#3C63B3">shared_data</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#809191;--1:#5E6578">            // 在线程中执行的代码块，锁定数据并递增它</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">            thread</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#82AAFF;--1:#3C63B3">spawn</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#C792EA;--1:#8D46B4">move</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">||</span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">                </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">mut</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">data</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">data</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">lock</span><span style="--0:#D6DEEB;--1:#403F53">()</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">unwrap</span><span style="--0:#D6DEEB;--1:#403F53">();</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">                </span><span style="--0:#7FDBCA;--1:#097174">*</span><span style="--0:#C5E478;--1:#3C63B3">data</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">+=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#F78C6C;--1:#AA0982">1</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">            })</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        })</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        </span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">collect</span><span style="--0:#D6DEEB;--1:#403F53">();</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#809191;--1:#5E6578">    // 等待所有线程完成</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">for</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">thread</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">in</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">threads</span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        </span><span style="--0:#C5E478;--1:#3C63B3">thread</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">join</span><span style="--0:#D6DEEB;--1:#403F53">()</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">unwrap</span><span style="--0:#D6DEEB;--1:#403F53">();</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    }</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#809191;--1:#5E6578">    // 锁定共享数据并获取结果</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">result</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#097174">*</span><span style="--0:#C5E478;--1:#3C63B3">shared_data</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">lock</span><span style="--0:#D6DEEB;--1:#403F53">()</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">unwrap</span><span style="--0:#D6DEEB;--1:#403F53">();</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#809191;--1:#5E6578">    // 输出结果</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#82AAFF;--1:#3C63B3">println!</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">共享数据: {}</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#C5E478;--1:#3C63B3">result</span><span style="--0:#D6DEEB;--1:#403F53">);</span><span style="--0:#809191;--1:#5E6578">  //输出"共享数据: 4"</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">}</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="use std::sync::{Arc, Mutex};use std::thread;fn main() {    // 创建一个共享数据结构，使用Arc包装Mutex以实现多线程安全    let shared_data = Arc::new(Mutex::new(0));    // 创建一个包含四个线程的向量    let threads: Vec<_> = (0..4)        .map(|_| {            // 克隆共享数据以便在线程间共享            let data = Arc::clone(&#x26;shared_data);            // 在线程中执行的代码块，锁定数据并递增它            thread::spawn(move || {                let mut data = data.lock().unwrap();                *data += 1;            })        })        .collect();    // 等待所有线程完成    for thread in threads {        thread.join().unwrap();    }    // 锁定共享数据并获取结果    let result = *shared_data.lock().unwrap();    // 输出结果    println!(&#x22;共享数据: {}&#x22;, result);  //输出&#x22;共享数据: 4&#x22;}"><div></div></button></div></figure></div>
</li>
</ol>
<p>这是一个简单的示例，展示了如何在Rust中使用多线程处理任务。多线程编程需要小心处理并发问题，确保线程安全性。在实际项目中，你可能需要更复杂的同步和通信机制来处理不同的并发场景。</p>
<h2 id="58-互斥锁">5.8 互斥锁</h2>
<p>互斥锁(Mutex)是一种在多线程编程中非常有用的工具，可以帮助我们解决多个线程同时访问共享资源可能引发的问题。想象一下你和你的朋友们在一起玩一个游戏，你们需要共享一个物品，比如一台游戏机。</p>
<p>现在，如果没有互斥锁，每个人都可以试图同时操作这台游戏机，这可能会导致混乱，游戏机崩溃，或者玩游戏时出现奇怪的问题。互斥锁就像一个虚拟的把手，只有一个人能够握住它，其他人必须等待。当一个人使用游戏机完成后，他们会放下这个把手，然后其他人可以继续玩。</p>
<p>这样，互斥锁确保在同一时刻只有一个人能够使用游戏机，防止了竞争和混乱。在编程中，它确保了不同的线程不会同时修改同一个数据，从而避免了数据错乱和程序崩溃。</p>
<p>在Rust编程语言中，它的作用是确保多个线程之间能够安全地访问共享数据，避免竞态条件(Race Conditions)和数据竞争(Data Races)。</p>
<p>以下是<code dir="auto">Mutex</code>的详细特征：</p>
<ol>
<li>
<p><strong>互斥性(Mutual Exclusion)</strong>：<code dir="auto">Mutex</code>的主要目标是实现<strong>互斥性</strong>，即<strong>一次只能有一个线程能够访问由锁保护的共享资源</strong>。如果一个线程已经获得了<code dir="auto">Mutex</code>的锁，其他线程必须等待直到该线程释放锁。</p>
</li>
<li>
<p><strong>内部可变性(Interior Mutability)</strong>：在Rust中，<code dir="auto">Mutex</code>通常与内部可变性(Interior Mutability)一起使用。这意味着<strong>你可以在不使用<code dir="auto">mut</code>关键字的情况下修改由<code dir="auto">Mutex</code>保护的数据</strong>。这是通过<code dir="auto">Mutex</code>提供的<code dir="auto">lock</code>方法来实现的。</p>
</li>
<li>
<p><strong>获取和释放锁</strong>：要使用<code dir="auto">Mutex</code>，线程必须首先获取锁，然后在临界区内执行操作，最后释放锁。这通常是通过<code dir="auto">lock</code>方法来完成的。当一个线程获得锁时，其他线程将被阻塞，直到锁被释放。</p>
</li>
</ol>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">use</span><span style="--0:#D6DEEB;--1:#403F53"> std</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#D6DEEB;--1:#403F53">sync</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#D6DEEB;--1:#403F53">{Mutex, Arc};</span></div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">use</span><span style="--0:#D6DEEB;--1:#403F53"> std</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#D6DEEB;--1:#403F53">thread;</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">fn</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">main</span><span style="--0:#D6DEEB;--1:#403F53">() {</span></div><div class="ec-line"><span style="--0:#809191;--1:#5E6578">    // 创建一个Mutex，用于共享整数</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">counter</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> Arc</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#82AAFF;--1:#3C63B3">new</span><span style="--0:#D6DEEB;--1:#403F53">(Mutex</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#82AAFF;--1:#3C63B3">new</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#F78C6C;--1:#AA0982">0</span><span style="--0:#D6DEEB;--1:#403F53">));</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">mut</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">handles</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">vec!</span><span style="--0:#D6DEEB;--1:#403F53">[];</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">for</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">_</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">in</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#F78C6C;--1:#AA0982">0</span><span style="--0:#7FDBCA;--1:#097174">..</span><span style="--0:#F78C6C;--1:#AA0982">10</span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">counter</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> Arc</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#82AAFF;--1:#3C63B3">clone</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#7FDBCA;--1:#097174">&#x26;</span><span style="--0:#C5E478;--1:#3C63B3">counter</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">handle</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> thread</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#82AAFF;--1:#3C63B3">spawn</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#C792EA;--1:#8D46B4">move</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">||</span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div><div class="ec-line"><span style="--0:#809191;--1:#5E6578">            // 获取锁</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">            </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">mut</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">num</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">counter</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">lock</span><span style="--0:#D6DEEB;--1:#403F53">()</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">unwrap</span><span style="--0:#D6DEEB;--1:#403F53">();</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">            </span><span style="--0:#7FDBCA;--1:#097174">*</span><span style="--0:#C5E478;--1:#3C63B3">num</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">+=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#F78C6C;--1:#AA0982">1</span><span style="--0:#D6DEEB;--1:#403F53">;</span><span style="--0:#809191;--1:#5E6578"> // 在临界区内修改共享数据</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        });</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        </span><span style="--0:#C5E478;--1:#3C63B3">handles</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">push</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#C5E478;--1:#3C63B3">handle</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    }</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#809191;--1:#5E6578">    // 等待所有线程完成</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">for</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">handle</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">in</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">handles</span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        </span><span style="--0:#C5E478;--1:#3C63B3">handle</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">join</span><span style="--0:#D6DEEB;--1:#403F53">()</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">unwrap</span><span style="--0:#D6DEEB;--1:#403F53">();</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    }</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#82AAFF;--1:#3C63B3">println!</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">Result: {}</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#7FDBCA;--1:#097174">*</span><span style="--0:#C5E478;--1:#3C63B3">counter</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">lock</span><span style="--0:#D6DEEB;--1:#403F53">()</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">unwrap</span><span style="--0:#D6DEEB;--1:#403F53">());</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">}</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="use std::sync::{Mutex, Arc};use std::thread;fn main() {    // 创建一个Mutex，用于共享整数    let counter = Arc::new(Mutex::new(0));    let mut handles = vec![];    for _ in 0..10 {        let counter = Arc::clone(&#x26;counter);        let handle = thread::spawn(move || {            // 获取锁            let mut num = counter.lock().unwrap();            *num += 1; // 在临界区内修改共享数据        });        handles.push(handle);    }    // 等待所有线程完成    for handle in handles {        handle.join().unwrap();    }    println!(&#x22;Result: {}&#x22;, *counter.lock().unwrap());}"><div></div></button></div></figure></div>
<ol start="4">
<li><strong>错误处理</strong>：在上面的示例中，我们使用<code dir="auto">unwrap</code>方法来处理<code dir="auto">lock</code>可能返回的错误。在实际应用中，你可能需要更复杂的错误处理来处理锁的获取失败情况。</li>
</ol>
<p>总之，<code dir="auto">Mutex</code>是Rust中一种非常重要的同步原语，用于保护共享数据免受并发访问的问题。通过正确地使用<code dir="auto">Mutex</code>，你可以确保多线程程序的安全性和可靠性。</p>
<h3 id="补充学习lock方法">补充学习：lock方法</h3>
<p>上面用到的 <code dir="auto">lock</code> 方法是用来处理互斥锁(Mutex)的一种特殊函数。它的作用有点像一把“钥匙”，只有拿到这把钥匙的线程才能进入被锁住的房间，也就是临界区，从而安全地修改共享的数据。</p>
<p>想象一下，你和你的朋友们一起玩一个游戏，而这个游戏有一个很酷的玩具，但是只能一个人玩。大家都想要玩这个玩具，但不能同时。这时就需要用到 <code dir="auto">lock</code> 方法。</p>
<ol>
<li>
<p><strong>获取锁</strong>：如果一个线程想要进入这个“玩具房间”，它必须使用 <code dir="auto">lock</code> 方法，就像使用一把特殊的钥匙。只有一个线程能够拿到这个钥匙，进入房间，然后进行操作。</p>
</li>
<li>
<p><strong>在临界区内工作</strong>：一旦线程拿到了钥匙，就可以进入房间，也就是临界区，安全地玩耍或修改共享数据。</p>
</li>
<li>
<p><strong>释放锁</strong>：当线程完成了房间内的工作，就需要把钥匙归还，也就是释放锁。这时其他线程就有机会获取锁，进入临界区，继续工作。</p>
</li>
</ol>
<p><code dir="auto">lock</code> 方法确保了在任何时候只有一个线程能够进入临界区，从而避免了数据错乱和混乱。这就像是一个玩具的控制钥匙，用来管理大家对玩具的访问，让程序更加可靠和安全。</p>
<h4 id="案例安全地更新账户余额">案例：安全地更新账户余额</h4>
<p>在金融领域，<code dir="auto">Mutex</code> 和多线程技术可以用于确保对共享数据的安全访问，尤其是在多个线程同时访问和更新账户余额等重要金融数据时。</p>
<p>以下是一个完整的 Rust 代码示例，演示如何使用 <code dir="auto">Mutex</code> 来处理多线程的存款和取款操作，并确保账户余额的一致性和正确性：</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">use</span><span style="--0:#D6DEEB;--1:#403F53"> std</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#D6DEEB;--1:#403F53">sync</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#D6DEEB;--1:#403F53">{Mutex, Arc};</span></div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">use</span><span style="--0:#D6DEEB;--1:#403F53"> std</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#D6DEEB;--1:#403F53">thread;</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#809191;--1:#5E6578">// 定义银行账户结构</span></div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">struct</span><span style="--0:#D6DEEB;--1:#403F53"> BankAccount {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C5E478;--1:#3C63B3">balance</span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#D6DEEB;--1:#403F53"> f64,</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">}</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">fn</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">main</span><span style="--0:#D6DEEB;--1:#403F53">() {</span></div><div class="ec-line"><span style="--0:#809191;--1:#5E6578">    // 创建一个Mutex，用于包装银行账户</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">account</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> Arc</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#82AAFF;--1:#3C63B3">new</span><span style="--0:#D6DEEB;--1:#403F53">(Mutex</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#82AAFF;--1:#3C63B3">new</span><span style="--0:#D6DEEB;--1:#403F53">(BankAccount { </span><span style="--0:#C5E478;--1:#3C63B3">balance</span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#F78C6C;--1:#AA0982">1000.0</span><span style="--0:#D6DEEB;--1:#403F53"> }));</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">mut</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">handles</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">vec!</span><span style="--0:#D6DEEB;--1:#403F53">[];</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#809191;--1:#5E6578">    // 模拟多个线程进行存款和取款操作</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">for</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">_</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">in</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#F78C6C;--1:#AA0982">0</span><span style="--0:#7FDBCA;--1:#097174">..</span><span style="--0:#F78C6C;--1:#AA0982">5</span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">account</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> Arc</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#82AAFF;--1:#3C63B3">clone</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#7FDBCA;--1:#097174">&#x26;</span><span style="--0:#C5E478;--1:#3C63B3">account</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">handle</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> thread</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#82AAFF;--1:#3C63B3">spawn</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#C792EA;--1:#8D46B4">move</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">||</span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div><div class="ec-line"><span style="--0:#809191;--1:#5E6578">            // 获取锁</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">            </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">mut</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">account</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">account</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">lock</span><span style="--0:#D6DEEB;--1:#403F53">()</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">unwrap</span><span style="--0:#D6DEEB;--1:#403F53">();</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#809191;--1:#5E6578">            // 模拟存款和取款操作</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">            </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">deposit_amount</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#F78C6C;--1:#AA0982">200.0</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">            </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">withdrawal_amount</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#F78C6C;--1:#AA0982">150.0</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#809191;--1:#5E6578">            // 存款</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">            </span><span style="--0:#C5E478;--1:#3C63B3">account</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#D6DEEB;--1:#403F53">balance </span><span style="--0:#C792EA;--1:#8D46B4">+=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">deposit_amount</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#809191;--1:#5E6578">            // 取款</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">            </span><span style="--0:#C792EA;--1:#8D46B4">if</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">account</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#D6DEEB;--1:#403F53">balance </span><span style="--0:#C792EA;--1:#8D46B4">>=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">withdrawal_amount</span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">                </span><span style="--0:#C5E478;--1:#3C63B3">account</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#D6DEEB;--1:#403F53">balance </span><span style="--0:#C792EA;--1:#8D46B4">-=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">withdrawal_amount</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">            }</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        });</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        </span><span style="--0:#C5E478;--1:#3C63B3">handles</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">push</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#C5E478;--1:#3C63B3">handle</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    }</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#809191;--1:#5E6578">    // 等待所有线程完成</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">for</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">handle</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">in</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">handles</span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        </span><span style="--0:#C5E478;--1:#3C63B3">handle</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">join</span><span style="--0:#D6DEEB;--1:#403F53">()</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">unwrap</span><span style="--0:#D6DEEB;--1:#403F53">();</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    }</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#809191;--1:#5E6578">    // 获取锁并打印最终的账户余额</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">account</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">account</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">lock</span><span style="--0:#D6DEEB;--1:#403F53">()</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">unwrap</span><span style="--0:#D6DEEB;--1:#403F53">();</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#82AAFF;--1:#3C63B3">println!</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">Final Balance: ${:.2}</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#C5E478;--1:#3C63B3">account</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#D6DEEB;--1:#403F53">balance);</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">}</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="use std::sync::{Mutex, Arc};use std::thread;// 定义银行账户结构struct BankAccount {    balance: f64,}fn main() {    // 创建一个Mutex，用于包装银行账户    let account = Arc::new(Mutex::new(BankAccount { balance: 1000.0 }));    let mut handles = vec![];    // 模拟多个线程进行存款和取款操作    for _ in 0..5 {        let account = Arc::clone(&#x26;account);        let handle = thread::spawn(move || {            // 获取锁            let mut account = account.lock().unwrap();            // 模拟存款和取款操作            let deposit_amount = 200.0;            let withdrawal_amount = 150.0;            // 存款            account.balance += deposit_amount;            // 取款            if account.balance >= withdrawal_amount {                account.balance -= withdrawal_amount;            }        });        handles.push(handle);    }    // 等待所有线程完成    for handle in handles {        handle.join().unwrap();    }    // 获取锁并打印最终的账户余额    let account = account.lock().unwrap();    println!(&#x22;Final Balance: ${:.2}&#x22;, account.balance);}"><div></div></button></div></figure></div>
<p><strong>执行结果：</strong></p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#d6deeb;--1:#403f53">Final Balance: $1250.00</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="Final Balance: $1250.00"><div></div></button></div></figure></div>
<p>在这个代码示例中，我们首先定义了一个银行账户结构 <code dir="auto">BankAccount</code>，包括一个余额字段。然后，我们创建一个 <code dir="auto">Mutex</code> 来包装这个账户，以确保多个线程可以安全地访问它。</p>
<p>在 <code dir="auto">main</code> 函数中，我们创建了多个线程来模拟存款和取款操作。每个线程首先使用 <code dir="auto">lock</code> 方法获取锁，然后进行存款和取款操作，最后释放锁。最终，我们等待所有线程完成，获取锁，并打印出最终的账户余额。</p>
<h2 id="59-堆分配的指针heap-allocated-pointers">5.9 堆分配的指针(heap allocated pointers)</h2>
<p>在Rust中，堆分配的指针通常是通过使用引用计数(Reference Counting)或智能指针(Smart Pointers)来管理堆上的数据的指针。Rust的安全性和所有权系统要求在访问堆上的数据时进行明确的内存管理，而堆分配的指针正是为此目的而设计的。下面将详细解释堆分配的指针和它们在Rust中的使用。</p>
<p>在Rust中，常见的堆分配的指针有以下两种：</p>
<ol>
<li>
<p><strong><code dir="auto">Box&#x3C;T></code> 智能指针</strong>：</p>
<ul>
<li><code dir="auto">Box&#x3C;T></code> 是Rust的一种智能指针，它用于在堆上分配内存并管理其生命周期。</li>
<li><code dir="auto">Box&#x3C;T></code> 允许你在堆上存储一个类型为 <code dir="auto">T</code> 的值，并负责在其超出作用域时自动释放该值。<strong>这消除了常见的内存泄漏和Use-after-free错误。</strong> “(Use-after-free” 是一种常见的内存安全错误，通常发生在编程语言中，包括Rust在内。这种错误发生在程序试图访问已经被释放的内存区域时。)</li>
<li>例如，你可以使用 <code dir="auto">Box</code> 来创建一个在堆上分配的整数：</li>
</ul>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">x</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> Box</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#82AAFF;--1:#3C63B3">new</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#F78C6C;--1:#AA0982">42</span><span style="--0:#D6DEEB;--1:#403F53">);</span><span style="--0:#809191;--1:#5E6578"> // 在堆上分配一个整数，并将它存储在Box中</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="let x = Box::new(42); // 在堆上分配一个整数，并将它存储在Box中"><div></div></button></div></figure></div>
</li>
<li>
<p><strong>引用计数智能指针(<code dir="auto">Rc&#x3C;T></code> 和 <code dir="auto">Arc&#x3C;T></code>)</strong>：</p>
<ul>
<li><code dir="auto">Rc&#x3C;T></code>(引用计数)和 <code dir="auto">Arc&#x3C;T></code>(原子引用计数)是Rust中的智能指针，用于跟踪堆上数据的引用计数。它们允许多个所有者共享同一块堆内存，直到所有所有者都离开作用域为止。</li>
<li><strong><code dir="auto">Rc&#x3C;T></code> 用于单线程环境，而 <code dir="auto">Arc&#x3C;T></code> 用于多线程环境，因为后者具有原子引用计数。</strong></li>
<li>例如，你可以使用 <code dir="auto">Rc</code> 来创建一个堆上的字符串：</li>
</ul>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">use</span><span style="--0:#D6DEEB;--1:#403F53"> std</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#D6DEEB;--1:#403F53">rc</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#D6DEEB;--1:#403F53">Rc;</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">s1</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> Rc</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#82AAFF;--1:#3C63B3">new</span><span style="--0:#D6DEEB;--1:#403F53">(String</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#82AAFF;--1:#3C63B3">from</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">hello</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">));</span><span style="--0:#809191;--1:#5E6578"> // 创建一个引用计数智能指针</span></div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">s2</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">s1</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">clone</span><span style="--0:#D6DEEB;--1:#403F53">();</span><span style="--0:#809191;--1:#5E6578"> // 克隆指针，增加引用计数</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="use std::rc::Rc;let s1 = Rc::new(String::from(&#x22;hello&#x22;)); // 创建一个引用计数智能指针let s2 = s1.clone(); // 克隆指针，增加引用计数"><div></div></button></div></figure></div>
</li>
</ol>
<p>这些堆分配的指针帮助Rust程序员在不违反所有权规则的情况下管理堆上的数据。当不再需要这些数据时，它们会自动释放内存，从而减少了内存泄漏和安全问题的风险。但需要注意的是，使用堆分配的指针很多情况下能提升性能，但是也可能会引入运行时开销，因此应谨慎使用，尤其是在需要高性能的代码中。</p>
<p>现在我们再来详细讲一下<code dir="auto">Rc&#x3C;T></code> 和 <code dir="auto">Arc&#x3C;T></code>。</p>
<h3 id="591-rc-指针reference-counting">5.9.1 <code dir="auto">Rc</code> 指针(Reference Counting)</h3>
<p><strong><code dir="auto">Rc</code></strong> 表示”引用计数”(Reference Counting)，在单线程环境中使用，它允许多个所有者共享数据，但不能用于多线程并发。是故可以使用<code dir="auto">Rc</code>(引用计数)来共享数据并在多个函数之间传递变量。</p>
<p><strong>示例代码：</strong></p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">use</span><span style="--0:#D6DEEB;--1:#403F53"> std</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#D6DEEB;--1:#403F53">rc</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#D6DEEB;--1:#403F53">Rc;</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#809191;--1:#5E6578">// 定义一个结构体，它包含一个整数字段</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">#[derive(Debug)]</span></div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">struct</span><span style="--0:#D6DEEB;--1:#403F53"> Data {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C5E478;--1:#3C63B3">value</span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#D6DEEB;--1:#403F53"> i32,</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">}</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#809191;--1:#5E6578">// 接受一个包含 Rc&#x3C;Data> 的参数的函数</span></div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">fn</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">print_data</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#C5E478;--1:#3C63B3">data</span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#D6DEEB;--1:#403F53"> Rc&#x3C;Data>) {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#82AAFF;--1:#3C63B3">println!</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">Data: {:?}</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#C5E478;--1:#3C63B3">data</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">}</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#809191;--1:#5E6578">// 修改 Rc&#x3C;Data> 的值的函数</span></div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">fn</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">modify_data</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#C5E478;--1:#3C63B3">data</span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#D6DEEB;--1:#403F53"> Rc&#x3C;Data>) </span><span style="--0:#7FDBCA;--1:#097174">-></span><span style="--0:#D6DEEB;--1:#403F53"> Rc&#x3C;Data> {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#82AAFF;--1:#3C63B3">println!</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">Modifying data...</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    Rc</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#82AAFF;--1:#3C63B3">new</span><span style="--0:#D6DEEB;--1:#403F53">(Data {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        </span><span style="--0:#C5E478;--1:#3C63B3">value</span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">data</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#D6DEEB;--1:#403F53">value </span><span style="--0:#7FDBCA;--1:#097174">+</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#F78C6C;--1:#AA0982">1</span><span style="--0:#D6DEEB;--1:#403F53">,</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    })</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">}</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">fn</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">main</span><span style="--0:#D6DEEB;--1:#403F53">() {</span></div><div class="ec-line"><span style="--0:#809191;--1:#5E6578">    // 创建一个 Rc&#x3C;Data> 实例</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">shared_data</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> Rc</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#82AAFF;--1:#3C63B3">new</span><span style="--0:#D6DEEB;--1:#403F53">(Data { </span><span style="--0:#C5E478;--1:#3C63B3">value</span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#F78C6C;--1:#AA0982">42</span><span style="--0:#D6DEEB;--1:#403F53"> });</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#809191;--1:#5E6578">    // 在不同的函数之间传递 Rc&#x3C;Data></span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#82AAFF;--1:#3C63B3">print_data</span><span style="--0:#D6DEEB;--1:#403F53">(Rc</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#82AAFF;--1:#3C63B3">clone</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#7FDBCA;--1:#097174">&#x26;</span><span style="--0:#C5E478;--1:#3C63B3">shared_data</span><span style="--0:#D6DEEB;--1:#403F53">));</span><span style="--0:#809191;--1:#5E6578"> // 克隆 Rc&#x3C;Data> 并传递给函数</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">modified_data</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">modify_data</span><span style="--0:#D6DEEB;--1:#403F53">(Rc</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#82AAFF;--1:#3C63B3">clone</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#7FDBCA;--1:#097174">&#x26;</span><span style="--0:#C5E478;--1:#3C63B3">shared_data</span><span style="--0:#D6DEEB;--1:#403F53">));</span><span style="--0:#809191;--1:#5E6578"> // 克隆 Rc&#x3C;Data> 并传递给函数</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#809191;--1:#5E6578">    // 打印修改后的数据</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#82AAFF;--1:#3C63B3">println!</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">Modified Data: {:?}</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#C5E478;--1:#3C63B3">modified_data</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#809191;--1:#5E6578">    // 这里还可以继续使用 shared_data 和 modified_data，因为它们都是 Rc&#x3C;Data> 的所有者</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#82AAFF;--1:#3C63B3">println!</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">Shared Data: {:?}</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#C5E478;--1:#3C63B3">shared_data</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">}</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="use std::rc::Rc;// 定义一个结构体，它包含一个整数字段#[derive(Debug)]struct Data {    value: i32,}// 接受一个包含 Rc<Data> 的参数的函数fn print_data(data: Rc<Data>) {    println!(&#x22;Data: {:?}&#x22;, data);}// 修改 Rc<Data> 的值的函数fn modify_data(data: Rc<Data>) -> Rc<Data> {    println!(&#x22;Modifying data...&#x22;);    Rc::new(Data {        value: data.value + 1,    })}fn main() {    // 创建一个 Rc<Data> 实例    let shared_data = Rc::new(Data { value: 42 });    // 在不同的函数之间传递 Rc<Data>    print_data(Rc::clone(&#x26;shared_data)); // 克隆 Rc<Data> 并传递给函数    let modified_data = modify_data(Rc::clone(&#x26;shared_data)); // 克隆 Rc<Data> 并传递给函数    // 打印修改后的数据    println!(&#x22;Modified Data: {:?}&#x22;, modified_data);    // 这里还可以继续使用 shared_data 和 modified_data，因为它们都是 Rc<Data> 的所有者    println!(&#x22;Shared Data: {:?}&#x22;, shared_data);}"><div></div></button></div></figure></div>
<p>在这个示例中，我们定义了一个包含整数字段的<code dir="auto">Data</code>结构体，并使用<code dir="auto">Rc</code>包装它。然后，我们创建一个<code dir="auto">Rc&#x3C;Data></code>实例并在不同的函数之间传递它。在 <code dir="auto">print_data</code> 函数中，我们只是打印了<code dir="auto">Rc&#x3C;Data></code>的值，而在<code dir="auto">modify_data</code>函数中，我们创建了一个新的<code dir="auto">Rc&#x3C;Data></code>实例，该实例修改了原始数据的值。由于<code dir="auto">Rc</code>允许多个所有者，我们可以在不同的函数之间传递数据，而不需要担心所有权的问题。</p>
<p><strong>执行结果：</strong></p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#d6deeb;--1:#403f53">Data: Data { value: 42 }</span></div><div class="ec-line"><span style="--0:#d6deeb;--1:#403f53">Modifying data...</span></div><div class="ec-line"><span style="--0:#d6deeb;--1:#403f53">Modified Data: Data { value: 43 }</span></div><div class="ec-line"><span style="--0:#d6deeb;--1:#403f53">Shared Data: Data { value: 42 }</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="Data: Data { value: 42 }Modifying data...Modified Data: Data { value: 43 }Shared Data: Data { value: 42 }"><div></div></button></div></figure></div>
<h3 id="592-arc指针atomic-reference-counting">5.9.2 `Arc指针(Atomic Reference Counting)</h3>
<p><strong><code dir="auto">Arc</code></strong> 表示”原子引用计数”(Atomic Reference Counting)，在多线程环境中使用，它与 <code dir="auto">Rc</code> 类似，但具备线程安全性。</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">use</span><span style="--0:#D6DEEB;--1:#403F53"> std</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#D6DEEB;--1:#403F53">sync</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#D6DEEB;--1:#403F53">Arc;</span></div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">use</span><span style="--0:#D6DEEB;--1:#403F53"> std</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#D6DEEB;--1:#403F53">thread;</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#809191;--1:#5E6578">// 定义一个结构体，它包含一个整数字段</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">#[allow(dead_code)]</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">#[derive(Debug)]</span></div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">struct</span><span style="--0:#D6DEEB;--1:#403F53"> Data {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C5E478;--1:#3C63B3">value</span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#D6DEEB;--1:#403F53"> i32,</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">}</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">fn</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">main</span><span style="--0:#D6DEEB;--1:#403F53">() {</span></div><div class="ec-line"><span style="--0:#809191;--1:#5E6578">    // 创建一个 Arc&#x3C;Data> 实例</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">shared_data</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> Arc</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#82AAFF;--1:#3C63B3">new</span><span style="--0:#D6DEEB;--1:#403F53">(Data { </span><span style="--0:#C5E478;--1:#3C63B3">value</span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#F78C6C;--1:#AA0982">42</span><span style="--0:#D6DEEB;--1:#403F53"> });</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#809191;--1:#5E6578">    // 创建一个线程，传递 Arc&#x3C;Data> 到线程中</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">thread_data</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> Arc</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#82AAFF;--1:#3C63B3">clone</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#7FDBCA;--1:#097174">&#x26;</span><span style="--0:#C5E478;--1:#3C63B3">shared_data</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">handle</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> thread</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#82AAFF;--1:#3C63B3">spawn</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#C792EA;--1:#8D46B4">move</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">||</span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div><div class="ec-line"><span style="--0:#809191;--1:#5E6578">        // 在新线程中打印 Arc&#x3C;Data> 的值</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        </span><span style="--0:#82AAFF;--1:#3C63B3">println!</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">Thread Data: {:?}</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#C5E478;--1:#3C63B3">thread_data</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    });</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#809191;--1:#5E6578">    // 主线程继续使用 shared_data</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#82AAFF;--1:#3C63B3">println!</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">Main Data: {:?}</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#C5E478;--1:#3C63B3">shared_data</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#809191;--1:#5E6578">    // 等待新线程完成</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C5E478;--1:#3C63B3">handle</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">join</span><span style="--0:#D6DEEB;--1:#403F53">()</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">unwrap</span><span style="--0:#D6DEEB;--1:#403F53">();</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">}</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="use std::sync::Arc;use std::thread;// 定义一个结构体，它包含一个整数字段#[allow(dead_code)]#[derive(Debug)]struct Data {    value: i32,}fn main() {    // 创建一个 Arc<Data> 实例    let shared_data = Arc::new(Data { value: 42 });    // 创建一个线程，传递 Arc<Data> 到线程中    let thread_data = Arc::clone(&#x26;shared_data);    let handle = thread::spawn(move || {        // 在新线程中打印 Arc<Data> 的值        println!(&#x22;Thread Data: {:?}&#x22;, thread_data);    });    // 主线程继续使用 shared_data    println!(&#x22;Main Data: {:?}&#x22;, shared_data);    // 等待新线程完成    handle.join().unwrap();}"><div></div></button></div></figure></div>
<p>在这个示例中，我们创建了一个包含整数字段的 <code dir="auto">Data</code> 结构体，并将其用 <code dir="auto">Arc</code> 包装。然后，我们创建了一个新的线程，并在新线程中打印了 <code dir="auto">thread_data</code>(一个克隆的 <code dir="auto">Arc&#x3C;Data></code>)的值。同时，主线程继续使用原始的 <code dir="auto">shared_data</code>。由于 <code dir="auto">Arc</code> 允许在多个线程之间共享数据，我们可以在不同线程之间传递数据而不担心线程安全性问题。</p>
<p><strong>执行结果：</strong></p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#d6deeb;--1:#403f53">Main Data: Data { value: 42 }</span></div><div class="ec-line"><span style="--0:#d6deeb;--1:#403f53">Thread Data: Data { value: 42 }</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="Main Data: Data { value: 42 }Thread Data: Data { value: 42 }"><div></div></button></div></figure></div>
<h3 id="593-常见的-rust-智能指针类型之间的比较">5.9.3 常见的 Rust 智能指针类型之间的比较</h3>
<p>现在让我们来回顾一下我们在本章学习的智能指针:</p>






























<table><thead><tr><th>指针类型</th><th>描述</th><th>主要特性和用途</th></tr></thead><tbody><tr><td><code dir="auto">Box&#x3C;T></code></td><td>堆分配的指针，拥有唯一所有权，通常用于数据所有权的转移。</td><td>在编译时检查下，避免了内存泄漏和数据竞争。</td></tr><tr><td><code dir="auto">Rc&#x3C;T></code></td><td>引用计数智能指针，允许多个所有者，但不能用于多线程环境。</td><td>用于共享数据的多个所有者，适用于单线程应用。</td></tr><tr><td><code dir="auto">Arc&#x3C;T></code></td><td>原子引用计数智能指针，允许多个所有者，适用于多线程环境。</td><td>用于共享数据的多个所有者，适用于多线程应用。</td></tr><tr><td><code dir="auto">Mutex&#x3C;T></code></td><td>互斥锁智能指针，用于多线程环境，提供内部可变性。</td><td>用于共享数据的多线程环境，确保一次只有一个线程可以访问共享数据。</td></tr></tbody></table>
<p>这个表格总结了 Rust 中常见的智能指针类型的比较，排除了 <code dir="auto">RefCell&#x3C;T></code> 和 <code dir="auto">Cell&#x3C;T></code> 这两个类型。根据你的需求，选择适合的智能指针类型，以满足所有权、可变性和线程安全性的要求。</p>
<h3 id="案例使用多线程备份一组金融数据">案例：使用多线程备份一组金融数据</h3>
<p>在Rust中使用多线程，以更好的性能备份一组金融数据到本地可以通过以下步骤完成：</p>
<ol>
<li>导入所需的库：
首先，你需要导入标准库中的多线程和文件操作相关的模块。</li>
</ol>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">use</span><span style="--0:#D6DEEB;--1:#403F53"> std</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#D6DEEB;--1:#403F53">fs</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#D6DEEB;--1:#403F53">File;</span></div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">use</span><span style="--0:#D6DEEB;--1:#403F53"> std</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#D6DEEB;--1:#403F53">io</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#D6DEEB;--1:#403F53">Write;</span></div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">use</span><span style="--0:#D6DEEB;--1:#403F53"> std</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#D6DEEB;--1:#403F53">sync</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#D6DEEB;--1:#403F53">{Arc, Mutex};</span></div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">use</span><span style="--0:#D6DEEB;--1:#403F53"> std</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#D6DEEB;--1:#403F53">thread;</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="use std::fs::File;use std::io::Write;use std::sync::{Arc, Mutex};use std::thread;"><div></div></button></div></figure></div>
<ol start="2">
<li>准备金融数据：
准备好你想要备份的金融数据，可以存储在一个向量或其他数据结构中。</li>
</ol>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#809191;--1:#5E6578">// 假设有一组金融数据</span></div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">financial_data</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">vec!</span><span style="--0:#D6DEEB;--1:#403F53">[</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">Data1</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">,</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">Data2</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">,</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">Data3</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">,</span></div><div class="ec-line"><span style="--0:#809191;--1:#5E6578">    // ...更多数据</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">];</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="// 假设有一组金融数据let financial_data = vec![    &#x22;Data1&#x22;,    &#x22;Data2&#x22;,    &#x22;Data3&#x22;,    // ...更多数据];"><div></div></button></div></figure></div>
<ol start="3">
<li>创建一个互斥锁和一个共享数据的Arc(原子引用计数器)：
这将用于多个线程之间共享金融数据。</li>
</ol>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">data_mutex</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> Arc</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#82AAFF;--1:#3C63B3">new</span><span style="--0:#D6DEEB;--1:#403F53">(Mutex</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#82AAFF;--1:#3C63B3">new</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#C5E478;--1:#3C63B3">financial_data</span><span style="--0:#D6DEEB;--1:#403F53">));</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="let data_mutex = Arc::new(Mutex::new(financial_data));"><div></div></button></div></figure></div>
<ol start="4">
<li>定义备份逻辑：
编写一个备份金融数据的函数，每个线程都会调用这个函数来备份数据。备份可以简单地写入文件。</li>
</ol>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">fn</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">backup_data</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#C5E478;--1:#3C63B3">data</span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#097174">&#x26;</span><span style="--0:#D6DEEB;--1:#403F53">str, </span><span style="--0:#C5E478;--1:#3C63B3">filename</span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#097174">&#x26;</span><span style="--0:#D6DEEB;--1:#403F53">str) </span><span style="--0:#7FDBCA;--1:#097174">-></span><span style="--0:#D6DEEB;--1:#403F53"> std</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#D6DEEB;--1:#403F53">io</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#D6DEEB;--1:#403F53">Result&#x3C;()> {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">mut</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">file</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> File</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#82AAFF;--1:#3C63B3">create</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#C5E478;--1:#3C63B3">filename</span><span style="--0:#D6DEEB;--1:#403F53">)</span><span style="--0:#7FDBCA;--1:#097174">?</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C5E478;--1:#3C63B3">file</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">write_all</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#C5E478;--1:#3C63B3">data</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">as_bytes</span><span style="--0:#D6DEEB;--1:#403F53">())</span><span style="--0:#7FDBCA;--1:#097174">?</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    Ok(())</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">}</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="fn backup_data(data: &#x26;str, filename: &#x26;str) -> std::io::Result<()> {    let mut file = File::create(filename)?;    file.write_all(data.as_bytes())?;    Ok(())}"><div></div></button></div></figure></div>
<ol start="5">
<li>创建多个线程来备份数据：
对每个金融数据启动一个线程，使用互斥锁来获取要备份的数据。</li>
</ol>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">mut</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">thread_handles</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">vec!</span><span style="--0:#D6DEEB;--1:#403F53">[];</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">for</span><span style="--0:#D6DEEB;--1:#403F53"> (</span><span style="--0:#C5E478;--1:#3C63B3">index</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#C5E478;--1:#3C63B3">data</span><span style="--0:#D6DEEB;--1:#403F53">) </span><span style="--0:#C792EA;--1:#8D46B4">in</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">data_mutex</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">lock</span><span style="--0:#D6DEEB;--1:#403F53">()</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">unwrap</span><span style="--0:#D6DEEB;--1:#403F53">()</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">iter_mut</span><span style="--0:#D6DEEB;--1:#403F53">()</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">enumerate</span><span style="--0:#D6DEEB;--1:#403F53">() {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">filename</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">format!</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">financial_data_{}.txt</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#C5E478;--1:#3C63B3">index</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">data</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">data</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">clone</span><span style="--0:#D6DEEB;--1:#403F53">();</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">handle</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> thread</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#82AAFF;--1:#3C63B3">spawn</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#C792EA;--1:#8D46B4">move</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">||</span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        </span><span style="--0:#C792EA;--1:#8D46B4">match</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">backup_data</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#7FDBCA;--1:#097174">&#x26;</span><span style="--0:#C5E478;--1:#3C63B3">data</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#7FDBCA;--1:#097174">&#x26;</span><span style="--0:#C5E478;--1:#3C63B3">filename</span><span style="--0:#D6DEEB;--1:#403F53">) {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">            Ok(</span><span style="--0:#C5E478;--1:#3C63B3">_</span><span style="--0:#D6DEEB;--1:#403F53">) </span><span style="--0:#7FDBCA;--1:#097174">=></span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">println!</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">Backup successful: {}</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#C5E478;--1:#3C63B3">filename</span><span style="--0:#D6DEEB;--1:#403F53">),</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">            Err(</span><span style="--0:#C5E478;--1:#3C63B3">err</span><span style="--0:#D6DEEB;--1:#403F53">) </span><span style="--0:#7FDBCA;--1:#097174">=></span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">eprintln!</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">Error backing up {}: {:?}</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#C5E478;--1:#3C63B3">filename</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#C5E478;--1:#3C63B3">err</span><span style="--0:#D6DEEB;--1:#403F53">),</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        }</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    });</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C5E478;--1:#3C63B3">thread_handles</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">push</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#C5E478;--1:#3C63B3">handle</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">}</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="let mut thread_handles = vec![];for (index, data) in data_mutex.lock().unwrap().iter_mut().enumerate() {    let filename = format!(&#x22;financial_data_{}.txt&#x22;, index);    let data = data.clone();    let handle = thread::spawn(move || {        match backup_data(&#x26;data, &#x26;filename) {            Ok(_) => println!(&#x22;Backup successful: {}&#x22;, filename),            Err(err) => eprintln!(&#x22;Error backing up {}: {:?}&#x22;, filename, err),        }    });    thread_handles.push(handle);}"><div></div></button></div></figure></div>
<p>这段代码遍历金融数据，并为每个数据启动一个线程。每个线程将金融数据备份到一个单独的文件中，文件名包含了数据的索引。备份操作使用 <code dir="auto">backup_data</code> 函数完成。</p>
<ol start="6">
<li>等待线程完成：
最后，等待所有线程完成备份操作。</li>
</ol>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">for</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">handle</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">in</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">thread_handles</span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C5E478;--1:#3C63B3">handle</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">join</span><span style="--0:#D6DEEB;--1:#403F53">()</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">unwrap</span><span style="--0:#D6DEEB;--1:#403F53">();</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">}</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="for handle in thread_handles {    handle.join().unwrap();}"><div></div></button></div></figure></div>
<p>完整的Rust多线程备份金融数据的代码如下：</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">use</span><span style="--0:#D6DEEB;--1:#403F53"> std</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#D6DEEB;--1:#403F53">fs</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#D6DEEB;--1:#403F53">File;</span></div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">use</span><span style="--0:#D6DEEB;--1:#403F53"> std</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#D6DEEB;--1:#403F53">io</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#D6DEEB;--1:#403F53">Write;</span></div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">use</span><span style="--0:#D6DEEB;--1:#403F53"> std</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#D6DEEB;--1:#403F53">sync</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#D6DEEB;--1:#403F53">{Arc, Mutex};</span></div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">use</span><span style="--0:#D6DEEB;--1:#403F53"> std</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#D6DEEB;--1:#403F53">thread;</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">fn</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">backup_data</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#C5E478;--1:#3C63B3">data</span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#097174">&#x26;</span><span style="--0:#D6DEEB;--1:#403F53">str, </span><span style="--0:#C5E478;--1:#3C63B3">filename</span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#097174">&#x26;</span><span style="--0:#D6DEEB;--1:#403F53">str) </span><span style="--0:#7FDBCA;--1:#097174">-></span><span style="--0:#D6DEEB;--1:#403F53"> std</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#D6DEEB;--1:#403F53">io</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#D6DEEB;--1:#403F53">Result&#x3C;()> {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">mut</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">file</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> File</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#82AAFF;--1:#3C63B3">create</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#C5E478;--1:#3C63B3">filename</span><span style="--0:#D6DEEB;--1:#403F53">)</span><span style="--0:#7FDBCA;--1:#097174">?</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C5E478;--1:#3C63B3">file</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">write_all</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#C5E478;--1:#3C63B3">data</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">as_bytes</span><span style="--0:#D6DEEB;--1:#403F53">())</span><span style="--0:#7FDBCA;--1:#097174">?</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    Ok(())</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">}</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">fn</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">main</span><span style="--0:#D6DEEB;--1:#403F53">() {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">financial_data</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">vec!</span><span style="--0:#D6DEEB;--1:#403F53">[</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">Data1</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">,</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">Data2</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">,</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">Data3</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">,</span></div><div class="ec-line"><span style="--0:#809191;--1:#5E6578">        // ... 添加更多数据</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    ];</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">data_mutex</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> Arc</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#82AAFF;--1:#3C63B3">new</span><span style="--0:#D6DEEB;--1:#403F53">(Mutex</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#82AAFF;--1:#3C63B3">new</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#C5E478;--1:#3C63B3">financial_data</span><span style="--0:#D6DEEB;--1:#403F53">));</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">mut</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">thread_handles</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">vec!</span><span style="--0:#D6DEEB;--1:#403F53">[];</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">for</span><span style="--0:#D6DEEB;--1:#403F53"> (</span><span style="--0:#C5E478;--1:#3C63B3">index</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#C5E478;--1:#3C63B3">data</span><span style="--0:#D6DEEB;--1:#403F53">) </span><span style="--0:#C792EA;--1:#8D46B4">in</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">data_mutex</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">lock</span><span style="--0:#D6DEEB;--1:#403F53">()</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">unwrap</span><span style="--0:#D6DEEB;--1:#403F53">()</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">iter_mut</span><span style="--0:#D6DEEB;--1:#403F53">()</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">enumerate</span><span style="--0:#D6DEEB;--1:#403F53">() {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">filename</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">format!</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">financial_data_{}.txt</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#C5E478;--1:#3C63B3">index</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">data</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">data</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">to_string</span><span style="--0:#D6DEEB;--1:#403F53">();</span><span style="--0:#809191;--1:#5E6578"> // 将&#x26;str转换为String</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">handle</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> thread</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#82AAFF;--1:#3C63B3">spawn</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#C792EA;--1:#8D46B4">move</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">||</span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">            </span><span style="--0:#C792EA;--1:#8D46B4">match</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">backup_data</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#7FDBCA;--1:#097174">&#x26;</span><span style="--0:#C5E478;--1:#3C63B3">data</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#7FDBCA;--1:#097174">&#x26;</span><span style="--0:#C5E478;--1:#3C63B3">filename</span><span style="--0:#D6DEEB;--1:#403F53">) {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">                Ok(</span><span style="--0:#C5E478;--1:#3C63B3">_</span><span style="--0:#D6DEEB;--1:#403F53">) </span><span style="--0:#7FDBCA;--1:#097174">=></span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">println!</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">Backup successful: {}</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#C5E478;--1:#3C63B3">filename</span><span style="--0:#D6DEEB;--1:#403F53">),</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">                Err(</span><span style="--0:#C5E478;--1:#3C63B3">err</span><span style="--0:#D6DEEB;--1:#403F53">) </span><span style="--0:#7FDBCA;--1:#097174">=></span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">eprintln!</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">Error backing up {}: {:?}</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#C5E478;--1:#3C63B3">filename</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#C5E478;--1:#3C63B3">err</span><span style="--0:#D6DEEB;--1:#403F53">),</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">            }</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        });</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        </span><span style="--0:#C5E478;--1:#3C63B3">thread_handles</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">push</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#C5E478;--1:#3C63B3">handle</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    }</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">for</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">handle</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">in</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">thread_handles</span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        </span><span style="--0:#C5E478;--1:#3C63B3">handle</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">join</span><span style="--0:#D6DEEB;--1:#403F53">()</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">unwrap</span><span style="--0:#D6DEEB;--1:#403F53">();</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    }</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">}</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="use std::fs::File;use std::io::Write;use std::sync::{Arc, Mutex};use std::thread;fn backup_data(data: &#x26;str, filename: &#x26;str) -> std::io::Result<()> {    let mut file = File::create(filename)?;    file.write_all(data.as_bytes())?;    Ok(())}fn main() {    let financial_data = vec![        &#x22;Data1&#x22;,        &#x22;Data2&#x22;,        &#x22;Data3&#x22;,        // ... 添加更多数据    ];    let data_mutex = Arc::new(Mutex::new(financial_data));    let mut thread_handles = vec![];    for (index, data) in data_mutex.lock().unwrap().iter_mut().enumerate() {        let filename = format!(&#x22;financial_data_{}.txt&#x22;, index);        let data = data.to_string(); // 将&#x26;str转换为String        let handle = thread::spawn(move || {            match backup_data(&#x26;data, &#x26;filename) {                Ok(_) => println!(&#x22;Backup successful: {}&#x22;, filename),                Err(err) => eprintln!(&#x22;Error backing up {}: {:?}&#x22;, filename, err),            }        });        thread_handles.push(handle);    }    for handle in thread_handles {        handle.join().unwrap();    }}"><div></div></button></div></figure></div>
<p>执行结果：</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#d6deeb;--1:#403f53">Backup successful: financial_data_0.txt</span></div><div class="ec-line"><span style="--0:#d6deeb;--1:#403f53">Backup successful: financial_data_1.txt</span></div><div class="ec-line"><span style="--0:#d6deeb;--1:#403f53">Backup successful: financial_data_2.txt</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="Backup successful: financial_data_0.txtBackup successful: financial_data_1.txtBackup successful: financial_data_2.txt"><div></div></button></div></figure></div>
<p>这段代码使用多线程并行备份金融数据到不同的文件中，确保数据的备份操作是并行执行的。每个线程都备份一个数据。备份成功后，程序会打印成功的消息，如果发生错误，会打印错误信息。</p> </div> <footer class="astro-w7wtsaw6"> <div class="meta sl-flex astro-w7wtsaw6">   </div> <div class="pagination-links astro-qnftudm7" dir="ltr"> <a href="/chapters/chapter_4/" rel="prev" class="astro-qnftudm7"> <svg aria-hidden="true" class="astro-qnftudm7 astro-xrndq6a6" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.5rem;"><path d="M17 11H9.41l3.3-3.29a1.004 1.004 0 1 0-1.42-1.42l-5 5a1 1 0 0 0-.21.33 1 1 0 0 0 0 .76 1 1 0 0 0 .21.33l5 5a1.002 1.002 0 0 0 1.639-.325 1 1 0 0 0-.219-1.095L9.41 13H17a1 1 0 0 0 0-2Z"/></svg>  <span class="astro-qnftudm7"> Previous <br class="astro-qnftudm7"> <span class="link-title astro-qnftudm7">4. 自定义类型 Struct &amp; Enum</span> </span> </a> <a href="/chapters/chapter_6/" rel="next" class="astro-qnftudm7"> <svg aria-hidden="true" class="astro-qnftudm7 astro-xrndq6a6" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.5rem;"><path d="M17.92 11.62a1.001 1.001 0 0 0-.21-.33l-5-5a1.003 1.003 0 1 0-1.42 1.42l3.3 3.29H7a1 1 0 0 0 0 2h7.59l-3.3 3.29a1.002 1.002 0 0 0 .325 1.639 1 1 0 0 0 1.095-.219l5-5a1 1 0 0 0 .21-.33 1 1 0 0 0 0-.76Z"/></svg>  <span class="astro-qnftudm7"> Next <br class="astro-qnftudm7"> <span class="link-title astro-qnftudm7">6. 变量和作用域</span> </span> </a> </div>  </footer>  </div> </div>   </main> </div> </div>  </div> </div>  </body></html>