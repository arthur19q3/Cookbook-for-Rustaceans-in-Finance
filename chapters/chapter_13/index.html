<!DOCTYPE html><html lang="en" dir="ltr" data-has-toc data-has-sidebar class="astro-fpze62lo"> <head><meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><title>属性(Attributes) | Cookbook for Rustaceans in Finance / Rust 量化金融开发指南</title><link rel="canonical"/><link rel="shortcut icon" href="/favicon.svg" type="image/svg+xml"/><meta name="generator" content="Astro v4.3.3"/><meta name="generator" content="Starlight v0.17.3"/><meta property="og:title" content="属性(Attributes)"/><meta property="og:type" content="article"/><meta property="og:url"/><meta property="og:locale" content="en"/><meta property="og:description"/><meta property="og:site_name" content="Cookbook for Rustaceans in Finance / Rust 量化金融开发指南"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:title" content="属性(Attributes)"/><meta name="twitter:description"/><script>
	window.StarlightThemeProvider = (() => {
		const storedTheme =
			typeof localStorage !== 'undefined' && localStorage.getItem('starlight-theme');
		const theme =
			storedTheme ||
			(window.matchMedia('(prefers-color-scheme: light)').matches ? 'light' : 'dark');
		document.documentElement.dataset.theme = theme === 'light' ? 'light' : 'dark';
		return {
			updatePickers(theme = storedTheme || 'auto') {
				document.querySelectorAll('starlight-theme-select').forEach((picker) => {
					const select = picker.querySelector('select');
					if (select) select.value = theme;
					/** @type {HTMLTemplateElement | null} */
					const tmpl = document.querySelector(`#theme-icons`);
					const newIcon = tmpl && tmpl.content.querySelector('.' + theme);
					if (newIcon) {
						const oldIcon = picker.querySelector('svg.label-icon');
						if (oldIcon) {
							oldIcon.replaceChildren(...newIcon.cloneNode(true).childNodes);
						}
					}
				});
			},
		};
	})();
</script><template id="theme-icons"><svg aria-hidden="true" class="light astro-xrndq6a6" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M5 12a1 1 0 0 0-1-1H3a1 1 0 0 0 0 2h1a1 1 0 0 0 1-1Zm.64 5-.71.71a1 1 0 0 0 0 1.41 1 1 0 0 0 1.41 0l.71-.71A1 1 0 0 0 5.64 17ZM12 5a1 1 0 0 0 1-1V3a1 1 0 0 0-2 0v1a1 1 0 0 0 1 1Zm5.66 2.34a1 1 0 0 0 .7-.29l.71-.71a1 1 0 1 0-1.41-1.41l-.66.71a1 1 0 0 0 0 1.41 1 1 0 0 0 .66.29Zm-12-.29a1 1 0 0 0 1.41 0 1 1 0 0 0 0-1.41l-.71-.71a1.004 1.004 0 1 0-1.43 1.41l.73.71ZM21 11h-1a1 1 0 0 0 0 2h1a1 1 0 0 0 0-2Zm-2.64 6A1 1 0 0 0 17 18.36l.71.71a1 1 0 0 0 1.41 0 1 1 0 0 0 0-1.41l-.76-.66ZM12 6.5a5.5 5.5 0 1 0 5.5 5.5A5.51 5.51 0 0 0 12 6.5Zm0 9a3.5 3.5 0 1 1 0-7 3.5 3.5 0 0 1 0 7Zm0 3.5a1 1 0 0 0-1 1v1a1 1 0 0 0 2 0v-1a1 1 0 0 0-1-1Z"/></svg> <svg aria-hidden="true" class="dark astro-xrndq6a6" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M21.64 13a1 1 0 0 0-1.05-.14 8.049 8.049 0 0 1-3.37.73 8.15 8.15 0 0 1-8.14-8.1 8.59 8.59 0 0 1 .25-2A1 1 0 0 0 8 2.36a10.14 10.14 0 1 0 14 11.69 1 1 0 0 0-.36-1.05Zm-9.5 6.69A8.14 8.14 0 0 1 7.08 5.22v.27a10.15 10.15 0 0 0 10.14 10.14 9.784 9.784 0 0 0 2.1-.22 8.11 8.11 0 0 1-7.18 4.32v-.04Z"/></svg> <svg aria-hidden="true" class="auto astro-xrndq6a6" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M21 14h-1V7a3 3 0 0 0-3-3H7a3 3 0 0 0-3 3v7H3a1 1 0 0 0-1 1v2a3 3 0 0 0 3 3h14a3 3 0 0 0 3-3v-2a1 1 0 0 0-1-1ZM6 7a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v7H6V7Zm14 10a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1v-1h16v1Z"/></svg> </template><link rel="stylesheet" href="/_astro/index.4lckRRHb.css" /><script type="module" src="/_astro/hoisted.RLbdawI7.js"></script>
<script type="module" src="/_astro/page.X_0NJa-z.js"></script></head> <body class="astro-fpze62lo"> <a href="#_top" class="astro-byjsuuaw">Skip to content</a>  <div class="page sl-flex astro-yxqmbg7i"> <header class="header astro-yxqmbg7i"><div class="header sl-flex astro-cyrhhlnw"> <div class="title-wrapper sl-flex astro-cyrhhlnw"> <a href="/" class="site-title sl-flex astro-ylanx5mn">  <span class="astro-ylanx5mn"> Cookbook for Rustaceans in Finance / Rust 量化金融开发指南 </span> </a>  </div> <div class="sl-flex astro-cyrhhlnw"> <site-search data-translations="{&#34;placeholder&#34;:&#34;Search&#34;}" class="astro-usz5hgcn"> <button data-open-modal disabled class="astro-usz5hgcn">  <svg aria-label="Search" class="astro-usz5hgcn astro-xrndq6a6" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M21.71 20.29 18 16.61A9 9 0 1 0 16.61 18l3.68 3.68a.999.999 0 0 0 1.42 0 1 1 0 0 0 0-1.39ZM11 18a7 7 0 1 1 0-14 7 7 0 0 1 0 14Z"/></svg>  <span class="sl-hidden md:sl-block astro-usz5hgcn" aria-hidden="true">Search</span> <svg aria-label="(Press / to Search)" class="sl-hidden md:sl-block astro-usz5hgcn astro-xrndq6a6" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M17 2H7a5 5 0 0 0-5 5v10a5 5 0 0 0 5 5h10a5 5 0 0 0 5-5V7a5 5 0 0 0-5-5Zm3 15a3 3 0 0 1-3 3H7a3 3 0 0 1-3-3V7a3 3 0 0 1 3-3h10a3 3 0 0 1 3 3v10Z"/><path d="M15.293 6.707a1 1 0 1 1 1.414 1.414l-8.485 8.486a1 1 0 0 1-1.414-1.415l8.485-8.485Z"/></svg>  </button> <dialog style="padding:0" aria-label="Search" class="astro-usz5hgcn"> <div class="dialog-frame sl-flex astro-usz5hgcn">  <button data-close-modal class="sl-flex md:sl-hidden astro-usz5hgcn"> Cancel </button> <div class="search-container astro-usz5hgcn"> <div id="starlight__search" class="astro-usz5hgcn"></div> </div> </div> </dialog> </site-search>    </div> <div class="sl-hidden md:sl-flex right-group astro-cyrhhlnw"> <div class="sl-flex social-icons astro-cyrhhlnw"> <a href="https://github.com/withastro/starlight" rel="me" class="sl-flex astro-3daxh4jc"><span class="sr-only astro-3daxh4jc">GitHub</span><svg aria-hidden="true" class="astro-3daxh4jc astro-xrndq6a6" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M12 .3a12 12 0 0 0-3.8 23.38c.6.12.83-.26.83-.57L9 21.07c-3.34.72-4.04-1.61-4.04-1.61-.55-1.39-1.34-1.76-1.34-1.76-1.08-.74.09-.73.09-.73 1.2.09 1.83 1.24 1.83 1.24 1.08 1.83 2.81 1.3 3.5 1 .1-.78.42-1.31.76-1.61-2.67-.3-5.47-1.33-5.47-5.93 0-1.31.47-2.38 1.24-3.22-.14-.3-.54-1.52.1-3.18 0 0 1-.32 3.3 1.23a11.5 11.5 0 0 1 6 0c2.28-1.55 3.29-1.23 3.29-1.23.64 1.66.24 2.88.12 3.18a4.65 4.65 0 0 1 1.23 3.22c0 4.61-2.8 5.63-5.48 5.92.42.36.81 1.1.81 2.22l-.01 3.29c0 .31.2.69.82.57A12 12 0 0 0 12 .3Z"/></svg> </a> </div> <starlight-theme-select>  <label style="--sl-select-width: 6.25em" class="astro-kc6u4lxd"> <span class="sr-only astro-kc6u4lxd">Select theme</span> <svg aria-hidden="true" class="icon label-icon astro-kc6u4lxd astro-xrndq6a6" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M21 14h-1V7a3 3 0 0 0-3-3H7a3 3 0 0 0-3 3v7H3a1 1 0 0 0-1 1v2a3 3 0 0 0 3 3h14a3 3 0 0 0 3-3v-2a1 1 0 0 0-1-1ZM6 7a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v7H6V7Zm14 10a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1v-1h16v1Z"/></svg>  <select value="auto" class="astro-kc6u4lxd"> <option value="dark" class="astro-kc6u4lxd">Dark</option><option value="light" class="astro-kc6u4lxd">Light</option><option value="auto" selected="true" class="astro-kc6u4lxd">Auto</option> </select> <svg aria-hidden="true" class="icon caret astro-kc6u4lxd astro-xrndq6a6" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M17 9.17a1 1 0 0 0-1.41 0L12 12.71 8.46 9.17a1 1 0 1 0-1.41 1.42l4.24 4.24a1.002 1.002 0 0 0 1.42 0L17 10.59a1.002 1.002 0 0 0 0-1.42Z"/></svg>  </label>  </starlight-theme-select>  <script>
	StarlightThemeProvider.updatePickers();
</script>   </div> </div> </header> <nav class="sidebar astro-yxqmbg7i" aria-label="Main"> <starlight-menu-button class="astro-eouth4v3"> <button aria-expanded="false" aria-label="Menu" aria-controls="starlight__sidebar" class="sl-flex md:sl-hidden astro-eouth4v3"> <svg aria-hidden="true" class="astro-eouth4v3 astro-xrndq6a6" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M3 8h18a1 1 0 1 0 0-2H3a1 1 0 0 0 0 2Zm18 8H3a1 1 0 0 0 0 2h18a1 1 0 0 0 0-2Zm0-5H3a1 1 0 0 0 0 2h18a1 1 0 0 0 0-2Z"/></svg>  </button> </starlight-menu-button>    <div id="starlight__sidebar" class="sidebar-pane astro-yxqmbg7i"> <div class="sidebar-content sl-flex astro-yxqmbg7i"> <ul class="top-level astro-4mcqxzkb"> <li class="astro-4mcqxzkb"> <details open class="astro-4mcqxzkb"> <summary class="astro-4mcqxzkb"> <div class="group-label astro-4mcqxzkb"> <span class="large astro-4mcqxzkb">PART I 基础部分 - 量化语境下的Rust编程基础</span>  </div> <svg aria-hidden="true" class="caret astro-4mcqxzkb astro-xrndq6a6" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.25rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg>  </summary> <ul class="astro-4mcqxzkb"> <li class="astro-4mcqxzkb"> <a href="/chapters/chapter_1" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">1. Rust 语言入门101</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_2/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">2. 格式化输出</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_3/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">3. 原生类型</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_4/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">4. 自定义类型 Struct &amp; Enum</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_5/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">5. 标准库类型</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_6/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">6. 变量和作用域</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_7/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">7. 类型系统</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_8/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">8. 类型转换</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_9/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">9. 流程控制</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_10/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">10. 函数、方法和闭包</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_11/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">11. 模块</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_12/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">12. Cargo 的进阶使用</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_13/" aria-current="page" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">13. 属性(Attributes)</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_14/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">14. 泛型进阶(Advanced Generic Type Usage)</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_15/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">15. 作用域规则和生命周期</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_16/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">16. 错误处理进阶(Advanced Error handling)</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_17/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">17. 特性(trait)详解</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_18/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">18. 创建自定义宏</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_19/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">19. 时间处理</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_20/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">20. Redis、爬虫、交易日库</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_21/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">21. 线程和管道</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_22/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">22. 文件处理</span>  </a> </li> </ul>  </details> </li><li class="astro-4mcqxzkb"> <details open class="astro-4mcqxzkb"> <summary class="astro-4mcqxzkb"> <div class="group-label astro-4mcqxzkb"> <span class="large astro-4mcqxzkb">PART II 进阶部分 - 量化实战</span>  </div> <svg aria-hidden="true" class="caret astro-4mcqxzkb astro-xrndq6a6" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.25rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg>  </summary> <ul class="astro-4mcqxzkb"> <li class="astro-4mcqxzkb"> <a href="/chapters/chapter_23/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">23. Polars 入门</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_24/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">24. 时序数据库 Clickhouse</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_25/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">25. Unsafe【未完成】</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_26/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">26. 文档和测试【未完成】</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_27/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">27. 常见技术指标及其实现【本章代码未添加】</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_28/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">28. 统计模型【未完成】</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_29/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">29. 引擎系统【未完成】</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_30/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">30. 日志系统【未完成】</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_31/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">31. 投资组合管理【未完成】</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_32/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">32. 量化计量经济学【未完成】</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_33/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">33. 限价指令簿【未完成】</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_34/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">34. 最优配置和执行【未完成】</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_35/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">35. 信息学、监管、风控【未完成】</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_36/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">36. 机器学习【未完成】</span>  </a> </li> </ul>  </details> </li> </ul>  <div class="md:sl-hidden"> <div class="mobile-preferences sl-flex astro-vfur2aw5"> <div class="sl-flex social-icons astro-vfur2aw5"> <a href="https://github.com/withastro/starlight" rel="me" class="sl-flex astro-3daxh4jc"><span class="sr-only astro-3daxh4jc">GitHub</span><svg aria-hidden="true" class="astro-3daxh4jc astro-xrndq6a6" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M12 .3a12 12 0 0 0-3.8 23.38c.6.12.83-.26.83-.57L9 21.07c-3.34.72-4.04-1.61-4.04-1.61-.55-1.39-1.34-1.76-1.34-1.76-1.08-.74.09-.73.09-.73 1.2.09 1.83 1.24 1.83 1.24 1.08 1.83 2.81 1.3 3.5 1 .1-.78.42-1.31.76-1.61-2.67-.3-5.47-1.33-5.47-5.93 0-1.31.47-2.38 1.24-3.22-.14-.3-.54-1.52.1-3.18 0 0 1-.32 3.3 1.23a11.5 11.5 0 0 1 6 0c2.28-1.55 3.29-1.23 3.29-1.23.64 1.66.24 2.88.12 3.18a4.65 4.65 0 0 1 1.23 3.22c0 4.61-2.8 5.63-5.48 5.92.42.36.81 1.1.81 2.22l-.01 3.29c0 .31.2.69.82.57A12 12 0 0 0 12 .3Z"/></svg> </a> </div> <starlight-theme-select>  <label style="--sl-select-width: 6.25em" class="astro-kc6u4lxd"> <span class="sr-only astro-kc6u4lxd">Select theme</span> <svg aria-hidden="true" class="icon label-icon astro-kc6u4lxd astro-xrndq6a6" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M21 14h-1V7a3 3 0 0 0-3-3H7a3 3 0 0 0-3 3v7H3a1 1 0 0 0-1 1v2a3 3 0 0 0 3 3h14a3 3 0 0 0 3-3v-2a1 1 0 0 0-1-1ZM6 7a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v7H6V7Zm14 10a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1v-1h16v1Z"/></svg>  <select value="auto" class="astro-kc6u4lxd"> <option value="dark" class="astro-kc6u4lxd">Dark</option><option value="light" class="astro-kc6u4lxd">Light</option><option value="auto" selected="true" class="astro-kc6u4lxd">Auto</option> </select> <svg aria-hidden="true" class="icon caret astro-kc6u4lxd astro-xrndq6a6" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M17 9.17a1 1 0 0 0-1.41 0L12 12.71 8.46 9.17a1 1 0 1 0-1.41 1.42l4.24 4.24a1.002 1.002 0 0 0 1.42 0L17 10.59a1.002 1.002 0 0 0 0-1.42Z"/></svg>  </label>  </starlight-theme-select>  <script>
	StarlightThemeProvider.updatePickers();
</script>   </div>  </div> </div> </div> </nav> <div class="main-frame astro-yxqmbg7i">  <div class="lg:sl-flex astro-3vvvt7cz"> <aside class="right-sidebar-container astro-3vvvt7cz"> <div class="right-sidebar astro-3vvvt7cz"> <div class="lg:sl-hidden astro-f63w33c6"><mobile-starlight-toc data-min-h="2" data-max-h="3" class="astro-q2mrqdva"><nav aria-labelledby="starlight__on-this-page--mobile" class="astro-q2mrqdva"><details id="starlight__mobile-toc" class="astro-q2mrqdva"><summary id="starlight__on-this-page--mobile" class="sl-flex astro-q2mrqdva"><div class="toggle sl-flex astro-q2mrqdva">On this page<svg aria-hidden="true" class="caret astro-q2mrqdva astro-xrndq6a6" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg> </div><span class="display-current astro-q2mrqdva"></span></summary><div class="dropdown astro-q2mrqdva"><ul class="isMobile astro-acifyk5h" style="--depth: 0;"> <li class="astro-acifyk5h" style="--depth: 0;"> <a href="#_top" class="astro-acifyk5h" style="--depth: 0;"> <span class="astro-acifyk5h" style="--depth: 0;">Overview</span> </a>  </li><li class="astro-acifyk5h" style="--depth: 0;"> <a href="#131-条件编译" class="astro-acifyk5h" style="--depth: 0;"> <span class="astro-acifyk5h" style="--depth: 0;">13.1 条件编译</span> </a> <ul class="isMobile astro-acifyk5h" style="--depth: 1;"> <li class="astro-acifyk5h" style="--depth: 1;"> <a href="#1311-在特定操作系统执行不同代码" class="astro-acifyk5h" style="--depth: 1;"> <span class="astro-acifyk5h" style="--depth: 1;">13.1.1 在特定操作系统执行不同代码</span> </a>  </li><li class="astro-acifyk5h" style="--depth: 1;"> <a href="#1312-条件编译测试" class="astro-acifyk5h" style="--depth: 1;"> <span class="astro-acifyk5h" style="--depth: 1;">13.1.2 条件编译测试</span> </a>  </li> </ul>  </li><li class="astro-acifyk5h" style="--depth: 0;"> <a href="#132-禁用-lint" class="astro-acifyk5h" style="--depth: 0;"> <span class="astro-acifyk5h" style="--depth: 0;">13.2 禁用 lint</span> </a> <ul class="isMobile astro-acifyk5h" style="--depth: 1;"> <li class="astro-acifyk5h" style="--depth: 1;"> <a href="#1321-允许可变引用转变为不可变" class="astro-acifyk5h" style="--depth: 1;"> <span class="astro-acifyk5h" style="--depth: 1;">13.2.1 允许可变引用转变为不可变</span> </a>  </li><li class="astro-acifyk5h" style="--depth: 1;"> <a href="#1322-强制禁止未使用的self参数" class="astro-acifyk5h" style="--depth: 1;"> <span class="astro-acifyk5h" style="--depth: 1;">13.2.2 强制禁止未使用的self参数</span> </a>  </li><li class="astro-acifyk5h" style="--depth: 1;"> <a href="#1323-其他常见-可用属性" class="astro-acifyk5h" style="--depth: 1;"> <span class="astro-acifyk5h" style="--depth: 1;">13.2.3 其他常见 可用属性</span> </a>  </li><li class="astro-acifyk5h" style="--depth: 1;"> <a href="#补充学习不可达模式" class="astro-acifyk5h" style="--depth: 1;"> <span class="astro-acifyk5h" style="--depth: 1;">补充学习：不可达模式</span> </a>  </li> </ul>  </li><li class="astro-acifyk5h" style="--depth: 0;"> <a href="#133-启用编译器的特性" class="astro-acifyk5h" style="--depth: 0;"> <span class="astro-acifyk5h" style="--depth: 0;">13.3 启用编译器的特性</span> </a>  </li><li class="astro-acifyk5h" style="--depth: 0;"> <a href="#134-链接到一个非-rust-语言的库" class="astro-acifyk5h" style="--depth: 0;"> <span class="astro-acifyk5h" style="--depth: 0;">13.4 链接到一个非 Rust 语言的库</span> </a>  </li><li class="astro-acifyk5h" style="--depth: 0;"> <a href="#135-标记函数作为单元测试" class="astro-acifyk5h" style="--depth: 0;"> <span class="astro-acifyk5h" style="--depth: 0;">13.5 标记函数作为单元测试</span> </a>  </li><li class="astro-acifyk5h" style="--depth: 0;"> <a href="#136-标记函数作为基准测试的某个部分" class="astro-acifyk5h" style="--depth: 0;"> <span class="astro-acifyk5h" style="--depth: 0;">13.6 标记函数作为基准测试的某个部分</span> </a>  </li> </ul> </div></details></nav></mobile-starlight-toc></div><div class="right-sidebar-panel sl-hidden lg:sl-block astro-f63w33c6"><div class="sl-container astro-f63w33c6"><starlight-toc data-min-h="2" data-max-h="3"><nav aria-labelledby="starlight__on-this-page"><h2 id="starlight__on-this-page">On this page</h2><ul class="astro-acifyk5h" style="--depth: 0;"> <li class="astro-acifyk5h" style="--depth: 0;"> <a href="#_top" class="astro-acifyk5h" style="--depth: 0;"> <span class="astro-acifyk5h" style="--depth: 0;">Overview</span> </a>  </li><li class="astro-acifyk5h" style="--depth: 0;"> <a href="#131-条件编译" class="astro-acifyk5h" style="--depth: 0;"> <span class="astro-acifyk5h" style="--depth: 0;">13.1 条件编译</span> </a> <ul class="astro-acifyk5h" style="--depth: 1;"> <li class="astro-acifyk5h" style="--depth: 1;"> <a href="#1311-在特定操作系统执行不同代码" class="astro-acifyk5h" style="--depth: 1;"> <span class="astro-acifyk5h" style="--depth: 1;">13.1.1 在特定操作系统执行不同代码</span> </a>  </li><li class="astro-acifyk5h" style="--depth: 1;"> <a href="#1312-条件编译测试" class="astro-acifyk5h" style="--depth: 1;"> <span class="astro-acifyk5h" style="--depth: 1;">13.1.2 条件编译测试</span> </a>  </li> </ul>  </li><li class="astro-acifyk5h" style="--depth: 0;"> <a href="#132-禁用-lint" class="astro-acifyk5h" style="--depth: 0;"> <span class="astro-acifyk5h" style="--depth: 0;">13.2 禁用 lint</span> </a> <ul class="astro-acifyk5h" style="--depth: 1;"> <li class="astro-acifyk5h" style="--depth: 1;"> <a href="#1321-允许可变引用转变为不可变" class="astro-acifyk5h" style="--depth: 1;"> <span class="astro-acifyk5h" style="--depth: 1;">13.2.1 允许可变引用转变为不可变</span> </a>  </li><li class="astro-acifyk5h" style="--depth: 1;"> <a href="#1322-强制禁止未使用的self参数" class="astro-acifyk5h" style="--depth: 1;"> <span class="astro-acifyk5h" style="--depth: 1;">13.2.2 强制禁止未使用的self参数</span> </a>  </li><li class="astro-acifyk5h" style="--depth: 1;"> <a href="#1323-其他常见-可用属性" class="astro-acifyk5h" style="--depth: 1;"> <span class="astro-acifyk5h" style="--depth: 1;">13.2.3 其他常见 可用属性</span> </a>  </li><li class="astro-acifyk5h" style="--depth: 1;"> <a href="#补充学习不可达模式" class="astro-acifyk5h" style="--depth: 1;"> <span class="astro-acifyk5h" style="--depth: 1;">补充学习：不可达模式</span> </a>  </li> </ul>  </li><li class="astro-acifyk5h" style="--depth: 0;"> <a href="#133-启用编译器的特性" class="astro-acifyk5h" style="--depth: 0;"> <span class="astro-acifyk5h" style="--depth: 0;">13.3 启用编译器的特性</span> </a>  </li><li class="astro-acifyk5h" style="--depth: 0;"> <a href="#134-链接到一个非-rust-语言的库" class="astro-acifyk5h" style="--depth: 0;"> <span class="astro-acifyk5h" style="--depth: 0;">13.4 链接到一个非 Rust 语言的库</span> </a>  </li><li class="astro-acifyk5h" style="--depth: 0;"> <a href="#135-标记函数作为单元测试" class="astro-acifyk5h" style="--depth: 0;"> <span class="astro-acifyk5h" style="--depth: 0;">13.5 标记函数作为单元测试</span> </a>  </li><li class="astro-acifyk5h" style="--depth: 0;"> <a href="#136-标记函数作为基准测试的某个部分" class="astro-acifyk5h" style="--depth: 0;"> <span class="astro-acifyk5h" style="--depth: 0;">13.6 标记函数作为基准测试的某个部分</span> </a>  </li> </ul> </nav></starlight-toc></div></div> </div> </aside> <div class="main-pane astro-3vvvt7cz">  <main data-pagefind-body lang="en" dir="ltr" class="astro-fpze62lo">    <div class="content-panel astro-vo2eo5fg"> <div class="sl-container astro-vo2eo5fg"> <h1 id="_top" class="astro-daoses2n">属性(Attributes)</h1>  </div> </div>  <div class="content-panel astro-vo2eo5fg"> <div class="sl-container astro-vo2eo5fg"> <div class="sl-markdown-content"> <p><code dir="auto">属性(Attributes)</code> 在 Rust 中是一种特殊的语法，它们可以提供关于代码块、函数、结构体、枚举等元素的附加信息。Rust 编译器会使用这些信息来更好地理解、处理代码。</p>
<p>属性有两种主要形式：<strong>内部属性</strong>和外部属性。内部属性(Inner Attributes)用于设置 crate 级别的元数据，例如 crate 名称、版本和类型等。而外部属性(Outer Attributes)则应用于模块、函数、结构体等，用于设置编译条件、禁用 lint、启用编译器特性等。</p>
<p>之前我们已经反复接触过了属性应用的一个基本例子：</p>
<div class="expressive-code"><link rel="stylesheet" href="/_astro/ec.usa2f.css"><script type="module" src="/_astro/ec.sgewm.js"></script><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">#[derive(Debug)]</span></div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">struct</span><span style="--0:#D6DEEB;--1:#403F53"> Person {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C5E478;--1:#3C63B3">name</span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#D6DEEB;--1:#403F53"> String,</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C5E478;--1:#3C63B3">age</span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#D6DEEB;--1:#403F53"> u32,</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">}</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="#[derive(Debug)]struct Person {    name: String,    age: u32,}"><div></div></button></div></figure></div>
<p>在这个例子中，<code dir="auto">#[derive(Debug)]</code> 是一个属性，它告诉 Rust 编译器自动为 <code dir="auto">Person</code> 结构体实现 <code dir="auto">Debug</code> trait。这样我们就可以打印出该结构体的调试信息。</p>
<p>下面是几个常用属性的具体说明：</p>
<h2 id="131-条件编译">13.1 条件编译</h2>
<p><code dir="auto">#[cfg(...)]</code>。这个属性可以根据特定的编译条件来决定是否编译某段代码。</p>
<h3 id="1311-在特定操作系统执行不同代码">13.1.1 在特定操作系统执行不同代码</h3>
<p>你可能想在只有在特定操作系统上才编译某段代码：</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">#[cfg(target_os </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">linux</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">)]</span><span style="--0:#809191;--1:#5E6578">  //编译时会检查代码中的 #[cfg(target_os = "linux")] 属性</span></div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">fn</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">on_linux</span><span style="--0:#D6DEEB;--1:#403F53">() {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#82AAFF;--1:#3C63B3">println!</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">This code is compiled on Linux only.</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">}</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">#[cfg(target_os </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">windows</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">)]</span><span style="--0:#809191;--1:#5E6578">  //编译时会检查代码中的 #[cfg(target_os = "windows")] 属性</span></div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">fn</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">on_windows</span><span style="--0:#D6DEEB;--1:#403F53">() {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#82AAFF;--1:#3C63B3">println!</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">This code is compiled on Windows only.</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">}</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">fn</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">main</span><span style="--0:#D6DEEB;--1:#403F53">() {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#82AAFF;--1:#3C63B3">on_linux</span><span style="--0:#D6DEEB;--1:#403F53">();</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#82AAFF;--1:#3C63B3">on_windows</span><span style="--0:#D6DEEB;--1:#403F53">();</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">}</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="#[cfg(target_os = &#x22;linux&#x22;)]  //编译时会检查代码中的 #[cfg(target_os = &#x22;linux&#x22;)] 属性fn on_linux() {    println!(&#x22;This code is compiled on Linux only.&#x22;);}#[cfg(target_os = &#x22;windows&#x22;)]  //编译时会检查代码中的 #[cfg(target_os = &#x22;windows&#x22;)] 属性fn on_windows() {    println!(&#x22;This code is compiled on Windows only.&#x22;);}fn main() {    on_linux();    on_windows();}"><div></div></button></div></figure></div>
<p>在上面的示例中，<code dir="auto">on_linux</code>函数只在目标操作系统是Linux时被编译，而<code dir="auto">on_windows</code>函数只在目标操作系统是Windows时被编译。你可以根据需要在<code dir="auto">cfg</code>属性中使用不同的条件。</p>
<h3 id="1312-条件编译测试">13.1.2 条件编译测试</h3>
<p><code dir="auto">#[cfg(test)]</code> 通常属性用于条件编译，将测试代码限定在测试环境(<code dir="auto">cargo test</code>)中。</p>
<p>当你的 Rust 源代码中包含 <code dir="auto">#[cfg(test)]</code> 时，这些代码将仅在运行测试时编译和执行。**在正常构建时，这些代码会被排除在外。**所以一般用于编写测试相关的辅助函数或测试模拟。</p>
<p><strong>示例：</strong></p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#d6deeb;--1:#403f53">rustCopy code#[cfg(test)]</span></div><div class="ec-line"><span style="--0:#d6deeb;--1:#403f53">mod tests {</span></div><div class="ec-line"><span style="--0:#d6deeb;--1:#403f53">    // 此模块中的代码仅在测试时编译和执行</span></div><div class="ec-line"><span style="--0:#d6deeb;--1:#403f53">    #[test]</span></div><div class="ec-line"><span style="--0:#d6deeb;--1:#403f53">    fn test_addition() {</span></div><div class="ec-line"><span style="--0:#d6deeb;--1:#403f53">        assert_eq!(2 + 2, 4);</span></div><div class="ec-line"><span style="--0:#d6deeb;--1:#403f53">    }</span></div><div class="ec-line"><span style="--0:#d6deeb;--1:#403f53">}</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="rustCopy code#[cfg(test)]mod tests {    // 此模块中的代码仅在测试时编译和执行    #[test]    fn test_addition() {        assert_eq!(2 + 2, 4);    }}"><div></div></button></div></figure></div>
<h2 id="132-禁用-lint">13.2 禁用 lint</h2>
<p><code dir="auto">#[allow(...)]</code> 或 <code dir="auto">#[deny(...)]</code>。这些属性可以禁用或启用特定的编译器警告。例如，你可能会允许一个被认为是不安全的代码模式，因为你的团队和你本人都确定你的代码是安全的。</p>
<h3 id="1321-允许可变引用转变为不可变">13.2.1 允许可变引用转变为不可变</h3>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">#[allow(clippy</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#D6DEEB;--1:#403F53">mut_from_ref)]</span></div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">fn</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">main</span><span style="--0:#D6DEEB;--1:#403F53">() {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">x</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#097174">&#x26;</span><span style="--0:#C792EA;--1:#8D46B4">mut</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#F78C6C;--1:#AA0982">42</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">y</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#097174">&#x26;*</span><span style="--0:#C5E478;--1:#3C63B3">x</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#7FDBCA;--1:#097174">**</span><span style="--0:#C5E478;--1:#3C63B3">y</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">+=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#F78C6C;--1:#AA0982">1</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#82AAFF;--1:#3C63B3">println!</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">{}</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#C5E478;--1:#3C63B3">x</span><span style="--0:#D6DEEB;--1:#403F53">);</span><span style="--0:#809191;--1:#5E6578"> // 输出 43</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">}</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="#[allow(clippy::mut_from_ref)]fn main() {    let x = &#x26;mut 42;    let y = &#x26;*x;    **y += 1;    println!(&#x22;{}&#x22;, x); // 输出 43}"><div></div></button></div></figure></div>
<p>在这个示例中，<code dir="auto">#[allow(clippy::mut_from_ref)]</code>属性允许使用<code dir="auto">&#x26;mut</code>引用转换为<code dir="auto">&#x26;</code>引用的代码模式。如果没有该属性，编译器会发出警告，因为这种代码模式可能会导致意外的行为。但是在这个特定的例子中，你知道代码是安全的，因为你没有在任何地方对<code dir="auto">y</code>进行再次的借用。</p>
<h3 id="1322-强制禁止未使用的self参数">13.2.2 强制禁止未使用的<code dir="auto">self</code>参数</h3>
<p>另一方面，<code dir="auto">#[deny(...)]</code>属性可以用于禁止特定的警告。这可以用于在团队中强制执行一些编码规则或安全性标准。例如：</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">#[deny(clippy</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#D6DEEB;--1:#403F53">unused_self)]</span></div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">fn</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">main</span><span style="--0:#D6DEEB;--1:#403F53">() {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">struct</span><span style="--0:#D6DEEB;--1:#403F53"> Foo;</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">impl</span><span style="--0:#D6DEEB;--1:#403F53"> Foo {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        </span><span style="--0:#C792EA;--1:#8D46B4">fn</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">bar</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#7FDBCA;--1:#097174">&#x26;self</span><span style="--0:#D6DEEB;--1:#403F53">) {}</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    }</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    Foo</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">bar</span><span style="--0:#D6DEEB;--1:#403F53">();</span><span style="--0:#809191;--1:#5E6578"> // 这将引发一个编译错误，因为`self`参数未使用</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">}</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="#[deny(clippy::unused_self)]fn main() {    struct Foo;    impl Foo {        fn bar(&#x26;self) {}    }    Foo.bar(); // 这将引发一个编译错误，因为&#x60;self&#x60;参数未使用}"><div></div></button></div></figure></div>
<p>在这个示例中，<code dir="auto">#[deny(clippy::unused_self)]</code>属性禁止了未使用的<code dir="auto">self</code>参数的警告。这意味着，如果团队成员在他们的代码中没有正确地使用<code dir="auto">self</code>参数，他们将收到一个编译错误，而不是一个警告。这有助于确保团队遵循一致的编码实践，并减少潜在的错误或安全漏洞。</p>
<h3 id="1323-其他常见-可用属性">13.2.3 其他常见 可用属性</h3>
<p>下面是一些其他常见的<code dir="auto">allow</code>和<code dir="auto">deny</code>选项：</p>
<ol>
<li><code dir="auto">warnings</code>: 允许或禁止所有警告。
示例：<code dir="auto">#[allow(warnings)]</code> 或 <code dir="auto">#[deny(warnings)]</code></li>
<li><code dir="auto">unused_variables</code>: 允许或禁止未使用变量的警告。
示例：<code dir="auto">#[allow(unused_variables)]</code> 或 <code dir="auto">#[deny(unused_variables)]</code></li>
<li><code dir="auto">unused_mut</code>: 允许或禁止未使用可变变量的警告。
示例：<code dir="auto">#[allow(unused_mut)]</code> 或 <code dir="auto">#[deny(unused_mut)]</code></li>
<li><code dir="auto">unused_assignments</code>: 允许或禁止未使用赋值的警告。
示例：<code dir="auto">#[allow(unused_assignments)]</code> 或 <code dir="auto">#[deny(unused_assignments)]</code></li>
<li><code dir="auto">dead_code</code>: 允许或禁止死代码的警告。
示例：<code dir="auto">#[allow(dead_code)]</code> 或 <code dir="auto">#[deny(dead_code)]</code></li>
<li><code dir="auto">unreachable_patterns</code>: 允许或禁止不可达模式的警告。
示例：<code dir="auto">#[allow(unreachable_patterns)]</code> 或 <code dir="auto">#[deny(unreachable_patterns)]</code></li>
<li><code dir="auto">clippy::all</code>: 允许或禁止所有Clippy lints的警告。
示例：<code dir="auto">#[allow(clippy::all)]</code> 或 <code dir="auto">#[deny(clippy::all)]</code></li>
<li><code dir="auto">clippy::pedantic</code>: 允许或禁止所有Clippy lints的警告，包括一些可能误报的情况。
示例：<code dir="auto">#[allow(clippy::pedantic)]</code> 或 <code dir="auto">#[deny(clippy::pedantic)]</code></li>
</ol>
<p>这些选项只是其中的一部分，Rust编译器和Clippy工具还提供了其他许多lint选项。你可以根据需要选择适当的选项来配置编译器的警告处理行为。</p>
<h3 id="补充学习不可达模式">补充学习：不可达模式</h3>
<p>’unreachable’宏是用来指示编译器某段代码是不可达的。</p>
<p>当编译器无法确定某段代码是否不可达时，这很有用。例如，在模式匹配语句中，如果某个分支的条件永远不会满足，编译器就可能标记这个分支的代码为’unreachable’。</p>
<p>如果这段被标记为’unreachable’的代码实际上能被执行到，程序会立即panic并终止。此外，Rust还有一个对应的不安全函数’unreachable_unchecked’，即如果这段代码被执行到，会导致未定义行为。</p>
<p>假设我们正在编写一个程序来处理股票交易。在这个程序中，我们可能会遇到这样的情况：</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">fn</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">process_order</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#C5E478;--1:#3C63B3">order</span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#097174">&#x26;</span><span style="--0:#D6DEEB;--1:#403F53">Order) </span><span style="--0:#7FDBCA;--1:#097174">-></span><span style="--0:#D6DEEB;--1:#403F53"> Result&#x3C;(), Error> {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">match</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">order</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">get_type</span><span style="--0:#D6DEEB;--1:#403F53">() {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        OrderType</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#D6DEEB;--1:#403F53">Buy </span><span style="--0:#7FDBCA;--1:#097174">=></span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div><div class="ec-line"><span style="--0:#809191;--1:#5E6578">            // 执行购买逻辑...</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">            Ok(())</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        },</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        OrderType</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#D6DEEB;--1:#403F53">Sell </span><span style="--0:#7FDBCA;--1:#097174">=></span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div><div class="ec-line"><span style="--0:#809191;--1:#5E6578">            // 执行卖出逻辑...</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">            Ok(())</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        },</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        </span><span style="--0:#C5E478;--1:#3C63B3">_</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#097174">=></span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">unreachable!</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">Invalid order type</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">),</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    }</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">}</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="fn process_order(order: &#x26;Order) -> Result<(), Error> {    match order.get_type() {        OrderType::Buy => {            // 执行购买逻辑...            Ok(())        },        OrderType::Sell => {            // 执行卖出逻辑...            Ok(())        },        _ => unreachable!(&#x22;Invalid order type&#x22;),    }}"><div></div></button></div></figure></div>
<p>在这个例子中，我们假设订单类型只能是“买入”或“卖出”。如果有其他的订单类型，我们就用 <code dir="auto">unreachable!()</code> 宏来表示这种情况是不应该发生的。如果由于某种原因，我们的程序接收到了一个我们不知道的订单类型，程序就会立即 panic，这样我们就可以立即发现问题，而不是让程序继续执行并可能导致错误。</p>
<h2 id="133-启用编译器的特性">13.3 启用编译器的特性</h2>
<p>在 Rust 中，<code dir="auto">#[feature(...)]</code> 属性用于启用编译器的特定特性。以下是一个示例案例，展示了使用 <code dir="auto">#[feature(...)]</code> 属性启用全局导入(glob import)和宏(macros)的特性：</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">#![feature(glob_import, proc_macro_hygiene)]</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">use</span><span style="--0:#D6DEEB;--1:#403F53"> std</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#D6DEEB;--1:#403F53">collections</span><span style="--0:#7FDBCA;--1:#097174">::*</span><span style="--0:#D6DEEB;--1:#403F53">;</span><span style="--0:#809191;--1:#5E6578"> // 全局导入 std::collections 模块中的所有内容</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">#[macro_use]</span></div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">extern</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">crate</span><span style="--0:#D6DEEB;--1:#403F53"> my_macros;</span><span style="--0:#809191;--1:#5E6578"> // 启用宏特性，并导入外部宏库 my_macros</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">fn</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">main</span><span style="--0:#D6DEEB;--1:#403F53">() {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">mut</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">map</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> HashMap</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#82AAFF;--1:#3C63B3">new</span><span style="--0:#D6DEEB;--1:#403F53">();</span><span style="--0:#809191;--1:#5E6578"> // 使用全局导入的 HashMap 类型</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C5E478;--1:#3C63B3">map</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">insert</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">key</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">value</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#82AAFF;--1:#3C63B3">println!</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">{:?}</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#C5E478;--1:#3C63B3">map</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#82AAFF;--1:#3C63B3">my_macro!</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">Hello, world!</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">);</span><span style="--0:#809191;--1:#5E6578"> // 使用外部宏库 my_macros 中的宏 my_macro!</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">}</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="#![feature(glob_import, proc_macro_hygiene)]use std::collections::*; // 全局导入 std::collections 模块中的所有内容#[macro_use]extern crate my_macros; // 启用宏特性，并导入外部宏库 my_macrosfn main() {    let mut map = HashMap::new(); // 使用全局导入的 HashMap 类型    map.insert(&#x22;key&#x22;, &#x22;value&#x22;);    println!(&#x22;{:?}&#x22;, map);    my_macro!(&#x22;Hello, world!&#x22;); // 使用外部宏库 my_macros 中的宏 my_macro!}"><div></div></button></div></figure></div>
<p>在这个示例中，<code dir="auto">#![feature(glob_import, proc_macro_hygiene)]</code> 属性启用了全局导入和宏的特性。接下来，<code dir="auto">use std::collections::*;</code> 语句使用全局导入将 <code dir="auto">std::collections</code> 模块中的<strong>所有内容</strong>导入到当前作用域。然后，<code dir="auto">#[macro_use] extern crate my_macros;</code> 语句启用了宏特性，并导入了名为 <code dir="auto">my_macros</code> 的<strong>外部宏库</strong>。</p>
<p>在 <code dir="auto">main</code> 函数中，我们创建了一个 <code dir="auto">HashMap</code> 实例，并使用了全局导入的 <code dir="auto">HashMap</code> 类型。接下来，我们调用了 <code dir="auto">my_macro!("Hello, world!");</code> 宏，该宏在编译时会被扩展为相应的代码。</p>
<p>注意，使用 <code dir="auto">#[feature(...)]</code> 属性启用特性是编译器相关的，<strong>不同的 Rust 编译器版本可能支持不同的特性集合</strong>。在实际开发中，应该根据所使用的 Rust 版本和编译器特性来选择适当的特性。</p>
<h2 id="134-链接到一个非-rust-语言的库">13.4 链接到一个非 Rust 语言的库</h2>
<p><code dir="auto">#[link(...)]</code> 是 Rust 中用于告诉编译器如何链接到外部库的属性。它通常用于与非 Rust 语言编写的库进行交互。 <code dir="auto">#[link]</code> 属性通常<strong>不需要显式声明</strong>，而是通过在 Cargo.toml 文件中的 <code dir="auto">[dependencies]</code> 部分指定外部库的名称来完成链接。</p>
<p>假设你有一个C语言库，其中包含一个名为 <code dir="auto">my_c_library</code> 的函数，你想在Rust中使用这个函数。</p>
<ol>
<li>
<p>首先，确保你已经安装了Rust，并且你的Rust项目已经初始化。</p>
</li>
<li>
<p>创建一个新的Rust源代码文件，例如 <code dir="auto">main.rs</code>。</p>
</li>
<li>
<p>在Rust源代码文件中，使用 <code dir="auto">extern</code> 关键字声明外部C函数的原型，并使用 <code dir="auto">#[link]</code> 属性指定要链接的库的名称。示例如下：</p>
</li>
</ol>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">extern</span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div><div class="ec-line"><span style="--0:#809191;--1:#5E6578">    // 声明外部C函数的原型</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">fn</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">my_c_library_function</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#C5E478;--1:#3C63B3">arg1</span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#D6DEEB;--1:#403F53"> i32, </span><span style="--0:#C5E478;--1:#3C63B3">arg2</span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#D6DEEB;--1:#403F53"> i32) </span><span style="--0:#7FDBCA;--1:#097174">-></span><span style="--0:#D6DEEB;--1:#403F53"> i32;</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">}</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">fn</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">main</span><span style="--0:#D6DEEB;--1:#403F53">() {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">result</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">unsafe</span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div><div class="ec-line"><span style="--0:#809191;--1:#5E6578">        // 调用外部C函数</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        </span><span style="--0:#C5E478;--1:#3C63B3">result</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">my_c_library_function</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#F78C6C;--1:#AA0982">42</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#F78C6C;--1:#AA0982">23</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    }</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#82AAFF;--1:#3C63B3">println!</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">Result from C function: {}</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#C5E478;--1:#3C63B3">result</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">}</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="extern {    // 声明外部C函数的原型    fn my_c_library_function(arg1: i32, arg2: i32) -> i32;}fn main() {    let result;    unsafe {        // 调用外部C函数        result = my_c_library_function(42, 23);    }    println!(&#x22;Result from C function: {}&#x22;, result);}"><div></div></button></div></figure></div>
<ol start="4">
<li>编译你的Rust代码，同时链接到C语言库，可以使用 <code dir="auto">rustc</code> 命令，但更常见的是使用 <code dir="auto">Cargo</code> 构建工具。首先，确保你的项目的 <code dir="auto">Cargo.toml</code> 文件中包含以下内容：</li>
</ol>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">[dependencies]</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="[dependencies]"><div></div></button></div></figure></div>
<p>然后，运行以下命令：</p>
<div class="expressive-code"><figure class="frame is-terminal not-content"><figcaption class="header"><span class="title"></span><span class="sr-only">Terminal window</span></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#82AAFF;--1:#3C63B3">cargo</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">build</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="cargo build"><div></div></button></div></figure></div>
<p>Cargo 将会自动查找系统中是否存在 <code dir="auto">my_c_library</code>，如果找到的话，它将会链接到该库并编译你的Rust代码。</p>
<h2 id="135-标记函数作为单元测试">13.5 标记函数作为单元测试</h2>
<p><code dir="auto">#[test]</code>。这个属性可以标记一个函数作为单元测试函数，这样你就可以使用 Rust 的测试框架来运行这个测试。下面是一个简单的例子：</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">#[test]</span></div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">fn</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">test_addition</span><span style="--0:#D6DEEB;--1:#403F53">() {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#82AAFF;--1:#3C63B3">assert_eq!</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#F78C6C;--1:#AA0982">2</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#097174">+</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#F78C6C;--1:#AA0982">2</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#F78C6C;--1:#AA0982">4</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">}</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="#[test]fn test_addition() {    assert_eq!(2 + 2, 4);}"><div></div></button></div></figure></div>
<p>在这个例子中，<code dir="auto">#[test]</code> 属性被应用于 <code dir="auto">test_addition</code> 函数，表示它是一个单元测试。函数体中的 <code dir="auto">assert_eq!</code> 宏用于断言两个表达式是否相等。在这种情况下，它检查 <code dir="auto">2 + 2</code> 是否等于 <code dir="auto">4</code>。如果这个表达式返回 <code dir="auto">true</code>，那么测试就会通过。如果返回 <code dir="auto">false</code>，测试就会失败，并输出相应的错误信息。</p>
<p>你可以在测试函数中使用其他宏和函数来编写更复杂的测试逻辑。例如，你可以使用 <code dir="auto">assert!</code> 宏来断言一个表达式是否为真，或者使用 <code dir="auto">assert_ne!</code> 宏来断言两个表达式是否不相等。</p>
<p><strong>注意</strong>，#[test]和#[cfg(test)]是有区别的：</p>


















































<table><thead><tr><th>特性</th><th><code dir="auto">#[test]</code></th><th><code dir="auto">#[cfg(test)]</code></th></tr></thead><tbody><tr><td>用途</td><td>用于标记单元测试函数</td><td>用于条件编译测试相关的代码</td></tr><tr><td>所属上下文</td><td>函数级别的属性</td><td>代码块级别的属性</td></tr><tr><td>执行时机</td><td>在测试运行时执行</td><td>仅在运行测试时编译和执行</td></tr><tr><td>典型用法</td><td>编写和运行测试用例</td><td>包含测试辅助函数或模拟的代码</td></tr><tr><td>示例</td><td><code dir="auto">rust fn test_function() {...}</code></td><td><code dir="auto">rust #[cfg(test)] mod tests { ... }</code></td></tr><tr><td>测试运行方式</td><td>在测试模块中执行，通常由测试运行器管理</td><td>在测试环境中运行，正常构建时排除</td></tr><tr><td>是否需要断言宏</td><td>通常需要使用断言宏(例如 <code dir="auto">assert_eq!</code>)进行测试</td><td>不一定需要，可以用于编写测试辅助函数</td></tr><tr><td>用于组织测试代码</td><td>直接包含在测试函数内部</td><td>通常包含在模块中</td></tr></tbody></table>
<p>但是这两个属性通常一起使用，<code dir="auto">#[cfg(test)]</code> 用于包装测试辅助代码和模拟，而 <code dir="auto">#[test]</code> 用于标记要运行的测试用例函数。在19章我们还会详细叙述测试的应用。</p>
<h2 id="136-标记函数作为基准测试的某个部分">13.6 标记函数作为基准测试的某个部分</h2>
<p>使用 Rust 编写基准测试时，可以使用 <code dir="auto">#[bench]</code> 属性来标记一个函数作为基准测试函数。下面是一个简单的例子，展示了如何使用 <code dir="auto">#[bench]</code> 属性和 Rust 的基准测试框架来测试一个函数的性能。</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">use</span><span style="--0:#D6DEEB;--1:#403F53"> test</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#D6DEEB;--1:#403F53">Bencher;</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">#[bench]</span></div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">fn</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">bench_addition</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#C5E478;--1:#3C63B3">b</span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#097174">&#x26;</span><span style="--0:#C792EA;--1:#8D46B4">mut</span><span style="--0:#D6DEEB;--1:#403F53"> Bencher) {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C5E478;--1:#3C63B3">b</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">iter</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#C792EA;--1:#8D46B4">||</span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">sum</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#F78C6C;--1:#AA0982">2</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#097174">+</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#F78C6C;--1:#AA0982">2</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        </span><span style="--0:#82AAFF;--1:#3C63B3">assert_eq!</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#C5E478;--1:#3C63B3">sum</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#F78C6C;--1:#AA0982">4</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    });</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">}</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="use test::Bencher;#[bench]fn bench_addition(b: &#x26;mut Bencher) {    b.iter(|| {        let sum = 2 + 2;        assert_eq!(sum, 4);    });}"><div></div></button></div></figure></div>
<p>在这个例子中，我们定义了一个名为 <code dir="auto">bench_addition</code> 的函数，并使用 <code dir="auto">#[bench]</code> 属性进行标记。函数接受一个 <code dir="auto">&#x26;mut Bencher</code> 类型的参数 <code dir="auto">b</code>，它提供了用于运行基准测试的方法。</p>
<p>在函数体中，我们使用 <code dir="auto">b.iter</code> 方法来指定要重复运行的测试代码块。这里使用了一个闭包 <code dir="auto">|| { ... }</code> 来定义要运行的代码。在这个例子中，我们简单地将 <code dir="auto">2 + 2</code> 的结果存储在 <code dir="auto">sum</code> 变量中，并使用 <code dir="auto">assert_eq!</code> 宏来断言 <code dir="auto">sum</code> 是否等于 <code dir="auto">4</code>。</p>
<p>要运行这个基准测试，可以在终端中使用 <code dir="auto">cargo bench</code> 命令。Rust 的基准测试框架会自动识别并使用 <code dir="auto">#[bench]</code> 属性标记的函数，并运行它们以测量性能。</p> </div> <footer class="astro-w7wtsaw6"> <div class="meta sl-flex astro-w7wtsaw6">   </div> <div class="pagination-links astro-qnftudm7" dir="ltr"> <a href="/chapters/chapter_12/" rel="prev" class="astro-qnftudm7"> <svg aria-hidden="true" class="astro-qnftudm7 astro-xrndq6a6" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.5rem;"><path d="M17 11H9.41l3.3-3.29a1.004 1.004 0 1 0-1.42-1.42l-5 5a1 1 0 0 0-.21.33 1 1 0 0 0 0 .76 1 1 0 0 0 .21.33l5 5a1.002 1.002 0 0 0 1.639-.325 1 1 0 0 0-.219-1.095L9.41 13H17a1 1 0 0 0 0-2Z"/></svg>  <span class="astro-qnftudm7"> Previous <br class="astro-qnftudm7"> <span class="link-title astro-qnftudm7">12. Cargo 的进阶使用</span> </span> </a> <a href="/chapters/chapter_14/" rel="next" class="astro-qnftudm7"> <svg aria-hidden="true" class="astro-qnftudm7 astro-xrndq6a6" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.5rem;"><path d="M17.92 11.62a1.001 1.001 0 0 0-.21-.33l-5-5a1.003 1.003 0 1 0-1.42 1.42l3.3 3.29H7a1 1 0 0 0 0 2h7.59l-3.3 3.29a1.002 1.002 0 0 0 .325 1.639 1 1 0 0 0 1.095-.219l5-5a1 1 0 0 0 .21-.33 1 1 0 0 0 0-.76Z"/></svg>  <span class="astro-qnftudm7"> Next <br class="astro-qnftudm7"> <span class="link-title astro-qnftudm7">14. 泛型进阶(Advanced Generic Type Usage)</span> </span> </a> </div>  </footer>  </div> </div>   </main> </div> </div>  </div> </div>  </body></html>