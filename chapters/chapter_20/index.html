<!DOCTYPE html><html lang="en" dir="ltr" data-has-toc data-has-sidebar class="astro-fpze62lo"> <head><meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><title>Redis、爬虫、交易日库 | Cookbook for Rustaceans in Finance / Rust 量化金融开发指南</title><link rel="canonical"/><link rel="shortcut icon" href="/favicon.svg" type="image/svg+xml"/><meta name="generator" content="Astro v4.3.3"/><meta name="generator" content="Starlight v0.17.3"/><meta property="og:title" content="Redis、爬虫、交易日库"/><meta property="og:type" content="article"/><meta property="og:url"/><meta property="og:locale" content="en"/><meta property="og:description"/><meta property="og:site_name" content="Cookbook for Rustaceans in Finance / Rust 量化金融开发指南"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:title" content="Redis、爬虫、交易日库"/><meta name="twitter:description"/><script>
	window.StarlightThemeProvider = (() => {
		const storedTheme =
			typeof localStorage !== 'undefined' && localStorage.getItem('starlight-theme');
		const theme =
			storedTheme ||
			(window.matchMedia('(prefers-color-scheme: light)').matches ? 'light' : 'dark');
		document.documentElement.dataset.theme = theme === 'light' ? 'light' : 'dark';
		return {
			updatePickers(theme = storedTheme || 'auto') {
				document.querySelectorAll('starlight-theme-select').forEach((picker) => {
					const select = picker.querySelector('select');
					if (select) select.value = theme;
					/** @type {HTMLTemplateElement | null} */
					const tmpl = document.querySelector(`#theme-icons`);
					const newIcon = tmpl && tmpl.content.querySelector('.' + theme);
					if (newIcon) {
						const oldIcon = picker.querySelector('svg.label-icon');
						if (oldIcon) {
							oldIcon.replaceChildren(...newIcon.cloneNode(true).childNodes);
						}
					}
				});
			},
		};
	})();
</script><template id="theme-icons"><svg aria-hidden="true" class="light astro-xrndq6a6" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M5 12a1 1 0 0 0-1-1H3a1 1 0 0 0 0 2h1a1 1 0 0 0 1-1Zm.64 5-.71.71a1 1 0 0 0 0 1.41 1 1 0 0 0 1.41 0l.71-.71A1 1 0 0 0 5.64 17ZM12 5a1 1 0 0 0 1-1V3a1 1 0 0 0-2 0v1a1 1 0 0 0 1 1Zm5.66 2.34a1 1 0 0 0 .7-.29l.71-.71a1 1 0 1 0-1.41-1.41l-.66.71a1 1 0 0 0 0 1.41 1 1 0 0 0 .66.29Zm-12-.29a1 1 0 0 0 1.41 0 1 1 0 0 0 0-1.41l-.71-.71a1.004 1.004 0 1 0-1.43 1.41l.73.71ZM21 11h-1a1 1 0 0 0 0 2h1a1 1 0 0 0 0-2Zm-2.64 6A1 1 0 0 0 17 18.36l.71.71a1 1 0 0 0 1.41 0 1 1 0 0 0 0-1.41l-.76-.66ZM12 6.5a5.5 5.5 0 1 0 5.5 5.5A5.51 5.51 0 0 0 12 6.5Zm0 9a3.5 3.5 0 1 1 0-7 3.5 3.5 0 0 1 0 7Zm0 3.5a1 1 0 0 0-1 1v1a1 1 0 0 0 2 0v-1a1 1 0 0 0-1-1Z"/></svg> <svg aria-hidden="true" class="dark astro-xrndq6a6" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M21.64 13a1 1 0 0 0-1.05-.14 8.049 8.049 0 0 1-3.37.73 8.15 8.15 0 0 1-8.14-8.1 8.59 8.59 0 0 1 .25-2A1 1 0 0 0 8 2.36a10.14 10.14 0 1 0 14 11.69 1 1 0 0 0-.36-1.05Zm-9.5 6.69A8.14 8.14 0 0 1 7.08 5.22v.27a10.15 10.15 0 0 0 10.14 10.14 9.784 9.784 0 0 0 2.1-.22 8.11 8.11 0 0 1-7.18 4.32v-.04Z"/></svg> <svg aria-hidden="true" class="auto astro-xrndq6a6" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M21 14h-1V7a3 3 0 0 0-3-3H7a3 3 0 0 0-3 3v7H3a1 1 0 0 0-1 1v2a3 3 0 0 0 3 3h14a3 3 0 0 0 3-3v-2a1 1 0 0 0-1-1ZM6 7a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v7H6V7Zm14 10a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1v-1h16v1Z"/></svg> </template><link rel="stylesheet" href="/_astro/index.4lckRRHb.css" /><script type="module" src="/_astro/hoisted.RLbdawI7.js"></script>
<script type="module" src="/_astro/page.X_0NJa-z.js"></script></head> <body class="astro-fpze62lo"> <a href="#_top" class="astro-byjsuuaw">Skip to content</a>  <div class="page sl-flex astro-yxqmbg7i"> <header class="header astro-yxqmbg7i"><div class="header sl-flex astro-cyrhhlnw"> <div class="title-wrapper sl-flex astro-cyrhhlnw"> <a href="/" class="site-title sl-flex astro-ylanx5mn">  <span class="astro-ylanx5mn"> Cookbook for Rustaceans in Finance / Rust 量化金融开发指南 </span> </a>  </div> <div class="sl-flex astro-cyrhhlnw"> <site-search data-translations="{&#34;placeholder&#34;:&#34;Search&#34;}" class="astro-usz5hgcn"> <button data-open-modal disabled class="astro-usz5hgcn">  <svg aria-label="Search" class="astro-usz5hgcn astro-xrndq6a6" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M21.71 20.29 18 16.61A9 9 0 1 0 16.61 18l3.68 3.68a.999.999 0 0 0 1.42 0 1 1 0 0 0 0-1.39ZM11 18a7 7 0 1 1 0-14 7 7 0 0 1 0 14Z"/></svg>  <span class="sl-hidden md:sl-block astro-usz5hgcn" aria-hidden="true">Search</span> <svg aria-label="(Press / to Search)" class="sl-hidden md:sl-block astro-usz5hgcn astro-xrndq6a6" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M17 2H7a5 5 0 0 0-5 5v10a5 5 0 0 0 5 5h10a5 5 0 0 0 5-5V7a5 5 0 0 0-5-5Zm3 15a3 3 0 0 1-3 3H7a3 3 0 0 1-3-3V7a3 3 0 0 1 3-3h10a3 3 0 0 1 3 3v10Z"/><path d="M15.293 6.707a1 1 0 1 1 1.414 1.414l-8.485 8.486a1 1 0 0 1-1.414-1.415l8.485-8.485Z"/></svg>  </button> <dialog style="padding:0" aria-label="Search" class="astro-usz5hgcn"> <div class="dialog-frame sl-flex astro-usz5hgcn">  <button data-close-modal class="sl-flex md:sl-hidden astro-usz5hgcn"> Cancel </button> <div class="search-container astro-usz5hgcn"> <div id="starlight__search" class="astro-usz5hgcn"></div> </div> </div> </dialog> </site-search>    </div> <div class="sl-hidden md:sl-flex right-group astro-cyrhhlnw"> <div class="sl-flex social-icons astro-cyrhhlnw"> <a href="https://github.com/withastro/starlight" rel="me" class="sl-flex astro-3daxh4jc"><span class="sr-only astro-3daxh4jc">GitHub</span><svg aria-hidden="true" class="astro-3daxh4jc astro-xrndq6a6" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M12 .3a12 12 0 0 0-3.8 23.38c.6.12.83-.26.83-.57L9 21.07c-3.34.72-4.04-1.61-4.04-1.61-.55-1.39-1.34-1.76-1.34-1.76-1.08-.74.09-.73.09-.73 1.2.09 1.83 1.24 1.83 1.24 1.08 1.83 2.81 1.3 3.5 1 .1-.78.42-1.31.76-1.61-2.67-.3-5.47-1.33-5.47-5.93 0-1.31.47-2.38 1.24-3.22-.14-.3-.54-1.52.1-3.18 0 0 1-.32 3.3 1.23a11.5 11.5 0 0 1 6 0c2.28-1.55 3.29-1.23 3.29-1.23.64 1.66.24 2.88.12 3.18a4.65 4.65 0 0 1 1.23 3.22c0 4.61-2.8 5.63-5.48 5.92.42.36.81 1.1.81 2.22l-.01 3.29c0 .31.2.69.82.57A12 12 0 0 0 12 .3Z"/></svg> </a> </div> <starlight-theme-select>  <label style="--sl-select-width: 6.25em" class="astro-kc6u4lxd"> <span class="sr-only astro-kc6u4lxd">Select theme</span> <svg aria-hidden="true" class="icon label-icon astro-kc6u4lxd astro-xrndq6a6" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M21 14h-1V7a3 3 0 0 0-3-3H7a3 3 0 0 0-3 3v7H3a1 1 0 0 0-1 1v2a3 3 0 0 0 3 3h14a3 3 0 0 0 3-3v-2a1 1 0 0 0-1-1ZM6 7a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v7H6V7Zm14 10a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1v-1h16v1Z"/></svg>  <select value="auto" class="astro-kc6u4lxd"> <option value="dark" class="astro-kc6u4lxd">Dark</option><option value="light" class="astro-kc6u4lxd">Light</option><option value="auto" selected="true" class="astro-kc6u4lxd">Auto</option> </select> <svg aria-hidden="true" class="icon caret astro-kc6u4lxd astro-xrndq6a6" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M17 9.17a1 1 0 0 0-1.41 0L12 12.71 8.46 9.17a1 1 0 1 0-1.41 1.42l4.24 4.24a1.002 1.002 0 0 0 1.42 0L17 10.59a1.002 1.002 0 0 0 0-1.42Z"/></svg>  </label>  </starlight-theme-select>  <script>
	StarlightThemeProvider.updatePickers();
</script>   </div> </div> </header> <nav class="sidebar astro-yxqmbg7i" aria-label="Main"> <starlight-menu-button class="astro-eouth4v3"> <button aria-expanded="false" aria-label="Menu" aria-controls="starlight__sidebar" class="sl-flex md:sl-hidden astro-eouth4v3"> <svg aria-hidden="true" class="astro-eouth4v3 astro-xrndq6a6" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M3 8h18a1 1 0 1 0 0-2H3a1 1 0 0 0 0 2Zm18 8H3a1 1 0 0 0 0 2h18a1 1 0 0 0 0-2Zm0-5H3a1 1 0 0 0 0 2h18a1 1 0 0 0 0-2Z"/></svg>  </button> </starlight-menu-button>    <div id="starlight__sidebar" class="sidebar-pane astro-yxqmbg7i"> <div class="sidebar-content sl-flex astro-yxqmbg7i"> <ul class="top-level astro-4mcqxzkb"> <li class="astro-4mcqxzkb"> <details open class="astro-4mcqxzkb"> <summary class="astro-4mcqxzkb"> <div class="group-label astro-4mcqxzkb"> <span class="large astro-4mcqxzkb">PART I 基础部分 - 量化语境下的Rust编程基础</span>  </div> <svg aria-hidden="true" class="caret astro-4mcqxzkb astro-xrndq6a6" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.25rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg>  </summary> <ul class="astro-4mcqxzkb"> <li class="astro-4mcqxzkb"> <a href="/chapters/chapter_1" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">1. Rust 语言入门101</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_2/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">2. 格式化输出</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_3/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">3. 原生类型</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_4/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">4. 自定义类型 Struct &amp; Enum</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_5/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">5. 标准库类型</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_6/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">6. 变量和作用域</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_7/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">7. 类型系统</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_8/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">8. 类型转换</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_9/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">9. 流程控制</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_10/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">10. 函数、方法和闭包</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_11/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">11. 模块</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_12/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">12. Cargo 的进阶使用</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_13/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">13. 属性(Attributes)</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_14/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">14. 泛型进阶(Advanced Generic Type Usage)</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_15/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">15. 作用域规则和生命周期</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_16/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">16. 错误处理进阶(Advanced Error handling)</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_17/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">17. 特性(trait)详解</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_18/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">18. 创建自定义宏</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_19/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">19. 时间处理</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_20/" aria-current="page" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">20. Redis、爬虫、交易日库</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_21/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">21. 线程和管道</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_22/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">22. 文件处理</span>  </a> </li> </ul>  </details> </li><li class="astro-4mcqxzkb"> <details open class="astro-4mcqxzkb"> <summary class="astro-4mcqxzkb"> <div class="group-label astro-4mcqxzkb"> <span class="large astro-4mcqxzkb">PART II 进阶部分 - 量化实战</span>  </div> <svg aria-hidden="true" class="caret astro-4mcqxzkb astro-xrndq6a6" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.25rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg>  </summary> <ul class="astro-4mcqxzkb"> <li class="astro-4mcqxzkb"> <a href="/chapters/chapter_23/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">23. Polars 入门</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_24/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">24. 时序数据库 Clickhouse</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_25/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">25. Unsafe【未完成】</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_26/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">26. 文档和测试【未完成】</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_27/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">27. 常见技术指标及其实现【本章代码未添加】</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_28/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">28. 统计模型【未完成】</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_29/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">29. 引擎系统【未完成】</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_30/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">30. 日志系统【未完成】</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_31/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">31. 投资组合管理【未完成】</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_32/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">32. 量化计量经济学【未完成】</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_33/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">33. 限价指令簿【未完成】</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_34/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">34. 最优配置和执行【未完成】</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_35/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">35. 信息学、监管、风控【未完成】</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_36/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">36. 机器学习【未完成】</span>  </a> </li> </ul>  </details> </li> </ul>  <div class="md:sl-hidden"> <div class="mobile-preferences sl-flex astro-vfur2aw5"> <div class="sl-flex social-icons astro-vfur2aw5"> <a href="https://github.com/withastro/starlight" rel="me" class="sl-flex astro-3daxh4jc"><span class="sr-only astro-3daxh4jc">GitHub</span><svg aria-hidden="true" class="astro-3daxh4jc astro-xrndq6a6" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M12 .3a12 12 0 0 0-3.8 23.38c.6.12.83-.26.83-.57L9 21.07c-3.34.72-4.04-1.61-4.04-1.61-.55-1.39-1.34-1.76-1.34-1.76-1.08-.74.09-.73.09-.73 1.2.09 1.83 1.24 1.83 1.24 1.08 1.83 2.81 1.3 3.5 1 .1-.78.42-1.31.76-1.61-2.67-.3-5.47-1.33-5.47-5.93 0-1.31.47-2.38 1.24-3.22-.14-.3-.54-1.52.1-3.18 0 0 1-.32 3.3 1.23a11.5 11.5 0 0 1 6 0c2.28-1.55 3.29-1.23 3.29-1.23.64 1.66.24 2.88.12 3.18a4.65 4.65 0 0 1 1.23 3.22c0 4.61-2.8 5.63-5.48 5.92.42.36.81 1.1.81 2.22l-.01 3.29c0 .31.2.69.82.57A12 12 0 0 0 12 .3Z"/></svg> </a> </div> <starlight-theme-select>  <label style="--sl-select-width: 6.25em" class="astro-kc6u4lxd"> <span class="sr-only astro-kc6u4lxd">Select theme</span> <svg aria-hidden="true" class="icon label-icon astro-kc6u4lxd astro-xrndq6a6" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M21 14h-1V7a3 3 0 0 0-3-3H7a3 3 0 0 0-3 3v7H3a1 1 0 0 0-1 1v2a3 3 0 0 0 3 3h14a3 3 0 0 0 3-3v-2a1 1 0 0 0-1-1ZM6 7a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v7H6V7Zm14 10a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1v-1h16v1Z"/></svg>  <select value="auto" class="astro-kc6u4lxd"> <option value="dark" class="astro-kc6u4lxd">Dark</option><option value="light" class="astro-kc6u4lxd">Light</option><option value="auto" selected="true" class="astro-kc6u4lxd">Auto</option> </select> <svg aria-hidden="true" class="icon caret astro-kc6u4lxd astro-xrndq6a6" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M17 9.17a1 1 0 0 0-1.41 0L12 12.71 8.46 9.17a1 1 0 1 0-1.41 1.42l4.24 4.24a1.002 1.002 0 0 0 1.42 0L17 10.59a1.002 1.002 0 0 0 0-1.42Z"/></svg>  </label>  </starlight-theme-select>  <script>
	StarlightThemeProvider.updatePickers();
</script>   </div>  </div> </div> </div> </nav> <div class="main-frame astro-yxqmbg7i">  <div class="lg:sl-flex astro-3vvvt7cz"> <aside class="right-sidebar-container astro-3vvvt7cz"> <div class="right-sidebar astro-3vvvt7cz"> <div class="lg:sl-hidden astro-f63w33c6"><mobile-starlight-toc data-min-h="2" data-max-h="3" class="astro-q2mrqdva"><nav aria-labelledby="starlight__on-this-page--mobile" class="astro-q2mrqdva"><details id="starlight__mobile-toc" class="astro-q2mrqdva"><summary id="starlight__on-this-page--mobile" class="sl-flex astro-q2mrqdva"><div class="toggle sl-flex astro-q2mrqdva">On this page<svg aria-hidden="true" class="caret astro-q2mrqdva astro-xrndq6a6" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg> </div><span class="display-current astro-q2mrqdva"></span></summary><div class="dropdown astro-q2mrqdva"><ul class="isMobile astro-acifyk5h" style="--depth: 0;"> <li class="astro-acifyk5h" style="--depth: 0;"> <a href="#_top" class="astro-acifyk5h" style="--depth: 0;"> <span class="astro-acifyk5h" style="--depth: 0;">Overview</span> </a>  </li><li class="astro-acifyk5h" style="--depth: 0;"> <a href="#201-redis入门安装和配置" class="astro-acifyk5h" style="--depth: 0;"> <span class="astro-acifyk5h" style="--depth: 0;">20.1 Redis入门、安装和配置</span> </a> <ul class="isMobile astro-acifyk5h" style="--depth: 1;"> <li class="astro-acifyk5h" style="--depth: 1;"> <a href="#在ubuntudebian上安装" class="astro-acifyk5h" style="--depth: 1;"> <span class="astro-acifyk5h" style="--depth: 1;">在Ubuntu/Debian上安装</span> </a>  </li><li class="astro-acifyk5h" style="--depth: 1;"> <a href="#在-manjaroarchlinux-上安装" class="astro-acifyk5h" style="--depth: 1;"> <span class="astro-acifyk5h" style="--depth: 1;">在 Manjaro/Archlinux 上安装</span> </a>  </li><li class="astro-acifyk5h" style="--depth: 1;"> <a href="#用户界面" class="astro-acifyk5h" style="--depth: 1;"> <span class="astro-acifyk5h" style="--depth: 1;">用户界面</span> </a>  </li> </ul>  </li><li class="astro-acifyk5h" style="--depth: 0;"> <a href="#202-常见redis数据结构类型" class="astro-acifyk5h" style="--depth: 0;"> <span class="astro-acifyk5h" style="--depth: 0;">20.2 常见Redis数据结构类型</span> </a> <ul class="isMobile astro-acifyk5h" style="--depth: 1;"> <li class="astro-acifyk5h" style="--depth: 1;"> <a href="#字符串strings" class="astro-acifyk5h" style="--depth: 1;"> <span class="astro-acifyk5h" style="--depth: 1;">字符串（Strings）</span> </a>  </li> </ul>  </li><li class="astro-acifyk5h" style="--depth: 0;"> <a href="#203-在rust中使用redis客户端" class="astro-acifyk5h" style="--depth: 0;"> <span class="astro-acifyk5h" style="--depth: 0;">20.3 在Rust中使用Redis客户端</span> </a>  </li><li class="astro-acifyk5h" style="--depth: 0;"> <a href="#204-爬虫" class="astro-acifyk5h" style="--depth: 0;"> <span class="astro-acifyk5h" style="--depth: 0;">20.4 爬虫</span> </a> <ul class="isMobile astro-acifyk5h" style="--depth: 1;"> <li class="astro-acifyk5h" style="--depth: 1;"> <a href="#2041-爬虫的基本原理" class="astro-acifyk5h" style="--depth: 1;"> <span class="astro-acifyk5h" style="--depth: 1;">20.4.1 爬虫的基本原理</span> </a>  </li><li class="astro-acifyk5h" style="--depth: 1;"> <a href="#2042-rust-用于爬虫的优势" class="astro-acifyk5h" style="--depth: 1;"> <span class="astro-acifyk5h" style="--depth: 1;">20.4.2. Rust 用于爬虫的优势</span> </a>  </li><li class="astro-acifyk5h" style="--depth: 1;"> <a href="#2043-rust-中用于爬虫的库和工具" class="astro-acifyk5h" style="--depth: 1;"> <span class="astro-acifyk5h" style="--depth: 1;">20.4.3. Rust 中用于爬虫的库和工具</span> </a>  </li><li class="astro-acifyk5h" style="--depth: 1;"> <a href="#2044-爬虫的伦理和法律考虑" class="astro-acifyk5h" style="--depth: 1;"> <span class="astro-acifyk5h" style="--depth: 1;">20.4.4. 爬虫的伦理和法律考虑</span> </a>  </li><li class="astro-acifyk5h" style="--depth: 1;"> <a href="#补充学习序列化和反序列化" class="astro-acifyk5h" style="--depth: 1;"> <span class="astro-acifyk5h" style="--depth: 1;">补充学习：序列化和反序列化</span> </a>  </li><li class="astro-acifyk5h" style="--depth: 1;"> <a href="#案例在redis中构建中国大陆交易日库" class="astro-acifyk5h" style="--depth: 1;"> <span class="astro-acifyk5h" style="--depth: 1;">案例：在Redis中构建中国大陆交易日库</span> </a>  </li> </ul>  </li> </ul> </div></details></nav></mobile-starlight-toc></div><div class="right-sidebar-panel sl-hidden lg:sl-block astro-f63w33c6"><div class="sl-container astro-f63w33c6"><starlight-toc data-min-h="2" data-max-h="3"><nav aria-labelledby="starlight__on-this-page"><h2 id="starlight__on-this-page">On this page</h2><ul class="astro-acifyk5h" style="--depth: 0;"> <li class="astro-acifyk5h" style="--depth: 0;"> <a href="#_top" class="astro-acifyk5h" style="--depth: 0;"> <span class="astro-acifyk5h" style="--depth: 0;">Overview</span> </a>  </li><li class="astro-acifyk5h" style="--depth: 0;"> <a href="#201-redis入门安装和配置" class="astro-acifyk5h" style="--depth: 0;"> <span class="astro-acifyk5h" style="--depth: 0;">20.1 Redis入门、安装和配置</span> </a> <ul class="astro-acifyk5h" style="--depth: 1;"> <li class="astro-acifyk5h" style="--depth: 1;"> <a href="#在ubuntudebian上安装" class="astro-acifyk5h" style="--depth: 1;"> <span class="astro-acifyk5h" style="--depth: 1;">在Ubuntu/Debian上安装</span> </a>  </li><li class="astro-acifyk5h" style="--depth: 1;"> <a href="#在-manjaroarchlinux-上安装" class="astro-acifyk5h" style="--depth: 1;"> <span class="astro-acifyk5h" style="--depth: 1;">在 Manjaro/Archlinux 上安装</span> </a>  </li><li class="astro-acifyk5h" style="--depth: 1;"> <a href="#用户界面" class="astro-acifyk5h" style="--depth: 1;"> <span class="astro-acifyk5h" style="--depth: 1;">用户界面</span> </a>  </li> </ul>  </li><li class="astro-acifyk5h" style="--depth: 0;"> <a href="#202-常见redis数据结构类型" class="astro-acifyk5h" style="--depth: 0;"> <span class="astro-acifyk5h" style="--depth: 0;">20.2 常见Redis数据结构类型</span> </a> <ul class="astro-acifyk5h" style="--depth: 1;"> <li class="astro-acifyk5h" style="--depth: 1;"> <a href="#字符串strings" class="astro-acifyk5h" style="--depth: 1;"> <span class="astro-acifyk5h" style="--depth: 1;">字符串（Strings）</span> </a>  </li> </ul>  </li><li class="astro-acifyk5h" style="--depth: 0;"> <a href="#203-在rust中使用redis客户端" class="astro-acifyk5h" style="--depth: 0;"> <span class="astro-acifyk5h" style="--depth: 0;">20.3 在Rust中使用Redis客户端</span> </a>  </li><li class="astro-acifyk5h" style="--depth: 0;"> <a href="#204-爬虫" class="astro-acifyk5h" style="--depth: 0;"> <span class="astro-acifyk5h" style="--depth: 0;">20.4 爬虫</span> </a> <ul class="astro-acifyk5h" style="--depth: 1;"> <li class="astro-acifyk5h" style="--depth: 1;"> <a href="#2041-爬虫的基本原理" class="astro-acifyk5h" style="--depth: 1;"> <span class="astro-acifyk5h" style="--depth: 1;">20.4.1 爬虫的基本原理</span> </a>  </li><li class="astro-acifyk5h" style="--depth: 1;"> <a href="#2042-rust-用于爬虫的优势" class="astro-acifyk5h" style="--depth: 1;"> <span class="astro-acifyk5h" style="--depth: 1;">20.4.2. Rust 用于爬虫的优势</span> </a>  </li><li class="astro-acifyk5h" style="--depth: 1;"> <a href="#2043-rust-中用于爬虫的库和工具" class="astro-acifyk5h" style="--depth: 1;"> <span class="astro-acifyk5h" style="--depth: 1;">20.4.3. Rust 中用于爬虫的库和工具</span> </a>  </li><li class="astro-acifyk5h" style="--depth: 1;"> <a href="#2044-爬虫的伦理和法律考虑" class="astro-acifyk5h" style="--depth: 1;"> <span class="astro-acifyk5h" style="--depth: 1;">20.4.4. 爬虫的伦理和法律考虑</span> </a>  </li><li class="astro-acifyk5h" style="--depth: 1;"> <a href="#补充学习序列化和反序列化" class="astro-acifyk5h" style="--depth: 1;"> <span class="astro-acifyk5h" style="--depth: 1;">补充学习：序列化和反序列化</span> </a>  </li><li class="astro-acifyk5h" style="--depth: 1;"> <a href="#案例在redis中构建中国大陆交易日库" class="astro-acifyk5h" style="--depth: 1;"> <span class="astro-acifyk5h" style="--depth: 1;">案例：在Redis中构建中国大陆交易日库</span> </a>  </li> </ul>  </li> </ul> </nav></starlight-toc></div></div> </div> </aside> <div class="main-pane astro-3vvvt7cz">  <main data-pagefind-body lang="en" dir="ltr" class="astro-fpze62lo">    <div class="content-panel astro-vo2eo5fg"> <div class="sl-container astro-vo2eo5fg"> <h1 id="_top" class="astro-daoses2n">Redis、爬虫、交易日库</h1>  </div> </div>  <div class="content-panel astro-vo2eo5fg"> <div class="sl-container astro-vo2eo5fg"> <div class="sl-markdown-content"> <h2 id="201-redis入门安装和配置">20.1 Redis入门、安装和配置</h2>
<p>Redis是一个开源的内存内(In-Memory)数据库，它可以用于存储和管理数据，通常用作缓存、消息队列、会话存储等用途。Redis支持多种数据结构，包括字符串、列表、集合、有序集合和哈希表。它以其高性能、低延迟和持久性存储特性而闻名，适用于许多应用场景。</p>
<p>大多数主流的Linux发行版都提供了Redis的软件包。</p>
<h3 id="在ubuntudebian上安装">在Ubuntu/Debian上安装</h3>
<p>你可以从官方的<code dir="auto">packages.redis.io</code> APT存储库安装最新的稳定版本的Redis。</p>
<p>先决条件</p>
<p>如果你正在运行一个非常精简的发行版（比如Docker容器），你可能需要首先安装<code dir="auto">lsb-release</code>、<code dir="auto">curl</code>和<code dir="auto">gpg</code>。</p>
<div class="expressive-code"><link rel="stylesheet" href="/_astro/ec.usa2f.css"><script type="module" src="/_astro/ec.sgewm.js"></script><figure class="frame is-terminal not-content"><figcaption class="header"><span class="title"></span><span class="sr-only">Terminal window</span></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#82AAFF;--1:#3C63B3">sudo</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">apt</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">install</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">lsb-release</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">curl</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">gpg</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="sudo apt install lsb-release curl gpg"><div></div></button></div></figure></div>
<p>将该存储库添加到<code dir="auto">apt</code>索引中，然后更新索引，最后进行安装：</p>
<div class="expressive-code"><figure class="frame is-terminal not-content"><figcaption class="header"><span class="title"></span><span class="sr-only">Terminal window</span></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#82AAFF;--1:#3C63B3">curl</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">-fsSL</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">https://packages.redis.io/gpg</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#097174">|</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">sudo</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">gpg</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">--dearmor</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">-o</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">/usr/share/keyrings/redis-archive-keyring.gpg</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#C5E478;--1:#3C63B3">echo</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">deb [signed-by=/usr/share/keyrings/redis-archive-keyring.gpg] https://packages.redis.io/deb </span><span style="--1:#3C63B3"><span style="--0:#ECC48D">$(</span><span style="--0:#82AAFF">lsb_release</span><span style="--0:#ECC48D"> </span><span style="--0:#82AAFF">-cs</span><span style="--0:#ECC48D">)</span></span><span style="--0:#ECC48D;--1:#9B504E"> main</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#097174">|</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">sudo</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">tee</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">/etc/apt/sources.list.d/redis.list</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#82AAFF;--1:#3C63B3">sudo</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">apt-get</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">update</span></div><div class="ec-line"><span style="--0:#82AAFF;--1:#3C63B3">sudo</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">apt-get</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">install</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">redis</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="curl -fsSL https://packages.redis.io/gpg | sudo gpg --dearmor -o /usr/share/keyrings/redis-archive-keyring.gpgecho &#x22;deb [signed-by=/usr/share/keyrings/redis-archive-keyring.gpg] https://packages.redis.io/deb $(lsb_release -cs) main&#x22; | sudo tee /etc/apt/sources.list.d/redis.listsudo apt-get updatesudo apt-get install redis"><div></div></button></div></figure></div>
<h3 id="在-manjaroarchlinux-上安装">在 Manjaro/Archlinux 上安装</h3>
<div class="expressive-code"><figure class="frame is-terminal not-content"><figcaption class="header"><span class="title"></span><span class="sr-only">Terminal window</span></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#82AAFF;--1:#3C63B3">sudo</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">pacman</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">-S</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">redis</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="sudo pacman -S redis"><div></div></button></div></figure></div>
<h3 id="用户界面">用户界面</h3>
<p>除了传统的CLI以外，Redis还提供了图形化前端 <a href="https://redis.com/redis-enterprise/redis-insight/">RedisInsight</a> 方便直观查看：</p>
<p><img src="/img.png" alt="img.png"></p>
<p>下面在20.3小节我们会演示如何为通过Rust和Redis的Rust客户端来插入图示的这对键值对。</p>
<h2 id="202-常见redis数据结构类型">20.2 常见Redis数据结构类型</h2>
<p>为了将Redis的不同数据结构类型与相应的命令详细叙述并创建一个示例表格，我将按照以下格式为你展示：</p>
<p><strong>数据结构类型</strong>：描述该数据结构类型的特点和用途。</p>
<p><strong>常用命令示例</strong>：列出该数据结构类型的一些常用命令示例，包括命令和用途。</p>
<p><strong>示例表格</strong>：创建一个示例表格，包含数据结构类型、命令示例以及示例值。</p>
<p>现在让我们开始：</p>
<h3 id="字符串strings">字符串（Strings）</h3>
<p><strong>数据结构类型</strong>：
字符串是Redis中最简单的数据结构，可以存储文本、二进制数据等。</p>
<p><strong>常用命令示例</strong>：</p>
<ul>
<li>设置字符串值：<code dir="auto">SET key value</code></li>
<li>获取字符串值：<code dir="auto">GET key</code></li>
</ul>
<p><strong>示例表格</strong>：</p>




















<table><thead><tr><th>数据结构类型</th><th>命令示例</th><th>示例值</th></tr></thead><tbody><tr><td>字符串</td><td><code dir="auto">SET username "Alice"</code></td><td>Key: username, Value: “Alice”</td></tr><tr><td>字符串</td><td><code dir="auto">GET username</code></td><td>返回值: “Alice”</td></tr></tbody></table>
<h4 id="哈希表hashes">哈希表（Hashes）</h4>
<p><strong>数据结构类型</strong>：
哈希表是一个键值对的集合，适用于存储多个字段和对应的值。</p>
<p><strong>常用命令示例</strong>：</p>
<ul>
<li>设置哈希表字段：<code dir="auto">HSET key field value</code></li>
<li>获取哈希表字段值：<code dir="auto">HGET key field</code></li>
</ul>
<p><strong>示例表格</strong>：</p>




















<table><thead><tr><th>数据结构类型</th><th>命令示例</th><th>示例值</th></tr></thead><tbody><tr><td>哈希表</td><td><code dir="auto">HSET user:id name "Bob"</code></td><td>Key: user<div></div>, Field: name, Value: “Bob”</td></tr><tr><td>哈希表</td><td><code dir="auto">HGET user:id name</code></td><td>返回值: “Bob”</td></tr></tbody></table>
<h4 id="列表lists">列表（Lists）</h4>
<p><strong>数据结构类型</strong>：
列表是一个有序的字符串元素集合，可用于实现队列或栈。</p>
<p><strong>常用命令示例</strong>：</p>
<ul>
<li>从列表左侧插入元素：<code dir="auto">LPUSH key value1 value2 ...</code></li>
<li>获取列表范围内的元素：<code dir="auto">LRANGE key start stop</code></li>
</ul>
<p><strong>示例表格</strong>：</p>




















<table><thead><tr><th>数据结构类型</th><th>命令示例</th><th>示例值</th></tr></thead><tbody><tr><td>列表</td><td><code dir="auto">LPUSH queue "item1"</code></td><td>Key: queue, Values: “item1”</td></tr><tr><td>列表</td><td><code dir="auto">LRANGE queue 0 -1</code></td><td>返回值: [“item1”]</td></tr></tbody></table>
<h4 id="集合sets">集合（Sets）</h4>
<p><strong>数据结构类型</strong>：
集合是一个无序的字符串元素集合，可用于存储唯一值。</p>
<p><strong>常用命令示例</strong>：</p>
<ul>
<li>添加元素到集合：<code dir="auto">SADD key member1 member2 ...</code></li>
<li>获取集合中的所有元素：<code dir="auto">SMEMBERS key</code></li>
</ul>
<p><strong>示例表格</strong>：</p>




















<table><thead><tr><th>数据结构类型</th><th>命令示例</th><th>示例值</th></tr></thead><tbody><tr><td>集合</td><td><code dir="auto">SADD employees "Alice" "Bob"</code></td><td>Key: employees, Members: [“Alice”, “Bob”]</td></tr><tr><td>集合</td><td><code dir="auto">SMEMBERS employees</code></td><td>返回值: [“Alice”, “Bob”]</td></tr></tbody></table>
<h4 id="有序集合sorted-sets">有序集合（Sorted Sets）</h4>
<p><strong>数据结构类型</strong>：
有序集合类似于集合，但每个元素都关联一个分数，用于排序元素。</p>
<p><strong>常用命令示例</strong>：</p>
<ul>
<li>添加元素到有序集合：<code dir="auto">ZADD key score1 member1 score2 member2 ...</code></li>
<li>获取有序集合范围内的元素：<code dir="auto">ZRANGE key start stop</code></li>
</ul>
<p><strong>示例表格</strong>：</p>




















<table><thead><tr><th>数据结构类型</th><th>命令示例</th><th>示例值</th></tr></thead><tbody><tr><td>有序集合</td><td><code dir="auto">ZADD leaderboard 100 "Alice"</code></td><td>Key: leaderboard, Score: 100, Member: “Alice”</td></tr><tr><td>有序集合</td><td><code dir="auto">ZRANGE leaderboard 0 -1</code></td><td>返回值: [“Alice”]</td></tr></tbody></table>
<p>这些示例展示了不同类型的Redis数据结构以及常用的命令示例，你可以根据你的具体需求和应用场景使用适当的数据结构和命令来构建你的Redis数据库。在20.3的例子中，我们会用一个最简单的字符串例子来做示范。</p>
<h2 id="203-在rust中使用redis客户端">20.3 在Rust中使用Redis客户端</h2>
<p>将Redis与Rust结合使用可以提供高性能和安全的数据存储和处理能力。下面详细说明如何将Redis与Rust配合使用：</p>
<ol>
<li>
<p>安装Redis客户端库：
首先，你需要在Rust项目中引入Redis客户端库，最常用的库是<code dir="auto">redis-rs</code>，可以在Cargo.toml文件中添加以下依赖项：</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">[dependencies]</span></div><div class="ec-line"><span style="--0:#C5E478;--1:#3C63B3">redis</span><span style="--0:#D6DEEB;--1:#403F53"> = </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">0.23</span><span style="--0:#D9F5DD;--1:#111111">"</span></div><div class="ec-line"><span style="--0:#C5E478;--1:#3C63B3">tokio</span><span style="--0:#D6DEEB;--1:#403F53"> = { </span><span style="--0:#C5E478;--1:#3C63B3">version</span><span style="--0:#D6DEEB;--1:#403F53"> = </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">1.29.1</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#C5E478;--1:#3C63B3">features</span><span style="--0:#D6DEEB;--1:#403F53"> = [</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">full</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">] }</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="[dependencies]redis = &#x22;0.23&#x22;tokio = { version = &#x22;1.29.1&#x22;, features = [&#x22;full&#x22;] }"><div></div></button></div></figure></div>
<p>然后运行<code dir="auto">cargo build</code>以安装库。</p>
</li>
<li>
<p>创建Redis连接
使用Redis客户端库连接到Redis服务器。以下是一个示例：</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">use</span><span style="--0:#D6DEEB;--1:#403F53"> redis</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#D6DEEB;--1:#403F53">Commands;</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">#[tokio</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#D6DEEB;--1:#403F53">main]</span></div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">async</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">fn</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">main</span><span style="--0:#D6DEEB;--1:#403F53">() </span><span style="--0:#7FDBCA;--1:#097174">-></span><span style="--0:#D6DEEB;--1:#403F53"> redis</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#D6DEEB;--1:#403F53">RedisResult&#x3C;()> {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">redis_url</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">redis://:@127.0.0.1:6379/0</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">client</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> redis</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#D6DEEB;--1:#403F53">Client</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#82AAFF;--1:#3C63B3">open</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#C5E478;--1:#3C63B3">redis_url</span><span style="--0:#D6DEEB;--1:#403F53">)</span><span style="--0:#7FDBCA;--1:#097174">?</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">mut</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">con</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">client</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">get_connection</span><span style="--0:#D6DEEB;--1:#403F53">()</span><span style="--0:#7FDBCA;--1:#097174">?</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#809191;--1:#5E6578">    // 执行Redis命令</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">_</span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#D6DEEB;--1:#403F53"> () </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">con</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">set</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">my_key</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">my_value</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">)</span><span style="--0:#7FDBCA;--1:#097174">?</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">result</span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#D6DEEB;--1:#403F53"> String </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">con</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">get</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">my_key</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">)</span><span style="--0:#7FDBCA;--1:#097174">?</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#82AAFF;--1:#3C63B3">println!</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">Got value: {}</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#C5E478;--1:#3C63B3">result</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    Ok(())</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">}</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="use redis::Commands;#[tokio::main]async fn main() -> redis::RedisResult<()> {    let redis_url = &#x22;redis://:@127.0.0.1:6379/0&#x22;;    let client = redis::Client::open(redis_url)?;    let mut con = client.get_connection()?;    // 执行Redis命令    let _: () = con.set(&#x22;my_key&#x22;, &#x22;my_value&#x22;)?;    let result: String = con.get(&#x22;my_key&#x22;)?;    println!(&#x22;Got value: {}&#x22;, result);    Ok(())}"><div></div></button></div></figure></div>
<p>这个示例首先创建了一个Redis客户端，然后与服务器建立连接，并执行了一些基本的操作。</p>
<p><strong>详细解释一下Redis链接的构成：</strong></p>
<ol>
<li><code dir="auto">redis://</code>：这部分指示了使用的协议，通常是 <code dir="auto">redis://</code> 或 <code dir="auto">rediss://</code>（如果你使用了加密连接）。</li>
<li><code dir="auto">:@</code>：这部分表示用户名和密码，但在你的示例中是空白的，因此没有提供用户名和密码。如果需要密码验证，你可以在 <code dir="auto">:</code> 后面提供密码，例如：<code dir="auto">redis://password@127.0.0.1:6379/0</code>。</li>
<li><code dir="auto">127.0.0.1</code>：这部分是 Redis 服务器的主机地址，指定了 Redis 服务器所在的机器的 IP 地址或主机名。在示例中，这是本地主机的 IP 地址，也就是 <code dir="auto">127.0.0.1</code>，表示连接到本地的 Redis 服务器。</li>
<li><code dir="auto">6379</code>：这部分是 Redis 服务器的端口号，指定了连接到 Redis 服务器的端口。默认情况下，Redis 使用 <code dir="auto">6379</code> 端口。</li>
<li><code dir="auto">/0</code>：这部分是 Redis 数据库的索引，Redis 支持多个数据库，默认情况下有 16 个数据库，索引从 <code dir="auto">0</code> 到 <code dir="auto">15</code>。在示例中，索引为 <code dir="auto">0</code>，表示连接到数据库索引为 0 的数据库。</li>
</ol>
<p>综合起来，你的示例 Redis 连接字符串表示连接到本地 Redis 服务器（<code dir="auto">127.0.0.1</code>）的默认端口（<code dir="auto">6379</code>），并选择索引为 0 的数据库，没有提供用户名和密码进行认证。如果你的 Redis 服务器有密码保护，你需要提供相应的密码来进行连接。</p>
</li>
<li>
<p>处理错误：
在Rust中，处理错误非常重要，因此需要考虑如何处理Redis操作可能出现的错误。在上面的示例中，我们使用了RedisResult来包裹返回结果，然后用<code dir="auto">?</code>来处理Redis操作可能引发的错误。你可以根据你的应用程序需求来处理这些错误，例如，记录日志或采取其他适当的措施。</p>
</li>
<li>
<p>使用异步编程：
如果你需要处理大量的并发操作或需要高性能，可以考虑使用Rust的异步编程库，如Tokio，与异步Redis客户端库配合使用。这将允许你以非阻塞的方式执行Redis操作，以提高性能。</p>
</li>
<li>
<p>定期清理过期数据：
Redis支持过期时间设置，你可以在将数据存储到Redis中时为其设置过期时间。在Rust中，你可以编写定期任务来清理过期数据，以确保Redis中的数据不会无限增长。</p>
</li>
</ol>
<p>总之，将Redis与Rust配合使用可以为你提供高性能、安全的数据存储和处理解决方案。通过使用Rust的强类型和内存安全性，以及Redis的速度和功能，你可以构建可靠的应用程序。当然，在实际应用中，还需要考虑更多复杂的细节，如连接池管理、性能优化和错误处理策略，以确保应用程序的稳定性和性能。</p>
<h2 id="204-爬虫">20.4 爬虫</h2>
<p>Rust 是一种图灵完备的系统级编程语言，当然也可以用于编写网络爬虫。Rust 具有出色的性能、内存安全性和并发性，这些特性使其成为编写高效且可靠的爬虫的理想选择。以下是 Rust 爬虫的简要介绍：</p>
<h3 id="2041-爬虫的基本原理">20.4.1 爬虫的基本原理</h3>
<p>爬虫是一个自动化程序，用于从互联网上的网页中提取数据。爬虫的基本工作流程通常包括以下步骤：</p>
<ol>
<li>
<p>发送 HTTP 请求：爬虫会向目标网站发送 HTTP 请求，以获取网页的内容。</p>
</li>
<li>
<p>解析 HTML：爬虫会解析 HTML 文档，从中提取有用的信息，如链接、文本内容等。</p>
</li>
<li>
<p>存储数据：爬虫将提取的数据存储在本地数据库、文件或内存中，以供后续分析和使用。</p>
</li>
<li>
<p>遍历链接：爬虫可能会从当前页面中提取链接，并递归地访问这些链接，以获取更多的数据。</p>
</li>
</ol>
<h3 id="2042-rust-用于爬虫的优势">20.4.2. Rust 用于爬虫的优势</h3>
<p>Rust 在编写爬虫时具有以下优势：</p>
<ul>
<li>
<p><strong>内存安全性</strong>：Rust 的借用检查器和所有权系统可以防止常见的内存错误，如空指针和数据竞争。这有助于减少爬虫程序中的错误和漏洞。</p>
</li>
<li>
<p><strong>并发性</strong>：Rust 内置了并发性支持，可以轻松地创建多线程和异步任务，从而提高爬虫的效率。</p>
</li>
<li>
<p><strong>性能</strong>：Rust 的性能非常出色，可以快速地下载和处理大量数据。</p>
</li>
<li>
<p><strong>生态系统</strong>：Rust 生态系统中有丰富的库和工具，可用于处理 HTTP 请求、HTML 解析、数据库访问等任务。</p>
</li>
<li>
<p><strong>跨平台</strong>：Rust 可以编写跨平台的爬虫，运行在不同的操作系统上。</p>
</li>
</ul>
<h3 id="2043-rust-中用于爬虫的库和工具">20.4.3. Rust 中用于爬虫的库和工具</h3>
<p>在 Rust 中，有一些库和工具可用于编写爬虫，其中一些包括：</p>
<ul>
<li>
<p><strong>reqwest</strong>：用于发送 HTTP 请求和处理响应的库。</p>
</li>
<li>
<p><strong>scraper</strong>：用于解析和提取 HTML 数据的库。</p>
</li>
<li>
<p><strong>tokio</strong>：用于异步编程的库，适用于高性能爬虫。</p>
</li>
<li>
<p><strong>serde</strong>：用于序列化和反序列化数据的库，有助于处理从网页中提取的结构化数据。</p>
</li>
<li>
<p><strong>rusqlite</strong> 或 <strong>diesel</strong>：用于数据库存储的库，可用于存储爬取的数据。</p>
</li>
<li>
<p><strong>regex</strong>：用于正则表达式匹配，有时可用于从文本中提取数据。</p>
</li>
</ul>
<h3 id="2044-爬虫的伦理和法律考虑">20.4.4. 爬虫的伦理和法律考虑</h3>
<p>在编写爬虫时，务必遵守网站的 <code dir="auto">robots.txt</code> 文件和相关法律法规。爬虫应该尊重网站的隐私政策和使用条款，并避免对网站造成不必要的负担。爬虫不应滥用网站资源或进行未经授权的数据收集。</p>
<p>总之，Rust 是一种强大的编程语言，可用于编写高性能、可靠和安全的网络爬虫。在编写爬虫程序时，始终要遵循最佳实践和伦理准则，以确保合法性和道德性。</p>
<h3 id="补充学习序列化和反序列化">补充学习：序列化和反序列化</h3>
<p>在Rust中，JSON（JavaScript Object Notation）是一种常见的数据序列化和反序列化格式，通常用于在不同的应用程序和服务之间交换数据。Rust提供了一些库来处理JSON数据的序列化和反序列化操作，其中最常用的是<code dir="auto">serde</code>库。</p>
<p>以下是如何在Rust中进行JSON序列化和反序列化的简要介绍：</p>
<ol>
<li><strong>添加serde库依赖：</strong> 首先，你需要在项目的<code dir="auto">Cargo.toml</code>文件中添加<code dir="auto">serde</code>和<code dir="auto">serde_json</code>依赖，因为<code dir="auto">serde_json</code>是serde的JSON支持库。在<code dir="auto">Cargo.toml</code>中添加如下依赖：</li>
</ol>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">[dependencies]</span></div><div class="ec-line"><span style="--0:#C5E478;--1:#3C63B3">serde</span><span style="--0:#D6DEEB;--1:#403F53"> = { </span><span style="--0:#C5E478;--1:#3C63B3">version</span><span style="--0:#D6DEEB;--1:#403F53"> = </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">1.0.188</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#C5E478;--1:#3C63B3">features</span><span style="--0:#D6DEEB;--1:#403F53"> = [</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">derive</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">] }</span></div><div class="ec-line"><span style="--0:#C5E478;--1:#3C63B3">serde_json</span><span style="--0:#D6DEEB;--1:#403F53"> = </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">1.0</span><span style="--0:#D9F5DD;--1:#111111">"</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="[dependencies]serde = { version = &#x22;1.0.188&#x22;, features = [&#x22;derive&#x22;] }serde_json = &#x22;1.0&#x22;"><div></div></button></div></figure></div>
<p>然后，在你的Rust代码中导入<code dir="auto">serde</code>和<code dir="auto">serde_json</code>：</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">use</span><span style="--0:#D6DEEB;--1:#403F53"> serde</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#D6DEEB;--1:#403F53">{Serialize, Deserialize};</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="use serde::{Serialize, Deserialize};"><div></div></button></div></figure></div>
<ol start="2">
<li><strong>定义结构体：</strong> 如果你要将自定义类型序列化为JSON，你需要在结构体上实现<code dir="auto">Serialize</code>和<code dir="auto">Deserialize</code> trait。例如：</li>
</ol>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">#[derive(Serialize, Deserialize)]</span></div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">struct</span><span style="--0:#D6DEEB;--1:#403F53"> Person {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C5E478;--1:#3C63B3">name</span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#D6DEEB;--1:#403F53"> String,</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C5E478;--1:#3C63B3">age</span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#D6DEEB;--1:#403F53"> u32,</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">}</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="#[derive(Serialize, Deserialize)]struct Person {    name: String,    age: u32,}"><div></div></button></div></figure></div>
<ol start="3">
<li><strong>序列化为JSON：</strong> 使用<code dir="auto">serde_json::to_string</code>将Rust数据结构序列化为JSON字符串：</li>
</ol>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">fn</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">main</span><span style="--0:#D6DEEB;--1:#403F53">() {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">person</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> Person {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        </span><span style="--0:#C5E478;--1:#3C63B3">name</span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">Alice</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">to_string</span><span style="--0:#D6DEEB;--1:#403F53">(),</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        </span><span style="--0:#C5E478;--1:#3C63B3">age</span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#F78C6C;--1:#AA0982">30</span><span style="--0:#D6DEEB;--1:#403F53">,</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    };</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">json_string</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> serde_json</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#82AAFF;--1:#3C63B3">to_string</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#7FDBCA;--1:#097174">&#x26;</span><span style="--0:#C5E478;--1:#3C63B3">person</span><span style="--0:#D6DEEB;--1:#403F53">)</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">unwrap</span><span style="--0:#D6DEEB;--1:#403F53">();</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#82AAFF;--1:#3C63B3">println!</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">{}</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#C5E478;--1:#3C63B3">json_string</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">}</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="fn main() {    let person = Person {        name: &#x22;Alice&#x22;.to_string(),        age: 30,    };    let json_string = serde_json::to_string(&#x26;person).unwrap();    println!(&#x22;{}&#x22;, json_string);}"><div></div></button></div></figure></div>
<ol start="4">
<li><strong>反序列化：</strong> 使用<code dir="auto">serde_json::from_str</code>将JSON字符串反序列化为Rust数据结构：</li>
</ol>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">fn</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">main</span><span style="--0:#D6DEEB;--1:#403F53">() {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">json_string</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#9B504E">r</span><span style="--0:#D9F5DD;--1:#111111">#"</span><span style="--0:#ECC48D;--1:#9B504E">{"name":"Bob","age":25}</span><span style="--0:#D9F5DD;--1:#111111">"#</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">person</span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#D6DEEB;--1:#403F53"> Person </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> serde_json</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#82AAFF;--1:#3C63B3">from_str</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#C5E478;--1:#3C63B3">json_string</span><span style="--0:#D6DEEB;--1:#403F53">)</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">unwrap</span><span style="--0:#D6DEEB;--1:#403F53">();</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#82AAFF;--1:#3C63B3">println!</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">Name: {}, Age: {}</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#C5E478;--1:#3C63B3">person</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#D6DEEB;--1:#403F53">name, </span><span style="--0:#C5E478;--1:#3C63B3">person</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#D6DEEB;--1:#403F53">age);</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">}</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="fn main() {    let json_string = r#&#x22;{&#x22;name&#x22;:&#x22;Bob&#x22;,&#x22;age&#x22;:25}&#x22;#;    let person: Person = serde_json::from_str(json_string).unwrap();    println!(&#x22;Name: {}, Age: {}&#x22;, person.name, person.age);}"><div></div></button></div></figure></div>
<p>这只是一个简单的介绍，你可以根据具体的需求进一步探索<code dir="auto">serde</code>和<code dir="auto">serde_json</code>库的功能，以及如何处理更复杂的JSON数据结构和场景。这些库提供了强大的工具，使得在Rust中进行JSON序列化和反序列化变得非常方便。</p>
<h3 id="案例在redis中构建中国大陆交易日库">案例：在Redis中构建中国大陆交易日库</h3>
<p>这个案例演示了如何使用 Rust 编写一个简单的爬虫，从指定的网址获取中国大陆的节假日数据，然后将数据存储到 Redis 数据库中。这个案例涵盖了许多 Rust 的核心概念，包括异步编程、HTTP 请求、JSON 解析、错误处理以及与 Redis 交互等。</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">use</span><span style="--0:#D6DEEB;--1:#403F53"> anyhow</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#D6DEEB;--1:#403F53">{anyhow, Error </span><span style="--0:#C792EA;--1:#8D46B4">as</span><span style="--0:#D6DEEB;--1:#403F53"> AnyError};</span><span style="--0:#809191;--1:#5E6578"> // 导入`anyhow`库中的`anyhow`和`Error`别名为`AnyError`</span></div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">use</span><span style="--0:#D6DEEB;--1:#403F53"> redis</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#D6DEEB;--1:#403F53">{Commands};</span><span style="--0:#809191;--1:#5E6578"> // 导入`redis`库中的`Commands`</span></div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">use</span><span style="--0:#D6DEEB;--1:#403F53"> reqwest</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#D6DEEB;--1:#403F53">Client </span><span style="--0:#C792EA;--1:#8D46B4">as</span><span style="--0:#D6DEEB;--1:#403F53"> ReqwestClient;</span><span style="--0:#809191;--1:#5E6578"> // 导入`reqwest`库中的`Client`别名为`ReqwestClient`</span></div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">use</span><span style="--0:#D6DEEB;--1:#403F53"> serde</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#D6DEEB;--1:#403F53">{Deserialize, Serialize};</span><span style="--0:#809191;--1:#5E6578"> // 导入`serde`库中的`Deserialize`和`Serialize`</span></div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">use</span><span style="--0:#D6DEEB;--1:#403F53"> std</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#D6DEEB;--1:#403F53">error</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#D6DEEB;--1:#403F53">Error;</span><span style="--0:#809191;--1:#5E6578"> // 导入标准库中的`Error`</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">#[derive(Debug, Serialize, Deserialize)]</span></div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">struct</span><span style="--0:#D6DEEB;--1:#403F53"> DayType {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C5E478;--1:#3C63B3">date</span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#D6DEEB;--1:#403F53"> i32,</span><span style="--0:#809191;--1:#5E6578"> // 定义一个结构体`DayType`，用于表示日期</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">}</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">#[derive(Debug, Serialize, Deserialize)]</span></div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">struct</span><span style="--0:#D6DEEB;--1:#403F53"> HolidaysType {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C5E478;--1:#3C63B3">cn</span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#D6DEEB;--1:#403F53"> Vec&#x3C;DayType>,</span><span style="--0:#809191;--1:#5E6578"> // 定义一个结构体`HolidaysType`，包含一个日期列表</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">}</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">#[derive(Debug, Serialize, Deserialize)]</span></div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">struct</span><span style="--0:#D6DEEB;--1:#403F53"> CalendarBody {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C5E478;--1:#3C63B3">holidays</span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#D6DEEB;--1:#403F53"> Option&#x3C;HolidaysType>,</span><span style="--0:#809191;--1:#5E6578"> // 定义一个结构体`CalendarBody`，包含一个可选的`HolidaysType`字段</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">}</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#809191;--1:#5E6578">// 异步函数，用于获取API数据并存储到Redis</span></div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">async</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">fn</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">store_calendar_to_redis</span><span style="--0:#D6DEEB;--1:#403F53">() </span><span style="--0:#7FDBCA;--1:#097174">-></span><span style="--0:#D6DEEB;--1:#403F53"> Result&#x3C;(), AnyError> {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">url</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">http://pc.suishenyun.net/peacock/api/h5/festival</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">;</span><span style="--0:#809191;--1:#5E6578"> // API的URL</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">client</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> ReqwestClient</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#82AAFF;--1:#3C63B3">new</span><span style="--0:#D6DEEB;--1:#403F53">();</span><span style="--0:#809191;--1:#5E6578"> // 创建一个Reqwest HTTP客户端</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">response</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">client</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">get</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#C5E478;--1:#3C63B3">url</span><span style="--0:#D6DEEB;--1:#403F53">)</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">send</span><span style="--0:#D6DEEB;--1:#403F53">()</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#C792EA;--1:#8D46B4">await</span><span style="--0:#7FDBCA;--1:#097174">?</span><span style="--0:#D6DEEB;--1:#403F53">;</span><span style="--0:#809191;--1:#5E6578"> // 发送HTTP GET请求并等待响应</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">body_s</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">response</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">text</span><span style="--0:#D6DEEB;--1:#403F53">()</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#C792EA;--1:#8D46B4">await</span><span style="--0:#7FDBCA;--1:#097174">?</span><span style="--0:#D6DEEB;--1:#403F53">;</span><span style="--0:#809191;--1:#5E6578"> // 读取响应体的文本数据</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#809191;--1:#5E6578">    // 将API响应的JSON字符串解析为CalendarBody结构体</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">cb</span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#D6DEEB;--1:#403F53"> CalendarBody </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">match</span><span style="--0:#D6DEEB;--1:#403F53"> serde_json</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#82AAFF;--1:#3C63B3">from_str</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#7FDBCA;--1:#097174">&#x26;</span><span style="--0:#C5E478;--1:#3C63B3">body_s</span><span style="--0:#D6DEEB;--1:#403F53">) {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        Ok(</span><span style="--0:#C5E478;--1:#3C63B3">cb</span><span style="--0:#D6DEEB;--1:#403F53">) </span><span style="--0:#7FDBCA;--1:#097174">=></span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">cb</span><span style="--0:#D6DEEB;--1:#403F53">,</span><span style="--0:#809191;--1:#5E6578"> // 解析成功，得到CalendarBody结构体</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        Err(</span><span style="--0:#C5E478;--1:#3C63B3">e</span><span style="--0:#D6DEEB;--1:#403F53">) </span><span style="--0:#7FDBCA;--1:#097174">=></span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">return</span><span style="--0:#D6DEEB;--1:#403F53"> Err(</span><span style="--0:#82AAFF;--1:#3C63B3">anyhow!</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">Failed to parse JSON string: {}</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#C5E478;--1:#3C63B3">e</span><span style="--0:#D6DEEB;--1:#403F53">)),</span><span style="--0:#809191;--1:#5E6578"> // 解析失败，返回错误</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    };</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">if</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> Some(</span><span style="--0:#C5E478;--1:#3C63B3">holidays</span><span style="--0:#D6DEEB;--1:#403F53">) </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">cb</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#D6DEEB;--1:#403F53">holidays {</span><span style="--0:#809191;--1:#5E6578"> // 如果存在节假日数据</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">days</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">holidays</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#D6DEEB;--1:#403F53">cn;</span><span style="--0:#809191;--1:#5E6578"> // 获取日期列表</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">mut</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">dates</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> Vec</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#82AAFF;--1:#3C63B3">new</span><span style="--0:#D6DEEB;--1:#403F53">();</span><span style="--0:#809191;--1:#5E6578"> // 创建一个空的日期向量</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        </span><span style="--0:#C792EA;--1:#8D46B4">for</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">day</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">in</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">days</span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">            </span><span style="--0:#C5E478;--1:#3C63B3">dates</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">push</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#C5E478;--1:#3C63B3">day</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#D6DEEB;--1:#403F53">date </span><span style="--0:#C792EA;--1:#8D46B4">as</span><span style="--0:#D6DEEB;--1:#403F53"> u32);</span><span style="--0:#809191;--1:#5E6578"> // 将日期添加到向量中，转换为u32类型</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        }</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">redis_url</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">redis://:@127.0.0.1:6379/0</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">;</span><span style="--0:#809191;--1:#5E6578"> // Redis服务器的连接URL</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">client</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> redis</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#D6DEEB;--1:#403F53">Client</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#82AAFF;--1:#3C63B3">open</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#C5E478;--1:#3C63B3">redis_url</span><span style="--0:#D6DEEB;--1:#403F53">)</span><span style="--0:#7FDBCA;--1:#097174">?</span><span style="--0:#D6DEEB;--1:#403F53">;</span><span style="--0:#809191;--1:#5E6578"> // 打开Redis连接</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">mut</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">con</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">client</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">get_connection</span><span style="--0:#D6DEEB;--1:#403F53">()</span><span style="--0:#7FDBCA;--1:#097174">?</span><span style="--0:#D6DEEB;--1:#403F53">;</span><span style="--0:#809191;--1:#5E6578"> // 获取Redis连接</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#809191;--1:#5E6578">        // 将每个日期添加到Redis集合中</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        </span><span style="--0:#C792EA;--1:#8D46B4">for</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">date</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">in</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#097174">&#x26;</span><span style="--0:#C5E478;--1:#3C63B3">dates</span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">            </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">_</span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#D6DEEB;--1:#403F53"> usize </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">con</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">sadd</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">holidays_set</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#C5E478;--1:#3C63B3">date</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">to_string</span><span style="--0:#D6DEEB;--1:#403F53">())</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">unwrap</span><span style="--0:#D6DEEB;--1:#403F53">();</span><span style="--0:#809191;--1:#5E6578"> // 添加日期到Redis集合</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        }</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        Ok(())</span><span style="--0:#809191;--1:#5E6578"> // 操作成功，返回Ok(())</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    } </span><span style="--0:#C792EA;--1:#8D46B4">else</span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        Err(</span><span style="--0:#82AAFF;--1:#3C63B3">anyhow!</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">No holiday data found.</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">))</span><span style="--0:#809191;--1:#5E6578"> // 没有节假日数据，返回错误</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    }</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">}</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">#[tokio</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#D6DEEB;--1:#403F53">main]</span></div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">async</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">fn</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">main</span><span style="--0:#D6DEEB;--1:#403F53">() </span><span style="--0:#7FDBCA;--1:#097174">-></span><span style="--0:#D6DEEB;--1:#403F53"> Result&#x3C;(), Box&#x3C;</span><span style="--0:#C792EA;--1:#8D46B4">dyn</span><span style="--0:#D6DEEB;--1:#403F53"> Error>> {</span></div><div class="ec-line"><span style="--0:#809191;--1:#5E6578">    // 调用存储数据到Redis的函数</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">if</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> Err(</span><span style="--0:#C5E478;--1:#3C63B3">err</span><span style="--0:#D6DEEB;--1:#403F53">) </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">store_calendar_to_redis</span><span style="--0:#D6DEEB;--1:#403F53">()</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#C792EA;--1:#8D46B4">await</span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        </span><span style="--0:#82AAFF;--1:#3C63B3">eprintln!</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">Error: {}</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#C5E478;--1:#3C63B3">err</span><span style="--0:#D6DEEB;--1:#403F53">);</span><span style="--0:#809191;--1:#5E6578"> // 打印错误信息</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    } </span><span style="--0:#C792EA;--1:#8D46B4">else</span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        </span><span style="--0:#82AAFF;--1:#3C63B3">println!</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">Holiday data stored in Redis successfully.</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">);</span><span style="--0:#809191;--1:#5E6578"> // 打印成功消息</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    }</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    Ok(())</span><span style="--0:#809191;--1:#5E6578"> // 返回Ok(())</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">}</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="use anyhow::{anyhow, Error as AnyError}; // 导入&#x60;anyhow&#x60;库中的&#x60;anyhow&#x60;和&#x60;Error&#x60;别名为&#x60;AnyError&#x60;use redis::{Commands}; // 导入&#x60;redis&#x60;库中的&#x60;Commands&#x60;use reqwest::Client as ReqwestClient; // 导入&#x60;reqwest&#x60;库中的&#x60;Client&#x60;别名为&#x60;ReqwestClient&#x60;use serde::{Deserialize, Serialize}; // 导入&#x60;serde&#x60;库中的&#x60;Deserialize&#x60;和&#x60;Serialize&#x60;use std::error::Error; // 导入标准库中的&#x60;Error&#x60;#[derive(Debug, Serialize, Deserialize)]struct DayType {    date: i32, // 定义一个结构体&#x60;DayType&#x60;，用于表示日期}#[derive(Debug, Serialize, Deserialize)]struct HolidaysType {    cn: Vec<DayType>, // 定义一个结构体&#x60;HolidaysType&#x60;，包含一个日期列表}#[derive(Debug, Serialize, Deserialize)]struct CalendarBody {    holidays: Option<HolidaysType>, // 定义一个结构体&#x60;CalendarBody&#x60;，包含一个可选的&#x60;HolidaysType&#x60;字段}// 异步函数，用于获取API数据并存储到Redisasync fn store_calendar_to_redis() -> Result<(), AnyError> {    let url = &#x22;http://pc.suishenyun.net/peacock/api/h5/festival&#x22;; // API的URL    let client = ReqwestClient::new(); // 创建一个Reqwest HTTP客户端    let response = client.get(url).send().await?; // 发送HTTP GET请求并等待响应    let body_s = response.text().await?; // 读取响应体的文本数据    // 将API响应的JSON字符串解析为CalendarBody结构体    let cb: CalendarBody = match serde_json::from_str(&#x26;body_s) {        Ok(cb) => cb, // 解析成功，得到CalendarBody结构体        Err(e) => return Err(anyhow!(&#x22;Failed to parse JSON string: {}&#x22;, e)), // 解析失败，返回错误    };    if let Some(holidays) = cb.holidays { // 如果存在节假日数据        let days = holidays.cn; // 获取日期列表        let mut dates = Vec::new(); // 创建一个空的日期向量        for day in days {            dates.push(day.date as u32); // 将日期添加到向量中，转换为u32类型        }        let redis_url = &#x22;redis://:@127.0.0.1:6379/0&#x22;; // Redis服务器的连接URL        let client = redis::Client::open(redis_url)?; // 打开Redis连接        let mut con = client.get_connection()?; // 获取Redis连接        // 将每个日期添加到Redis集合中        for date in &#x26;dates {            let _: usize = con.sadd(&#x22;holidays_set&#x22;, date.to_string()).unwrap(); // 添加日期到Redis集合        }        Ok(()) // 操作成功，返回Ok(())    } else {        Err(anyhow!(&#x22;No holiday data found.&#x22;)) // 没有节假日数据，返回错误    }}#[tokio::main]async fn main() -> Result<(), Box<dyn Error>> {    // 调用存储数据到Redis的函数    if let Err(err) = store_calendar_to_redis().await {        eprintln!(&#x22;Error: {}&#x22;, err); // 打印错误信息    } else {        println!(&#x22;Holiday data stored in Redis successfully.&#x22;); // 打印成功消息    }    Ok(()) // 返回Ok(())}"><div></div></button></div></figure></div>
<p><strong>案例要点：</strong></p>
<ol>
<li><strong>依赖库引入：</strong> 为了实现这个案例，首先引入了一系列 Rust 的外部依赖库，包括 <code dir="auto">reqwest</code> 用于发送 HTTP 请求、<code dir="auto">serde</code> 用于 JSON 序列化和反序列化、<code dir="auto">redis</code> 用于与 Redis 交互等等。这些库提供了必要的工具和功能，以便从网站获取数据并将其存储到 Redis 中。</li>
<li><strong>数据结构定义：</strong> 在案例中定义了三个结构体，<code dir="auto">DayType</code>、<code dir="auto">HolidaysType</code> 和 <code dir="auto">CalendarBody</code>，用于将 JSON 数据解析为 Rust 数据结构。这些结构体的字段对应于 JSON 数据中的字段，用于存储从网站获取的数据。</li>
<li><strong>异步函数和错误处理：</strong> 使用 <code dir="auto">async</code> 关键字定义了一个异步函数 <code dir="auto">store_calendar_to_redis</code>，该函数负责执行以下操作：
<ul>
<li>发送 HTTP 请求以获取节假日数据。</li>
<li>解析 JSON 数据。</li>
<li>将数据存储到 Redis 数据库中。 这个函数还演示了 Rust 中的错误处理机制，使用 <code dir="auto">Result</code> 返回可能的错误，以及如何使用 <code dir="auto">anyhow</code> 库来创建自定义错误信息。</li>
</ul>
</li>
<li><strong>Redis 数据存储：</strong> 使用 <code dir="auto">redis</code> 库连接到 Redis 数据库，并使用 <code dir="auto">sadd</code> 命令将节假日数据存储到名为 <code dir="auto">holidays_set</code> 的 Redis 集合中。</li>
<li><strong>main函数：</strong> <code dir="auto">main</code> 函数是程序的入口点。它使用 <code dir="auto">tokio</code> 框架的 <code dir="auto">#[tokio::main]</code> 属性宏来支持异步操作。在 <code dir="auto">main</code> 函数中，我们调用了 <code dir="auto">store_calendar_to_redis</code> 函数来执行节假日数据的存储操作。如果存储过程中出现错误，错误信息将被打印到标准错误流中；否则，将打印成功消息。</li>
</ol> </div> <footer class="astro-w7wtsaw6"> <div class="meta sl-flex astro-w7wtsaw6">   </div> <div class="pagination-links astro-qnftudm7" dir="ltr"> <a href="/chapters/chapter_19/" rel="prev" class="astro-qnftudm7"> <svg aria-hidden="true" class="astro-qnftudm7 astro-xrndq6a6" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.5rem;"><path d="M17 11H9.41l3.3-3.29a1.004 1.004 0 1 0-1.42-1.42l-5 5a1 1 0 0 0-.21.33 1 1 0 0 0 0 .76 1 1 0 0 0 .21.33l5 5a1.002 1.002 0 0 0 1.639-.325 1 1 0 0 0-.219-1.095L9.41 13H17a1 1 0 0 0 0-2Z"/></svg>  <span class="astro-qnftudm7"> Previous <br class="astro-qnftudm7"> <span class="link-title astro-qnftudm7">19. 时间处理</span> </span> </a> <a href="/chapters/chapter_21/" rel="next" class="astro-qnftudm7"> <svg aria-hidden="true" class="astro-qnftudm7 astro-xrndq6a6" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.5rem;"><path d="M17.92 11.62a1.001 1.001 0 0 0-.21-.33l-5-5a1.003 1.003 0 1 0-1.42 1.42l3.3 3.29H7a1 1 0 0 0 0 2h7.59l-3.3 3.29a1.002 1.002 0 0 0 .325 1.639 1 1 0 0 0 1.095-.219l5-5a1 1 0 0 0 .21-.33 1 1 0 0 0 0-.76Z"/></svg>  <span class="astro-qnftudm7"> Next <br class="astro-qnftudm7"> <span class="link-title astro-qnftudm7">21. 线程和管道</span> </span> </a> </div>  </footer>  </div> </div>   </main> </div> </div>  </div> </div>  </body></html>