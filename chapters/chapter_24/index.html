<!DOCTYPE html><html lang="en" dir="ltr" data-has-toc data-has-sidebar class="astro-fpze62lo"> <head><meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><title>时序数据库 Clickhouse | Cookbook for Rustaceans in Finance / Rust 量化金融开发指南</title><link rel="canonical"/><link rel="shortcut icon" href="/favicon.svg" type="image/svg+xml"/><meta name="generator" content="Astro v4.3.3"/><meta name="generator" content="Starlight v0.17.3"/><meta property="og:title" content="时序数据库 Clickhouse"/><meta property="og:type" content="article"/><meta property="og:url"/><meta property="og:locale" content="en"/><meta property="og:description"/><meta property="og:site_name" content="Cookbook for Rustaceans in Finance / Rust 量化金融开发指南"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:title" content="时序数据库 Clickhouse"/><meta name="twitter:description"/><script>
	window.StarlightThemeProvider = (() => {
		const storedTheme =
			typeof localStorage !== 'undefined' && localStorage.getItem('starlight-theme');
		const theme =
			storedTheme ||
			(window.matchMedia('(prefers-color-scheme: light)').matches ? 'light' : 'dark');
		document.documentElement.dataset.theme = theme === 'light' ? 'light' : 'dark';
		return {
			updatePickers(theme = storedTheme || 'auto') {
				document.querySelectorAll('starlight-theme-select').forEach((picker) => {
					const select = picker.querySelector('select');
					if (select) select.value = theme;
					/** @type {HTMLTemplateElement | null} */
					const tmpl = document.querySelector(`#theme-icons`);
					const newIcon = tmpl && tmpl.content.querySelector('.' + theme);
					if (newIcon) {
						const oldIcon = picker.querySelector('svg.label-icon');
						if (oldIcon) {
							oldIcon.replaceChildren(...newIcon.cloneNode(true).childNodes);
						}
					}
				});
			},
		};
	})();
</script><template id="theme-icons"><svg aria-hidden="true" class="light astro-xrndq6a6" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M5 12a1 1 0 0 0-1-1H3a1 1 0 0 0 0 2h1a1 1 0 0 0 1-1Zm.64 5-.71.71a1 1 0 0 0 0 1.41 1 1 0 0 0 1.41 0l.71-.71A1 1 0 0 0 5.64 17ZM12 5a1 1 0 0 0 1-1V3a1 1 0 0 0-2 0v1a1 1 0 0 0 1 1Zm5.66 2.34a1 1 0 0 0 .7-.29l.71-.71a1 1 0 1 0-1.41-1.41l-.66.71a1 1 0 0 0 0 1.41 1 1 0 0 0 .66.29Zm-12-.29a1 1 0 0 0 1.41 0 1 1 0 0 0 0-1.41l-.71-.71a1.004 1.004 0 1 0-1.43 1.41l.73.71ZM21 11h-1a1 1 0 0 0 0 2h1a1 1 0 0 0 0-2Zm-2.64 6A1 1 0 0 0 17 18.36l.71.71a1 1 0 0 0 1.41 0 1 1 0 0 0 0-1.41l-.76-.66ZM12 6.5a5.5 5.5 0 1 0 5.5 5.5A5.51 5.51 0 0 0 12 6.5Zm0 9a3.5 3.5 0 1 1 0-7 3.5 3.5 0 0 1 0 7Zm0 3.5a1 1 0 0 0-1 1v1a1 1 0 0 0 2 0v-1a1 1 0 0 0-1-1Z"/></svg> <svg aria-hidden="true" class="dark astro-xrndq6a6" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M21.64 13a1 1 0 0 0-1.05-.14 8.049 8.049 0 0 1-3.37.73 8.15 8.15 0 0 1-8.14-8.1 8.59 8.59 0 0 1 .25-2A1 1 0 0 0 8 2.36a10.14 10.14 0 1 0 14 11.69 1 1 0 0 0-.36-1.05Zm-9.5 6.69A8.14 8.14 0 0 1 7.08 5.22v.27a10.15 10.15 0 0 0 10.14 10.14 9.784 9.784 0 0 0 2.1-.22 8.11 8.11 0 0 1-7.18 4.32v-.04Z"/></svg> <svg aria-hidden="true" class="auto astro-xrndq6a6" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M21 14h-1V7a3 3 0 0 0-3-3H7a3 3 0 0 0-3 3v7H3a1 1 0 0 0-1 1v2a3 3 0 0 0 3 3h14a3 3 0 0 0 3-3v-2a1 1 0 0 0-1-1ZM6 7a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v7H6V7Zm14 10a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1v-1h16v1Z"/></svg> </template><link rel="stylesheet" href="/_astro/index.4lckRRHb.css" /><script type="module" src="/_astro/hoisted.RLbdawI7.js"></script>
<script type="module" src="/_astro/page.X_0NJa-z.js"></script></head> <body class="astro-fpze62lo"> <a href="#_top" class="astro-byjsuuaw">Skip to content</a>  <div class="page sl-flex astro-yxqmbg7i"> <header class="header astro-yxqmbg7i"><div class="header sl-flex astro-cyrhhlnw"> <div class="title-wrapper sl-flex astro-cyrhhlnw"> <a href="/" class="site-title sl-flex astro-ylanx5mn">  <span class="astro-ylanx5mn"> Cookbook for Rustaceans in Finance / Rust 量化金融开发指南 </span> </a>  </div> <div class="sl-flex astro-cyrhhlnw"> <site-search data-translations="{&#34;placeholder&#34;:&#34;Search&#34;}" class="astro-usz5hgcn"> <button data-open-modal disabled class="astro-usz5hgcn">  <svg aria-label="Search" class="astro-usz5hgcn astro-xrndq6a6" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M21.71 20.29 18 16.61A9 9 0 1 0 16.61 18l3.68 3.68a.999.999 0 0 0 1.42 0 1 1 0 0 0 0-1.39ZM11 18a7 7 0 1 1 0-14 7 7 0 0 1 0 14Z"/></svg>  <span class="sl-hidden md:sl-block astro-usz5hgcn" aria-hidden="true">Search</span> <svg aria-label="(Press / to Search)" class="sl-hidden md:sl-block astro-usz5hgcn astro-xrndq6a6" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M17 2H7a5 5 0 0 0-5 5v10a5 5 0 0 0 5 5h10a5 5 0 0 0 5-5V7a5 5 0 0 0-5-5Zm3 15a3 3 0 0 1-3 3H7a3 3 0 0 1-3-3V7a3 3 0 0 1 3-3h10a3 3 0 0 1 3 3v10Z"/><path d="M15.293 6.707a1 1 0 1 1 1.414 1.414l-8.485 8.486a1 1 0 0 1-1.414-1.415l8.485-8.485Z"/></svg>  </button> <dialog style="padding:0" aria-label="Search" class="astro-usz5hgcn"> <div class="dialog-frame sl-flex astro-usz5hgcn">  <button data-close-modal class="sl-flex md:sl-hidden astro-usz5hgcn"> Cancel </button> <div class="search-container astro-usz5hgcn"> <div id="starlight__search" class="astro-usz5hgcn"></div> </div> </div> </dialog> </site-search>    </div> <div class="sl-hidden md:sl-flex right-group astro-cyrhhlnw"> <div class="sl-flex social-icons astro-cyrhhlnw"> <a href="https://github.com/withastro/starlight" rel="me" class="sl-flex astro-3daxh4jc"><span class="sr-only astro-3daxh4jc">GitHub</span><svg aria-hidden="true" class="astro-3daxh4jc astro-xrndq6a6" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M12 .3a12 12 0 0 0-3.8 23.38c.6.12.83-.26.83-.57L9 21.07c-3.34.72-4.04-1.61-4.04-1.61-.55-1.39-1.34-1.76-1.34-1.76-1.08-.74.09-.73.09-.73 1.2.09 1.83 1.24 1.83 1.24 1.08 1.83 2.81 1.3 3.5 1 .1-.78.42-1.31.76-1.61-2.67-.3-5.47-1.33-5.47-5.93 0-1.31.47-2.38 1.24-3.22-.14-.3-.54-1.52.1-3.18 0 0 1-.32 3.3 1.23a11.5 11.5 0 0 1 6 0c2.28-1.55 3.29-1.23 3.29-1.23.64 1.66.24 2.88.12 3.18a4.65 4.65 0 0 1 1.23 3.22c0 4.61-2.8 5.63-5.48 5.92.42.36.81 1.1.81 2.22l-.01 3.29c0 .31.2.69.82.57A12 12 0 0 0 12 .3Z"/></svg> </a> </div> <starlight-theme-select>  <label style="--sl-select-width: 6.25em" class="astro-kc6u4lxd"> <span class="sr-only astro-kc6u4lxd">Select theme</span> <svg aria-hidden="true" class="icon label-icon astro-kc6u4lxd astro-xrndq6a6" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M21 14h-1V7a3 3 0 0 0-3-3H7a3 3 0 0 0-3 3v7H3a1 1 0 0 0-1 1v2a3 3 0 0 0 3 3h14a3 3 0 0 0 3-3v-2a1 1 0 0 0-1-1ZM6 7a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v7H6V7Zm14 10a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1v-1h16v1Z"/></svg>  <select value="auto" class="astro-kc6u4lxd"> <option value="dark" class="astro-kc6u4lxd">Dark</option><option value="light" class="astro-kc6u4lxd">Light</option><option value="auto" selected="true" class="astro-kc6u4lxd">Auto</option> </select> <svg aria-hidden="true" class="icon caret astro-kc6u4lxd astro-xrndq6a6" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M17 9.17a1 1 0 0 0-1.41 0L12 12.71 8.46 9.17a1 1 0 1 0-1.41 1.42l4.24 4.24a1.002 1.002 0 0 0 1.42 0L17 10.59a1.002 1.002 0 0 0 0-1.42Z"/></svg>  </label>  </starlight-theme-select>  <script>
	StarlightThemeProvider.updatePickers();
</script>   </div> </div> </header> <nav class="sidebar astro-yxqmbg7i" aria-label="Main"> <starlight-menu-button class="astro-eouth4v3"> <button aria-expanded="false" aria-label="Menu" aria-controls="starlight__sidebar" class="sl-flex md:sl-hidden astro-eouth4v3"> <svg aria-hidden="true" class="astro-eouth4v3 astro-xrndq6a6" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M3 8h18a1 1 0 1 0 0-2H3a1 1 0 0 0 0 2Zm18 8H3a1 1 0 0 0 0 2h18a1 1 0 0 0 0-2Zm0-5H3a1 1 0 0 0 0 2h18a1 1 0 0 0 0-2Z"/></svg>  </button> </starlight-menu-button>    <div id="starlight__sidebar" class="sidebar-pane astro-yxqmbg7i"> <div class="sidebar-content sl-flex astro-yxqmbg7i"> <ul class="top-level astro-4mcqxzkb"> <li class="astro-4mcqxzkb"> <details open class="astro-4mcqxzkb"> <summary class="astro-4mcqxzkb"> <div class="group-label astro-4mcqxzkb"> <span class="large astro-4mcqxzkb">PART I 基础部分 - 量化语境下的Rust编程基础</span>  </div> <svg aria-hidden="true" class="caret astro-4mcqxzkb astro-xrndq6a6" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.25rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg>  </summary> <ul class="astro-4mcqxzkb"> <li class="astro-4mcqxzkb"> <a href="/chapters/chapter_1" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">1. Rust 语言入门101</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_2/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">2. 格式化输出</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_3/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">3. 原生类型</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_4/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">4. 自定义类型 Struct &amp; Enum</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_5/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">5. 标准库类型</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_6/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">6. 变量和作用域</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_7/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">7. 类型系统</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_8/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">8. 类型转换</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_9/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">9. 流程控制</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_10/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">10. 函数、方法和闭包</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_11/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">11. 模块</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_12/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">12. Cargo 的进阶使用</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_13/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">13. 属性(Attributes)</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_14/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">14. 泛型进阶(Advanced Generic Type Usage)</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_15/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">15. 作用域规则和生命周期</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_16/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">16. 错误处理进阶(Advanced Error handling)</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_17/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">17. 特性(trait)详解</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_18/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">18. 创建自定义宏</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_19/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">19. 时间处理</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_20/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">20. Redis、爬虫、交易日库</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_21/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">21. 线程和管道</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_22/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">22. 文件处理</span>  </a> </li> </ul>  </details> </li><li class="astro-4mcqxzkb"> <details open class="astro-4mcqxzkb"> <summary class="astro-4mcqxzkb"> <div class="group-label astro-4mcqxzkb"> <span class="large astro-4mcqxzkb">PART II 进阶部分 - 量化实战</span>  </div> <svg aria-hidden="true" class="caret astro-4mcqxzkb astro-xrndq6a6" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.25rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg>  </summary> <ul class="astro-4mcqxzkb"> <li class="astro-4mcqxzkb"> <a href="/chapters/chapter_23/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">23. Polars 入门</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_24/" aria-current="page" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">24. 时序数据库 Clickhouse</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_25/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">25. Unsafe【未完成】</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_26/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">26. 文档和测试【未完成】</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_27/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">27. 常见技术指标及其实现【本章代码未添加】</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_28/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">28. 统计模型【未完成】</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_29/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">29. 引擎系统【未完成】</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_30/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">30. 日志系统【未完成】</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_31/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">31. 投资组合管理【未完成】</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_32/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">32. 量化计量经济学【未完成】</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_33/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">33. 限价指令簿【未完成】</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_34/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">34. 最优配置和执行【未完成】</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_35/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">35. 信息学、监管、风控【未完成】</span>  </a> </li><li class="astro-4mcqxzkb"> <a href="/chapters/chapter_36/" class="astro-4mcqxzkb"> <span class="astro-4mcqxzkb">36. 机器学习【未完成】</span>  </a> </li> </ul>  </details> </li> </ul>  <div class="md:sl-hidden"> <div class="mobile-preferences sl-flex astro-vfur2aw5"> <div class="sl-flex social-icons astro-vfur2aw5"> <a href="https://github.com/withastro/starlight" rel="me" class="sl-flex astro-3daxh4jc"><span class="sr-only astro-3daxh4jc">GitHub</span><svg aria-hidden="true" class="astro-3daxh4jc astro-xrndq6a6" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M12 .3a12 12 0 0 0-3.8 23.38c.6.12.83-.26.83-.57L9 21.07c-3.34.72-4.04-1.61-4.04-1.61-.55-1.39-1.34-1.76-1.34-1.76-1.08-.74.09-.73.09-.73 1.2.09 1.83 1.24 1.83 1.24 1.08 1.83 2.81 1.3 3.5 1 .1-.78.42-1.31.76-1.61-2.67-.3-5.47-1.33-5.47-5.93 0-1.31.47-2.38 1.24-3.22-.14-.3-.54-1.52.1-3.18 0 0 1-.32 3.3 1.23a11.5 11.5 0 0 1 6 0c2.28-1.55 3.29-1.23 3.29-1.23.64 1.66.24 2.88.12 3.18a4.65 4.65 0 0 1 1.23 3.22c0 4.61-2.8 5.63-5.48 5.92.42.36.81 1.1.81 2.22l-.01 3.29c0 .31.2.69.82.57A12 12 0 0 0 12 .3Z"/></svg> </a> </div> <starlight-theme-select>  <label style="--sl-select-width: 6.25em" class="astro-kc6u4lxd"> <span class="sr-only astro-kc6u4lxd">Select theme</span> <svg aria-hidden="true" class="icon label-icon astro-kc6u4lxd astro-xrndq6a6" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M21 14h-1V7a3 3 0 0 0-3-3H7a3 3 0 0 0-3 3v7H3a1 1 0 0 0-1 1v2a3 3 0 0 0 3 3h14a3 3 0 0 0 3-3v-2a1 1 0 0 0-1-1ZM6 7a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v7H6V7Zm14 10a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1v-1h16v1Z"/></svg>  <select value="auto" class="astro-kc6u4lxd"> <option value="dark" class="astro-kc6u4lxd">Dark</option><option value="light" class="astro-kc6u4lxd">Light</option><option value="auto" selected="true" class="astro-kc6u4lxd">Auto</option> </select> <svg aria-hidden="true" class="icon caret astro-kc6u4lxd astro-xrndq6a6" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M17 9.17a1 1 0 0 0-1.41 0L12 12.71 8.46 9.17a1 1 0 1 0-1.41 1.42l4.24 4.24a1.002 1.002 0 0 0 1.42 0L17 10.59a1.002 1.002 0 0 0 0-1.42Z"/></svg>  </label>  </starlight-theme-select>  <script>
	StarlightThemeProvider.updatePickers();
</script>   </div>  </div> </div> </div> </nav> <div class="main-frame astro-yxqmbg7i">  <div class="lg:sl-flex astro-3vvvt7cz"> <aside class="right-sidebar-container astro-3vvvt7cz"> <div class="right-sidebar astro-3vvvt7cz"> <div class="lg:sl-hidden astro-f63w33c6"><mobile-starlight-toc data-min-h="2" data-max-h="3" class="astro-q2mrqdva"><nav aria-labelledby="starlight__on-this-page--mobile" class="astro-q2mrqdva"><details id="starlight__mobile-toc" class="astro-q2mrqdva"><summary id="starlight__on-this-page--mobile" class="sl-flex astro-q2mrqdva"><div class="toggle sl-flex astro-q2mrqdva">On this page<svg aria-hidden="true" class="caret astro-q2mrqdva astro-xrndq6a6" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg> </div><span class="display-current astro-q2mrqdva"></span></summary><div class="dropdown astro-q2mrqdva"><ul class="isMobile astro-acifyk5h" style="--depth: 0;"> <li class="astro-acifyk5h" style="--depth: 0;"> <a href="#_top" class="astro-acifyk5h" style="--depth: 0;"> <span class="astro-acifyk5h" style="--depth: 0;">Overview</span> </a> <ul class="isMobile astro-acifyk5h" style="--depth: 1;"> <li class="astro-acifyk5h" style="--depth: 1;"> <a href="#241-安装和配置clickhouse数据库" class="astro-acifyk5h" style="--depth: 1;"> <span class="astro-acifyk5h" style="--depth: 1;">24.1 安装和配置ClickHouse数据库</span> </a>  </li><li class="astro-acifyk5h" style="--depth: 1;"> <a href="#2411-安装" class="astro-acifyk5h" style="--depth: 1;"> <span class="astro-acifyk5h" style="--depth: 1;">24.1.1 安装</span> </a>  </li><li class="astro-acifyk5h" style="--depth: 1;"> <a href="#242-clickhouse-for-rust-clickhousers库" class="astro-acifyk5h" style="--depth: 1;"> <span class="astro-acifyk5h" style="--depth: 1;">24.2 ClickHouse for Rust: clickhouse.rs库</span> </a>  </li><li class="astro-acifyk5h" style="--depth: 1;"> <a href="#243-备份-clickhouse-数据库的教程" class="astro-acifyk5h" style="--depth: 1;"> <span class="astro-acifyk5h" style="--depth: 1;">24.3 备份 ClickHouse 数据库的教程</span> </a>  </li><li class="astro-acifyk5h" style="--depth: 1;"> <a href="#244-关于clickhouse的优化" class="astro-acifyk5h" style="--depth: 1;"> <span class="astro-acifyk5h" style="--depth: 1;">24.4 关于Clickhouse的优化</span> </a>  </li><li class="astro-acifyk5h" style="--depth: 1;"> <a href="#案例1-通过rust脚本在clickhouse数据库中建表删表查询" class="astro-acifyk5h" style="--depth: 1;"> <span class="astro-acifyk5h" style="--depth: 1;">案例1 通过Rust脚本在Clickhouse数据库中建表、删表、查询</span> </a>  </li><li class="astro-acifyk5h" style="--depth: 1;"> <a href="#案例2-创建布林带表的-sql-脚本示例" class="astro-acifyk5h" style="--depth: 1;"> <span class="astro-acifyk5h" style="--depth: 1;">案例2 创建布林带表的 SQL 脚本示例</span> </a>  </li><li class="astro-acifyk5h" style="--depth: 1;"> <a href="#脚本解析" class="astro-acifyk5h" style="--depth: 1;"> <span class="astro-acifyk5h" style="--depth: 1;">脚本解析</span> </a>  </li><li class="astro-acifyk5h" style="--depth: 1;"> <a href="#案例与外部金融库的交互" class="astro-acifyk5h" style="--depth: 1;"> <span class="astro-acifyk5h" style="--depth: 1;">案例：与外部金融库的交互</span> </a>  </li><li class="astro-acifyk5h" style="--depth: 1;"> <a href="#案例高性能数值计算" class="astro-acifyk5h" style="--depth: 1;"> <span class="astro-acifyk5h" style="--depth: 1;">案例：高性能数值计算</span> </a>  </li> </ul>  </li><li class="astro-acifyk5h" style="--depth: 0;"> <a href="#261-文档注释" class="astro-acifyk5h" style="--depth: 0;"> <span class="astro-acifyk5h" style="--depth: 0;">26.1 文档注释</span> </a>  </li><li class="astro-acifyk5h" style="--depth: 0;"> <a href="#261-单元测试" class="astro-acifyk5h" style="--depth: 0;"> <span class="astro-acifyk5h" style="--depth: 0;">26.1 单元测试</span> </a>  </li><li class="astro-acifyk5h" style="--depth: 0;"> <a href="#262-文档测试" class="astro-acifyk5h" style="--depth: 0;"> <span class="astro-acifyk5h" style="--depth: 0;">26.2 文档测试</span> </a>  </li><li class="astro-acifyk5h" style="--depth: 0;"> <a href="#263-项目集成测试" class="astro-acifyk5h" style="--depth: 0;"> <span class="astro-acifyk5h" style="--depth: 0;">26.3 项目集成测试</span> </a> <ul class="isMobile astro-acifyk5h" style="--depth: 1;"> <li class="astro-acifyk5h" style="--depth: 1;"> <a href="#271-随机指标stochastic-oscillator" class="astro-acifyk5h" style="--depth: 1;"> <span class="astro-acifyk5h" style="--depth: 1;">27.1： 随机指标（Stochastic Oscillator）</span> </a>  </li><li class="astro-acifyk5h" style="--depth: 1;"> <a href="#272布林带bollinger-bands" class="astro-acifyk5h" style="--depth: 1;"> <span class="astro-acifyk5h" style="--depth: 1;">27.2：布林带（Bollinger Bands）</span> </a>  </li><li class="astro-acifyk5h" style="--depth: 1;"> <a href="#273macd指标moving-average-convergence-divergence" class="astro-acifyk5h" style="--depth: 1;"> <span class="astro-acifyk5h" style="--depth: 1;">27.3：MACD指标（Moving Average Convergence Divergence）</span> </a>  </li><li class="astro-acifyk5h" style="--depth: 1;"> <a href="#274adx指标average-directional-index" class="astro-acifyk5h" style="--depth: 1;"> <span class="astro-acifyk5h" style="--depth: 1;">27.4：ADX指标（Average Directional Index）</span> </a>  </li><li class="astro-acifyk5h" style="--depth: 1;"> <a href="#275-roc指标rate-of-change" class="astro-acifyk5h" style="--depth: 1;"> <span class="astro-acifyk5h" style="--depth: 1;">27.5 ：ROC指标（Rate of Change）</span> </a>  </li><li class="astro-acifyk5h" style="--depth: 1;"> <a href="#276cci指标commodity-channel-index" class="astro-acifyk5h" style="--depth: 1;"> <span class="astro-acifyk5h" style="--depth: 1;">27.6：CCI指标（Commodity Channel Index）</span> </a>  </li><li class="astro-acifyk5h" style="--depth: 1;"> <a href="#277fibonacci回调和扩展水平" class="astro-acifyk5h" style="--depth: 1;"> <span class="astro-acifyk5h" style="--depth: 1;">27.7：Fibonacci回调和扩展水平</span> </a>  </li><li class="astro-acifyk5h" style="--depth: 1;"> <a href="#278均线交叉策略" class="astro-acifyk5h" style="--depth: 1;"> <span class="astro-acifyk5h" style="--depth: 1;">27.8：均线交叉策略</span> </a>  </li><li class="astro-acifyk5h" style="--depth: 1;"> <a href="#279-ichimoku云" class="astro-acifyk5h" style="--depth: 1;"> <span class="astro-acifyk5h" style="--depth: 1;">27.9： Ichimoku云</span> </a>  </li><li class="astro-acifyk5h" style="--depth: 1;"> <a href="#2710威廉指标williams-r" class="astro-acifyk5h" style="--depth: 1;"> <span class="astro-acifyk5h" style="--depth: 1;">27.10：威廉指标（Williams %R）</span> </a>  </li><li class="astro-acifyk5h" style="--depth: 1;"> <a href="#2711均幅指标average-directional-movement-indexadx" class="astro-acifyk5h" style="--depth: 1;"> <span class="astro-acifyk5h" style="--depth: 1;">27.11：均幅指标（Average Directional Movement Index，ADX）</span> </a>  </li><li class="astro-acifyk5h" style="--depth: 1;"> <a href="#2712多重时间框架分析multiple-time-frame-analysis" class="astro-acifyk5h" style="--depth: 1;"> <span class="astro-acifyk5h" style="--depth: 1;">27.12：多重时间框架分析（Multiple Time Frame Analysis）</span> </a>  </li><li class="astro-acifyk5h" style="--depth: 1;"> <a href="#2713-指标的遴选和应用" class="astro-acifyk5h" style="--depth: 1;"> <span class="astro-acifyk5h" style="--depth: 1;">27.13 指标的遴选和应用</span> </a>  </li> </ul>  </li> </ul> </div></details></nav></mobile-starlight-toc></div><div class="right-sidebar-panel sl-hidden lg:sl-block astro-f63w33c6"><div class="sl-container astro-f63w33c6"><starlight-toc data-min-h="2" data-max-h="3"><nav aria-labelledby="starlight__on-this-page"><h2 id="starlight__on-this-page">On this page</h2><ul class="astro-acifyk5h" style="--depth: 0;"> <li class="astro-acifyk5h" style="--depth: 0;"> <a href="#_top" class="astro-acifyk5h" style="--depth: 0;"> <span class="astro-acifyk5h" style="--depth: 0;">Overview</span> </a> <ul class="astro-acifyk5h" style="--depth: 1;"> <li class="astro-acifyk5h" style="--depth: 1;"> <a href="#241-安装和配置clickhouse数据库" class="astro-acifyk5h" style="--depth: 1;"> <span class="astro-acifyk5h" style="--depth: 1;">24.1 安装和配置ClickHouse数据库</span> </a>  </li><li class="astro-acifyk5h" style="--depth: 1;"> <a href="#2411-安装" class="astro-acifyk5h" style="--depth: 1;"> <span class="astro-acifyk5h" style="--depth: 1;">24.1.1 安装</span> </a>  </li><li class="astro-acifyk5h" style="--depth: 1;"> <a href="#242-clickhouse-for-rust-clickhousers库" class="astro-acifyk5h" style="--depth: 1;"> <span class="astro-acifyk5h" style="--depth: 1;">24.2 ClickHouse for Rust: clickhouse.rs库</span> </a>  </li><li class="astro-acifyk5h" style="--depth: 1;"> <a href="#243-备份-clickhouse-数据库的教程" class="astro-acifyk5h" style="--depth: 1;"> <span class="astro-acifyk5h" style="--depth: 1;">24.3 备份 ClickHouse 数据库的教程</span> </a>  </li><li class="astro-acifyk5h" style="--depth: 1;"> <a href="#244-关于clickhouse的优化" class="astro-acifyk5h" style="--depth: 1;"> <span class="astro-acifyk5h" style="--depth: 1;">24.4 关于Clickhouse的优化</span> </a>  </li><li class="astro-acifyk5h" style="--depth: 1;"> <a href="#案例1-通过rust脚本在clickhouse数据库中建表删表查询" class="astro-acifyk5h" style="--depth: 1;"> <span class="astro-acifyk5h" style="--depth: 1;">案例1 通过Rust脚本在Clickhouse数据库中建表、删表、查询</span> </a>  </li><li class="astro-acifyk5h" style="--depth: 1;"> <a href="#案例2-创建布林带表的-sql-脚本示例" class="astro-acifyk5h" style="--depth: 1;"> <span class="astro-acifyk5h" style="--depth: 1;">案例2 创建布林带表的 SQL 脚本示例</span> </a>  </li><li class="astro-acifyk5h" style="--depth: 1;"> <a href="#脚本解析" class="astro-acifyk5h" style="--depth: 1;"> <span class="astro-acifyk5h" style="--depth: 1;">脚本解析</span> </a>  </li><li class="astro-acifyk5h" style="--depth: 1;"> <a href="#案例与外部金融库的交互" class="astro-acifyk5h" style="--depth: 1;"> <span class="astro-acifyk5h" style="--depth: 1;">案例：与外部金融库的交互</span> </a>  </li><li class="astro-acifyk5h" style="--depth: 1;"> <a href="#案例高性能数值计算" class="astro-acifyk5h" style="--depth: 1;"> <span class="astro-acifyk5h" style="--depth: 1;">案例：高性能数值计算</span> </a>  </li> </ul>  </li><li class="astro-acifyk5h" style="--depth: 0;"> <a href="#261-文档注释" class="astro-acifyk5h" style="--depth: 0;"> <span class="astro-acifyk5h" style="--depth: 0;">26.1 文档注释</span> </a>  </li><li class="astro-acifyk5h" style="--depth: 0;"> <a href="#261-单元测试" class="astro-acifyk5h" style="--depth: 0;"> <span class="astro-acifyk5h" style="--depth: 0;">26.1 单元测试</span> </a>  </li><li class="astro-acifyk5h" style="--depth: 0;"> <a href="#262-文档测试" class="astro-acifyk5h" style="--depth: 0;"> <span class="astro-acifyk5h" style="--depth: 0;">26.2 文档测试</span> </a>  </li><li class="astro-acifyk5h" style="--depth: 0;"> <a href="#263-项目集成测试" class="astro-acifyk5h" style="--depth: 0;"> <span class="astro-acifyk5h" style="--depth: 0;">26.3 项目集成测试</span> </a> <ul class="astro-acifyk5h" style="--depth: 1;"> <li class="astro-acifyk5h" style="--depth: 1;"> <a href="#271-随机指标stochastic-oscillator" class="astro-acifyk5h" style="--depth: 1;"> <span class="astro-acifyk5h" style="--depth: 1;">27.1： 随机指标（Stochastic Oscillator）</span> </a>  </li><li class="astro-acifyk5h" style="--depth: 1;"> <a href="#272布林带bollinger-bands" class="astro-acifyk5h" style="--depth: 1;"> <span class="astro-acifyk5h" style="--depth: 1;">27.2：布林带（Bollinger Bands）</span> </a>  </li><li class="astro-acifyk5h" style="--depth: 1;"> <a href="#273macd指标moving-average-convergence-divergence" class="astro-acifyk5h" style="--depth: 1;"> <span class="astro-acifyk5h" style="--depth: 1;">27.3：MACD指标（Moving Average Convergence Divergence）</span> </a>  </li><li class="astro-acifyk5h" style="--depth: 1;"> <a href="#274adx指标average-directional-index" class="astro-acifyk5h" style="--depth: 1;"> <span class="astro-acifyk5h" style="--depth: 1;">27.4：ADX指标（Average Directional Index）</span> </a>  </li><li class="astro-acifyk5h" style="--depth: 1;"> <a href="#275-roc指标rate-of-change" class="astro-acifyk5h" style="--depth: 1;"> <span class="astro-acifyk5h" style="--depth: 1;">27.5 ：ROC指标（Rate of Change）</span> </a>  </li><li class="astro-acifyk5h" style="--depth: 1;"> <a href="#276cci指标commodity-channel-index" class="astro-acifyk5h" style="--depth: 1;"> <span class="astro-acifyk5h" style="--depth: 1;">27.6：CCI指标（Commodity Channel Index）</span> </a>  </li><li class="astro-acifyk5h" style="--depth: 1;"> <a href="#277fibonacci回调和扩展水平" class="astro-acifyk5h" style="--depth: 1;"> <span class="astro-acifyk5h" style="--depth: 1;">27.7：Fibonacci回调和扩展水平</span> </a>  </li><li class="astro-acifyk5h" style="--depth: 1;"> <a href="#278均线交叉策略" class="astro-acifyk5h" style="--depth: 1;"> <span class="astro-acifyk5h" style="--depth: 1;">27.8：均线交叉策略</span> </a>  </li><li class="astro-acifyk5h" style="--depth: 1;"> <a href="#279-ichimoku云" class="astro-acifyk5h" style="--depth: 1;"> <span class="astro-acifyk5h" style="--depth: 1;">27.9： Ichimoku云</span> </a>  </li><li class="astro-acifyk5h" style="--depth: 1;"> <a href="#2710威廉指标williams-r" class="astro-acifyk5h" style="--depth: 1;"> <span class="astro-acifyk5h" style="--depth: 1;">27.10：威廉指标（Williams %R）</span> </a>  </li><li class="astro-acifyk5h" style="--depth: 1;"> <a href="#2711均幅指标average-directional-movement-indexadx" class="astro-acifyk5h" style="--depth: 1;"> <span class="astro-acifyk5h" style="--depth: 1;">27.11：均幅指标（Average Directional Movement Index，ADX）</span> </a>  </li><li class="astro-acifyk5h" style="--depth: 1;"> <a href="#2712多重时间框架分析multiple-time-frame-analysis" class="astro-acifyk5h" style="--depth: 1;"> <span class="astro-acifyk5h" style="--depth: 1;">27.12：多重时间框架分析（Multiple Time Frame Analysis）</span> </a>  </li><li class="astro-acifyk5h" style="--depth: 1;"> <a href="#2713-指标的遴选和应用" class="astro-acifyk5h" style="--depth: 1;"> <span class="astro-acifyk5h" style="--depth: 1;">27.13 指标的遴选和应用</span> </a>  </li> </ul>  </li> </ul> </nav></starlight-toc></div></div> </div> </aside> <div class="main-pane astro-3vvvt7cz">  <main data-pagefind-body lang="en" dir="ltr" class="astro-fpze62lo">    <div class="content-panel astro-vo2eo5fg"> <div class="sl-container astro-vo2eo5fg"> <h1 id="_top" class="astro-daoses2n">时序数据库 Clickhouse</h1>  </div> </div>  <div class="content-panel astro-vo2eo5fg"> <div class="sl-container astro-vo2eo5fg"> <div class="sl-markdown-content"> <p><code dir="auto">ClickHouse</code> 是一个开源的列式时序数据库管理系统（DBMS），专为高性能和低延迟的数据分析而设计。它最初由俄罗斯的互联网公司 <code dir="auto">Yandex</code> 开发，用于处理海量的数据分析工作负载。以下是 <code dir="auto">ClickHouse</code> 的主要特点和介绍：</p>
<ol>
<li>
<p><strong>列式存储</strong>：ClickHouse 采用列式存储，这意味着它将数据按列存储在磁盘上，而不是按行存储。这种存储方式对于数据分析非常高效，因为它允许查询只读取所需的列，而不必读取整个行。这导致了更快的查询性能和更小的存储空间占用。</p>
</li>
<li>
<p><strong>分布式架构</strong>：ClickHouse 具有分布式架构，可以轻松扩展以处理大规模数据集。它支持数据分片、分布式复制和负载均衡，以确保高可用性和容错性。</p>
</li>
<li>
<p><strong>支持 SQL 查询</strong>：ClickHouse 支持标准的 SQL 查询语言，使用户可以使用熟悉的查询语法执行数据分析操作。它还支持复杂的查询，如聚合、窗口函数和子查询。</p>
</li>
<li>
<p><strong>高性能</strong>：ClickHouse 以查询性能和吞吐量为重点进行了优化。它专为快速的数据分析查询而设计，可以在毫秒级别内处理数十亿行的数据。</p>
</li>
<li>
<p><strong>实时数据注入</strong>：ClickHouse 支持实时数据注入，允许将新数据迅速插入到表中，并能够在不停机的情况下进行数据更新。</p>
</li>
<li>
<p><strong>支持多种数据格式</strong>：ClickHouse 可以处理多种数据格式，包括 JSON、CSV、Parquet 等，使其能够与各种数据源无缝集成。</p>
</li>
<li>
<p><strong>可扩展性</strong>：ClickHouse 具有可扩展性，可以与其他工具和框架（如 Apache Kafka、Spark、Presto）集成，以满足各种数据处理需求。</p>
</li>
<li>
<p><strong>开源和活跃的社区</strong>：ClickHouse 是一个开源项目，拥有活跃的社区支持。这意味着你可以免费获取并使用它，并且有一个庞大的开发者社区，提供了大量的文档和资源。</p>
</li>
</ol>
<p>ClickHouse 在大数据分析、日志处理、事件追踪、时序数据分析等场景中得到了广泛的应用。它的高性能、可扩展性和强大的查询功能使其成为处理大规模数据的理想选择。如果你需要处理大量时序数据并进行快速数据分析，那么 ClickHouse 可能是一个非常有价值的数据库管理系统。</p>
<h3 id="241-安装和配置clickhouse数据库">24.1 安装和配置ClickHouse数据库</h3>
<h3 id="2411-安装">24.1.1 安装</h3>
<h4 id="在ubuntu上安装clickhouse">在Ubuntu上安装ClickHouse</h4>
<ol>
<li>
<p>打开终端并更新包列表：</p>
<div class="expressive-code"><link rel="stylesheet" href="/_astro/ec.usa2f.css"><script type="module" src="/_astro/ec.sgewm.js"></script><figure class="frame is-terminal not-content"><figcaption class="header"><span class="title"></span><span class="sr-only">Terminal window</span></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#82AAFF;--1:#3C63B3">sudo</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">apt</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">update</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="sudo apt update"><div></div></button></div></figure></div>
</li>
<li>
<p>安装ClickHouse的APT存储库：</p>
<div class="expressive-code"><figure class="frame is-terminal not-content"><figcaption class="header"><span class="title"></span><span class="sr-only">Terminal window</span></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#82AAFF;--1:#3C63B3">sudo</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">apt</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">install</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">apt-transport-https</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">ca-certificates</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">dirmngr</span></div><div class="ec-line"><span style="--0:#82AAFF;--1:#3C63B3">sudo</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">apt-key</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">adv</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">--keyserver</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">hkp://keyserver.ubuntu.com:80</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">--recv</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">E0C56BD4</span></div><div class="ec-line"><span style="--0:#C5E478;--1:#3C63B3">echo</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">deb https://repo.clickhouse.tech/deb/stable/ main/</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#097174">|</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">sudo</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">tee</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">/etc/apt/sources.list.d/clickhouse.list</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="sudo apt install apt-transport-https ca-certificates dirmngrsudo apt-key adv --keyserver hkp://keyserver.ubuntu.com:80 --recv E0C56BD4echo &#x22;deb https://repo.clickhouse.tech/deb/stable/ main/&#x22; | sudo tee /etc/apt/sources.list.d/clickhouse.list"><div></div></button></div></figure></div>
</li>
<li>
<p>再次更新包列表以获取ClickHouse包：</p>
<div class="expressive-code"><figure class="frame is-terminal not-content"><figcaption class="header"><span class="title"></span><span class="sr-only">Terminal window</span></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#82AAFF;--1:#3C63B3">sudo</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">apt</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">update</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="sudo apt update"><div></div></button></div></figure></div>
</li>
<li>
<p>安装ClickHouse Server：</p>
<div class="expressive-code"><figure class="frame is-terminal not-content"><figcaption class="header"><span class="title"></span><span class="sr-only">Terminal window</span></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#82AAFF;--1:#3C63B3">sudo</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">apt</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">install</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">clickhouse-server</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="sudo apt install clickhouse-server"><div></div></button></div></figure></div>
</li>
<li>
<p>启动ClickHouse服务：</p>
<div class="expressive-code"><figure class="frame is-terminal not-content"><figcaption class="header"><span class="title"></span><span class="sr-only">Terminal window</span></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#82AAFF;--1:#3C63B3">sudo</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">service</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">clickhouse-server</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">start</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="sudo service clickhouse-server start"><div></div></button></div></figure></div>
</li>
<li>
<p>我们可以使用以下命令检查ClickHouse服务器的状态：</p>
<div class="expressive-code"><figure class="frame is-terminal not-content"><figcaption class="header"><span class="title"></span><span class="sr-only">Terminal window</span></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#82AAFF;--1:#3C63B3">sudo</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">service</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">clickhouse-server</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">status</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="sudo service clickhouse-server status"><div></div></button></div></figure></div>
</li>
</ol>
<h4 id="在manjaro--arch-linux上安装clickhouse">在Manjaro / Arch Linux上安装ClickHouse</h4>
<ol>
<li>
<p>打开终端并使用以下命令安装ClickHouse：</p>
<div class="expressive-code"><figure class="frame is-terminal not-content"><figcaption class="header"><span class="title"></span><span class="sr-only">Terminal window</span></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#82AAFF;--1:#3C63B3">sudo</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">pacman</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">-S</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">clickhouse</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="sudo pacman -S clickhouse"><div></div></button></div></figure></div>
</li>
<li>
<p>启动ClickHouse服务：</p>
<div class="expressive-code"><figure class="frame is-terminal not-content"><figcaption class="header"><span class="title"></span><span class="sr-only">Terminal window</span></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#82AAFF;--1:#3C63B3">sudo</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">systemctl</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">start</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">clickhouse-server</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="sudo systemctl start clickhouse-server"><div></div></button></div></figure></div>
</li>
<li>
<p>我们可以使用以下命令检查ClickHouse服务器的状态：</p>
<div class="expressive-code"><figure class="frame is-terminal not-content"><figcaption class="header"><span class="title"></span><span class="sr-only">Terminal window</span></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#82AAFF;--1:#3C63B3">sudo</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">systemctl</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">status</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">clickhouse-server</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="sudo systemctl status clickhouse-server"><div></div></button></div></figure></div>
</li>
</ol>
<p>这样ClickHouse就已经安装在你的Ubuntu或Arch Linux系统上了，并且服务已启动。</p>
<p>此时如果我们如果访问本地host上的这个网址：<a href="http://localhost:8123">http://localhost:8123</a> ，会看到服务器返回了一个’Ok’给我们。</p>
<h4 id="2412-配置clickhouse的密码">24.1.2 配置clickhouse的密码</h4>
<p>还是不要忘记，生产环境中安全是至关重要的，在ClickHouse中配置密码需要完成以下步骤：</p>
<ol>
<li>
<p><strong>创建用户和设置密码</strong>：
首先，我们需要登录到ClickHouse服务器上，并使用管理员权限创建用户并设置密码。我们可以使用ClickHouse客户端或者通过在配置文件中执行SQL来完成这一步骤。</p>
<p>使用ClickHouse客户端：</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">CREATE</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">USER</span><span style="--0:#D6DEEB;--1:#403F53"> '</span><span style="--0:#82AAFF;--1:#3C63B3">your_username</span><span style="--0:#D6DEEB;--1:#403F53">' IDENTIFIED </span><span style="--0:#C792EA;--1:#8D46B4">BY</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#ECC48D;--1:#9B504E">your_password</span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="CREATE USER &#x27;your_username&#x27; IDENTIFIED BY &#x27;your_password&#x27;;"><div></div></button></div></figure></div>
<p>请将 <code dir="auto">'your_username'</code> 替换为我们要创建的用户名，将 <code dir="auto">'your_password'</code> 替换为用户的密码。</p>
</li>
<li>
<p><strong>分配权限</strong>：
创建用户后，需要分配相应的权限。通常，我们可以使用<code dir="auto">GRANT</code>语句来为用户分配权限。以下是一个示例，将允许用户对特定表执行SELECT操作：</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">GRANT</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">SELECT</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">ON</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">database_name</span><span style="--0:#D6DEEB;--1:#403F53">.</span><span style="--0:#82AAFF;--1:#3C63B3">table_name</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">TO</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#ECC48D;--1:#9B504E">your_username</span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="GRANT SELECT ON database_name.table_name TO &#x27;your_username&#x27;;"><div></div></button></div></figure></div>
<p>这将授予 <code dir="auto">'your_username'</code> 用户对 <code dir="auto">'database_name.table_name'</code> 表的SELECT权限。我们可以根据需要为用户分配不同的权限。</p>
</li>
<li>
<p><strong>配置ClickHouse服务</strong>：
接下来，我们需要配置ClickHouse服务器以启用身份验证。在ClickHouse的配置文件中，找到并编辑<code dir="auto">users.xml</code>文件。通常，该文件的位置是<code dir="auto">/etc/clickhouse-server/users.xml</code>。在该文件中，我们可以为刚刚创建的用户添加相应的配置。</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--1:#8D46B4"><span style="--0:#7FDBCA">&#x3C;</span><span style="--0:#CAECE6">yandex</span><span style="--0:#7FDBCA">></span></span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--1:#8D46B4"><span style="--0:#7FDBCA">&#x3C;</span><span style="--0:#CAECE6">profiles</span><span style="--0:#7FDBCA">></span></span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        </span><span style="--0:#809191;--1:#616671">&#x3C;!-- 添加用户配置 --></span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        </span><span style="--1:#8D46B4"><span style="--0:#7FDBCA">&#x3C;</span><span style="--0:#CAECE6">your_username</span><span style="--0:#7FDBCA">></span></span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">            </span><span style="--1:#8D46B4"><span style="--0:#7FDBCA">&#x3C;</span><span style="--0:#CAECE6">password</span><span style="--0:#7FDBCA">></span></span><span style="--0:#D6DEEB;--1:#403F53">your_password</span><span style="--1:#8D46B4"><span style="--0:#7FDBCA">&#x3C;/</span><span style="--0:#CAECE6">password</span><span style="--0:#7FDBCA">></span></span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">            </span><span style="--1:#8D46B4"><span style="--0:#7FDBCA">&#x3C;</span><span style="--0:#CAECE6">networks</span><span style="--0:#7FDBCA">></span></span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">                </span><span style="--1:#8D46B4"><span style="--0:#7FDBCA">&#x3C;</span><span style="--0:#CAECE6">ip</span><span style="--0:#7FDBCA">></span></span><span style="--0:#D6DEEB;--1:#403F53">::/0</span><span style="--1:#8D46B4"><span style="--0:#7FDBCA">&#x3C;/</span><span style="--0:#CAECE6">ip</span><span style="--0:#7FDBCA">></span></span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#809191;--1:#616671">&#x3C;!-- 允许所有IP连接 --></span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">            </span><span style="--1:#8D46B4"><span style="--0:#7FDBCA">&#x3C;/</span><span style="--0:#CAECE6">networks</span><span style="--0:#7FDBCA">></span></span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        </span><span style="--1:#8D46B4"><span style="--0:#7FDBCA">&#x3C;/</span><span style="--0:#CAECE6">your_username</span><span style="--0:#7FDBCA">></span></span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--1:#8D46B4"><span style="--0:#7FDBCA">&#x3C;/</span><span style="--0:#CAECE6">profiles</span><span style="--0:#7FDBCA">></span></span></div><div class="ec-line"><span style="--1:#8D46B4"><span style="--0:#7FDBCA">&#x3C;/</span><span style="--0:#CAECE6">yandex</span><span style="--0:#7FDBCA">></span></span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="<yandex>    <profiles>        <!-- 添加用户配置 -->        <your_username>            <password>your_password</password>            <networks>                <ip>::/0</ip> <!-- 允许所有IP连接 -->            </networks>        </your_username>    </profiles></yandex>"><div></div></button></div></figure></div>
<p>请注意，这只是一个示例配置，我们需要将 <code dir="auto">'your_username'</code> 和 <code dir="auto">'your_password'</code> 替换为实际的用户名和密码。此外，上述配置允许来自所有IP地址的连接，这可能不是最安全的配置。我们可以根据需要限制连接的IP地址范围。</p>
</li>
<li>
<p><strong>重启ClickHouse服务</strong>：
最后，重新启动ClickHouse服务器以使配置更改生效：</p>
<div class="expressive-code"><figure class="frame is-terminal not-content"><figcaption class="header"><span class="title"></span><span class="sr-only">Terminal window</span></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#82AAFF;--1:#3C63B3">sudo</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">systemctl</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">restart</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">clickhouse-server</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="sudo systemctl restart clickhouse-server"><div></div></button></div></figure></div>
<p>这会重新加载配置文件并应用新的用户和权限设置。</p>
</li>
</ol>
<p>完成上述步骤后，我们的ClickHouse服务器将配置了用户名和密码的身份验证机制，并且只有具有正确凭据的用户才能访问相应的数据库和表。请确保密码强度足够，以增强安全性。</p>
<h3 id="242-clickhouse-for-rust-clickhousers库">24.2 ClickHouse for Rust: clickhouse.rs库</h3>
<p><code dir="auto">clickhouse.rs</code> 是一个网友 Paul Loyd 开发的比较成熟的第三方 Rust 库，旨在与 ClickHouse 数据库进行交互，提供了便捷的查询执行、数据处理和连接管理功能。以下是该库的一些主要特点：</p>
<h4 id="主要特点">主要特点</h4>
<ol>
<li><strong>异步支持</strong>：<code dir="auto">clickhouse.rs</code> 利用了 Rust 的异步编程能力，非常适合需要非阻塞数据库操作的高性能应用程序。</li>
<li><strong>类型化接口</strong>：该库提供了强类型接口，使数据库交互更加安全和可预测，减少运行时错误并提高代码的健壮性。</li>
<li><strong>支持 ClickHouse 特性</strong>：库支持多种 ClickHouse 特性，包括批量插入、复杂查询和不同的数据类型。</li>
<li><strong>连接池</strong>：<code dir="auto">clickhouse.rs</code> 包含连接池功能，在高负载场景下实现高效的数据库连接管理。</li>
<li><strong>易用性</strong>：该库设计简洁明了的 API，使各级 Rust 开发者都能轻松上手。</li>
</ol>
<h4 id="安装">安装</h4>
<p>要使用 <code dir="auto">clickhouse.rs</code>，需要在 <code dir="auto">Cargo.toml</code> 中添加依赖项：</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">[dependencies]</span></div><div class="ec-line"><span style="--0:#C5E478;--1:#3C63B3">clickhouse</span><span style="--0:#D6DEEB;--1:#403F53"> = </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">0.11</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">  </span><span style="--0:#809191;--1:#616671"># 请确保使用最新版本</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="[dependencies]clickhouse = &#x22;0.11&#x22;  # 请确保使用最新版本"><div></div></button></div></figure></div>
<h4 id="基本用法">基本用法</h4>
<p>以下是使用 <code dir="auto">clickhouse.rs</code> 连接 ClickHouse 数据库并执行查询的简单示例：</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">use</span><span style="--0:#D6DEEB;--1:#403F53"> clickhouse</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#D6DEEB;--1:#403F53">{Client, Row};</span></div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">use</span><span style="--0:#D6DEEB;--1:#403F53"> futures</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#D6DEEB;--1:#403F53">stream</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#D6DEEB;--1:#403F53">StreamExt;</span></div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">use</span><span style="--0:#D6DEEB;--1:#403F53"> tokio;</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">#[tokio</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#D6DEEB;--1:#403F53">main]</span></div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">async</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">fn</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">main</span><span style="--0:#D6DEEB;--1:#403F53">() {</span></div><div class="ec-line"><span style="--0:#809191;--1:#5E6578">    // 初始化客户端</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">client</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> Client</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#82AAFF;--1:#3C63B3">default</span><span style="--0:#D6DEEB;--1:#403F53">()</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        </span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">with_url</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">http://localhost:8123</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">)</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        </span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">with_database</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">default</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#809191;--1:#5E6578">    // 执行查询示例</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">mut</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">cursor</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">client</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">query</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">SELECT number FROM system.numbers LIMIT 10</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">)</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">fetch</span><span style="--0:#D6DEEB;--1:#403F53">()</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">unwrap</span><span style="--0:#D6DEEB;--1:#403F53">();</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">while</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> Some(</span><span style="--0:#C5E478;--1:#3C63B3">row</span><span style="--0:#D6DEEB;--1:#403F53">) </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">cursor</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">next</span><span style="--0:#D6DEEB;--1:#403F53">()</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#C792EA;--1:#8D46B4">await</span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">number</span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#D6DEEB;--1:#403F53"> u64 </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">row</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">unwrap</span><span style="--0:#D6DEEB;--1:#403F53">()</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">get</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">number</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">)</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">unwrap</span><span style="--0:#D6DEEB;--1:#403F53">();</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        </span><span style="--0:#82AAFF;--1:#3C63B3">println!</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">{}</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#C5E478;--1:#3C63B3">number</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    }</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">}</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="use clickhouse::{Client, Row};use futures::stream::StreamExt;use tokio;#[tokio::main]async fn main() {    // 初始化客户端    let client = Client::default()        .with_url(&#x22;http://localhost:8123&#x22;)        .with_database(&#x22;default&#x22;);    // 执行查询示例    let mut cursor = client.query(&#x22;SELECT number FROM system.numbers LIMIT 10&#x22;).fetch().unwrap();    while let Some(row) = cursor.next().await {        let number: u64 = row.unwrap().get(&#x22;number&#x22;).unwrap();        println!(&#x22;{}&#x22;, number);    }}"><div></div></button></div></figure></div>
<h4 id="错误处理">错误处理</h4>
<p>该库使用标准的 Rust 错误处理机制，使得管理潜在问题变得简单。以下是处理查询执行错误的示例：</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">use</span><span style="--0:#D6DEEB;--1:#403F53"> clickhouse</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#D6DEEB;--1:#403F53">{Client, Error};</span></div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">use</span><span style="--0:#D6DEEB;--1:#403F53"> tokio;</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">#[tokio</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#D6DEEB;--1:#403F53">main]</span></div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">async</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">fn</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">main</span><span style="--0:#D6DEEB;--1:#403F53">() </span><span style="--0:#7FDBCA;--1:#097174">-></span><span style="--0:#D6DEEB;--1:#403F53"> Result&#x3C;(), Error> {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">client</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> Client</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#82AAFF;--1:#3C63B3">default</span><span style="--0:#D6DEEB;--1:#403F53">()</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">with_url</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">http://localhost:8123</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">result</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">client</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">query</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">SELECT number FROM system.numbers LIMIT 10</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">)</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        </span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">fetch</span><span style="--0:#D6DEEB;--1:#403F53">()</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        </span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#C792EA;--1:#8D46B4">await</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">match</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">result</span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        Ok(</span><span style="--0:#C792EA;--1:#8D46B4">mut</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">cursor</span><span style="--0:#D6DEEB;--1:#403F53">) </span><span style="--0:#7FDBCA;--1:#097174">=></span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">            </span><span style="--0:#C792EA;--1:#8D46B4">while</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> Some(</span><span style="--0:#C5E478;--1:#3C63B3">row</span><span style="--0:#D6DEEB;--1:#403F53">) </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">cursor</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">next</span><span style="--0:#D6DEEB;--1:#403F53">()</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#C792EA;--1:#8D46B4">await</span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">                </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">number</span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#D6DEEB;--1:#403F53"> u64 </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">row</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">unwrap</span><span style="--0:#D6DEEB;--1:#403F53">()</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">get</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">number</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">)</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">unwrap</span><span style="--0:#D6DEEB;--1:#403F53">();</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">                </span><span style="--0:#82AAFF;--1:#3C63B3">println!</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">{}</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#C5E478;--1:#3C63B3">number</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">            }</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        }</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        Err(</span><span style="--0:#C5E478;--1:#3C63B3">e</span><span style="--0:#D6DEEB;--1:#403F53">) </span><span style="--0:#7FDBCA;--1:#097174">=></span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">eprintln!</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">查询执行错误: {:?}</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#C5E478;--1:#3C63B3">e</span><span style="--0:#D6DEEB;--1:#403F53">),</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    }</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    Ok(())</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">}</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="use clickhouse::{Client, Error};use tokio;#[tokio::main]async fn main() -> Result<(), Error> {    let client = Client::default().with_url(&#x22;http://localhost:8123&#x22;);    let result = client.query(&#x22;SELECT number FROM system.numbers LIMIT 10&#x22;)        .fetch()        .await;    match result {        Ok(mut cursor) => {            while let Some(row) = cursor.next().await {                let number: u64 = row.unwrap().get(&#x22;number&#x22;).unwrap();                println!(&#x22;{}&#x22;, number);            }        }        Err(e) => eprintln!(&#x22;查询执行错误: {:?}&#x22;, e),    }    Ok(())}"><div></div></button></div></figure></div>
<h4 id="高级用法">高级用法</h4>
<p>对于批量插入或处理特定数据类型等复杂场景，请参阅库的文档和示例。该库支持多种 ClickHouse 特性，可以适应各种使用场景。</p>
<h3 id="243-备份-clickhouse-数据库的教程">24.3 备份 ClickHouse 数据库的教程</h3>
<p>备份 ClickHouse 数据库对于数据安全和业务连续性至关重要。通过定期备份，可以在数据丢失、硬件故障或人为错误时快速恢复，确保数据完整性和可用性。此外，备份有助于在系统升级或迁移过程中保护数据，避免意外损失。备份还支持增量备份和压缩，优化存储空间和备份速度，为企业提供灵活、高效的数据管理解决方案。通过良好的备份策略，可以大大降低数据丢失风险，保障业务稳定运行。</p>
<h4 id="配置备份目的地">配置备份目的地</h4>
<p>首先，在 <code dir="auto">/etc/clickhouse-server/config.d/backup_disk.xml</code> 中添加备份目的地配置：</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--1:#8D46B4"><span style="--0:#7FDBCA">&#x3C;</span><span style="--0:#CAECE6">clickhouse</span><span style="--0:#7FDBCA">></span></span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--1:#8D46B4"><span style="--0:#7FDBCA">&#x3C;</span><span style="--0:#CAECE6">storage_configuration</span><span style="--0:#7FDBCA">></span></span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        </span><span style="--1:#8D46B4"><span style="--0:#7FDBCA">&#x3C;</span><span style="--0:#CAECE6">disks</span><span style="--0:#7FDBCA">></span></span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">            </span><span style="--1:#8D46B4"><span style="--0:#7FDBCA">&#x3C;</span><span style="--0:#CAECE6">backups</span><span style="--0:#7FDBCA">></span></span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">                </span><span style="--1:#8D46B4"><span style="--0:#7FDBCA">&#x3C;</span><span style="--0:#CAECE6">type</span><span style="--0:#7FDBCA">></span></span><span style="--0:#D6DEEB;--1:#403F53">local</span><span style="--1:#8D46B4"><span style="--0:#7FDBCA">&#x3C;/</span><span style="--0:#CAECE6">type</span><span style="--0:#7FDBCA">></span></span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">                </span><span style="--1:#8D46B4"><span style="--0:#7FDBCA">&#x3C;</span><span style="--0:#CAECE6">path</span><span style="--0:#7FDBCA">></span></span><span style="--0:#D6DEEB;--1:#403F53">/backups/</span><span style="--1:#8D46B4"><span style="--0:#7FDBCA">&#x3C;/</span><span style="--0:#CAECE6">path</span><span style="--0:#7FDBCA">></span></span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">            </span><span style="--1:#8D46B4"><span style="--0:#7FDBCA">&#x3C;/</span><span style="--0:#CAECE6">backups</span><span style="--0:#7FDBCA">></span></span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        </span><span style="--1:#8D46B4"><span style="--0:#7FDBCA">&#x3C;/</span><span style="--0:#CAECE6">disks</span><span style="--0:#7FDBCA">></span></span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--1:#8D46B4"><span style="--0:#7FDBCA">&#x3C;/</span><span style="--0:#CAECE6">storage_configuration</span><span style="--0:#7FDBCA">></span></span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--1:#8D46B4"><span style="--0:#7FDBCA">&#x3C;</span><span style="--0:#CAECE6">backups</span><span style="--0:#7FDBCA">></span></span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        </span><span style="--1:#8D46B4"><span style="--0:#7FDBCA">&#x3C;</span><span style="--0:#CAECE6">allowed_disk</span><span style="--0:#7FDBCA">></span></span><span style="--0:#D6DEEB;--1:#403F53">backups</span><span style="--1:#8D46B4"><span style="--0:#7FDBCA">&#x3C;/</span><span style="--0:#CAECE6">allowed_disk</span><span style="--0:#7FDBCA">></span></span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        </span><span style="--1:#8D46B4"><span style="--0:#7FDBCA">&#x3C;</span><span style="--0:#CAECE6">allowed_path</span><span style="--0:#7FDBCA">></span></span><span style="--0:#D6DEEB;--1:#403F53">/backups/</span><span style="--1:#8D46B4"><span style="--0:#7FDBCA">&#x3C;/</span><span style="--0:#CAECE6">allowed_path</span><span style="--0:#7FDBCA">></span></span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--1:#8D46B4"><span style="--0:#7FDBCA">&#x3C;/</span><span style="--0:#CAECE6">backups</span><span style="--0:#7FDBCA">></span></span></div><div class="ec-line"><span style="--1:#8D46B4"><span style="--0:#7FDBCA">&#x3C;/</span><span style="--0:#CAECE6">clickhouse</span><span style="--0:#7FDBCA">></span></span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="<clickhouse>    <storage_configuration>        <disks>            <backups>                <type>local</type>                <path>/backups/</path>            </backups>        </disks>    </storage_configuration>    <backups>        <allowed_disk>backups</allowed_disk>        <allowed_path>/backups/</allowed_path>    </backups></clickhouse>"><div></div></button></div></figure></div>
<h4 id="备份整个数据库">备份整个数据库</h4>
<p>执行以下命令将整个数据库备份到指定磁盘：</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">BACKUP</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">DATABASE</span><span style="--0:#D6DEEB;--1:#403F53"> my_database </span><span style="--0:#C792EA;--1:#8D46B4">TO</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">Disk</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#ECC48D;--1:#9B504E">backups</span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#ECC48D;--1:#9B504E">database_backup.zip</span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="BACKUP DATABASE my_database TO Disk(&#x27;backups&#x27;, &#x27;database_backup.zip&#x27;);"><div></div></button></div></figure></div>
<h4 id="恢复整个数据库">恢复整个数据库</h4>
<p>从备份文件中恢复整个数据库：</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">RESTORE</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">DATABASE</span><span style="--0:#D6DEEB;--1:#403F53"> my_database </span><span style="--0:#C792EA;--1:#8D46B4">FROM</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">Disk</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#ECC48D;--1:#9B504E">backups</span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#ECC48D;--1:#9B504E">database_backup.zip</span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="RESTORE DATABASE my_database FROM Disk(&#x27;backups&#x27;, &#x27;database_backup.zip&#x27;);"><div></div></button></div></figure></div>
<h4 id="备份表">备份表</h4>
<p>执行以下命令将表备份到指定磁盘：</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">BACKUP</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">TABLE</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">my_database</span><span style="--0:#D6DEEB;--1:#403F53">.</span><span style="--0:#82AAFF;--1:#3C63B3">my_table</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">TO</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">Disk</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#ECC48D;--1:#9B504E">backups</span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#ECC48D;--1:#9B504E">table_backup.zip</span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="BACKUP TABLE my_database.my_table TO Disk(&#x27;backups&#x27;, &#x27;table_backup.zip&#x27;);"><div></div></button></div></figure></div>
<h4 id="恢复表">恢复表</h4>
<p>从备份文件中恢复表：</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">RESTORE</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">TABLE</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">my_database</span><span style="--0:#D6DEEB;--1:#403F53">.</span><span style="--0:#82AAFF;--1:#3C63B3">my_table</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">FROM</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">Disk</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#ECC48D;--1:#9B504E">backups</span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#ECC48D;--1:#9B504E">table_backup.zip</span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="RESTORE TABLE my_database.my_table FROM Disk(&#x27;backups&#x27;, &#x27;table_backup.zip&#x27;);"><div></div></button></div></figure></div>
<h4 id="增量备份">增量备份</h4>
<p>指定基础备份进行增量备份：</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">BACKUP</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">DATABASE</span><span style="--0:#D6DEEB;--1:#403F53"> my_database </span><span style="--0:#C792EA;--1:#8D46B4">TO</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">Disk</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#ECC48D;--1:#9B504E">backups</span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#ECC48D;--1:#9B504E">incremental_backup.zip</span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#D6DEEB;--1:#403F53">) SETTINGS base_backup </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">Disk</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#ECC48D;--1:#9B504E">backups</span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#ECC48D;--1:#9B504E">database_backup.zip</span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="BACKUP DATABASE my_database TO Disk(&#x27;backups&#x27;, &#x27;incremental_backup.zip&#x27;) SETTINGS base_backup = Disk(&#x27;backups&#x27;, &#x27;database_backup.zip&#x27;);"><div></div></button></div></figure></div>
<h4 id="使用密码保护备份">使用密码保护备份</h4>
<p>备份文件使用密码保护：</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">BACKUP</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">DATABASE</span><span style="--0:#D6DEEB;--1:#403F53"> my_database </span><span style="--0:#C792EA;--1:#8D46B4">TO</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">Disk</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#ECC48D;--1:#9B504E">backups</span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#ECC48D;--1:#9B504E">protected_backup.zip</span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#D6DEEB;--1:#403F53">) SETTINGS </span><span style="--0:#C792EA;--1:#8D46B4">password=</span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#ECC48D;--1:#9B504E">yourpassword</span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="BACKUP DATABASE my_database TO Disk(&#x27;backups&#x27;, &#x27;protected_backup.zip&#x27;) SETTINGS password=&#x27;yourpassword&#x27;;"><div></div></button></div></figure></div>
<h4 id="压缩设置">压缩设置</h4>
<p>指定压缩方法和级别：</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">BACKUP</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">DATABASE</span><span style="--0:#D6DEEB;--1:#403F53"> my_database </span><span style="--0:#C792EA;--1:#8D46B4">TO</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">Disk</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#ECC48D;--1:#9B504E">backups</span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#ECC48D;--1:#9B504E">compressed_backup.zip</span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#D6DEEB;--1:#403F53">) SETTINGS compression_method</span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#ECC48D;--1:#9B504E">lzma</span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#D6DEEB;--1:#403F53">, compression_level</span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#F78C6C;--1:#AA0982">3</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="BACKUP DATABASE my_database TO Disk(&#x27;backups&#x27;, &#x27;compressed_backup.zip&#x27;) SETTINGS compression_method=&#x27;lzma&#x27;, compression_level=3;"><div></div></button></div></figure></div>
<h4 id="恢复特定分区">恢复特定分区</h4>
<p>从备份中恢复特定分区：</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">RESTORE</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">TABLE</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">my_database</span><span style="--0:#D6DEEB;--1:#403F53">.</span><span style="--0:#82AAFF;--1:#3C63B3">my_table</span><span style="--0:#D6DEEB;--1:#403F53"> PARTITIONS </span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#ECC48D;--1:#9B504E">partition_id</span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">FROM</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">Disk</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#ECC48D;--1:#9B504E">backups</span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#ECC48D;--1:#9B504E">table_backup.zip</span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="RESTORE TABLE my_database.my_table PARTITIONS &#x27;partition_id&#x27; FROM Disk(&#x27;backups&#x27;, &#x27;table_backup.zip&#x27;);"><div></div></button></div></figure></div>
<p>更多详细信息请参考 <a href="https://clickhouse.com/docs/en/operations/backup">ClickHouse 文档</a>。</p>
<h3 id="244-关于clickhouse的优化">24.4 关于Clickhouse的优化</h3>
<p>在量化金融领域，处理大量实时数据至关重要。ClickHouse作为一款高性能列式数据库，提供了高效的查询和存储方案。然而，为了充分发挥其性能，必须对其进行优化。</p>
<h4 id="硬件优化">硬件优化</h4>
<ol>
<li><strong>存储设备</strong>：选择高性能 SSD，可以显著提高数据读取和写入速度。</li>
<li><strong>内存</strong>：增加内存容量，有助于更快地处理大量数据。</li>
<li><strong>网络</strong>：优化网络带宽和延迟，确保分布式集群间的数据传输效率。</li>
</ol>
<h4 id="配置优化">配置优化</h4>
<ol>
<li><strong>设置合适的分区策略</strong>：根据时间或其他关键维度分区，提高查询性能。</li>
<li><strong>合并设置</strong>：配置合适的 <code dir="auto">merge_tree</code> 设置，优化数据合并过程，减少碎片。</li>
<li><strong>缓存和内存设置</strong>：调整 <code dir="auto">mark_cache_size</code> 和 <code dir="auto">max_memory_usage</code> 等参数，提升缓存命中率和内存使用效率。</li>
</ol>
<h4 id="查询优化">查询优化</h4>
<ol>
<li><strong>索引</strong>：利用主键和二级索引，加速查询。</li>
<li><strong>并行查询</strong>：启用 <code dir="auto">max_threads</code> 参数，充分利用多核 CPU 并行处理查询。</li>
<li><strong>物化视图</strong>：预计算常用查询结果，减少实时计算开销。</li>
</ol>
<h4 id="数据模型优化">数据模型优化</h4>
<ol>
<li><strong>列存储设计</strong>：尽量将频繁查询的列存储在一起，减少 I/O 开销。</li>
<li><strong>压缩算法</strong>：选择合适的压缩算法，如 <code dir="auto">LZ4</code> 或 <code dir="auto">ZSTD</code>，在压缩率和性能之间取得平衡。</li>
</ol>
<h4 id="实践案例">实践案例</h4>
<p>以量化金融中的市场数据分析为例，优化 ClickHouse 的关键步骤如下：</p>
<ol>
<li><strong>分区策略</strong>：按日期分区，使查询特定时间段数据时更高效。</li>
<li><strong>物化视图</strong>：预计算每日交易量、价格波动等关键指标，减少实时计算负担。</li>
<li><strong>并行查询</strong>：调整 <code dir="auto">max_threads</code>，确保查询时充分利用服务器多核资源。</li>
</ol>
<h4 id="监控和维护">监控和维护</h4>
<ol>
<li><strong>监控工具</strong>：使用 ClickHouse 提供的 <code dir="auto">system</code> 表监控系统性能和查询效率。</li>
<li><strong>定期维护</strong>：定期检查并优化分区和索引，防止性能下降。</li>
</ol>
<p>通过合理的硬件配置、优化查询和数据模型设计，以及持续的监控和维护，ClickHouse 可以在量化金融领域中提供卓越的性能和可靠性，支持高频交易、实时数据分析等应用场景。以下我将介绍一些优化实例：</p>
<h5 id="2441-硬件配置">24.4.1. 硬件配置</h5>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--1:#8D46B4"><span style="--0:#7FDBCA">&#x3C;</span><span style="--0:#CAECE6">clickhouse</span><span style="--0:#7FDBCA">></span></span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--1:#8D46B4"><span style="--0:#7FDBCA">&#x3C;</span><span style="--0:#CAECE6">storage_configuration</span><span style="--0:#7FDBCA">></span></span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        </span><span style="--1:#8D46B4"><span style="--0:#7FDBCA">&#x3C;</span><span style="--0:#CAECE6">disks</span><span style="--0:#7FDBCA">></span></span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">            </span><span style="--1:#8D46B4"><span style="--0:#7FDBCA">&#x3C;</span><span style="--0:#CAECE6">default</span><span style="--0:#7FDBCA">></span></span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">                </span><span style="--1:#8D46B4"><span style="--0:#7FDBCA">&#x3C;</span><span style="--0:#CAECE6">path</span><span style="--0:#7FDBCA">></span></span><span style="--0:#D6DEEB;--1:#403F53">/var/lib/clickhouse/</span><span style="--1:#8D46B4"><span style="--0:#7FDBCA">&#x3C;/</span><span style="--0:#CAECE6">path</span><span style="--0:#7FDBCA">></span></span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">            </span><span style="--1:#8D46B4"><span style="--0:#7FDBCA">&#x3C;/</span><span style="--0:#CAECE6">default</span><span style="--0:#7FDBCA">></span></span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">            </span><span style="--1:#8D46B4"><span style="--0:#7FDBCA">&#x3C;</span><span style="--0:#CAECE6">ssd</span><span style="--0:#7FDBCA">></span></span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">                </span><span style="--1:#8D46B4"><span style="--0:#7FDBCA">&#x3C;</span><span style="--0:#CAECE6">type</span><span style="--0:#7FDBCA">></span></span><span style="--0:#D6DEEB;--1:#403F53">local</span><span style="--1:#8D46B4"><span style="--0:#7FDBCA">&#x3C;/</span><span style="--0:#CAECE6">type</span><span style="--0:#7FDBCA">></span></span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">                </span><span style="--1:#8D46B4"><span style="--0:#7FDBCA">&#x3C;</span><span style="--0:#CAECE6">path</span><span style="--0:#7FDBCA">></span></span><span style="--0:#D6DEEB;--1:#403F53">/mnt/ssd/</span><span style="--1:#8D46B4"><span style="--0:#7FDBCA">&#x3C;/</span><span style="--0:#CAECE6">path</span><span style="--0:#7FDBCA">></span></span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">            </span><span style="--1:#8D46B4"><span style="--0:#7FDBCA">&#x3C;/</span><span style="--0:#CAECE6">ssd</span><span style="--0:#7FDBCA">></span></span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        </span><span style="--1:#8D46B4"><span style="--0:#7FDBCA">&#x3C;/</span><span style="--0:#CAECE6">disks</span><span style="--0:#7FDBCA">></span></span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--1:#8D46B4"><span style="--0:#7FDBCA">&#x3C;/</span><span style="--0:#CAECE6">storage_configuration</span><span style="--0:#7FDBCA">></span></span></div><div class="ec-line"><span style="--1:#8D46B4"><span style="--0:#7FDBCA">&#x3C;/</span><span style="--0:#CAECE6">clickhouse</span><span style="--0:#7FDBCA">></span></span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="<clickhouse>    <storage_configuration>        <disks>            <default>                <path>/var/lib/clickhouse/</path>            </default>            <ssd>                <type>local</type>                <path>/mnt/ssd/</path>            </ssd>        </disks>    </storage_configuration></clickhouse>"><div></div></button></div></figure></div>
<h5 id="2442-创建分区表">24.4.2. 创建分区表</h5>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">CREATE</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">TABLE</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">market_data</span><span style="--0:#D6DEEB;--1:#403F53"> (</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">date</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">Date</span><span style="--0:#D6DEEB;--1:#403F53">,</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    symbol String,</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    price Float64,</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    volume UInt64</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">) ENGINE </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> MergeTree()</span></div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">PARTITION</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">BY</span><span style="--0:#D6DEEB;--1:#403F53"> toYYYYMM(</span><span style="--0:#C792EA;--1:#8D46B4">date</span><span style="--0:#D6DEEB;--1:#403F53">)</span></div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">ORDER BY</span><span style="--0:#D6DEEB;--1:#403F53"> (symbol, </span><span style="--0:#C792EA;--1:#8D46B4">date</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="CREATE TABLE market_data (    date Date,    symbol String,    price Float64,    volume UInt64) ENGINE = MergeTree()PARTITION BY toYYYYMM(date)ORDER BY (symbol, date);"><div></div></button></div></figure></div>
<h5 id="2443-使用物化视图">24.4.3. 使用物化视图</h5>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">CREATE</span><span style="--0:#D6DEEB;--1:#403F53"> MATERIALIZED VIEW market_summary</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">ENGINE </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> AggregatingMergeTree()</span></div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">PARTITION</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">BY</span><span style="--0:#D6DEEB;--1:#403F53"> toYYYYMM(</span><span style="--0:#C792EA;--1:#8D46B4">date</span><span style="--0:#D6DEEB;--1:#403F53">)</span></div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">ORDER BY</span><span style="--0:#D6DEEB;--1:#403F53"> (symbol, </span><span style="--0:#C792EA;--1:#8D46B4">date</span><span style="--0:#D6DEEB;--1:#403F53">)</span></div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">AS</span></div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">SELECT</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    symbol,</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    toYYYYMM(</span><span style="--0:#C792EA;--1:#8D46B4">date</span><span style="--0:#D6DEEB;--1:#403F53">) </span><span style="--0:#C792EA;--1:#8D46B4">as</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">month</span><span style="--0:#D6DEEB;--1:#403F53">,</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C5E478;--1:#3C63B3">avg</span><span style="--0:#D6DEEB;--1:#403F53">(price) </span><span style="--0:#C792EA;--1:#8D46B4">as</span><span style="--0:#D6DEEB;--1:#403F53"> avg_price,</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C5E478;--1:#3C63B3">sum</span><span style="--0:#D6DEEB;--1:#403F53">(volume) </span><span style="--0:#C792EA;--1:#8D46B4">as</span><span style="--0:#D6DEEB;--1:#403F53"> total_volume</span></div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">FROM</span><span style="--0:#D6DEEB;--1:#403F53"> market_data</span></div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">GROUP BY</span><span style="--0:#D6DEEB;--1:#403F53"> symbol, </span><span style="--0:#C792EA;--1:#8D46B4">month</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="CREATE MATERIALIZED VIEW market_summaryENGINE = AggregatingMergeTree()PARTITION BY toYYYYMM(date)ORDER BY (symbol, date)ASSELECT    symbol,    toYYYYMM(date) as month,    avg(price) as avg_price,    sum(volume) as total_volumeFROM market_dataGROUP BY symbol, month;"><div></div></button></div></figure></div>
<h5 id="2444-并行查询">24.4.4. 并行查询</h5>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">SET</span><span style="--0:#D6DEEB;--1:#403F53"> max_threads </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#F78C6C;--1:#AA0982">8</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">SELECT</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    symbol,</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C5E478;--1:#3C63B3">avg</span><span style="--0:#D6DEEB;--1:#403F53">(price) </span><span style="--0:#C792EA;--1:#8D46B4">as</span><span style="--0:#D6DEEB;--1:#403F53"> avg_price</span></div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">FROM</span><span style="--0:#D6DEEB;--1:#403F53"> market_data</span></div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">WHERE</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">date</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">>=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#ECC48D;--1:#9B504E">2023-01-01</span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">AND</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">date</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">&#x3C;=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#ECC48D;--1:#9B504E">2023-12-31</span><span style="--0:#D9F5DD;--1:#111111">'</span></div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">GROUP BY</span><span style="--0:#D6DEEB;--1:#403F53"> symbol;</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="SET max_threads = 8;SELECT    symbol,    avg(price) as avg_priceFROM market_dataWHERE date >= &#x27;2023-01-01&#x27; AND date <= &#x27;2023-12-31&#x27;GROUP BY symbol;"><div></div></button></div></figure></div>
<h5 id="2445-压缩算法">24.4.5. 压缩算法</h5>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">CREATE</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">TABLE</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">compressed_data</span><span style="--0:#D6DEEB;--1:#403F53"> (</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">date</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">Date</span><span style="--0:#D6DEEB;--1:#403F53">,</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    symbol String,</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    price Float64,</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    volume UInt64</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">) ENGINE </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> MergeTree()</span></div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">PARTITION</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">BY</span><span style="--0:#D6DEEB;--1:#403F53"> toYYYYMM(</span><span style="--0:#C792EA;--1:#8D46B4">date</span><span style="--0:#D6DEEB;--1:#403F53">)</span></div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">ORDER BY</span><span style="--0:#D6DEEB;--1:#403F53"> (symbol, </span><span style="--0:#C792EA;--1:#8D46B4">date</span><span style="--0:#D6DEEB;--1:#403F53">)</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">SETTINGS index_granularity </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#F78C6C;--1:#AA0982">8192</span><span style="--0:#D6DEEB;--1:#403F53">,</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    compress_on_write </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#F78C6C;--1:#AA0982">1</span><span style="--0:#D6DEEB;--1:#403F53">,</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">compression</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#ECC48D;--1:#9B504E">lz4</span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="CREATE TABLE compressed_data (    date Date,    symbol String,    price Float64,    volume UInt64) ENGINE = MergeTree()PARTITION BY toYYYYMM(date)ORDER BY (symbol, date)SETTINGS index_granularity = 8192,    compress_on_write = 1,    compression = &#x27;lz4&#x27;;"><div></div></button></div></figure></div>
<p>通过合理的硬件配置、优化查询和数据模型设计，以及持续的监控和维护，ClickHouse 可以在量化金融领域中提供卓越的性能和可靠性，支持高频交易、实时数据分析等应用场景。</p>
<h3 id="案例1-通过rust脚本在clickhouse数据库中建表删表查询">案例1 通过Rust脚本在Clickhouse数据库中建表、删表、查询</h3>
<p>在量化金融领域中，使用 Rust 脚本管理 ClickHouse 数据库可以实现高效的数据处理和管理。以下是一个基本案例 。</p>
<h4 id="准备工作">准备工作</h4>
<p>首先，确保在你的 <code dir="auto">Cargo.toml</code> 中添加 <code dir="auto">clickhouse</code> 依赖：</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">[dependencies]</span></div><div class="ec-line"><span style="--0:#C5E478;--1:#3C63B3">clickhouse</span><span style="--0:#D6DEEB;--1:#403F53"> = { </span><span style="--0:#C5E478;--1:#3C63B3">default-features</span><span style="--0:#D6DEEB;--1:#403F53"> = </span><span style="--0:#FF5874;--1:#A54A4A">false</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#C5E478;--1:#3C63B3">version</span><span style="--0:#D6DEEB;--1:#403F53"> = </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">0.11.6</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53"> }</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="[dependencies]clickhouse = { default-features = false, version = &#x22;0.11.6&#x22; }"><div></div></button></div></figure></div>
<h4 id="创建-clickhouse-客户端">创建 ClickHouse 客户端</h4>
<p>定义并初始化一个 ClickHouse 客户端：</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">use</span><span style="--0:#D6DEEB;--1:#403F53"> clickhouse</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#D6DEEB;--1:#403F53">{Client, Row};</span></div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">use</span><span style="--0:#D6DEEB;--1:#403F53"> lazy_static</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#D6DEEB;--1:#403F53">lazy_static;</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#82AAFF;--1:#3C63B3">lazy_static!</span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">pub</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">static</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">ref</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">CLICKHOUSE_CLIENT</span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#D6DEEB;--1:#403F53"> ClickHouseClient </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> ClickHouseClient</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#82AAFF;--1:#3C63B3">new</span><span style="--0:#D6DEEB;--1:#403F53">();</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">}</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">pub</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">struct</span><span style="--0:#D6DEEB;--1:#403F53"> ClickHouseClient {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">pub</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">client</span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#D6DEEB;--1:#403F53"> Client,</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">}</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">impl</span><span style="--0:#D6DEEB;--1:#403F53"> ClickHouseClient {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">pub</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">fn</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">new</span><span style="--0:#D6DEEB;--1:#403F53">() </span><span style="--0:#7FDBCA;--1:#097174">-></span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#097174">Self</span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">client</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> Client</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#82AAFF;--1:#3C63B3">default</span><span style="--0:#D6DEEB;--1:#403F53">()</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">with_url</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">http://localhost:8123</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">)</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">with_database</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">default</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        ClickHouseClient { </span><span style="--0:#C5E478;--1:#3C63B3">client</span><span style="--0:#D6DEEB;--1:#403F53"> }</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    }</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">}</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="use clickhouse::{Client, Row};use lazy_static::lazy_static;lazy_static! {    pub static ref CLICKHOUSE_CLIENT: ClickHouseClient = ClickHouseClient::new();}pub struct ClickHouseClient {    pub client: Client,}impl ClickHouseClient {    pub fn new() -> Self {        let client = Client::default().with_url(&#x22;http://localhost:8123&#x22;).with_database(&#x22;default&#x22;);        ClickHouseClient { client }    }}"><div></div></button></div></figure></div>
<h4 id="创建表">创建表</h4>
<p>创建一个新的表 <code dir="auto">market_data</code>：</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">impl</span><span style="--0:#D6DEEB;--1:#403F53"> ClickHouseClient {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">pub</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">async</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">fn</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">create_table</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#7FDBCA;--1:#097174">&#x26;self</span><span style="--0:#D6DEEB;--1:#403F53">) </span><span style="--0:#7FDBCA;--1:#097174">-></span><span style="--0:#D6DEEB;--1:#403F53"> Result&#x3C;(), </span><span style="--0:#C5E478;--1:#3C63B3">clickhouse</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#C5E478;--1:#3C63B3">error</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#D6DEEB;--1:#403F53">Error> {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">query</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#9B504E">r</span><span style="--0:#D9F5DD;--1:#111111">#"</span></div><div class="ec-line"><span style="--0:#ECC48D;--1:#9B504E">            CREATE TABLE market_data (</span></div><div class="ec-line"><span style="--0:#ECC48D;--1:#9B504E">                date Date,</span></div><div class="ec-line"><span style="--0:#ECC48D;--1:#9B504E">                symbol String,</span></div><div class="ec-line"><span style="--0:#ECC48D;--1:#9B504E">                price Float64,</span></div><div class="ec-line"><span style="--0:#ECC48D;--1:#9B504E">                volume UInt64</span></div><div class="ec-line"><span style="--0:#ECC48D;--1:#9B504E">            ) ENGINE = MergeTree()</span></div><div class="ec-line"><span style="--0:#ECC48D;--1:#9B504E">            PARTITION BY date</span></div><div class="ec-line"><span style="--0:#ECC48D;--1:#9B504E">            ORDER BY (symbol, date)</span></div><div class="ec-line"><span style="--0:#ECC48D;--1:#9B504E">        </span><span style="--0:#D9F5DD;--1:#111111">"#</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        </span><span style="--0:#7FDBCA;--1:#097174">self.</span><span style="--0:#D6DEEB;--1:#403F53">client</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">query</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#C5E478;--1:#3C63B3">query</span><span style="--0:#D6DEEB;--1:#403F53">)</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">execute</span><span style="--0:#D6DEEB;--1:#403F53">()</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#C792EA;--1:#8D46B4">await</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    }</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">}</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="impl ClickHouseClient {    pub async fn create_table(&#x26;self) -> Result<(), clickhouse::error::Error> {        let query = r#&#x22;            CREATE TABLE market_data (                date Date,                symbol String,                price Float64,                volume UInt64            ) ENGINE = MergeTree()            PARTITION BY date            ORDER BY (symbol, date)        &#x22;#;        self.client.query(query).execute().await    }}"><div></div></button></div></figure></div>
<h4 id="删除表">删除表</h4>
<p>删除一个已存在的表：</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">impl</span><span style="--0:#D6DEEB;--1:#403F53"> ClickHouseClient {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">pub</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">async</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">fn</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">drop_table</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#7FDBCA;--1:#097174">&#x26;self</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#C5E478;--1:#3C63B3">table_name</span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#097174">&#x26;</span><span style="--0:#D6DEEB;--1:#403F53">str) </span><span style="--0:#7FDBCA;--1:#097174">-></span><span style="--0:#D6DEEB;--1:#403F53"> Result&#x3C;(), </span><span style="--0:#C5E478;--1:#3C63B3">clickhouse</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#C5E478;--1:#3C63B3">error</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#D6DEEB;--1:#403F53">Error> {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">query</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">format!</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">DROP TABLE IF EXISTS {}</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#C5E478;--1:#3C63B3">table_name</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        </span><span style="--0:#7FDBCA;--1:#097174">self.</span><span style="--0:#D6DEEB;--1:#403F53">client</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">query</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#7FDBCA;--1:#097174">&#x26;</span><span style="--0:#C5E478;--1:#3C63B3">query</span><span style="--0:#D6DEEB;--1:#403F53">)</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">execute</span><span style="--0:#D6DEEB;--1:#403F53">()</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#C792EA;--1:#8D46B4">await</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    }</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">}</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="impl ClickHouseClient {    pub async fn drop_table(&#x26;self, table_name: &#x26;str) -> Result<(), clickhouse::error::Error> {        let query = format!(&#x22;DROP TABLE IF EXISTS {}&#x22;, table_name);        self.client.query(&#x26;query).execute().await    }}"><div></div></button></div></figure></div>
<h4 id="查询数据">查询数据</h4>
<p>从表中查询数据：</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">#[derive(Debug, Serialize, Deserialize, Row)]</span></div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">pub</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">struct</span><span style="--0:#D6DEEB;--1:#403F53"> MarketData {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">pub</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">date</span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#D6DEEB;--1:#403F53"> String,</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">pub</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">symbol</span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#D6DEEB;--1:#403F53"> String,</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">pub</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">price</span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#D6DEEB;--1:#403F53"> f64,</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">pub</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">volume</span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#D6DEEB;--1:#403F53"> u64,</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">}</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">impl</span><span style="--0:#D6DEEB;--1:#403F53"> ClickHouseClient {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">pub</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">async</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">fn</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">query_data</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#7FDBCA;--1:#097174">&#x26;self</span><span style="--0:#D6DEEB;--1:#403F53">) </span><span style="--0:#7FDBCA;--1:#097174">-></span><span style="--0:#D6DEEB;--1:#403F53"> Result&#x3C;Vec&#x3C;MarketData>, </span><span style="--0:#C5E478;--1:#3C63B3">clickhouse</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#C5E478;--1:#3C63B3">error</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#D6DEEB;--1:#403F53">Error> {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">query</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">SELECT * FROM market_data LIMIT 10</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">result</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#097174">self.</span><span style="--0:#D6DEEB;--1:#403F53">client</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">query</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#C5E478;--1:#3C63B3">query</span><span style="--0:#D6DEEB;--1:#403F53">)</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">fetch_all</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#D6DEEB;--1:#403F53">&#x3C;MarketData>()</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#C792EA;--1:#8D46B4">await</span><span style="--0:#7FDBCA;--1:#097174">?</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        Ok(</span><span style="--0:#C5E478;--1:#3C63B3">result</span><span style="--0:#D6DEEB;--1:#403F53">)</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    }</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">}</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="#[derive(Debug, Serialize, Deserialize, Row)]pub struct MarketData {    pub date: String,    pub symbol: String,    pub price: f64,    pub volume: u64,}impl ClickHouseClient {    pub async fn query_data(&#x26;self) -> Result<Vec<MarketData>, clickhouse::error::Error> {        let query = &#x22;SELECT * FROM market_data LIMIT 10&#x22;;        let result = self.client.query(query).fetch_all::<MarketData>().await?;        Ok(result)    }}"><div></div></button></div></figure></div>
<h4 id="示例用法">示例用法</h4>
<p>完整的示例代码展示了如何使用这些功能：</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">#[tokio</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#D6DEEB;--1:#403F53">main]</span></div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">async</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">fn</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">main</span><span style="--0:#D6DEEB;--1:#403F53">() </span><span style="--0:#7FDBCA;--1:#097174">-></span><span style="--0:#D6DEEB;--1:#403F53"> Result&#x3C;(), </span><span style="--0:#C5E478;--1:#3C63B3">clickhouse</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#C5E478;--1:#3C63B3">error</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#D6DEEB;--1:#403F53">Error> {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">client</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> ClickHouseClient</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#82AAFF;--1:#3C63B3">new</span><span style="--0:#D6DEEB;--1:#403F53">();</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#809191;--1:#5E6578">    // 创建表</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C5E478;--1:#3C63B3">client</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">create_table</span><span style="--0:#D6DEEB;--1:#403F53">()</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#C792EA;--1:#8D46B4">await</span><span style="--0:#7FDBCA;--1:#097174">?</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#82AAFF;--1:#3C63B3">println!</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">Table created successfully.</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#809191;--1:#5E6578">    // 查询数据</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">data</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">client</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">query_data</span><span style="--0:#D6DEEB;--1:#403F53">()</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#C792EA;--1:#8D46B4">await</span><span style="--0:#7FDBCA;--1:#097174">?</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">for</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">row</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">in</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">data</span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        </span><span style="--0:#82AAFF;--1:#3C63B3">println!</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">{:?}</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#C5E478;--1:#3C63B3">row</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    }</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#809191;--1:#5E6578">    // 删除表</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C5E478;--1:#3C63B3">client</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">drop_table</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">market_data</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">)</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#C792EA;--1:#8D46B4">await</span><span style="--0:#7FDBCA;--1:#097174">?</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#82AAFF;--1:#3C63B3">println!</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">Table dropped successfully.</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    Ok(())</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">}</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="#[tokio::main]async fn main() -> Result<(), clickhouse::error::Error> {    let client = ClickHouseClient::new();    // 创建表    client.create_table().await?;    println!(&#x22;Table created successfully.&#x22;);    // 查询数据    let data = client.query_data().await?;    for row in data {        println!(&#x22;{:?}&#x22;, row);    }    // 删除表    client.drop_table(&#x22;market_data&#x22;).await?;    println!(&#x22;Table dropped successfully.&#x22;);    Ok(())}"><div></div></button></div></figure></div>
<p>通过这个基本教程，你可以在 Rust 脚本中实现对 ClickHouse 数据库的基本管理操作。这些示例代码可以根据具体需求进行扩展和优化，以满足量化金融领域的复杂数据处理需求。</p>
<h3 id="案例2-创建布林带表的-sql-脚本示例">案例2 创建布林带表的 SQL 脚本示例</h3>
<p>本案例展示如何利用 Rust 脚本与 ClickHouse 交互，计算布林带 (Bollinger Bands) 和其他技术指标，帮助金融分析师和量化交易员优化他们的交易策略。</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#809191;--1:#616671">-- 创建名为 AG2305_TEST 的表，使用 MergeTree 引擎</span></div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">CREATE</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">TABLE</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">AG2305_TEST</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    ENGINE </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> MergeTree()</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        </span><span style="--0:#C792EA;--1:#8D46B4">ORDER BY</span><span style="--0:#D6DEEB;--1:#403F53"> (</span><span style="--0:#C792EA;--1:#8D46B4">minute</span><span style="--0:#D6DEEB;--1:#403F53">, mean_lastprice) </span><span style="--0:#809191;--1:#616671">-- 按 minute 和 mean_lastprice 排序</span></div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">AS</span></div><div class="ec-line"><span style="--0:#809191;--1:#616671">-- 从子查询中选择字段</span></div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">SELECT</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">outer_query</span><span style="--0:#D6DEEB;--1:#403F53">.</span><span style="--0:#82AAFF;--1:#3C63B3">minute</span><span style="--0:#D6DEEB;--1:#403F53">,</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">       </span><span style="--0:#C5E478;--1:#3C63B3">CAST</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#82AAFF;--1:#3C63B3">outer_query</span><span style="--0:#D6DEEB;--1:#403F53">.</span><span style="--0:#82AAFF;--1:#3C63B3">mean_lastprice</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">AS</span><span style="--0:#D6DEEB;--1:#403F53"> Float32) </span><span style="--0:#C792EA;--1:#8D46B4">AS</span><span style="--0:#D6DEEB;--1:#403F53"> mean_lastprice, </span><span style="--0:#809191;--1:#616671">-- 将 mean_lastprice 转换为 Float32 类型</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">       </span><span style="--0:#C5E478;--1:#3C63B3">CAST</span><span style="--0:#D6DEEB;--1:#403F53">(sma </span><span style="--0:#C792EA;--1:#8D46B4">AS</span><span style="--0:#D6DEEB;--1:#403F53"> Float32)                        </span><span style="--0:#C792EA;--1:#8D46B4">AS</span><span style="--0:#D6DEEB;--1:#403F53"> sma,           </span><span style="--0:#809191;--1:#616671">-- 将 sma 转换为 Float32 类型</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">       </span><span style="--0:#C5E478;--1:#3C63B3">CAST</span><span style="--0:#D6DEEB;--1:#403F53">(stddev </span><span style="--0:#C792EA;--1:#8D46B4">AS</span><span style="--0:#D6DEEB;--1:#403F53"> Float32)                     </span><span style="--0:#C792EA;--1:#8D46B4">AS</span><span style="--0:#D6DEEB;--1:#403F53"> stddev,        </span><span style="--0:#809191;--1:#616671">-- 将 stddev 转换为 Float32 类型</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">       </span><span style="--0:#C5E478;--1:#3C63B3">CAST</span><span style="--0:#D6DEEB;--1:#403F53">(upper </span><span style="--0:#C792EA;--1:#8D46B4">AS</span><span style="--0:#D6DEEB;--1:#403F53"> Float32)                      </span><span style="--0:#C792EA;--1:#8D46B4">AS</span><span style="--0:#D6DEEB;--1:#403F53"> upper,         </span><span style="--0:#809191;--1:#616671">-- 将 upper 转换为 Float32 类型</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">       </span><span style="--0:#C5E478;--1:#3C63B3">CAST</span><span style="--0:#D6DEEB;--1:#403F53">(lower </span><span style="--0:#C792EA;--1:#8D46B4">AS</span><span style="--0:#D6DEEB;--1:#403F53"> Float32)                      </span><span style="--0:#C792EA;--1:#8D46B4">AS</span><span style="--0:#D6DEEB;--1:#403F53"> lower,         </span><span style="--0:#809191;--1:#616671">-- 将 lower 转换为 Float32 类型</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">       </span><span style="--0:#C5E478;--1:#3C63B3">CAST</span><span style="--0:#D6DEEB;--1:#403F53">(super_upper </span><span style="--0:#C792EA;--1:#8D46B4">AS</span><span style="--0:#D6DEEB;--1:#403F53"> Float32)                </span><span style="--0:#C792EA;--1:#8D46B4">AS</span><span style="--0:#D6DEEB;--1:#403F53"> super_upper,   </span><span style="--0:#809191;--1:#616671">-- 将 super_upper 转换为 Float32 类型</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">       </span><span style="--0:#C5E478;--1:#3C63B3">CAST</span><span style="--0:#D6DEEB;--1:#403F53">(super_lower </span><span style="--0:#C792EA;--1:#8D46B4">AS</span><span style="--0:#D6DEEB;--1:#403F53"> Float32)                </span><span style="--0:#C792EA;--1:#8D46B4">AS</span><span style="--0:#D6DEEB;--1:#403F53"> super_lower,   </span><span style="--0:#809191;--1:#616671">-- 将 super_lower 转换为 Float32 类型</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">       </span><span style="--0:#C5E478;--1:#3C63B3">CAST</span><span style="--0:#D6DEEB;--1:#403F53">(ssuper_upper </span><span style="--0:#C792EA;--1:#8D46B4">AS</span><span style="--0:#D6DEEB;--1:#403F53"> Float32)               </span><span style="--0:#C792EA;--1:#8D46B4">AS</span><span style="--0:#D6DEEB;--1:#403F53"> ssuper_upper,  </span><span style="--0:#809191;--1:#616671">-- 将 ssuper_upper 转换为 Float32 类型</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">       </span><span style="--0:#C5E478;--1:#3C63B3">CAST</span><span style="--0:#D6DEEB;--1:#403F53">(ssuper_lower </span><span style="--0:#C792EA;--1:#8D46B4">AS</span><span style="--0:#D6DEEB;--1:#403F53"> Float32)               </span><span style="--0:#C792EA;--1:#8D46B4">AS</span><span style="--0:#D6DEEB;--1:#403F53"> ssuper_lower,  </span><span style="--0:#809191;--1:#616671">-- 将 ssuper_lower 转换为 Float32 类型</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">       </span><span style="--0:#C792EA;--1:#8D46B4">CASE</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">           </span><span style="--0:#809191;--1:#616671">-- 根据价格突破的不同情况赋值 bollinger_band_status</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">           </span><span style="--0:#C792EA;--1:#8D46B4">WHEN</span><span style="--0:#D6DEEB;--1:#403F53"> super_upper </span><span style="--0:#C792EA;--1:#8D46B4">></span><span style="--0:#D6DEEB;--1:#403F53"> mean_lastprice </span><span style="--0:#C792EA;--1:#8D46B4">AND</span><span style="--0:#D6DEEB;--1:#403F53"> mean_lastprice </span><span style="--0:#C792EA;--1:#8D46B4">></span><span style="--0:#D6DEEB;--1:#403F53"> upper </span><span style="--0:#C792EA;--1:#8D46B4">THEN</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#F78C6C;--1:#AA0982">1</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#809191;--1:#616671">-- 向上突破2个标准差</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">           </span><span style="--0:#C792EA;--1:#8D46B4">WHEN</span><span style="--0:#D6DEEB;--1:#403F53"> super_lower </span><span style="--0:#C792EA;--1:#8D46B4">&#x3C;</span><span style="--0:#D6DEEB;--1:#403F53"> mean_lastprice </span><span style="--0:#C792EA;--1:#8D46B4">AND</span><span style="--0:#D6DEEB;--1:#403F53"> mean_lastprice </span><span style="--0:#C792EA;--1:#8D46B4">&#x3C;</span><span style="--0:#D6DEEB;--1:#403F53"> lower </span><span style="--0:#C792EA;--1:#8D46B4">THEN</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#F78C6C;--1:#AA0982">2</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#809191;--1:#616671">-- 向下突破2个标准差</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">           </span><span style="--0:#C792EA;--1:#8D46B4">WHEN</span><span style="--0:#D6DEEB;--1:#403F53"> ssuper_upper </span><span style="--0:#C792EA;--1:#8D46B4">></span><span style="--0:#D6DEEB;--1:#403F53"> mean_lastprice </span><span style="--0:#C792EA;--1:#8D46B4">AND</span><span style="--0:#D6DEEB;--1:#403F53"> mean_lastprice </span><span style="--0:#C792EA;--1:#8D46B4">></span><span style="--0:#D6DEEB;--1:#403F53"> super_upper </span><span style="--0:#C792EA;--1:#8D46B4">THEN</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#F78C6C;--1:#AA0982">3</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#809191;--1:#616671">-- 向上突破4个标准差</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">           </span><span style="--0:#C792EA;--1:#8D46B4">WHEN</span><span style="--0:#D6DEEB;--1:#403F53"> ssuper_lower </span><span style="--0:#C792EA;--1:#8D46B4">&#x3C;</span><span style="--0:#D6DEEB;--1:#403F53"> mean_lastprice </span><span style="--0:#C792EA;--1:#8D46B4">AND</span><span style="--0:#D6DEEB;--1:#403F53"> mean_lastprice </span><span style="--0:#C792EA;--1:#8D46B4">&#x3C;</span><span style="--0:#D6DEEB;--1:#403F53"> super_lower </span><span style="--0:#C792EA;--1:#8D46B4">THEN</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#F78C6C;--1:#AA0982">4</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#809191;--1:#616671">-- 向下突破4个标准差</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">           </span><span style="--0:#C792EA;--1:#8D46B4">WHEN</span><span style="--0:#D6DEEB;--1:#403F53"> mean_lastprice </span><span style="--0:#C792EA;--1:#8D46B4">></span><span style="--0:#D6DEEB;--1:#403F53"> ssuper_upper </span><span style="--0:#C792EA;--1:#8D46B4">THEN</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#F78C6C;--1:#AA0982">5</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#809191;--1:#616671">-- 向上突破5个标准差</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">           </span><span style="--0:#C792EA;--1:#8D46B4">WHEN</span><span style="--0:#D6DEEB;--1:#403F53"> mean_lastprice </span><span style="--0:#C792EA;--1:#8D46B4">&#x3C;</span><span style="--0:#D6DEEB;--1:#403F53"> ssuper_lower </span><span style="--0:#C792EA;--1:#8D46B4">AND</span><span style="--0:#D6DEEB;--1:#403F53"> upper </span><span style="--0:#C792EA;--1:#8D46B4">!=</span><span style="--0:#D6DEEB;--1:#403F53"> lower </span><span style="--0:#C792EA;--1:#8D46B4">THEN</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#F78C6C;--1:#AA0982">6</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#809191;--1:#616671">-- 向下突破5个标准差</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">           </span><span style="--0:#C792EA;--1:#8D46B4">ELSE</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#F78C6C;--1:#AA0982">0</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#809191;--1:#616671">-- 在布林带内及其他情况</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">       </span><span style="--0:#C792EA;--1:#8D46B4">END</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">AS</span><span style="--0:#D6DEEB;--1:#403F53"> bollinger_band_status</span></div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">FROM</span><span style="--0:#D6DEEB;--1:#403F53"> (</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#809191;--1:#616671">-- 从内层查询中选择字段</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">SELECT</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">subquery</span><span style="--0:#D6DEEB;--1:#403F53">.</span><span style="--0:#82AAFF;--1:#3C63B3">minute</span><span style="--0:#D6DEEB;--1:#403F53">,</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">           </span><span style="--0:#82AAFF;--1:#3C63B3">subquery</span><span style="--0:#D6DEEB;--1:#403F53">.</span><span style="--0:#82AAFF;--1:#3C63B3">mean_lastprice</span><span style="--0:#D6DEEB;--1:#403F53">,</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">           </span><span style="--0:#82AAFF;--1:#3C63B3">subquery</span><span style="--0:#D6DEEB;--1:#403F53">.</span><span style="--0:#82AAFF;--1:#3C63B3">start_time</span><span style="--0:#D6DEEB;--1:#403F53">,</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">           </span><span style="--0:#809191;--1:#616671">-- 计算简单移动平均线 (SMA)</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">           </span><span style="--0:#C5E478;--1:#3C63B3">avg</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#82AAFF;--1:#3C63B3">subquery</span><span style="--0:#D6DEEB;--1:#403F53">.</span><span style="--0:#82AAFF;--1:#3C63B3">mean_lastprice</span><span style="--0:#D6DEEB;--1:#403F53">)</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">               </span><span style="--0:#C792EA;--1:#8D46B4">OVER</span><span style="--0:#D6DEEB;--1:#403F53"> (</span><span style="--0:#C792EA;--1:#8D46B4">PARTITION</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">BY</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">subquery</span><span style="--0:#D6DEEB;--1:#403F53">.</span><span style="--0:#82AAFF;--1:#3C63B3">start_time</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">ORDER BY</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">subquery</span><span style="--0:#D6DEEB;--1:#403F53">.</span><span style="--0:#82AAFF;--1:#3C63B3">minute</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">ASC</span><span style="--0:#D6DEEB;--1:#403F53">) </span><span style="--0:#C792EA;--1:#8D46B4">AS</span><span style="--0:#D6DEEB;--1:#403F53"> sma,</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">           </span><span style="--0:#809191;--1:#616671">-- 计算标准差</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">           stddevPop(</span><span style="--0:#82AAFF;--1:#3C63B3">subquery</span><span style="--0:#D6DEEB;--1:#403F53">.</span><span style="--0:#82AAFF;--1:#3C63B3">mean_lastprice</span><span style="--0:#D6DEEB;--1:#403F53">)</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">               </span><span style="--0:#C792EA;--1:#8D46B4">OVER</span><span style="--0:#D6DEEB;--1:#403F53"> (</span><span style="--0:#C792EA;--1:#8D46B4">PARTITION</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">BY</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">subquery</span><span style="--0:#D6DEEB;--1:#403F53">.</span><span style="--0:#82AAFF;--1:#3C63B3">start_time</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">ORDER BY</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">subquery</span><span style="--0:#D6DEEB;--1:#403F53">.</span><span style="--0:#82AAFF;--1:#3C63B3">minute</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">ASC</span><span style="--0:#D6DEEB;--1:#403F53">) </span><span style="--0:#C792EA;--1:#8D46B4">AS</span><span style="--0:#D6DEEB;--1:#403F53"> stddev,</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">           </span><span style="--0:#809191;--1:#616671">-- 计算布林带上下轨</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">           sma </span><span style="--0:#7FDBCA;--1:#097174">+</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#F78C6C;--1:#AA0982">1</span><span style="--0:#D6DEEB;--1:#403F53">.</span><span style="--0:#F78C6C;--1:#AA0982">5</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#097174">*</span><span style="--0:#D6DEEB;--1:#403F53"> stddevPop(</span><span style="--0:#82AAFF;--1:#3C63B3">subquery</span><span style="--0:#D6DEEB;--1:#403F53">.</span><span style="--0:#82AAFF;--1:#3C63B3">mean_lastprice</span><span style="--0:#D6DEEB;--1:#403F53">)</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">               </span><span style="--0:#C792EA;--1:#8D46B4">OVER</span><span style="--0:#D6DEEB;--1:#403F53"> (</span><span style="--0:#C792EA;--1:#8D46B4">PARTITION</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">BY</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">subquery</span><span style="--0:#D6DEEB;--1:#403F53">.</span><span style="--0:#82AAFF;--1:#3C63B3">start_time</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">ORDER BY</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">subquery</span><span style="--0:#D6DEEB;--1:#403F53">.</span><span style="--0:#82AAFF;--1:#3C63B3">minute</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">ASC</span><span style="--0:#D6DEEB;--1:#403F53">) </span><span style="--0:#C792EA;--1:#8D46B4">AS</span><span style="--0:#D6DEEB;--1:#403F53"> upper,</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">           sma </span><span style="--0:#7FDBCA;--1:#097174">-</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#F78C6C;--1:#AA0982">1</span><span style="--0:#D6DEEB;--1:#403F53">.</span><span style="--0:#F78C6C;--1:#AA0982">5</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#097174">*</span><span style="--0:#D6DEEB;--1:#403F53"> stddevPop(</span><span style="--0:#82AAFF;--1:#3C63B3">subquery</span><span style="--0:#D6DEEB;--1:#403F53">.</span><span style="--0:#82AAFF;--1:#3C63B3">mean_lastprice</span><span style="--0:#D6DEEB;--1:#403F53">)</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">               </span><span style="--0:#C792EA;--1:#8D46B4">OVER</span><span style="--0:#D6DEEB;--1:#403F53"> (</span><span style="--0:#C792EA;--1:#8D46B4">PARTITION</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">BY</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">subquery</span><span style="--0:#D6DEEB;--1:#403F53">.</span><span style="--0:#82AAFF;--1:#3C63B3">start_time</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">ORDER BY</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">subquery</span><span style="--0:#D6DEEB;--1:#403F53">.</span><span style="--0:#82AAFF;--1:#3C63B3">minute</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">ASC</span><span style="--0:#D6DEEB;--1:#403F53">) </span><span style="--0:#C792EA;--1:#8D46B4">AS</span><span style="--0:#D6DEEB;--1:#403F53"> lower,</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">           </span><span style="--0:#809191;--1:#616671">-- 计算更高和更低的布林带轨道</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">           sma </span><span style="--0:#7FDBCA;--1:#097174">+</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#F78C6C;--1:#AA0982">3</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#097174">*</span><span style="--0:#D6DEEB;--1:#403F53"> stddevPop(</span><span style="--0:#82AAFF;--1:#3C63B3">subquery</span><span style="--0:#D6DEEB;--1:#403F53">.</span><span style="--0:#82AAFF;--1:#3C63B3">mean_lastprice</span><span style="--0:#D6DEEB;--1:#403F53">)</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">               </span><span style="--0:#C792EA;--1:#8D46B4">OVER</span><span style="--0:#D6DEEB;--1:#403F53"> (</span><span style="--0:#C792EA;--1:#8D46B4">PARTITION</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">BY</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">subquery</span><span style="--0:#D6DEEB;--1:#403F53">.</span><span style="--0:#82AAFF;--1:#3C63B3">start_time</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">ORDER BY</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">subquery</span><span style="--0:#D6DEEB;--1:#403F53">.</span><span style="--0:#82AAFF;--1:#3C63B3">minute</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">ASC</span><span style="--0:#D6DEEB;--1:#403F53">) </span><span style="--0:#C792EA;--1:#8D46B4">AS</span><span style="--0:#D6DEEB;--1:#403F53"> super_upper,</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">           sma </span><span style="--0:#7FDBCA;--1:#097174">-</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#F78C6C;--1:#AA0982">3</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#097174">*</span><span style="--0:#D6DEEB;--1:#403F53"> stddevPop(</span><span style="--0:#82AAFF;--1:#3C63B3">subquery</span><span style="--0:#D6DEEB;--1:#403F53">.</span><span style="--0:#82AAFF;--1:#3C63B3">mean_lastprice</span><span style="--0:#D6DEEB;--1:#403F53">)</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">               </span><span style="--0:#C792EA;--1:#8D46B4">OVER</span><span style="--0:#D6DEEB;--1:#403F53"> (</span><span style="--0:#C792EA;--1:#8D46B4">PARTITION</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">BY</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">subquery</span><span style="--0:#D6DEEB;--1:#403F53">.</span><span style="--0:#82AAFF;--1:#3C63B3">start_time</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">ORDER BY</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">subquery</span><span style="--0:#D6DEEB;--1:#403F53">.</span><span style="--0:#82AAFF;--1:#3C63B3">minute</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">ASC</span><span style="--0:#D6DEEB;--1:#403F53">) </span><span style="--0:#C792EA;--1:#8D46B4">AS</span><span style="--0:#D6DEEB;--1:#403F53"> super_lower,</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">           sma </span><span style="--0:#7FDBCA;--1:#097174">+</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#F78C6C;--1:#AA0982">4</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#097174">*</span><span style="--0:#D6DEEB;--1:#403F53"> stddevPop(</span><span style="--0:#82AAFF;--1:#3C63B3">subquery</span><span style="--0:#D6DEEB;--1:#403F53">.</span><span style="--0:#82AAFF;--1:#3C63B3">mean_lastprice</span><span style="--0:#D6DEEB;--1:#403F53">)</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">               </span><span style="--0:#C792EA;--1:#8D46B4">OVER</span><span style="--0:#D6DEEB;--1:#403F53"> (</span><span style="--0:#C792EA;--1:#8D46B4">PARTITION</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">BY</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">subquery</span><span style="--0:#D6DEEB;--1:#403F53">.</span><span style="--0:#82AAFF;--1:#3C63B3">start_time</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">ORDER BY</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">subquery</span><span style="--0:#D6DEEB;--1:#403F53">.</span><span style="--0:#82AAFF;--1:#3C63B3">minute</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">ASC</span><span style="--0:#D6DEEB;--1:#403F53">) </span><span style="--0:#C792EA;--1:#8D46B4">AS</span><span style="--0:#D6DEEB;--1:#403F53"> ssuper_upper,</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">           sma </span><span style="--0:#7FDBCA;--1:#097174">-</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#F78C6C;--1:#AA0982">4</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#097174">*</span><span style="--0:#D6DEEB;--1:#403F53"> stddevPop(</span><span style="--0:#82AAFF;--1:#3C63B3">subquery</span><span style="--0:#D6DEEB;--1:#403F53">.</span><span style="--0:#82AAFF;--1:#3C63B3">mean_lastprice</span><span style="--0:#D6DEEB;--1:#403F53">)</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">               </span><span style="--0:#C792EA;--1:#8D46B4">OVER</span><span style="--0:#D6DEEB;--1:#403F53"> (</span><span style="--0:#C792EA;--1:#8D46B4">PARTITION</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">BY</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">subquery</span><span style="--0:#D6DEEB;--1:#403F53">.</span><span style="--0:#82AAFF;--1:#3C63B3">start_time</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">ORDER BY</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">subquery</span><span style="--0:#D6DEEB;--1:#403F53">.</span><span style="--0:#82AAFF;--1:#3C63B3">minute</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">ASC</span><span style="--0:#D6DEEB;--1:#403F53">) </span><span style="--0:#C792EA;--1:#8D46B4">AS</span><span style="--0:#D6DEEB;--1:#403F53"> ssuper_lower</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">FROM</span><span style="--0:#D6DEEB;--1:#403F53"> (</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        </span><span style="--0:#809191;--1:#616671">-- 最内层查询，按分钟聚合数据并计算均价</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        </span><span style="--0:#C792EA;--1:#8D46B4">SELECT</span><span style="--0:#D6DEEB;--1:#403F53"> toStartOfMinute(</span><span style="--0:#C792EA;--1:#8D46B4">datetime</span><span style="--0:#D6DEEB;--1:#403F53">) </span><span style="--0:#C792EA;--1:#8D46B4">AS</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">minute</span><span style="--0:#D6DEEB;--1:#403F53">,</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">               </span><span style="--0:#C5E478;--1:#3C63B3">AVG</span><span style="--0:#D6DEEB;--1:#403F53">(lastprice)            </span><span style="--0:#C792EA;--1:#8D46B4">AS</span><span style="--0:#D6DEEB;--1:#403F53"> mean_lastprice,</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">               </span><span style="--0:#809191;--1:#616671">-- 计算开始时间，根据 datetime 决定是当前日期的 21 点还是前一天的 21 点</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">               </span><span style="--0:#C792EA;--1:#8D46B4">CASE</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">                   </span><span style="--0:#C792EA;--1:#8D46B4">WHEN</span><span style="--0:#D6DEEB;--1:#403F53"> toHour(</span><span style="--0:#C792EA;--1:#8D46B4">datetime</span><span style="--0:#D6DEEB;--1:#403F53">) </span><span style="--0:#C792EA;--1:#8D46B4">&#x3C;</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#F78C6C;--1:#AA0982">21</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">THEN</span><span style="--0:#D6DEEB;--1:#403F53"> toDate(</span><span style="--0:#C792EA;--1:#8D46B4">datetime</span><span style="--0:#D6DEEB;--1:#403F53">) </span><span style="--0:#7FDBCA;--1:#097174">-</span><span style="--0:#D6DEEB;--1:#403F53"> INTERVAL </span><span style="--0:#F78C6C;--1:#AA0982">1</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">DAY</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#097174">+</span><span style="--0:#D6DEEB;--1:#403F53"> INTERVAL </span><span style="--0:#F78C6C;--1:#AA0982">21</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">HOUR</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">                   </span><span style="--0:#C792EA;--1:#8D46B4">ELSE</span><span style="--0:#D6DEEB;--1:#403F53"> toDate(</span><span style="--0:#C792EA;--1:#8D46B4">datetime</span><span style="--0:#D6DEEB;--1:#403F53">) </span><span style="--0:#7FDBCA;--1:#097174">+</span><span style="--0:#D6DEEB;--1:#403F53"> INTERVAL </span><span style="--0:#F78C6C;--1:#AA0982">21</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">HOUR</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">               </span><span style="--0:#C792EA;--1:#8D46B4">END</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">AS</span><span style="--0:#D6DEEB;--1:#403F53"> start_time</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        </span><span style="--0:#C792EA;--1:#8D46B4">FROM</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">futures</span><span style="--0:#D6DEEB;--1:#403F53">.</span><span style="--0:#82AAFF;--1:#3C63B3">AG2305</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        </span><span style="--0:#C792EA;--1:#8D46B4">GROUP BY</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">minute</span><span style="--0:#D6DEEB;--1:#403F53">, start_time</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    ) subquery</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">) outer_query</span></div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">ORDER BY</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">outer_query</span><span style="--0:#D6DEEB;--1:#403F53">.</span><span style="--0:#82AAFF;--1:#3C63B3">minute</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="-- 创建名为 AG2305_TEST 的表，使用 MergeTree 引擎CREATE TABLE AG2305_TEST    ENGINE = MergeTree()        ORDER BY (minute, mean_lastprice) -- 按 minute 和 mean_lastprice 排序AS-- 从子查询中选择字段SELECT outer_query.minute,       CAST(outer_query.mean_lastprice AS Float32) AS mean_lastprice, -- 将 mean_lastprice 转换为 Float32 类型       CAST(sma AS Float32)                        AS sma,           -- 将 sma 转换为 Float32 类型       CAST(stddev AS Float32)                     AS stddev,        -- 将 stddev 转换为 Float32 类型       CAST(upper AS Float32)                      AS upper,         -- 将 upper 转换为 Float32 类型       CAST(lower AS Float32)                      AS lower,         -- 将 lower 转换为 Float32 类型       CAST(super_upper AS Float32)                AS super_upper,   -- 将 super_upper 转换为 Float32 类型       CAST(super_lower AS Float32)                AS super_lower,   -- 将 super_lower 转换为 Float32 类型       CAST(ssuper_upper AS Float32)               AS ssuper_upper,  -- 将 ssuper_upper 转换为 Float32 类型       CAST(ssuper_lower AS Float32)               AS ssuper_lower,  -- 将 ssuper_lower 转换为 Float32 类型       CASE           -- 根据价格突破的不同情况赋值 bollinger_band_status           WHEN super_upper > mean_lastprice AND mean_lastprice > upper THEN 1 -- 向上突破2个标准差           WHEN super_lower < mean_lastprice AND mean_lastprice < lower THEN 2 -- 向下突破2个标准差           WHEN ssuper_upper > mean_lastprice AND mean_lastprice > super_upper THEN 3 -- 向上突破4个标准差           WHEN ssuper_lower < mean_lastprice AND mean_lastprice < super_lower THEN 4 -- 向下突破4个标准差           WHEN mean_lastprice > ssuper_upper THEN 5 -- 向上突破5个标准差           WHEN mean_lastprice < ssuper_lower AND upper != lower THEN 6 -- 向下突破5个标准差           ELSE 0 -- 在布林带内及其他情况       END AS bollinger_band_statusFROM (    -- 从内层查询中选择字段    SELECT subquery.minute,           subquery.mean_lastprice,           subquery.start_time,           -- 计算简单移动平均线 (SMA)           avg(subquery.mean_lastprice)               OVER (PARTITION BY subquery.start_time ORDER BY subquery.minute ASC) AS sma,           -- 计算标准差           stddevPop(subquery.mean_lastprice)               OVER (PARTITION BY subquery.start_time ORDER BY subquery.minute ASC) AS stddev,           -- 计算布林带上下轨           sma + 1.5 * stddevPop(subquery.mean_lastprice)               OVER (PARTITION BY subquery.start_time ORDER BY subquery.minute ASC) AS upper,           sma - 1.5 * stddevPop(subquery.mean_lastprice)               OVER (PARTITION BY subquery.start_time ORDER BY subquery.minute ASC) AS lower,           -- 计算更高和更低的布林带轨道           sma + 3 * stddevPop(subquery.mean_lastprice)               OVER (PARTITION BY subquery.start_time ORDER BY subquery.minute ASC) AS super_upper,           sma - 3 * stddevPop(subquery.mean_lastprice)               OVER (PARTITION BY subquery.start_time ORDER BY subquery.minute ASC) AS super_lower,           sma + 4 * stddevPop(subquery.mean_lastprice)               OVER (PARTITION BY subquery.start_time ORDER BY subquery.minute ASC) AS ssuper_upper,           sma - 4 * stddevPop(subquery.mean_lastprice)               OVER (PARTITION BY subquery.start_time ORDER BY subquery.minute ASC) AS ssuper_lower    FROM (        -- 最内层查询，按分钟聚合数据并计算均价        SELECT toStartOfMinute(datetime) AS minute,               AVG(lastprice)            AS mean_lastprice,               -- 计算开始时间，根据 datetime 决定是当前日期的 21 点还是前一天的 21 点               CASE                   WHEN toHour(datetime) < 21 THEN toDate(datetime) - INTERVAL 1 DAY + INTERVAL 21 HOUR                   ELSE toDate(datetime) + INTERVAL 21 HOUR               END AS start_time        FROM futures.AG2305        GROUP BY minute, start_time    ) subquery) outer_queryORDER BY outer_query.minute;"><div></div></button></div></figure></div>
<h3 id="脚本解析">脚本解析</h3>
<ol>
<li><strong>创建表</strong>：使用 MergeTree 引擎创建表 <code dir="auto">AG2305_TEST</code>，并按 <code dir="auto">minute</code> 和 <code dir="auto">mean_lastprice</code> 排序。</li>
<li><strong>选择字段</strong>：从内部查询中选择字段并进行类型转换。</li>
<li><strong>布林带状态</strong>：根据价格与布林带上下轨的关系，确定 <code dir="auto">bollinger_band_status</code> 的值。</li>
<li><strong>内部查询</strong>：
<ul>
<li><strong>子查询</strong>：聚合每分钟的平均价格 <code dir="auto">mean_lastprice</code>，并计算开始时间 <code dir="auto">start_time</code>。</li>
<li><strong>布林带计算</strong>：计算简单移动平均线（SMA）和不同标准差倍数的上下轨。</li>
</ul>
</li>
</ol>
<p>通过这个逐行注释的 SQL 脚本，可以更好地理解如何在 ClickHouse 中创建复杂的计算表，并应用于量化金融领域的数据处理。</p>
<h1 id="chapter-25---unsafe">Chapter 25 - Unsafe</h1>
<p><code dir="auto">unsafe</code> 关键字是 Rust 中的一个特性，允许你编写不受 Rust 安全性检查保护的代码块。使用 <code dir="auto">unsafe</code> 可以执行一些不安全的操作，如手动管理内存、绕过借用检查、执行原生指针操作等。它为你提供了更多的灵活性，但也增加了出现内存不安全和其他错误的风险。</p>
<p>以下是 <code dir="auto">unsafe</code> 在 Rust 中的一些典型应用：</p>
<ol>
<li>
<p><strong>手动管理内存</strong>：使用 <code dir="auto">unsafe</code> 可以手动分配和释放内存，例如使用 <code dir="auto">malloc</code> 和 <code dir="auto">free</code> 类似的操作。这在编写操作系统、嵌入式系统或需要精细控制内存的高性能应用中很有用。</p>
</li>
<li>
<p><strong>原生指针</strong>：<code dir="auto">unsafe</code> 允许你使用原生指针（raw pointers），如裸指针（<code dir="auto">*const T</code> 和 <code dir="auto">*mut T</code>）来进行底层内存操作。这包括解引用、指针算术和类型转换等。</p>
</li>
<li>
<p><strong>绕过借用检查</strong>：有时候，你可能需要在某些情况下绕过 Rust 的借用检查规则，以实现一些特殊的操作，如跨函数传递可变引用。</p>
</li>
<li>
<p><strong>调用外部代码</strong>：当与其他编程语言（如 C 或 C++）进行交互时，你可能需要使用 <code dir="auto">unsafe</code> 来调用外部的不受 Rust 控制的代码。这包括编写 Rust 绑定以与 C 库进行交互。</p>
</li>
<li>
<p><strong>多线程编程</strong>：<code dir="auto">unsafe</code> 有时候用于多线程编程，以管理共享状态、原子操作和同步原语。这包括 <code dir="auto">std::sync</code> 和 <code dir="auto">std::thread</code> 中的一些功能。</p>
</li>
</ol>
<p>需要注意的是，使用 <code dir="auto">unsafe</code> 需要非常小心，因为它可以导致内存不安全、数据竞争和其他严重的错误。Rust 的安全性特性是它的一大卖点，<code dir="auto">unsafe</code> 的使用应该被限制在必要的情况下，并且必须经过仔细的审查和测试。在实际编程中，大多数情况下都可以避免使用 <code dir="auto">unsafe</code>，因为 Rust 提供了强大的工具来确保代码的安全性和正确性。只有在需要访问底层系统资源、进行高性能优化或与外部代码交互等特殊情况下，才应该考虑使用 <code dir="auto">unsafe</code>。</p>
<p>在金融领域，Rust 的 <code dir="auto">unsafe</code> 关键字通常需要谨慎使用，因为金融系统涉及到重要的安全性和可靠性要求。<code dir="auto">unsafe</code> 允许绕过 Rust 的安全检查和规则，这意味着你需要更加小心地管理代码，以确保它不会导致内存不安全或其他安全性问题。</p>
<p>以下是在金融领域中可能使用 <code dir="auto">unsafe</code> 的一些场景和用例：</p>
<ol>
<li>
<p><strong>与外部系统集成</strong>：金融系统通常需要与底层硬件、操作系统、网络库等进行交互。在这些情况下，<code dir="auto">unsafe</code> 可能用于编写与外部 C 代码进行交互的 Rust 绑定，以确保正确的内存布局和数据传递。</p>
</li>
<li>
<p><strong>性能优化</strong>：金融计算通常涉及大量数据处理，对性能要求较高。在某些情况下，使用 <code dir="auto">unsafe</code> 可能允许你进行底层内存操作或使用不安全的优化技巧，以提高计算性能。</p>
</li>
<li>
<p><strong>数据结构的自定义实现</strong>：金融领域可能需要定制的数据结构，以满足特定的需求。在这种情况下，<code dir="auto">unsafe</code> 可能用于实现自定义数据结构，但必须确保这些结构是正确和安全的。</p>
</li>
<li>
<p><strong>低级别的多线程编程</strong>：金融系统通常需要高度并发的处理能力。在处理多线程和并发性时，可能需要使用 <code dir="auto">unsafe</code> 来管理线程间的共享状态和同步原语，但必须小心避免数据竞争和其他多线程问题。</p>
</li>
</ol>
<p>无论在金融领域还是其他领域，使用 <code dir="auto">unsafe</code> 都需要严格的代码审查和测试，以确保代码的正确性和安全性。在金融领域特别需要保持高度的可信度，因此必须格外小心，遵循最佳实践，使用 <code dir="auto">unsafe</code> 的时机应该非常明确，并且必须有充分的理由。另外，金融领域通常受到监管和合规性要求，这也需要确保代码的安全性和稳定性。因此，<code dir="auto">unsafe</code> 应该谨慎使用，只在真正需要时才使用，并且应该由经验丰富的工程师来管理和审查。</p>
<p>在量化金融领域，有些情况下确实需要使用 <code dir="auto">unsafe</code> 来执行一些底层操作，尤其是在与外部 C/C++ 库进行交互时。一个常见的案例是与某些量化金融库或市场数据提供商的 C/C++ API 进行集成。以下是一个示例，展示了如何在 Rust 中与外部 C/C++ 金融库进行交互，可能需要使用 <code dir="auto">unsafe</code>。</p>
<h3 id="案例与外部金融库的交互"><strong>案例：与外部金融库的交互</strong></h3>
<p>假设你的量化金融策略需要获取市场数据，但市场数据提供商只提供了 C/C++ API。在这种情况下，你可以编写一个 Rust 绑定，以便在 Rust 中调用外部 C/C++ 函数。</p>
<p>首先，你需要创建一个 Rust 项目，并设置一个用于与外部库交互的 Rust 模块。然后，创建一个 Rust 绑定，将外部库的函数声明和数据结构导入到 Rust 中。这可能涉及到使用 <code dir="auto">extern</code> 关键字和 <code dir="auto">unsafe</code> 代码块来调用外部函数。</p>
<p>以下是一个简化的示例：</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#809191;--1:#5E6578">// extern声明，将外部库中的函数导入到Rust中</span></div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">extern</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">C</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">fn</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">get_stock_price</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#C5E478;--1:#3C63B3">symbol</span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#097174">*</span><span style="--0:#C792EA;--1:#8D46B4">const</span><span style="--0:#D6DEEB;--1:#403F53"> u8) </span><span style="--0:#7FDBCA;--1:#097174">-></span><span style="--0:#D6DEEB;--1:#403F53"> f64;</span></div><div class="ec-line"><span style="--0:#809191;--1:#5E6578">    // 还可以导入其他函数和数据结构</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">}</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#809191;--1:#5E6578">// 调用外部函数的Rust封装</span></div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">pub</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">fn</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">get_stock_price_rust</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#C5E478;--1:#3C63B3">symbol</span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#097174">&#x26;</span><span style="--0:#D6DEEB;--1:#403F53">str) </span><span style="--0:#7FDBCA;--1:#097174">-></span><span style="--0:#D6DEEB;--1:#403F53"> Option&#x3C;f64> {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">c_symbol</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> CString</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#82AAFF;--1:#3C63B3">new</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#C5E478;--1:#3C63B3">symbol</span><span style="--0:#D6DEEB;--1:#403F53">)</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">expect</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">CString conversion failed</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">price</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">unsafe</span><span style="--0:#D6DEEB;--1:#403F53"> { </span><span style="--0:#82AAFF;--1:#3C63B3">get_stock_price</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#C5E478;--1:#3C63B3">c_symbol</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">as_ptr</span><span style="--0:#D6DEEB;--1:#403F53">()) };</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">if</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">price</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">&#x3C;</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#F78C6C;--1:#AA0982">0.0</span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        None</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    } </span><span style="--0:#C792EA;--1:#8D46B4">else</span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        Some(</span><span style="--0:#C5E478;--1:#3C63B3">price</span><span style="--0:#D6DEEB;--1:#403F53">)</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    }</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">}</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">fn</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">main</span><span style="--0:#D6DEEB;--1:#403F53">() {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">symbol</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">AAPL</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">if</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> Some(</span><span style="--0:#C5E478;--1:#3C63B3">price</span><span style="--0:#D6DEEB;--1:#403F53">) </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">get_stock_price_rust</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#C5E478;--1:#3C63B3">symbol</span><span style="--0:#D6DEEB;--1:#403F53">) {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        </span><span style="--0:#82AAFF;--1:#3C63B3">println!</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">The stock price of {} is ${:.2}</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#C5E478;--1:#3C63B3">symbol</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#C5E478;--1:#3C63B3">price</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    } </span><span style="--0:#C792EA;--1:#8D46B4">else</span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        </span><span style="--0:#82AAFF;--1:#3C63B3">println!</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">Failed to retrieve the stock price for {}</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#C5E478;--1:#3C63B3">symbol</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    }</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">}</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="// extern声明，将外部库中的函数导入到Rust中extern &#x22;C&#x22; {    fn get_stock_price(symbol: *const u8) -> f64;    // 还可以导入其他函数和数据结构}// 调用外部函数的Rust封装pub fn get_stock_price_rust(symbol: &#x26;str) -> Option<f64> {    let c_symbol = CString::new(symbol).expect(&#x22;CString conversion failed&#x22;);    let price = unsafe { get_stock_price(c_symbol.as_ptr()) };    if price < 0.0 {        None    } else {        Some(price)    }}fn main() {    let symbol = &#x22;AAPL&#x22;;    if let Some(price) = get_stock_price_rust(symbol) {        println!(&#x22;The stock price of {} is ${:.2}&#x22;, symbol, price);    } else {        println!(&#x22;Failed to retrieve the stock price for {}&#x22;, symbol);    }}"><div></div></button></div></figure></div>
<p>在这个示例中，我们假设有一个外部 C/C++ 函数 <code dir="auto">get_stock_price</code>，它获取股票代码并返回股价。我们使用 <code dir="auto">extern "C"</code> 声明将其导入到 Rust 中，并在 <code dir="auto">get_stock_price_rust</code> 函数中使用 <code dir="auto">unsafe</code> 调用它。</p>
<p>这个示例展示了在量化金融中可能需要使用 <code dir="auto">unsafe</code> 的情况，因为你必须管理外部 C/C++ 函数的调用以及与它们的交互。在这种情况下，你需要确保 <code dir="auto">unsafe</code> 代码块中的操作是正确且安全的，并且进行了适当的错误处理。在与外部库进行交互时，一定要小心确保代码的正确性和稳定性。</p>
<h3 id="案例高性能数值计算"><strong>案例：高性能数值计算</strong></h3>
<p>另一个可能需要使用 <code dir="auto">unsafe</code> 的量化金融案例是执行高性能计算和优化，特别是在需要进行大规模数据处理和数值计算时。以下是一个示例，展示了如何使用 <code dir="auto">unsafe</code> 来执行高性能数值计算的情况。</p>
<p>假设你正在开发一个量化金融策略，需要进行大规模的数值计算，例如蒙特卡洛模拟或优化算法。在这种情况下，你可能需要使用 Rust 中的 <code dir="auto">ndarray</code> 或其他数值计算库来执行操作，但某些操作可能需要使用 <code dir="auto">unsafe</code> 来提高性能。</p>
<p>以下是一个示例，展示了如何使用 <code dir="auto">unsafe</code> 来执行矩阵操作：</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">use</span><span style="--0:#D6DEEB;--1:#403F53"> ndarray</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#D6DEEB;--1:#403F53">{Array2, Axis, s};</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">fn</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">main</span><span style="--0:#D6DEEB;--1:#403F53">() {</span></div><div class="ec-line"><span style="--0:#809191;--1:#5E6578">    // 创建一个大矩阵</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">size</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#F78C6C;--1:#AA0982">1000</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">mut</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">matrix</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> Array2</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#82AAFF;--1:#3C63B3">zeros</span><span style="--0:#D6DEEB;--1:#403F53">((</span><span style="--0:#C5E478;--1:#3C63B3">size</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#C5E478;--1:#3C63B3">size</span><span style="--0:#D6DEEB;--1:#403F53">));</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#809191;--1:#5E6578">    // 使用 unsafe 来执行高性能操作</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">unsafe</span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div><div class="ec-line"><span style="--0:#809191;--1:#5E6578">        // 假设这是一个计算密集型的操作</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        </span><span style="--0:#C792EA;--1:#8D46B4">for</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">i</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">in</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#F78C6C;--1:#AA0982">0</span><span style="--0:#7FDBCA;--1:#097174">..</span><span style="--0:#C5E478;--1:#3C63B3">size</span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">            </span><span style="--0:#C792EA;--1:#8D46B4">for</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">j</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">in</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#F78C6C;--1:#AA0982">0</span><span style="--0:#7FDBCA;--1:#097174">..</span><span style="--0:#C5E478;--1:#3C63B3">size</span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">                </span><span style="--0:#7FDBCA;--1:#097174">*</span><span style="--0:#C5E478;--1:#3C63B3">matrix</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">uget_mut</span><span style="--0:#D6DEEB;--1:#403F53">((</span><span style="--0:#C5E478;--1:#3C63B3">i</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#C5E478;--1:#3C63B3">j</span><span style="--0:#D6DEEB;--1:#403F53">)) </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">i</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">as</span><span style="--0:#D6DEEB;--1:#403F53"> f64 </span><span style="--0:#7FDBCA;--1:#097174">*</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">j</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">as</span><span style="--0:#D6DEEB;--1:#403F53"> f64;</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">            }</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        }</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    }</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#809191;--1:#5E6578">    // 执行其他操作</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">row_sum</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">matrix</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">sum_axis</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#82AAFF;--1:#3C63B3">Axis</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#F78C6C;--1:#AA0982">0</span><span style="--0:#D6DEEB;--1:#403F53">));</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">max_value</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">matrix</span><span style="--0:#7FDBCA;--1:#097174">.</span><span style="--0:#82AAFF;--1:#3C63B3">fold</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#F78C6C;--1:#AA0982">0.0</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#C792EA;--1:#8D46B4">|</span><span style="--0:#C5E478;--1:#3C63B3">max</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#7FDBCA;--1:#097174">&#x26;</span><span style="--0:#C5E478;--1:#3C63B3">x</span><span style="--0:#C792EA;--1:#8D46B4">|</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">if</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">x</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">></span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">max</span><span style="--0:#D6DEEB;--1:#403F53"> { </span><span style="--0:#C5E478;--1:#3C63B3">x</span><span style="--0:#D6DEEB;--1:#403F53"> } </span><span style="--0:#C792EA;--1:#8D46B4">else</span><span style="--0:#D6DEEB;--1:#403F53"> { </span><span style="--0:#C5E478;--1:#3C63B3">max</span><span style="--0:#D6DEEB;--1:#403F53"> });</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#82AAFF;--1:#3C63B3">println!</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">Row sum: {:?}</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#C5E478;--1:#3C63B3">row_sum</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#82AAFF;--1:#3C63B3">println!</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">Max value: {:?}</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#C5E478;--1:#3C63B3">max_value</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">}</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="use ndarray::{Array2, Axis, s};fn main() {    // 创建一个大矩阵    let size = 1000;    let mut matrix = Array2::zeros((size, size));    // 使用 unsafe 来执行高性能操作    unsafe {        // 假设这是一个计算密集型的操作        for i in 0..size {            for j in 0..size {                *matrix.uget_mut((i, j)) = i as f64 * j as f64;            }        }    }    // 执行其他操作    let row_sum = matrix.sum_axis(Axis(0));    let max_value = matrix.fold(0.0, |max, &#x26;x| if x > max { x } else { max });    println!(&#x22;Row sum: {:?}&#x22;, row_sum);    println!(&#x22;Max value: {:?}&#x22;, max_value);}"><div></div></button></div></figure></div>
<p>在这个示例中，我们使用 <code dir="auto">ndarray</code> 库创建了一个大矩阵，并使用 <code dir="auto">unsafe</code> 块来执行计算密集型的操作以填充矩阵。这个操作假设你已经确保了正确性和安全性，因此可以使用 <code dir="auto">unsafe</code> 来提高性能。</p>
<p>需要注意的是，使用 <code dir="auto">unsafe</code> 应该非常小心，必须确保操作是正确的且不会导致内存不安全。在实际应用中，你可能需要使用更多的数值计算库和优化工具，但 <code dir="auto">unsafe</code> 可以在某些情况下提供额外的性能优势。无论如何，对于量化金融策略，正确性和可维护性始终比性能更重要，因此使用 <code dir="auto">unsafe</code> 应该谨慎，并且必须小心验证和测试代码。</p>
<h1 id="chapter-26---文档和测试">Chapter 26 - 文档和测试</h1>
<h2 id="261-文档注释">26.1 文档注释</h2>
<p>在 Rust 中，文档的编写主要使用文档注释（Doc Comments）和 Rustdoc 工具来生成文档。文档注释以 <code dir="auto">///</code> 或 <code dir="auto">//!</code> 开始，通常位于函数、模块、结构体、枚举等声明的前面。以下是 Rust 中文档编写的基本写法和示例：</p>
<ol>
<li>
<p><strong>文档注释格式</strong>：</p>
<p>文档注释通常遵循一定的格式，包括描述、用法示例、参数说明、返回值说明等。下面是一个通用的文档注释格式示例：</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#809191;--1:#616671">/// This is a description of what the item does.</span></div><div class="ec-line"><span style="--0:#809191;--1:#616671">///</span></div><div class="ec-line"><span style="--0:#809191;--1:#616671">/// # Examples</span></div><div class="ec-line"><span style="--0:#809191;--1:#616671">///</span></div><div class="ec-line"><span style="--0:#809191;--1:#616671">/// ```</span></div><div class="ec-line"><span style="--0:#809191;--1:#616671">/// let result = my_function(arg1, arg2);</span></div><div class="ec-line"><span style="--0:#809191;--1:#616671">/// assert_eq!(result, expected_value);</span></div><div class="ec-line"><span style="--0:#809191;--1:#616671">/// ```</span></div><div class="ec-line"><span style="--0:#809191;--1:#616671">///</span></div><div class="ec-line"><span style="--0:#809191;--1:#616671">/// ## Parameters</span></div><div class="ec-line"><span style="--0:#809191;--1:#616671">///</span></div><div class="ec-line"><span style="--0:#809191;--1:#616671">/// - `arg1`: Description of the first argument.</span></div><div class="ec-line"><span style="--0:#809191;--1:#616671">/// - `arg2`: Description of the second argument.</span></div><div class="ec-line"><span style="--0:#809191;--1:#616671">///</span></div><div class="ec-line"><span style="--0:#809191;--1:#616671">/// ## Returns</span></div><div class="ec-line"><span style="--0:#809191;--1:#616671">///</span></div><div class="ec-line"><span style="--0:#809191;--1:#616671">/// Description of the return value.</span></div><div class="ec-line"><span style="--0:#809191;--1:#616671">///</span></div><div class="ec-line"><span style="--0:#809191;--1:#616671">/// # Panics</span></div><div class="ec-line"><span style="--0:#809191;--1:#616671">///</span></div><div class="ec-line"><span style="--0:#809191;--1:#616671">/// Description of panic conditions, if any.</span></div><div class="ec-line"><span style="--0:#809191;--1:#616671">///</span></div><div class="ec-line"><span style="--0:#809191;--1:#616671">/// # Errors</span></div><div class="ec-line"><span style="--0:#809191;--1:#616671">///</span></div><div class="ec-line"><span style="--0:#809191;--1:#616671">/// Description of possible error conditions, if any.</span></div><div class="ec-line"><span style="--0:#809191;--1:#616671">///</span></div><div class="ec-line"><span style="--0:#809191;--1:#616671">/// # Safety</span></div><div class="ec-line"><span style="--0:#809191;--1:#616671">///</span></div><div class="ec-line"><span style="--0:#809191;--1:#616671">/// Explanation of any unsafe code or invariants.</span></div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">pub</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">fn</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">my_function</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#C5E478;--1:#3C63B3">arg1</span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#D6DEEB;--1:#403F53"> Type1, </span><span style="--0:#C5E478;--1:#3C63B3">arg2</span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#D6DEEB;--1:#403F53"> Type2) </span><span style="--0:#7FDBCA;--1:#097174">-></span><span style="--0:#D6DEEB;--1:#403F53"> ReturnType {</span></div><div class="ec-line"><span style="--0:#809191;--1:#5E6578">    // Function implementation</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">}</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="/// This is a description of what the item does.////// # Examples////// &#x60;&#x60;&#x60;/// let result = my_function(arg1, arg2);/// assert_eq!(result, expected_value);/// &#x60;&#x60;&#x60;////// ## Parameters////// - &#x60;arg1&#x60;: Description of the first argument./// - &#x60;arg2&#x60;: Description of the second argument.////// ## Returns////// Description of the return value.////// # Panics////// Description of panic conditions, if any.////// # Errors////// Description of possible error conditions, if any.////// # Safety////// Explanation of any unsafe code or invariants.pub fn my_function(arg1: Type1, arg2: Type2) -> ReturnType {    // Function implementation}"><div></div></button></div></figure></div>
<p>在上面的示例中，文档注释包括描述、用法示例、参数说明、返回值说明以及可能的 panic 和错误情况的描述。</p>
</li>
<li>
<p><strong>生成文档</strong>：</p>
<p>为了生成文档，你可以使用 Rust 内置的文档生成工具 Rustdoc。运行以下命令来生成文档：</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#d6deeb;--1:#403f53">cargo doc</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="cargo doc"><div></div></button></div></figure></div>
<p>这将生成文档并将其保存在项目目录的 <code dir="auto">target/doc</code> 文件夹下。你可以在浏览器中打开生成的文档（位于 <code dir="auto">target/doc</code> 中的 <code dir="auto">index.html</code> 文件）来查看你的代码文档。</p>
</li>
<li>
<p><strong>链接到其他项</strong>：</p>
<p>你可以在文档中链接到其他项，如函数、模块、结构体等，以便创建交叉引用。使用 <code dir="auto">[</code> 和 <code dir="auto">]</code> 符号来创建链接，例如 <code dir="auto">[</code>my_function<code dir="auto">]</code> 将链接到名为 <code dir="auto">my_function</code> 的项。</p>
</li>
<li>
<p><strong>测试文档示例</strong>：</p>
<p>你可以通过运行文档测试来确保文档中的示例代码是有效的。运行文档测试的命令是：</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#d6deeb;--1:#403f53">cargo test --doc</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="cargo test --doc"><div></div></button></div></figure></div>
<p>这将运行文档中的所有示例代码，确保它们仍然有效。</p>
</li>
<li>
<p><strong>文档主题</strong>：</p>
<p>你可以使用 Markdown 语法来美化文档。Rustdoc支持Markdown，所以你可以使用标题、列表、代码块、链接等Markdown元素来组织文档并增强其可读性。</p>
</li>
</ol>
<p>文档编写是开发过程中的重要部分，它帮助你的代码更易于理解、使用和维护。好的文档不仅对其他开发人员有帮助，还有助于你自己更容易回顾和理解代码。因此，确保在 Rust 项目中编写清晰和有用的文档是一个良好的实践。</p>
<h2 id="261-单元测试">26.1 单元测试</h2>
<p>Rust 是一种系统级编程语言，它鼓励编写高性能和安全的代码。为了确保代码的正确性，Rust 提供了一套强大的测试工具，包括单元测试、集成测试和属性测试。在这里，我们将详细介绍 Rust 的单元测试。</p>
<p>单元测试是一种测试方法，用于验证代码的各个单元（通常是函数或方法）是否按预期工作。在 Rust 中，单元测试通常包括编写测试函数，然后使用 <code dir="auto">#[cfg(test)]</code> 属性标记它们，以便只在测试模式下编译和运行。</p>
<p>以下是 Rust 单元测试的详细解释：</p>
<ol>
<li>
<p><strong>创建测试函数</strong>：</p>
<p>在 Rust 中，测试函数的命名通常以 <code dir="auto">test</code> 开头，后面跟着描述性的函数名。测试函数应该返回 <code dir="auto">()</code>（unit 类型），因为它们通常不返回任何值。测试函数可以使用 <code dir="auto">assert!</code> 宏或其他断言宏来检查代码的行为是否与预期一致。例如：</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">#[cfg(test)]</span></div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">mod</span><span style="--0:#D6DEEB;--1:#403F53"> tests {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    #[test]</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">fn</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">test_addition</span><span style="--0:#D6DEEB;--1:#403F53">() {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        </span><span style="--0:#82AAFF;--1:#3C63B3">assert_eq!</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#F78C6C;--1:#AA0982">2</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#097174">+</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#F78C6C;--1:#AA0982">2</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#F78C6C;--1:#AA0982">4</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    }</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">}</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="#[cfg(test)]mod tests {    #[test]    fn test_addition() {        assert_eq!(2 + 2, 4);    }}"><div></div></button></div></figure></div>
<p>在这个示例中，我们有一个名为 <code dir="auto">test_addition</code> 的测试函数，它使用 <code dir="auto">assert_eq!</code> 宏来断言 2 + 2 的结果是否等于 4。如果不等于 4，测试将失败。</p>
</li>
<li>
<p><strong>使用 <code dir="auto">#[cfg(test)]</code> 标志</strong>：</p>
<p>在 Rust 中，你可以使用 <code dir="auto">#[cfg(test)]</code> 属性将测试代码标记为仅在测试模式下编译和运行。这可以防止测试代码影响生产代码的性能和大小。在示例中，我们在测试模块中使用了 <code dir="auto">#[cfg(test)]</code>。</p>
</li>
<li>
<p><strong>运行测试</strong>：</p>
<p>要运行测试，可以使用 Rust 的测试运行器，通常是 <code dir="auto">cargo test</code> 命令。在你的项目根目录下，运行 <code dir="auto">cargo test</code> 将运行所有标记为测试的函数。测试运行器将输出测试结果，包括通过的测试和失败的测试。</p>
</li>
<li>
<p><strong>添加更多测试</strong>：</p>
<p>你可以在测试模块中添加任意数量的测试函数，以验证你的代码的不同部分。测试函数应该覆盖你的代码中的各种情况和边界条件，以确保代码的正确性。</p>
</li>
<li>
<p><strong>测试断言宏</strong>：</p>
<p>Rust 提供了许多测试断言宏，如 <code dir="auto">assert_eq!</code>、<code dir="auto">assert_ne!</code>、<code dir="auto">assert!</code>、<code dir="auto">assert_approx_eq!</code> 等，以适应不同的测试需求。你可以根据需要选择适当的宏来编写测试。</p>
</li>
<li>
<p><strong>测试组织</strong>：</p>
<p>你可以在不同的模块中组织你的测试，以使测试代码更清晰和易于管理。测试模块可以嵌套，以反映你的代码组织结构。</p>
</li>
</ol>
<p>单元测试在量化金融领域具有重要的意义，它有助于确保量化金融代码的正确性、稳定性和可维护性：</p>
<ol>
<li><strong>验证金融模型和算法的正确性</strong>：在量化金融领域，代码通常涉及复杂的金融模型和算法。通过编写单元测试，可以验证这些模型和算法是否按照预期工作，从而提高了金融策略的可靠性。</li>
<li><strong>捕获潜在的问题</strong>：单元测试可以帮助捕获潜在的问题和错误，包括数值计算错误、边界情况处理不当、算法逻辑错误等。这有助于在生产环境中避免意外的风险和损失。</li>
<li><strong>快速反馈</strong>：单元测试提供了快速反馈的机制。当开发人员进行代码更改时，单元测试可以自动运行，并迅速告诉开发人员是否破坏了现有的功能。这有助于迅速修复问题，减少了错误的传播。</li>
<li><strong>确保代码的可维护性</strong>：单元测试通常要求编写模块化和可测试的代码。这鼓励开发人员编写清晰、简洁和易于理解的代码，从而提高了代码的可维护性。</li>
<li><strong>支持重构和优化</strong>：通过具有完善的单元测试套件，开发人员可以更加放心地进行代码重构和性能优化。单元测试可以确保在这些过程中不会破坏现有的功能。</li>
</ol>
<p>所以单元测试在量化金融领域是一种关键的质量保证工具。通过合理编写和维护单元测试，可以降低金融策略的风险，提高交易系统的可靠性，并促进团队的协作和知识共享。因此，在量化金融领域，单元测试被认为是不可或缺的开发实践。</p>
<h2 id="262-文档测试">26.2 文档测试</h2>
<p>文档测试是 Rust 中一种特殊类型的测试，它与单元测试有所不同。文档测试主要用于验证文档中的代码示例是否有效，可以作为文档的一部分运行。这些测试以 <code dir="auto">cargo test</code> 命令运行，但它们会在文档构建期间执行，以确保示例代码仍然有效。以下是如何编写和运行文档测试的详细步骤：</p>
<ol>
<li>
<p><strong>编写文档注释</strong>：</p>
<p>在你的 Rust 代码中，你可以使用特殊的注释块 <code dir="auto">///</code> 或 <code dir="auto">//!</code> 来编写文档注释。在文档注释中，你可以包括代码示例，如下所示：</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#809191;--1:#616671">/// This function adds two numbers.</span></div><div class="ec-line"><span style="--0:#809191;--1:#616671">///</span></div><div class="ec-line"><span style="--0:#809191;--1:#616671">/// # Examples</span></div><div class="ec-line"><span style="--0:#809191;--1:#616671">///</span></div><div class="ec-line"><span style="--0:#809191;--1:#616671">/// ```</span></div><div class="ec-line"><span style="--0:#809191;--1:#616671">/// let result = add(2, 3);</span></div><div class="ec-line"><span style="--0:#809191;--1:#616671">/// assert_eq!(result, 5);</span></div><div class="ec-line"><span style="--0:#809191;--1:#616671">/// ```</span></div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">pub</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">fn</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">add</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#C5E478;--1:#3C63B3">a</span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#D6DEEB;--1:#403F53"> i32, </span><span style="--0:#C5E478;--1:#3C63B3">b</span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#D6DEEB;--1:#403F53"> i32) </span><span style="--0:#7FDBCA;--1:#097174">-></span><span style="--0:#D6DEEB;--1:#403F53"> i32 {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C5E478;--1:#3C63B3">a</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#097174">+</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">b</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">}</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="/// This function adds two numbers.////// # Examples////// &#x60;&#x60;&#x60;/// let result = add(2, 3);/// assert_eq!(result, 5);/// &#x60;&#x60;&#x60;pub fn add(a: i32, b: i32) -> i32 {    a + b}"><div></div></button></div></figure></div>
<p>在上面的示例中，我们编写了一个名为 <code dir="auto">add</code> 的函数，并使用文档注释包含了一个示例。</p>
</li>
<li>
<p><strong>运行文档测试</strong>：</p>
<p>要运行文档测试，你可以使用 <code dir="auto">cargo test</code> 命令，并包括 <code dir="auto">--doc</code> 标志：</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#d6deeb;--1:#403f53">cargo test --doc</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="cargo test --doc"><div></div></button></div></figure></div>
<p>运行后，Cargo 将执行文档测试并输出结果。它将查找文档注释中的示例，并尝试运行这些示例。如果示例中的代码成功运行且产生的输出与注释中的示例匹配，测试将通过。</p>
</li>
<li>
<p><strong>检查文档测试结果</strong>：</p>
<p>文档测试的结果将包括通过的测试示例和失败的测试示例。你应该检查输出以确保示例代码仍然有效。如果有失败的示例，你需要检查并修复文档或代码中的问题。</p>
</li>
</ol>
<p>文档测试（Document Testing）在量化金融领域具有重要的意义，它不仅有助于确保代码的正确性，还有助于提高代码的可维护性和可理解性。以下是文档测试在量化金融中的一些重要意义：</p>
<ol>
<li>
<p><strong>验证金融模型的正确性</strong>：量化金融领域涉及复杂的金融模型和算法。文档测试可以用于验证这些模型的正确性，确保它们按照预期工作。通过在文档中提供示例和预期结果，可以确保模型在代码实现中与理论模型一致。</p>
</li>
<li>
<p><strong>示例和文档</strong>：文档测试的结果可以成为代码文档的一部分，提供示例和用法说明。这对于其他开发人员、研究人员和用户来说是非常有价值的，因为他们可以轻松地查看代码示例，了解如何使用量化金融工具和库。</p>
</li>
<li>
<p><strong>改进代码可读性</strong>：编写文档测试通常需要清晰的文档注释和示例代码，这有助于提高代码的可读性和可理解性。通过清晰的注释和示例，其他人可以更容易地理解代码的工作原理，降低了学习和使用的难度。</p>
</li>
<li>
<p><strong>快速反馈</strong>：文档测试是一种快速获得反馈的方式。当你修改代码时，文档测试可以自动运行，并告诉你是否破坏了现有的功能或预期结果。这有助于快速捕获潜在的问题并进行修复。</p>
</li>
<li>
<p><strong>合规性和审计</strong>：在金融领域，合规性和审计是非常重要的。文档测试可以作为合规性和审计过程的一部分，提供可追溯的证据，证明代码的正确性和稳定性。</p>
</li>
<li>
<p><strong>教育和培训</strong>：文档测试还可以用于培训和教育目的。新入职的开发人员可以通过查看文档测试中的示例和注释来快速了解代码的工作方式和最佳实践。</p>
</li>
</ol>
<p>总之，文档测试在量化金融领域具有重要意义，它不仅有助于验证代码的正确性，还提供了示例、文档、可读性和合规性的好处。通过合理使用文档测试，可以提高量化金融代码的质量，减少错误和问题，并增强代码的可维护性和可理解性。</p>
<h2 id="263-项目集成测试">26.3 项目集成测试</h2>
<p>Rust 项目的集成测试通常用于测试不同模块之间的交互，以确保整个项目的各个部分正常协作。与单元测试不同，集成测试涵盖了更广泛的范围，通常测试整个程序的功能而不是单个函数或模块。以下是在 Rust 项目中进行集成测试的一般步骤：</p>
<ol>
<li>
<p><strong>创建测试文件</strong>：</p>
<p>集成测试通常与项目的源代码分开，因此你需要创建一个专门的测试文件夹和测试文件。一般来说，测试文件的命名约定是 <code dir="auto">tests</code> 文件夹下的文件以 <code dir="auto">.rs</code> 扩展名结尾，并且测试模块应该使用 <code dir="auto">mod</code> 关键字定义。</p>
<p>创建一个测试文件，例如 <code dir="auto">tests/integration_test.rs</code>。</p>
</li>
<li>
<p><strong>编写集成测试</strong>：</p>
<p>在测试文件中，你可以编写测试函数来测试整个项目的功能。这些测试函数应该模拟实际的应用场景，包括模块之间的交互。你可以使用 Rust 的标准库中的 <code dir="auto">assert!</code> 宏或其他断言宏来验证代码的行为是否与预期一致。</p>
<div class="expressive-code"><figure class="frame has-title not-content"><figcaption class="header"><span class="title">tests/integration_test.rs</span></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">#[cfg(test)]</span></div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">mod</span><span style="--0:#D6DEEB;--1:#403F53"> tests {</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    #[test]</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#C792EA;--1:#8D46B4">fn</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">test_whole_system</span><span style="--0:#D6DEEB;--1:#403F53">() {</span></div><div class="ec-line"><span style="--0:#809191;--1:#5E6578">        // 模拟整个系统的交互</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        </span><span style="--0:#C792EA;--1:#8D46B4">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">result</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=</span><span style="--0:#D6DEEB;--1:#403F53"> your_project</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#82AAFF;--1:#3C63B3">function1</span><span style="--0:#D6DEEB;--1:#403F53">() </span><span style="--0:#7FDBCA;--1:#097174">+</span><span style="--0:#D6DEEB;--1:#403F53"> your_project</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#82AAFF;--1:#3C63B3">function2</span><span style="--0:#D6DEEB;--1:#403F53">();</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">        </span><span style="--0:#82AAFF;--1:#3C63B3">assert_eq!</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#C5E478;--1:#3C63B3">result</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#F78C6C;--1:#AA0982">42</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">    }</span></div><div class="ec-line"><span style="--0:#D6DEEB;--1:#403F53">}</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="#[cfg(test)]mod tests {    #[test]    fn test_whole_system() {        // 模拟整个系统的交互        let result = your_project::function1() + your_project::function2();        assert_eq!(result, 42);    }}"><div></div></button></div></figure></div>
<p>在这个示例中，我们有一个名为 <code dir="auto">test_whole_system</code> 的集成测试函数，它测试整个系统的行为。</p>
</li>
<li>
<p><strong>配置测试环境</strong>：</p>
<p>在集成测试中，你可能需要配置一些测试环境，以模拟实际应用中的情况。这可以包括初始化数据库、设置配置选项等。</p>
</li>
<li>
<p><strong>运行集成测试</strong>：</p>
<p>使用 <code dir="auto">cargo test</code> 命令来运行项目的集成测试：</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#d6deeb;--1:#403f53">cargo test --test integration_test</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="cargo test --test integration_test"><div></div></button></div></figure></div>
<p>这将运行名为 <code dir="auto">integration_test</code> 的测试文件中的所有集成测试函数。</p>
</li>
<li>
<p><strong>检查测试结果</strong>：</p>
<p>检查测试运行的结果，包括通过的测试和失败的测试。如果有失败的测试，你需要检查并修复与项目的整合相关的问题。</p>
</li>
</ol>
<p>项目集成测试在 Rust 量化金融中具有关键的意义，它有助于确保整个量化金融系统在各个组件之间协同工作，并满足业务需求。以下是项目集成测试不可或缺的的原因：</p>
<ol>
<li>
<p><strong>验证整个系统的一致性</strong>：量化金融系统通常由多个组件组成，包括数据采集、模型计算、交易执行等。项目集成测试可以确保这些组件在整个系统中协同工作，并保持一致性。它有助于检测潜在的集成问题，例如数据流传输、算法接口等。</p>
</li>
<li>
<p><strong>模拟真实市场环境</strong>：项目集成测试可以模拟真实市场环境，包括不同市场条件、波动性和交易活动水平。这有助于评估系统在各种市场情况下的性能和可靠性。</p>
</li>
<li>
<p><strong>检测潜在风险</strong>：量化金融系统必须具备高度的可靠性，以避免潜在的风险和损失。项目集成测试可以帮助检测潜在的风险，例如系统崩溃、错误的交易执行等。</p>
</li>
<li>
<p><strong>评估系统性能</strong>：集成测试可以用于评估系统的性能，包括响应时间、吞吐量和稳定性。这有助于确定系统是否能够在高负载下正常运行。</p>
</li>
<li>
<p><strong>测试策略的执行</strong>：量化金融策略可能包括多个组件，包括数据处理、信号生成、仓位管理和风险控制等。项目集成测试可以确保整个策略的执行符合预期。</p>
</li>
<li>
<p><strong>合规性和审计</strong>：在金融领域，合规性和审计非常重要。项目集成测试可以提供可追溯性和审计的证据，以确保系统在合规性方面达到要求。</p>
</li>
<li>
<p><strong>自动化测试流程</strong>：通过自动化项目集成测试流程，可以快速发现问题并降低测试成本。自动化测试还可以在每次代码变更后持续运行，以捕获潜在问题。</p>
</li>
<li>
<p><strong>改进系统可维护性</strong>：项目集成测试通常需要将系统的不同部分解耦合作，这有助于改进系统的可维护性。通过强调接口和模块化设计，可以使系统更容易维护和扩展。</p>
</li>
</ol>
<p>项目集成测试在 Rust 量化金融中的意义在于确保系统的正确性、稳定性和性能，同时降低风险并提高系统的可维护性。这是构建高度可信赖的金融系统所必需的实践，有助于确保交易策略在实际市场中能够可靠执行。</p>
<p><strong>最后，让我们来对比以下三种测试的异同，以下是 Rust 中单元测试、文档测试和集成测试的对比表格：</strong></p>







































































<table><thead><tr><th>特征</th><th>单元测试</th><th>文档测试</th><th>集成测试</th></tr></thead><tbody><tr><td>目的</td><td>验证代码的单个单元（通常是函数或方法）是否按预期工作</td><td>验证文档中的代码示例是否有效</td><td>验证整个项目的各个部分是否正常协作</td></tr><tr><td>代码位置</td><td>通常与生产代码位于同一文件中（测试模块）</td><td>嵌入在文档注释中</td><td>通常位于项目的测试文件夹中，与生产代码分开</td></tr><tr><td>运行方式</td><td>使用 <code dir="auto">cargo test</code> 命令运行</td><td>使用 <code dir="auto">cargo test --doc</code> 命令运行</td><td>使用 <code dir="auto">cargo test</code> 命令运行，指定测试文件</td></tr><tr><td>测试范围</td><td>通常测试单个函数或模块的功能</td><td>验证文档中的代码示例</td><td>测试整个项目的不同部分之间的交互</td></tr><tr><td>断言宏</td><td>使用断言宏如 <code dir="auto">assert_eq!</code>、<code dir="auto">assert_ne!</code>、<code dir="auto">assert!</code> 等</td><td>使用断言宏如 <code dir="auto">assert_eq!</code>、<code dir="auto">assert_ne!</code>、<code dir="auto">assert!</code> 等</td><td>使用断言宏如 <code dir="auto">assert_eq!</code>、<code dir="auto">assert_ne!</code>、<code dir="auto">assert!</code> 等</td></tr><tr><td>测试目标</td><td>确保单元的正确性</td><td>确保文档中的示例代码正确性</td><td>确保整个项目的功能和协作正确性</td></tr><tr><td>测试环境</td><td>通常不需要额外的测试环境</td><td>可能需要模拟一些环境或配置</td><td>可能需要配置一些测试环境，如数据库、配置选项等</td></tr><tr><td>分离性</td><td>通常与生产代码分开，但位于同一文件中</td><td>与文档和代码紧密集成，位于文档注释中</td><td>通常与生产代码分开，位于测试文件中</td></tr><tr><td>自动化</td><td>通常在开发流程中频繁运行，可自动化</td><td>通常在文档构建时运行，可自动化</td><td>通常在开发流程中运行，可自动化</td></tr><tr><td>用途</td><td>验证代码功能是否正确</td><td>验证示例代码是否有效</td><td>验证整个项目的各个部分是否正常协作</td></tr></tbody></table>
<p>请注意，这些测试类型通常用于不同的目的和测试场景。单元测试主要用于验证单个函数或模块的功能，文档测试用于验证文档中的示例代码，而集成测试用于验证整个项目的功能和协作。在实际开发中，你可能会同时使用这三种测试类型来确保代码的质量和可维护性。</p>
<h1 id="chapter-27-常见技术指标及其实现">Chapter 27 常见技术指标及其实现</h1>
<p>量化金融技术指标通常用于分析和预测金融市场的走势和价格变动。以下是一些常见的量化金融技术指标：</p>
<p>以下是关于各种常见技术指标的信息，包括它们的名称、描述以及主要用途：</p>































































































<table><thead><tr><th>技术指标</th><th>描述</th><th>主要用途</th></tr></thead><tbody><tr><td>移动平均线（Moving Averages）</td><td>包括简单移动平均线（SMA）和指数移动平均线（EMA），用于平滑价格数据以识别趋势。</td><td>识别价格趋势和确定趋势的方向。</td></tr><tr><td>相对强度指标（RSI）</td><td>衡量市场超买和超卖情况，用于判断价格是否过度波动。</td><td>识别市场的超买和超卖情况，判断价格是否具备反转潜力。</td></tr><tr><td>随机指标（Stochastic Oscillator）</td><td>用于测量价格相对于其价格范围的位置，以确定超买和超卖情况。</td><td>识别资产的超买和超卖情况，产生买卖信号。</td></tr><tr><td>布林带（Bollinger Bands）</td><td>通过在价格周围绘制波动性通道来识别价格波动性和趋势。</td><td>识别价格波动性，确定支撑和阻力水平。</td></tr><tr><td>MACD指标（Moving Average Convergence Divergence）</td><td>结合不同期限的移动平均线以识别价格趋势的强度和方向。</td><td>识别价格的趋势、方向和潜在的交叉点。</td></tr><tr><td>随机强度指标（RSI）</td><td>衡量一种资产相对于市场指数的表现。</td><td>评估资产的相对强度和相对弱点。</td></tr><tr><td>ATR指标（Average True Range）</td><td>测量资产的波动性，帮助确定止损和止盈水平。</td><td>评估资产的波动性，确定适当的风险管理策略。</td></tr><tr><td>ADX指标（Average Directional Index）</td><td>衡量趋势的强度和方向。</td><td>识别市场趋势的强度和方向，帮助决策进出场时机。</td></tr><tr><td>ROC指标（Rate of Change）</td><td>衡量价格百分比变化以识别趋势的加速或减速。</td><td>识别价格趋势的速度变化，潜在的反转或加速。</td></tr><tr><td>CCI指标（Commodity Channel Index）</td><td>用于识别价格相对于其统计平均值的偏离。</td><td>评估资产是否处于超买或超卖状态。</td></tr><tr><td>Fibonacci回调和扩展水平</td><td>基于黄金比例的数学工具，用于预测支撑和阻力水平。</td><td>识别潜在的支撑和阻力水平，帮助决策进出场时机。</td></tr><tr><td>成交量分析指标</td><td>包括成交量柱状图和成交量移动平均线，用于分析市场的活跃度和力量。</td><td>评估市场活跃度，辅助价格趋势分析。</td></tr><tr><td>均线交叉</td><td>通过不同周期的移动平均线的交叉来识别买入和卖出信号。</td><td>识别趋势的改变，产生买卖信号。</td></tr><tr><td>Ichimoku云</td><td>提供了有关趋势、支撑和阻力水平的综合信息。</td><td>提供多个指标的综合信息，帮助识别趋势和支撑/阻力水平。</td></tr><tr><td>威廉指标（Williams %R）</td><td>类似于随机指标，用于测量超买和超卖情况。</td><td>评估资产是否处于超买或超卖状态，产生买卖信号。</td></tr><tr><td>均幅指标（Average Directional Movement Index，ADX）</td><td>用于确定趋势的方向和强度。</td><td>识别市场的趋势方向和趋势的强度，帮助决策进出场时机。</td></tr><tr><td>多重时间框架分析（Multiple Time Frame Analysis）</td><td>同时使用不同时间周期的图表来确认趋势。</td><td>提供更全面的市场分析，减少错误信号的可能性。</td></tr></tbody></table>
<p>这些技术指标是量化金融和股票市场分析中常用的工具，交易者使用它们来帮助做出买入和卖出决策，评估市场趋势和风险，并制定有效的交易策略。根据市场情况和交易者的需求，可以选择使用其中一个或多个指标来进行分析。</p>
<p>通常各个主要编程语言都有用于技术分析（Technical Analysis，TA）的库和工具，用于在金融市场数据上执行各种技术指标和分析。在C、Go和Python中常见的TA库一般有这些：</p>
<p><strong>C语言：</strong></p>
<ol>
<li><strong>TA-Lib（Technical Analysis Library）：</strong> TA-Lib是一种广泛使用的C库，提供了超过150种技术指标和图表模式的计算功能。它支持各种不同类型的金融市场数据，并且可以轻松与C/C++项目集成。</li>
</ol>
<p><strong>Go语言：</strong></p>
<ol>
<li><strong>tulipindicators：</strong> tulipindicators是一个用Go编写的开源技术指标库，它提供了多种常用技术指标的实现。这个库易于使用，可以在Go项目中方便地集成。</li>
<li>**go-talib：**ta的go语言wrapper</li>
</ol>
<p><strong>Python语言：</strong></p>
<ol>
<li><strong>Pandas TA：</strong> Pandas TA是一个基于Python的库，构建在Pandas DataFrame之上，它提供了超过150个技术指标的计算功能。Pandas TA与Pandas无缝集成，使得在Python中进行金融数据分析变得非常方便。</li>
<li><strong>TA-Lib for Python：</strong> 与C版本类似，TA-Lib也有适用于Python的接口，允许Python开发者使用TA-Lib中的技术指标。这个库通过绑定C库的方式实现了高性能。</li>
</ol>
<p>作为量化金融系统部署的前提之一，在Rust社区的生态中，当然也具有用于技术分析的库，虽然它的生态系统可能没有像Python或C那样丰富，但仍然存在一些可以用于量化金融分析的工具和库，配合自研的技术指标库和数学库，在生产环境下也足够使用。</p>
<p>以下是一些常见的可用于技术分析和量化金融的Rust库，：</p>
<ol>
<li>
<p><strong>TAlib-rs：</strong> TAlib-rs是一个Rust的TA-Lib绑定，它允许Rust开发者使用TA-Lib中的技术指标功能。TA-Lib包含了150多种技术指标的实现，因此通过TAlib-rs，你可以在Rust中执行广泛的技术分</p>
</li>
<li>
<p><strong>RustQuant：</strong> Rust中的量化金融工具库。同时也是Rust中最大、最成熟的期权定价库。</p>
</li>
<li>
<p><strong>investments:</strong> 一个用Rust编写的开源库，旨在提供一些用于金融和投资的工具和函数。这个库可能包括用于计算投资回报率、分析金融数据以及执行基本的投资分析的功能。</p>
</li>
</ol>
<p>Rust在金融领域的应用确实相对较新，因此可用的库和工具有一定的可能阙如。不过，随着Rust的不断发展和生态系统的壮大，我预期将会有更多的金融分析和量化交易工具出现。当你已经熟悉Rust编程，并且希望在此领域进行开发的时候，也可以考虑一下为Rust社区贡献更多的金融相关项目和库。</p>
<p>好，之前在第3章我们已经实现了SMA、EMA和RSI，现在我们来尝试进行一些其他实用技术分析指标的rust实现。</p>
<h3 id="271-随机指标stochastic-oscillator">27.1： 随机指标（Stochastic Oscillator）</h3>
<p>在金融市场中，很多投资者会通过尝试识别**“超买”（Overbought）<strong>和</strong>”超卖”（Oversold）**状态并通过自己对这些状态的应对策略来套利。 超买是指市场或特定资产的价格被认为高于其正常或合理的价值水平的情况。这通常发生在价格迅速上升后，投资者情绪变得过于乐观，导致购买压力增加。超买时，市场可能出现过度购买的现象，价格可能会进一步下跌或趋于平稳。而超卖是指市场或特定资产的价格被认为低于其正常或合理的价值水平的情况。这通常发生在价格迅速下跌后，投资者情绪变得过于悲观，导致卖出压力增加。超卖时，市场可能出现过度卖出的现象，价格可能会进一步上涨或趋于平稳。</p>
<p>一些技术指标如相对强度指标（RSI）或随机指标（Stochastic Oscillator）常用来识别超买情况。当这些指标的数值超过特定阈值（通常为70～80），就被视为市场处于超买状态，可能预示着价格的下跌。而当这些指标的数值低于特定阈值（通常为20～30），就被视为市场处于超卖状态，可能预示着价格的上涨。</p>
<p>之前我们在第3章对RSI已经有所了解。现在我们再来学习一下随机指标，它由George C. Lane 在20世纪50年代开发，是一种相对简单但有效的、常用于技术分析的动量指标。</p>
<p>随机指标通常由以下几个主要组成部分构成：</p>
<ol>
<li>
<p><strong>%K线（%K Line）：</strong> %K线是当前价格与一段时间内的价格范围的比率，通常以百分比表示。它可以用以下公式计算：</p>
<p>%K = [(当前收盘价 - 最低价) / (最高价 - 最低价)] * 100</p>
<p>%K线的计算结果在0到100之间波动，可以帮助识别价格相对于给定周期内的价格范围的位置。</p>
</li>
<li>
<p><strong>%D线（%D Line）：</strong> %D线是%K线的平滑线，通常使用移动平均线进行平滑处理。这有助于减少%K线的噪音，提供更可靠的信号。%D线通常使用简单移动平均线（SMA）或指数移动平均线（EMA）进行计算。</p>
</li>
<li>
<p><strong>超买和超卖水平：</strong> 在随机指标中，通常会绘制两个水平线，一个表示超买水平（通常为80），另一个表示超卖水平（通常为20）。当%K线上穿80时，表明市场可能处于超买状态，可能会发生价格下跌。当%K线下穿20时，表明市场可能处于超卖状态，可能会发生价格上涨。</p>
</li>
</ol>
<p>随机指标的典型用法包括：</p>
<ul>
<li>当%K线上穿%D线时，产生买入信号，表示价格可能上涨。</li>
<li>当%K线下穿%D线时，产生卖出信号，表示价格可能下跌。</li>
<li>当%K线位于超买水平以上时，可能发生卖出信号。</li>
<li>当%K线位于超卖水平以下时，可能发生买入信号。</li>
</ul>
<p>需要注意的是，随机指标并不是一种绝对的买卖信号工具，而是用于辅助决策的指标。它常常与其他技术指标和分析工具一起使用，以提供更全面的市场分析。交易者还应谨慎使用随机指标，特别是在非趋势市场中，因为在价格范围内波动较大时，可能会产生误导性的信号。因此，对于每个市场环境，需要根据其他指标和分析来进行综合判断。</p>
<p>以下是Stochastic Oscillator（随机指标）和RSI（相对强度指标）之间的主要区别：</p>

































































<table><thead><tr><th>特征</th><th>Stochastic Oscillator</th><th>相对强度指标 (RSI)</th></tr></thead><tbody><tr><td>类型</td><td>动量指标</td><td>动量指标</td></tr><tr><td>创建者</td><td>George C. Lane</td><td>J. Welles Wilder</td></tr><tr><td>计算方式</td><td>基于当前价格与价格范围的比率</td><td>基于平均增益和平均损失</td></tr><tr><td>计算结果的范围</td><td>0 到 100</td><td>0 到 100</td></tr><tr><td>主要目的</td><td>识别超买和超卖情况，以及价格趋势变化</td><td>衡量资产价格的强弱</td></tr><tr><td>%K线和%D线</td><td>包括%K线和%D线，%D线是%K线的平滑线</td><td>通常只有一个RSI线</td></tr><tr><td>超买和超卖水平</td><td>通常在80和20之间，用于产生买卖信号</td><td>通常在70和30之间，用于产生买卖信号</td></tr><tr><td>信号产生</td><td>当%K线上穿%D线时产生买入信号，下穿时产生卖出信号</td><td>当RSI线上穿70时产生卖出信号，下穿30时产生买入信号</td></tr><tr><td>应用领域</td><td>用于识别超买和超卖情况以及价格的反转点</td><td>用于衡量资产的强弱并确定买卖时机</td></tr><tr><td>时间周期</td><td>通常使用短期和长期周期进行计算</td><td>通常使用14个交易日周期进行计算</td></tr><tr><td>常见用途</td><td>适用于不同市场和资产类别，特别是适用于振荡市场</td><td>适用于评估股票、期货和外汇等资产的强弱</td></tr></tbody></table>
<p>需要注意的是，虽然Stochastic Oscillator和RSI都是用于动量分析的指标，但它们的计算方式、信号产生方式和主要应用方向都略有不同。交易者可以根据自己的交易策略和市场条件选择使用其中一个或两者结合使用，以辅助决策。</p>
<h3 id="272布林带bollinger-bands">27.2：布林带（Bollinger Bands）</h3>
<p>布林带（Bollinger Bands）是一种常用于技术分析的指标，旨在帮助交易者识别资产价格的波动性和趋势方向。它由约翰·布林格（John Bollinger）于1980年代开发，是一种基于统计学原理的工具。以下是对布林带的详细解释：</p>
<p><strong>布林带的构成：</strong> 布林带由以下三个主要部分组成：</p>
<ol>
<li>
<p><strong>中轨（中间线）：</strong> 中轨是布林带的中心线，通常是简单移动平均线（SMA）。中轨的计算通常基于一段固定的时间周期，例如20个交易日的收盘价的SMA。这个中轨代表了资产价格的趋势方向。</p>
</li>
<li>
<p><strong>上轨（上限线）：</strong> 上轨是位于中轨上方的线，其位置通常是中轨加上两倍标准差（Standard Deviation）的值。标准差是一种测量数据分散程度的统计指标，用于衡量价格波动性。上轨代表了资产价格的波动性，通常用来识别价格上涨的潜力。</p>
</li>
<li>
<p><strong>下轨（下限线）：</strong> 下轨是位于中轨下方的线，其位置通常是中轨减去两倍标准差的值。下轨同样代表了资产价格的波动性，通常用来识别价格下跌的潜力。</p>
</li>
</ol>
<p><strong>布林带的应用：</strong> 布林带有以下几个主要的应用和用途：</p>
<ol>
<li>
<p><strong>波动性识别：</strong> 布林带的宽窄可以用来衡量价格波动性。带宽收窄通常表示价格波动性较低，而带宽扩大则表示价格波动性较高。这可以帮助交易者判断市场的活跃度和价格趋势的稳定性。</p>
</li>
<li>
<p><strong>趋势识别：</strong> 当价格趋势明显时，布林带的上轨和下轨可以帮助确定支撑和阻力水平。当价格触及或穿越上轨时，可能表明价格上涨趋势强劲，而当价格触及或穿越下轨时，可能表明价格下跌趋势较强。</p>
</li>
<li>
<p><strong>超买和超卖情况：</strong> 当价格接近或穿越布林带的上轨时，可能表明市场处于超买状态，因为价格偏离了其正常波动范围。相反，当价格接近或穿越布林带的下轨时，可能表明市场处于超卖状态。</p>
</li>
<li>
<p><strong>交易信号：</strong> 交易者经常使用布林带产生买入和卖出信号。一种常见的策略是在价格触及上轨时卖出，在价格触及下轨时买入。这可以帮助捕捉价格的短期波动。</p>
</li>
</ol>
<p>需要注意的是，布林带是一种辅助工具，通常需要与其他技术指标和市场分析方法结合使用。交易者应谨慎使用布林带信号，并考虑市场的整体背景和趋势。此外，布林带的参数（如时间周期和标准差倍数）可以根据不同市场和交易策略进行调整。</p>
<h3 id="273macd指标moving-average-convergence-divergence">27.3：MACD指标（Moving Average Convergence Divergence）</h3>
<p>MACD（Moving Average Convergence Divergence）是一种常用于技术分析的动量指标，用于衡量资产价格趋势的强度和方向。它由杰拉尔德·阿佩尔（Gerald Appel）于1979年首次引入，并且在技术分析中广泛应用。以下是对MACD指标的详细解释：</p>
<p><strong>MACD指标的构成：</strong> MACD指标由以下三个主要组成部分构成：</p>
<ol>
<li>
<p><strong>快速线（Fast Line）：</strong> 也称为MACD线（MACD Line），是资产价格的短期移动平均线与长期移动平均线之间的差值。通常，快速线的计算基于12个交易日的短期移动平均线减去26个交易日的长期移动平均线。</p>
<p>快速线（MACD Line） = 12日EMA - 26日EMA</p>
<p>其中，EMA代表指数加权移动平均线（Exponential Moving Average），它使得近期价格对快速线的影响较大。</p>
</li>
<li>
<p><strong>慢速线（Slow Line）：</strong> 也称为信号线（Signal Line），是快速线的移动平均线。通常，慢速线的计算使用快速线的9日EMA。</p>
<p>慢速线（Signal Line） = 9日EMA(MACD Line)</p>
</li>
<li>
<p><strong>MACD柱状图（MACD Histogram）：</strong> MACD柱状图表示快速线和慢速线之间的差值，用于展示价格趋势的强度和方向。MACD柱状图的计算方法是：</p>
<p>MACD柱状图 = 快速线（MACD Line） - 慢速线（Signal Line）</p>
</li>
</ol>
<p><strong>MACD的应用：</strong> MACD指标可以用于以下几个方面的技术分析：</p>
<ol>
<li>
<p><strong>趋势识别：</strong> 当MACD线位于慢速线上方并向上移动时，通常表示价格处于上升趋势，这可能是买入信号。相反，当MACD线位于慢速线下方并向下移动时，通常表示价格处于下降趋势，这可能是卖出信号。</p>
</li>
<li>
<p><strong>交叉信号：</strong> 当MACD线上穿慢速线时，产生买入信号，表示价格可能上涨。当MACD线下穿慢速线时，产生卖出信号，表示价格可能下跌。</p>
</li>
<li>
<p><strong>背离（Divergence）：</strong> 当MACD指标与价格图形出现背离时，可能表示趋势的弱化或反转。例如，如果价格创下新低而MACD柱状图创下高点，这可能是价格反转的信号。</p>
</li>
<li>
<p><strong>柱状图的观察：</strong> MACD柱状图的高度可以反映价格趋势的强度。较高的柱状图表示价格动能较强，较低的柱状图表示价格动能较弱。</p>
</li>
</ol>
<p>需要注意的是，MACD是一种多功能的指标，可以用于不同市场和不同时间周期的分析。它通常需要与其他技术指标和市场分析方法结合使用，以提供更全面的市场信息。MACD的参数可以根据具体情况进行调整，以满足不同的交易策略和市场条件。</p>
<h3 id="274adx指标average-directional-index">27.4：ADX指标（Average Directional Index）</h3>
<p>ADX（Average Directional Index）是一种用于技术分析的指标，旨在衡量资产价格趋势的强度和方向。ADX是由威尔斯·威尔德（Welles Wilder）于1978年首次引入，它通常与另外两个相关的指标，即DI+（Positive Directional Indicator）和DI-（Negative Directional Indicator）一起使用。以下是对ADX指标的详细解释：</p>
<p><strong>ADX指标的构成：</strong> ADX指标主要由以下几个部分组成：</p>
<ol>
<li>
<p><strong>DI+（Positive Directional Indicator）：</strong> DI+用于测量正价格移动的强度和方向。它基于价格的正向变化量和总变化量来计算，然后用百分比来表示正向变化的比率。DI+的计算方式如下：</p>
<p>DI+ = （今日最高价 - 昨日最高价） / 今日最高价与昨日最高价之差 * 100</p>
</li>
<li>
<p><strong>DI-（Negative Directional Indicator）：</strong> DI-用于测量负价格移动的强度和方向。它类似于DI+，但是针对价格的负向变化量进行计算。DI-的计算方式如下：</p>
<p>DI- = （昨日最低价 - 今日最低价） / 昨日最低价与今日最低价之差 * 100</p>
</li>
<li>
<p><strong>DX（Directional Movement Index）：</strong> DX是计算DI+和DI-之间的相对关系的指标，用于确定价格趋势的方向。DX的计算方式如下：</p>
<p>DX = |（DI+ - DI-）| / （DI+ + DI-） * 100</p>
</li>
<li>
<p><strong>ADX（Average Directional Index）：</strong> ADX是DX的平滑移动平均线，通常使用14个交易日的EMA来计算。ADX的计算方式如下：</p>
<p>ADX = 14日EMA(DX)</p>
</li>
</ol>
<p><strong>ADX的应用：</strong> ADX指标可以用于以下几个方面的技术分析：</p>
<ol>
<li>
<p><strong>趋势强度：</strong> ADX可以帮助交易者确定价格趋势的强度。当ADX值高于某一阈值（通常为25或30）时，表示价格趋势强劲。较高的ADX值可能意味着趋势可能会持续。反之，ADX值低于阈值时，表示价格可能处于横盘或弱势市场中。</p>
</li>
<li>
<p><strong>趋势方向：</strong> 当DI+高于DI-时，表示市场可能处于上升趋势。当DI-高于DI+时，表示市场可能处于下降趋势。ADX的方向可以帮助确定趋势的方向。</p>
</li>
<li>
<p><strong>背离（Divergence）：</strong> 当价格趋势与ADX指标出现背离时，可能表示趋势的强度正在减弱，这可能是趋势反转的信号。</p>
</li>
</ol>
<p>需要注意的是，ADX指标主要用于衡量趋势的强度和方向，而不是价格的绝对水平。它通常需要与其他技术指标和分析方法结合使用，以提供更全面的市场信息。ADX的参数（如时间周期和阈值）可以根据具体情况进行调整，以满足不同的交易策略和市场条件。</p>
<h3 id="275-roc指标rate-of-change">27.5 ：ROC指标（Rate of Change）</h3>
<p>ROC（Rate of Change）指标是一种用于技术分析的动量指标，用于衡量资产价格的百分比变化率。ROC指标的主要目的是帮助交易者识别价格趋势的加速或减速，以及潜在的超买和超卖情况。以下是对ROC指标的详细解释：</p>
<p><strong>ROC指标的计算：</strong> ROC指标的计算非常简单，它通常基于某一时间周期内的价格变化。计算ROC的一般步骤如下：</p>
<ol>
<li>
<p>选择一个特定的时间周期（例如，14个交易日）。</p>
</li>
<li>
<p>计算当前时刻的价格与过去一段时间内的价格之间的百分比变化率。计算公式如下：</p>
<p>ROC = （当前价格 - 过去一段时间内的价格） / 过去一段时间内的价格 * 100</p>
<p>过去一段时间内的价格可以是开盘价、收盘价或任何其他价格。</p>
</li>
<li>
<p>最终得到的ROC值表示了在给定时间周期内价格的变化率，通常以百分比形式表示。</p>
</li>
</ol>
<p><strong>ROC的应用：</strong> ROC指标可以用于以下几个方面的技术分析：</p>
<ol>
<li>
<p><strong>趋势识别：</strong> ROC可以帮助交易者识别价格趋势的加速或减速。当ROC值处于正数区域时，表示价格上涨的速度较快；当ROC值处于负数区域时，表示价格下跌的速度较快。趋势的加速通常被视为买入信号或卖出信号，具体取决于市场情况。</p>
</li>
<li>
<p><strong>超买和超卖情况：</strong> ROC指标也可以用来识别资产的超买和超卖情况。当ROC值迅速上升并达到较高水平时，可能表示市场处于超买状态，价格可能会下跌。相反，当ROC值迅速下降并达到较低水平时，可能表示市场处于超卖状态，价格可能会上涨。</p>
</li>
<li>
<p><strong>背离（Divergence）：</strong> 当价格走势与ROC指标出现背离时，可能表示趋势的弱化或反转。例如，如果价格创下新高而ROC值没有创新高，这可能是价格反转的信号。</p>
</li>
</ol>
<p>需要注意的是，ROC指标通常需要与其他技术指标和市场分析方法结合使用，以提供更全面的市场信息。ROC的参数（如时间周期）可以根据具体情况进行调整，以满足不同的交易策略和市场条件。</p>
<h3 id="276cci指标commodity-channel-index">27.6：CCI指标（Commodity Channel Index）</h3>
<p>CCI（Commodity Channel Index）是一种常用于技术分析的指标，旨在帮助交易者识别资产价格是否超买或超卖，以及趋势的变化。CCI指标最初是由唐纳德·兰伯特（Donald Lambert）在20世纪80年代为商品市场设计的，但后来也广泛用于其他金融市场的技术分析。以下是对CCI指标的详细解释：</p>
<p><strong>CCI指标的计算：</strong> CCI指标的计算涉及以下几个步骤：</p>
<ol>
<li>
<p><strong>计算Typical Price（典型价格）：</strong> 典型价格是每个交易日的最高价、最低价和收盘价的均值。计算典型价格的公式如下：</p>
<p>典型价格 = （最高价 + 最低价 + 收盘价） / 3</p>
</li>
<li>
<p><strong>计算平均典型价格（平均价）：</strong> 平均典型价格是过去一段时间内的典型价格的简单移动平均值。通常，使用一个特定的时间周期（例如20个交易日）来计算平均典型价格。</p>
</li>
<li>
<p><strong>计算平均绝对偏差（Mean Absolute Deviation）：</strong> 平均绝对偏差是每个交易日的典型价格与平均典型价格之间的差的绝对值的平均值。计算平均绝对偏差的公式如下：</p>
<p>平均绝对偏差 = 平均值（|典型价格 - 平均典型价格|）</p>
</li>
<li>
<p><strong>计算CCI指标：</strong> CCI指标的计算使用平均绝对偏差和一个常数倍数（通常为0.015）来计算。计算CCI的公式如下：</p>
<p>CCI = （典型价格 - 平均典型价格） / （0.015 * 平均绝对偏差）</p>
</li>
</ol>
<p><strong>CCI的应用：</strong> CCI指标可以用于以下几个方面的技术分析：</p>
<ol>
<li>
<p><strong>超买和超卖情况：</strong> CCI指标通常在一个范围内波动，正值表示资产价格相对较高，负值表示价格相对较低。当CCI值大于100时，可能表示市场超买，价格可能会下跌。当CCI值小于-100时，可能表示市场超卖，价格可能会上涨。</p>
</li>
<li>
<p><strong>趋势确认：</strong> CCI指标也可以用于确认价格趋势。当CCI持续保持正值时，可能表示上升趋势；当CCI持续保持负值时，可能表示下降趋势。</p>
</li>
<li>
<p><strong>背离（Divergence）：</strong> 当CCI指标与价格图形出现背离时，可能表示趋势的弱化或反转。例如，如果价格创下新高而CCI没有创新高，这可能是价格反转的信号。</p>
</li>
</ol>
<p>需要注意的是，CCI指标通常需要与其他技术指标和市场分析方法结合使用，以提供更全面的市场信息。CCI的参数（如时间周期和常数倍数）可以根据具体情况进行调整，以满足不同的交易策略和市场条件。</p>
<h3 id="277fibonacci回调和扩展水平">27.7：Fibonacci回调和扩展水平</h3>
<p>Fibonacci回调和扩展水平是一种基于黄金比例和斐波那契数列的技术分析工具，用于预测资产价格的支撑和阻力水平，以及可能的价格反转点。这些水平是根据斐波那契数列中的特定比率来计算的。以下是对Fibonacci回调和扩展水平的详细解释：</p>
<p><strong>1. Fibonacci回调水平：</strong></p>
<ul>
<li>
<p><strong>0%水平：</strong> 这是价格上涨或下跌前的起始点。它代表了没有任何价格变化的水平。</p>
</li>
<li>
<p><strong>23.6%水平：</strong> 这是最小的Fibonacci回调水平，通常用于标识价格回调的起始点。在上升趋势中，价格可能在达到一定高度后回调至此水平。在下降趋势中，价格可能在达到一定低点后回调至此水平。</p>
</li>
<li>
<p><strong>38.2%水平：</strong> 这是另一个重要的Fibonacci回调水平，通常用于识别更深的回调。在趋势中，价格可能在达到高点或低点后回调至此水平。</p>
</li>
<li>
<p><strong>50%水平：</strong> 这不是斐波那契数列的一部分，但它在技术分析中仍然常常被视为重要水平。价格回调至50%水平通常表示一种中性或平衡状态。</p>
</li>
<li>
<p><strong>61.8%水平：</strong> 这是最常用的Fibonacci回调水平之一，通常用于标识较深的回调。在趋势中，价格可能在达到高点或低点后回调至此水平。</p>
</li>
<li>
<p><strong>76.4%水平：</strong> 这是另一个较深的回调水平，有时被用作支撑或阻力水平。</p>
</li>
</ul>
<p><strong>2. Fibonacci扩展水平：</strong></p>
<ul>
<li>
<p><strong>100%水平：</strong> 这是价格的起始点，与0%水平相对应。在技术分析中，价格达到100%水平通常表示可能出现完全的价格反转。</p>
</li>
<li>
<p><strong>123.6%水平：</strong> 这是用于标识较深的价格反转点的扩展水平。在趋势中，价格可能在达到一定高度后反转至此水平。</p>
</li>
<li>
<p><strong>138.2%水平：</strong> 这是另一个扩展水平，通常用于识别更深的价格反转。</p>
</li>
<li>
<p><strong>161.8%水平：</strong> 这是最常用的Fibonacci扩展水平之一，通常用于标识较深的价格反转点。</p>
</li>
<li>
<p><strong>200%水平：</strong> 这是价格的终点，与0%水平相对应。在技术分析中，价格达到200%水平通常表示可能出现完全的价格反转。</p>
</li>
</ul>
<p>Fibonacci回调和扩展水平可以帮助交易者识别可能的支撑和阻力水平，以及价格反转的潜在点。然而，需要注意的是，这些水平并不是绝对的，不能单独用于决策。它们通常需要与其他技术指标和分析方法结合使用，以提供更全面的市场信息。此外，市场中的价格行为可能会受到多种因素的影响，因此仍需要谨慎分析。</p>
<h3 id="278均线交叉策略">27.8：均线交叉策略</h3>
<p>均线交叉策略是一种常用于技术分析和股票交易的简单但有效的策略。该策略利用不同时间周期的移动平均线的交叉来识别买入和卖出信号。以下是对均线交叉策略的详细解释：</p>
<p><strong>1. 移动平均线（Moving Averages）：</strong> 均线交叉策略的核心是使用移动平均线，通常包括以下两种类型：</p>
<ul>
<li>
<p><strong>短期移动平均线（Short-term Moving Average）：</strong> 通常使用较短的时间周期，如10天或20天，用来反映较短期的价格趋势。</p>
</li>
<li>
<p><strong>长期移动平均线（Long-term Moving Average）：</strong> 通常使用较长的时间周期，如50天或200天，用来反映较长期的价格趋势。</p>
</li>
</ul>
<p><strong>2. 买入信号：</strong> 均线交叉策略的买入信号通常发生在短期移动平均线向上穿越长期移动平均线时，这被称为“黄金交叉”。这意味着短期趋势正在上升，可能是买入的好时机。</p>
<p><strong>3. 卖出信号：</strong> 均线交叉策略的卖出信号通常发生在短期移动平均线向下穿越长期移动平均线时，这被称为“死亡交叉”。这意味着短期趋势正在下降，可能是卖出的好时机。</p>
<p><strong>4. 确认信号：</strong> 一些交易者使用其他技术指标或价格模式来确认均线交叉信号的有效性。例如，他们可能会查看相对强度指标（RSI）或MACD指标，以确保市场处于趋势状态。</p>
<p><strong>5. 风险管理：</strong> 在执行均线交叉策略时，风险管理非常重要。交易者通常会设定止损和止盈水平，以控制风险并保护利润。止损水平通常设置在买入价格下方，而止盈水平则根据市场条件和交易者的目标而定。</p>
<p><strong>6. 适用性：</strong> 均线交叉策略适用于不同市场和资产，包括股票、外汇、期货和加密货币。然而，它可能在不同市场环境下表现不同，因此需要根据市场情况进行调整。</p>
<p><strong>7. 缺点：</strong> 均线交叉策略有时会产生虚假信号，特别是在市场处于横盘或震荡状态时。因此，交易者需要谨慎使用，并结合其他指标和分析方法来提高准确性。</p>
<p>总之，均线交叉策略是一种简单但常用的技术分析策略，用于识别买入和卖出信号。它可以作为交易决策的起点，但交易者需要谨慎使用，并结合其他因素来进行综合分析和风险管理。</p>
<h3 id="279-ichimoku云">27.9： Ichimoku云</h3>
<p><img src="/home/arthur/Documents/Cookbook-for-Rustaceans-in-Finance/img_1.png" alt="img_1.png">
Ichimoku云，也称为<strong>一目均衡图</strong>，是一种综合性的技术分析工具，最初由日本分析师兼记者一目山人（Goichi Hosoda）在20世纪20年代开发。该工具旨在提供有关资产价格趋势、支撑和阻力水平以及未来价格走势的综合信息。Ichimoku云由多个组成部分组成，以下是对每个组成部分的详细解释：</p>
<p><strong>1. 转换线（転換線 Tenkan-sen）：</strong> 转换线是计算Ichimoku云的第一个组成部分，通常表示为红色线。它是最近9个交易日的最高价和最低价的平均值。转换线用于提供近期价格走势的参考。</p>
<p><strong>2. 基准线（基準線 Kijun-sen）：</strong> 基准线是计算Ichimoku云的第二个组成部分，通常表示为蓝色线。它是最近26个交易日的最高价和最低价的平均值。基准线用于提供中期价格走势的参考。</p>
<p><strong>3. 云层（先行スパン Senkou Span/Kumo）：</strong> 云层是Ichimoku云的主要组成部分之一，包括两条线，分别称为Senkou Span A和Senkou Span B。Senkou Span A通常表示为浅绿色线，是转换线和基准线的平均值，向前移动26个交易日。Senkou Span B通常表示为深绿色线，是最近52个交易日的最高价和最低价的平均值，向前移动26个交易日。云层的颜色表示价格走势的方向，例如，云层由浅绿色变为深绿色可能表示上升趋势。</p>
<p><strong>4. 未来云（Future Cloud）：</strong> 未来云是Ichimoku云中的一部分，通常由两个Senkou Span线组成，即Senkou Span A和Senkou Span B。未来云的颜色也表示价格走势的方向，可以用来预测未来价格趋势。云层和未来云之间的区域称为“云中”也叫雲 kumo (抵抗帯 teikoutai )，可以用来识别支撑和阻力水平。</p>
<p><strong>5. 延迟线（遅行スパン Chikou Span）：</strong> 延迟线是Ichimoku云的最后一个组成部分，通常表示为橙色线。它是当前收盘价移动到过去26个交易日的线。延迟线用于提供价格走势的确认，当延迟线在云层或未来云之上时，可能表示上升趋势，当它在云层或未来云之下时，可能表示下降趋势。</p>
<p>Ichimoku云的主要应用包括：</p>
<ul>
<li>
<p>识别趋势：Ichimoku云可以帮助交易者识别价格的长期和中期趋势。上升趋势通常表现为云层由浅绿色变为深绿色，而下降趋势则相反。</p>
</li>
<li>
<p>支撑和阻力：云层和未来云中的区域可以用作支撑和阻力水平的参考。</p>
</li>
<li>
<p>买卖信号：均线的交叉以及价格与云层的相对位置可以提供买入和卖出信号。</p>
</li>
</ul>
<p>需要注意的是，Ichimoku云是一种复杂的工具，通常需要深入学习和理解。交易者应该谨慎使用，并结合其他技术指标和市场分析方法来进行综合分析。</p>
<h3 id="2710威廉指标williams-r">27.10：威廉指标（Williams %R）</h3>
<p>威廉指标（Williams %R），也称为威廉超买超卖指标，是一种用于衡量市场超买和超卖情况的动量振荡指标。它是由拉里·威廉斯（Larry Williams）在20世纪70年代开发的。威廉指标的主要目标是帮助交易者识别价格反转点，并提供买入和卖出的时机。</p>
<p>以下是威廉指标的详细解释：</p>
<ol>
<li>
<p><strong>计算方式：</strong> 威廉指标的计算基于以下公式：</p>
<p>威廉%R = [（最高价 - 当前收盘价） / （最高价 - 最低价）] * (-100)</p>
<ul>
<li>最高价是在一定时间内的最高价格。</li>
<li>最低价是在一定时间内的最低价格。</li>
<li>当前收盘价是当前周期的收盘价格。</li>
</ul>
<p>威廉%R的值通常在-100到0之间波动，其中-100表示市场处于最超卖状态，0表示市场处于最超买状态。</p>
</li>
<li>
<p><strong>超买和超卖情况：</strong> 威廉指标的主要应用是识别市场的超买和超卖情况。当威廉%R的值位于-80或更高时，通常被认为市场处于超卖状态，可能会发生价格上涨的机会。相反，当威廉%R的值位于-20或更低时，通常被认为市场处于超买状态，可能会发生价格下跌的机会。</p>
</li>
<li>
<p><strong>买入和卖出信号：</strong> 威廉指标的买入和卖出信号通常基于以下条件：</p>
<ul>
<li>
<p>买入信号：当威廉%R的值从超卖区域向上穿越-20时，产生买入信号。这表示市场可能正在从超卖状态中反弹，并可能迎来价格上涨。</p>
</li>
<li>
<p>卖出信号：当威廉%R的值从超买区域向下穿越-80时，产生卖出信号。这表示市场可能正在从超买状态中回调，并可能迎来价格下跌。</p>
</li>
</ul>
</li>
<li>
<p><strong>背离（Divergence）：</strong> 交易者还可以使用威廉指标与价格图形之间的背离来确认信号。例如，如果价格创下新高而威廉%R没有创新高，这可能表示价格反转的信号。</p>
</li>
<li>
<p><strong>适用性：</strong> 威廉指标适用于各种市场，包括股票、外汇、期货和加密货币。然而，需要注意的是，它在不同市场环境下表现可能不同，因此交易者应该谨慎使用，并结合其他技术指标和分析方法来提高准确性。</p>
</li>
</ol>
<p>需要强调的是，威廉指标是一种动量振荡指标，通常用于短期交易。交易者应该将其与其他分析工具和风险管理策略结合使用，以作出更明智的交易决策。</p>
<h3 id="2711均幅指标average-directional-movement-indexadx">27.11：均幅指标（Average Directional Movement Index，ADX）</h3>
<p>均幅指标（Average Directional Movement Index，ADX）是一种用于衡量市场趋势强度和方向的技术指标。它是由威尔斯·威尔德（Welles Wilder）在1978年首次引入，并在他的著作《新概念技术分析》中详细描述。ADX的主要用途是帮助交易者确认是否存在趋势并评估趋势的强度。以下是对ADX的详细解释：</p>
<ol>
<li>
<p><strong>计算方式：</strong> ADX的计算基于一系列的步骤：</p>
<p>a. <strong>真实范围（True Range）：</strong> 首先，需要计算每个周期的真实范围。真实范围是以下三个值中的最大值：</p>
<ul>
<li>当前周期的最高价与最低价之差。</li>
<li>当前周期的最高价与前一个周期的收盘价之差的绝对值。</li>
<li>当前周期的最低价与前一个周期的收盘价之差的绝对值。</li>
</ul>
<p>b. <strong>方向定向运动（Directional Movement）：</strong> 接下来，需要计算正方向定向运动（+DI）和负方向定向运动（-DI）。这些值用于测量上升和下降的趋势方向。+DI表示上升趋势方向，而-DI表示下降趋势方向。</p>
<p>c. <strong>方向定向运动指数（Directional Movement Index，DX）：</strong> DX是+DI和-DI之间的差值的绝对值除以它们的和的百分比。</p>
<p>d. <strong>平均方向定向运动指数（Average Directional Movement Index，ADX）：</strong> 最后，ADX是DX的移动平均线，通常使用14个周期的简单移动平均线。</p>
</li>
<li>
<p><strong>ADX的取值范围：</strong> ADX的值通常在0到100之间，表示市场趋势的强度。一般来说，ADX的值越高，趋势越强。当ADX的值高于25到30时，通常被视为趋势强度足够，可以考虑进行趋势跟随交易。当ADX的值低于25到20时，通常被视为市场处于非趋势状态，可能更适合进行区间交易或避免交易。</p>
</li>
<li>
<p><strong>ADX的应用：</strong> ADX可以用于以下方式：</p>
<ul>
<li>
<p><strong>确认趋势：</strong> ADX可以帮助交易者确认市场是否处于趋势状态。当ADX的值升高时，表示市场可能处于强烈的趋势中，可以考虑跟随趋势交易。反之，当ADX的值低时，市场可能处于震荡或横盘状态。</p>
</li>
<li>
<p><strong>评估趋势强度：</strong> ADX的值可以用来评估趋势的强度。较高的ADX值表示趋势更强烈，而较低的ADX值表示趋势较弱。</p>
</li>
<li>
<p><strong>确定交易策略：</strong> 交易者可以将ADX与其他技术指标结合使用，例如移动平均线或相对强度指标（RSI），来制定交易策略。</p>
</li>
</ul>
</li>
</ol>
<p>需要注意的是，ADX是一个延迟指标，因为它是基于一定周期的数据计算的。交易者应该将ADX与其他分析工具和风险管理策略一起使用，以作出明智的交易决策。</p>
<h3 id="2712多重时间框架分析multiple-time-frame-analysis">27.12：多重时间框架分析（Multiple Time Frame Analysis）</h3>
<p>多重时间框架分析（Multiple Time Frame Analysis）是一种广泛用于技术分析和交易决策的方法。它的基本理念是，在进行技术分析时，不仅要考虑单一的时间框架（例如日线图或小时图），而是要同时考虑多个不同时间周期的图表，以获得更全面的市场信息和更可靠的交易信号。多重时间框架分析有助于交易者更好地了解市场的大趋势、中期趋势和短期趋势，以便更明智地做出交易决策。</p>
<p>以下是多重时间框架分析的详细解释：</p>
<ol>
<li>
<p><strong>选择多个时间框架：</strong> 首先，交易者需要选择多个不同的时间框架来分析市场。通常，会选择长期、中期和短期时间框架，如日线图（长期）、4小时图（中期）和1小时图（短期）。</p>
</li>
<li>
<p><strong>分析长期趋势：</strong> 在最长时间框架上，交易者将查看市场的长期趋势。这有助于确定市场的主要趋势方向，例如是否是上升、下降或横盘。长期趋势分析通常涉及到趋势线、移动平均线和其他长期指标的使用。</p>
</li>
<li>
<p><strong>分析中期趋势：</strong> 在中期时间框架上，交易者将更详细地研究市场的中期趋势。这有助于确定长期趋势中的次要波动。中期趋势通常以几天到几周为单位。交易者可以使用各种技术工具，如MACD（移动平均收敛散度）或RSI（相对强弱指标）来分析中期趋势。</p>
</li>
<li>
<p><strong>分析短期趋势：</strong> 在短期时间框架上，交易者将更仔细地观察市场的短期波动。这有助于确定在中期和长期趋势中的适当入场和出场点。短期趋势通常以几小时到几天为单位。在这个时间框架上，交易者可能使用技术分析中的各种图形和信号，如头肩顶和双底，以及短期移动平均线。</p>
</li>
<li>
<p><strong>协调分析结果：</strong> 最后，交易者需要协调不同时间框架的分析结果。例如，如果长期趋势是上升的，中期趋势也是上升的，那么短期内出现的下跌可能只是短期波动，而不是反转趋势的信号。这种协调有助于避免错误的交易决策。</p>
</li>
</ol>
<p>多重时间框架分析的优势在于它提供了更全面的市场视角，有助于降低交易者因短期波动而做出的错误决策的风险。然而，这也需要更多的时间和分析工作，因此需要交易者有耐心和技术分析的知识。</p>
<p>最后，多重时间框架分析不是一种绝对的成功方法，而是一种帮助交易者更好地理解市场的工具。成功的交易还依赖于风险管理、资金管理和心理控制等其他因素。</p>
<h3 id="2713-指标的遴选和应用">27.13 指标的遴选和应用</h3>
<p>有这么多判断超卖超买的指标，到底该怎么选择呢？选择哪种指标来判断超买和超卖情况，以及其他技术分析工具，取决于你的个人偏好、交易策略和市场状况。以下是一些建议，帮助你在使用这些指标时作出明智的选择：</p>
<ol>
<li>
<p><strong>了解不同指标的原理和计算方法：</strong> 首先，你应该深入了解每个指标的工作原理、计算方式以及它们所衡量的市场特征。这将帮助你更好地理解它们在不同市场情况下的适用性。</p>
</li>
<li>
<p><strong>根据交易策略选择指标：</strong> 你的交易策略应该是决定使用哪些指标的关键因素。不同的策略可能需要不同类型的指标。例如，日内交易者可能更关心短期波动，而长期投资者可能更关心趋势的长期方向。</p>
</li>
<li>
<p><strong>多指标确认：</strong> 通常，不应该依赖单一指标来做出决策。相反，使用多个指标来确认信号，可以提高你的决策的可靠性。例如，当多个指标同时显示超买信号时，这可能更具说服力。</p>
</li>
<li>
<p><strong>了解市场条件：</strong> 不同的市场条件下，不同的指标可能更有效。在平静的市场中，可能更容易出现超买或超卖情况，而在趋势明显的市场中，其他趋势跟踪指标可能更有用。</p>
</li>
<li>
<p><strong>适应时间周期：</strong> 选择指标时，要考虑你所交易的时间周期。某些指标可能在较短时间框架上更为有效，而其他指标可能在较长时间框架上更为有效。</p>
</li>
<li>
<p><strong>实践和回测：</strong> 在真实市场之前，先在模拟环境中使用不同的指标进行回测和实践。这可以帮助你了解不同指标的表现，并找到最适合你的策略的指标组合。</p>
</li>
<li>
<p><strong>风险管理：</strong> 无论你选择哪些指标，都要记住风险管理的重要性。不要仅仅依赖指标来做出决策，而是将其作为整个交易计划的一部分。</p>
</li>
</ol>
<p>最终，选择哪些指标是一项个人化的决策，需要基于你的交易目标、风险承受能力和市场条件做出。建议与其他经验丰富的交易者交流，学习他们的方法，并根据自己的经验不断优化你的交易策略。</p>
<p>判断这些指标在回测中的表现需要进行系统性的分析和评估。以下是一些步骤，未来会帮助我们来评估指标在回测中的表现：</p>
<ol>
<li><strong>选择回测平台和数据源：</strong> 首先，选择一个可信赖的回测平台或软件，并获取高质量的历史市场数据。确保我们的回测环境与实际交易条件尽可能一致。</li>
<li><strong>制定明确的交易策略：</strong> 在回测之前，明确定义我们的交易策略，包括入场规则、出场规则、止损和止盈策略，以及资本管理规则。确保策略清晰且可操作。</li>
<li><strong>回测参数设置：</strong> 针对每个指标，设置适当的参数值。例如，对于RSI，我们可以测试不同的周期（通常是14天），并确定哪个周期在历史数据上表现最好。</li>
<li><strong>回测时间段：</strong> 选择一个适当的回测时间段，可以是几年或更长时间的历史数据。确保涵盖不同市场情况，包括趋势市和横盘市。</li>
<li><strong>执行回测：</strong> 使用所选的回测平台执行回测，根据我们的策略和参数值生成交易信号，并模拟实际交易。记录每笔交易的入场和出场价格、止损和止盈水平，以及交易成本（如手续费和滑点）。</li>
<li><strong>绩效度量：</strong> 评估回测的绩效。常见的绩效度量包括：
<ul>
<li><strong>累积回报率（Cumulative Returns）：</strong> 查看策略的总回报。</li>
<li><strong>胜率（Win Rate）：</strong> 计算获利交易的比例。</li>
<li><strong>最大回撤（Maximum Drawdown）：</strong> 识别策略在最差情况下可能遭受的损失。</li>
<li><strong>夏普比率（Sharpe Ratio）：</strong> 衡量每单位风险所产生的回报。</li>
<li><strong>年化回报率（Annualized Returns）：</strong> 将回报率 annualize 为年度水平。</li>
</ul>
</li>
<li><strong>优化参数：</strong> 如果回测结果不理想，可以尝试不同的参数组合或修改策略规则，然后重新进行回测，以寻找更好的表现。</li>
<li><strong>风险管理：</strong> 在回测中也要考虑风险管理策略，如止损和止盈水平的设置，以及头寸规模的管理。</li>
<li><strong>实时模拟测试：</strong> 最后，在回测表现良好后，进行实时模拟测试以验证策略在实际市场条件下的表现。</li>
</ol>
<p>不过最好还是要有这个意识——回测是一种有限制的模拟，不能保证未来表现与历史表现相同。市场条件会不断变化，因此，我建议我们应该将回测作为策略开发的一部分，而不是最终的唯一决策依据。此外，在未来我们要持续注意避免他和7th过度拟合（过度优化）的问题，不要过于依赖特定的参数组合，而是寻找稳健的策略。最好的方法是持续监测和优化我们的交易策略，以适应不断变化的市场。</p> </div> <footer class="astro-w7wtsaw6"> <div class="meta sl-flex astro-w7wtsaw6">   </div> <div class="pagination-links astro-qnftudm7" dir="ltr"> <a href="/chapters/chapter_23/" rel="prev" class="astro-qnftudm7"> <svg aria-hidden="true" class="astro-qnftudm7 astro-xrndq6a6" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.5rem;"><path d="M17 11H9.41l3.3-3.29a1.004 1.004 0 1 0-1.42-1.42l-5 5a1 1 0 0 0-.21.33 1 1 0 0 0 0 .76 1 1 0 0 0 .21.33l5 5a1.002 1.002 0 0 0 1.639-.325 1 1 0 0 0-.219-1.095L9.41 13H17a1 1 0 0 0 0-2Z"/></svg>  <span class="astro-qnftudm7"> Previous <br class="astro-qnftudm7"> <span class="link-title astro-qnftudm7">23. Polars 入门</span> </span> </a> <a href="/chapters/chapter_25/" rel="next" class="astro-qnftudm7"> <svg aria-hidden="true" class="astro-qnftudm7 astro-xrndq6a6" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.5rem;"><path d="M17.92 11.62a1.001 1.001 0 0 0-.21-.33l-5-5a1.003 1.003 0 1 0-1.42 1.42l3.3 3.29H7a1 1 0 0 0 0 2h7.59l-3.3 3.29a1.002 1.002 0 0 0 .325 1.639 1 1 0 0 0 1.095-.219l5-5a1 1 0 0 0 .21-.33 1 1 0 0 0 0-.76Z"/></svg>  <span class="astro-qnftudm7"> Next <br class="astro-qnftudm7"> <span class="link-title astro-qnftudm7">25. Unsafe【未完成】</span> </span> </a> </div>  </footer>  </div> </div>   </main> </div> </div>  </div> </div>  </body></html>